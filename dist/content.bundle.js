/*! For license information please see content.bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={7568:(t,e,r)=>{var i=e;i.bignum=r(2344),i.define=r(7363).define,i.base=r(9673),i.constants=r(2153),i.decoders=r(2853),i.encoders=r(4669)},7363:(t,e,r)=>{var i=r(7568),n=r(6698);function s(t,e){this.name=t,this.body=e,this.decoders={},this.encoders={}}e.define=function(t,e){return new s(t,e)},s.prototype._createNamed=function(t){var e;try{e=r(8961).runInThisContext("(function "+this.name+"(entity) {\n  this._initNamed(entity);\n})")}catch(t){e=function(t){this._initNamed(t)}}return n(e,t),e.prototype._initNamed=function(e){t.call(this,e)},new e(this)},s.prototype._getDecoder=function(t){return t=t||"der",this.decoders.hasOwnProperty(t)||(this.decoders[t]=this._createNamed(i.decoders[t])),this.decoders[t]},s.prototype.decode=function(t,e,r){return this._getDecoder(e).decode(t,r)},s.prototype._getEncoder=function(t){return t=t||"der",this.encoders.hasOwnProperty(t)||(this.encoders[t]=this._createNamed(i.encoders[t])),this.encoders[t]},s.prototype.encode=function(t,e,r){return this._getEncoder(e).encode(t,r)}},7227:(t,e,r)=>{var i=r(6698),n=r(9673).Reporter,s=r(8287).Buffer;function o(t,e){n.call(this,e),s.isBuffer(t)?(this.base=t,this.offset=0,this.length=t.length):this.error("Input not Buffer")}function a(t,e){if(Array.isArray(t))this.length=0,this.value=t.map((function(t){return t instanceof a||(t=new a(t,e)),this.length+=t.length,t}),this);else if("number"==typeof t){if(!(0<=t&&t<=255))return e.error("non-byte EncoderBuffer value");this.value=t,this.length=1}else if("string"==typeof t)this.value=t,this.length=s.byteLength(t);else{if(!s.isBuffer(t))return e.error("Unsupported type: "+typeof t);this.value=t,this.length=t.length}}i(o,n),e.t=o,o.prototype.save=function(){return{offset:this.offset,reporter:n.prototype.save.call(this)}},o.prototype.restore=function(t){var e=new o(this.base);return e.offset=t.offset,e.length=this.offset,this.offset=t.offset,n.prototype.restore.call(this,t.reporter),e},o.prototype.isEmpty=function(){return this.offset===this.length},o.prototype.readUInt8=function(t){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(t||"DecoderBuffer overrun")},o.prototype.skip=function(t,e){if(!(this.offset+t<=this.length))return this.error(e||"DecoderBuffer overrun");var r=new o(this.base);return r._reporterState=this._reporterState,r.offset=this.offset,r.length=this.offset+t,this.offset+=t,r},o.prototype.raw=function(t){return this.base.slice(t?t.offset:this.offset,this.length)},e.d=a,a.prototype.join=function(t,e){return t||(t=new s(this.length)),e||(e=0),0===this.length||(Array.isArray(this.value)?this.value.forEach((function(r){r.join(t,e),e+=r.length})):("number"==typeof this.value?t[e]=this.value:"string"==typeof this.value?t.write(this.value,e):s.isBuffer(this.value)&&this.value.copy(t,e),e+=this.length)),t}},9673:(t,e,r)=>{var i=e;i.Reporter=r(9220).a,i.DecoderBuffer=r(7227).t,i.EncoderBuffer=r(7227).d,i.Node=r(993)},993:(t,e,r)=>{var i=r(9673).Reporter,n=r(9673).EncoderBuffer,s=r(9673).DecoderBuffer,o=r(3349),a=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],h=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(a);function u(t,e){var r={};this._baseState=r,r.enc=t,r.parent=e||null,r.children=null,r.tag=null,r.args=null,r.reverseArgs=null,r.choice=null,r.optional=!1,r.any=!1,r.obj=!1,r.use=null,r.useDecoder=null,r.key=null,r.default=null,r.explicit=null,r.implicit=null,r.contains=null,r.parent||(r.children=[],this._wrap())}t.exports=u;var c=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];u.prototype.clone=function(){var t=this._baseState,e={};c.forEach((function(r){e[r]=t[r]}));var r=new this.constructor(e.parent);return r._baseState=e,r},u.prototype._wrap=function(){var t=this._baseState;h.forEach((function(e){this[e]=function(){var r=new this.constructor(this);return t.children.push(r),r[e].apply(r,arguments)}}),this)},u.prototype._init=function(t){var e=this._baseState;o(null===e.parent),t.call(this),e.children=e.children.filter((function(t){return t._baseState.parent===this}),this),o.equal(e.children.length,1,"Root node can have only one child")},u.prototype._useArgs=function(t){var e=this._baseState,r=t.filter((function(t){return t instanceof this.constructor}),this);t=t.filter((function(t){return!(t instanceof this.constructor)}),this),0!==r.length&&(o(null===e.children),e.children=r,r.forEach((function(t){t._baseState.parent=this}),this)),0!==t.length&&(o(null===e.args),e.args=t,e.reverseArgs=t.map((function(t){if("object"!=typeof t||t.constructor!==Object)return t;var e={};return Object.keys(t).forEach((function(r){r==(0|r)&&(r|=0);var i=t[r];e[i]=r})),e})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(t){u.prototype[t]=function(){var e=this._baseState;throw new Error(t+" not implemented for encoding: "+e.enc)}})),a.forEach((function(t){u.prototype[t]=function(){var e=this._baseState,r=Array.prototype.slice.call(arguments);return o(null===e.tag),e.tag=t,this._useArgs(r),this}})),u.prototype.use=function(t){o(t);var e=this._baseState;return o(null===e.use),e.use=t,this},u.prototype.optional=function(){return this._baseState.optional=!0,this},u.prototype.def=function(t){var e=this._baseState;return o(null===e.default),e.default=t,e.optional=!0,this},u.prototype.explicit=function(t){var e=this._baseState;return o(null===e.explicit&&null===e.implicit),e.explicit=t,this},u.prototype.implicit=function(t){var e=this._baseState;return o(null===e.explicit&&null===e.implicit),e.implicit=t,this},u.prototype.obj=function(){var t=this._baseState,e=Array.prototype.slice.call(arguments);return t.obj=!0,0!==e.length&&this._useArgs(e),this},u.prototype.key=function(t){var e=this._baseState;return o(null===e.key),e.key=t,this},u.prototype.any=function(){return this._baseState.any=!0,this},u.prototype.choice=function(t){var e=this._baseState;return o(null===e.choice),e.choice=t,this._useArgs(Object.keys(t).map((function(e){return t[e]}))),this},u.prototype.contains=function(t){var e=this._baseState;return o(null===e.use),e.contains=t,this},u.prototype._decode=function(t,e){var r=this._baseState;if(null===r.parent)return t.wrapResult(r.children[0]._decode(t,e));var i,n=r.default,o=!0,a=null;if(null!==r.key&&(a=t.enterKey(r.key)),r.optional){var h=null;if(null!==r.explicit?h=r.explicit:null!==r.implicit?h=r.implicit:null!==r.tag&&(h=r.tag),null!==h||r.any){if(o=this._peekTag(t,h,r.any),t.isError(o))return o}else{var u=t.save();try{null===r.choice?this._decodeGeneric(r.tag,t,e):this._decodeChoice(t,e),o=!0}catch(t){o=!1}t.restore(u)}}if(r.obj&&o&&(i=t.enterObject()),o){if(null!==r.explicit){var c=this._decodeTag(t,r.explicit);if(t.isError(c))return c;t=c}var l=t.offset;if(null===r.use&&null===r.choice){r.any&&(u=t.save());var d=this._decodeTag(t,null!==r.implicit?r.implicit:r.tag,r.any);if(t.isError(d))return d;r.any?n=t.raw(u):t=d}if(e&&e.track&&null!==r.tag&&e.track(t.path(),l,t.length,"tagged"),e&&e.track&&null!==r.tag&&e.track(t.path(),t.offset,t.length,"content"),r.any||(n=null===r.choice?this._decodeGeneric(r.tag,t,e):this._decodeChoice(t,e)),t.isError(n))return n;if(r.any||null!==r.choice||null===r.children||r.children.forEach((function(r){r._decode(t,e)})),r.contains&&("octstr"===r.tag||"bitstr"===r.tag)){var f=new s(n);n=this._getUse(r.contains,t._reporterState.obj)._decode(f,e)}}return r.obj&&o&&(n=t.leaveObject(i)),null===r.key||null===n&&!0!==o?null!==a&&t.exitKey(a):t.leaveKey(a,r.key,n),n},u.prototype._decodeGeneric=function(t,e,r){var i=this._baseState;return"seq"===t||"set"===t?null:"seqof"===t||"setof"===t?this._decodeList(e,t,i.args[0],r):/str$/.test(t)?this._decodeStr(e,t,r):"objid"===t&&i.args?this._decodeObjid(e,i.args[0],i.args[1],r):"objid"===t?this._decodeObjid(e,null,null,r):"gentime"===t||"utctime"===t?this._decodeTime(e,t,r):"null_"===t?this._decodeNull(e,r):"bool"===t?this._decodeBool(e,r):"objDesc"===t?this._decodeStr(e,t,r):"int"===t||"enum"===t?this._decodeInt(e,i.args&&i.args[0],r):null!==i.use?this._getUse(i.use,e._reporterState.obj)._decode(e,r):e.error("unknown tag: "+t)},u.prototype._getUse=function(t,e){var r=this._baseState;return r.useDecoder=this._use(t,e),o(null===r.useDecoder._baseState.parent),r.useDecoder=r.useDecoder._baseState.children[0],r.implicit!==r.useDecoder._baseState.implicit&&(r.useDecoder=r.useDecoder.clone(),r.useDecoder._baseState.implicit=r.implicit),r.useDecoder},u.prototype._decodeChoice=function(t,e){var r=this._baseState,i=null,n=!1;return Object.keys(r.choice).some((function(s){var o=t.save(),a=r.choice[s];try{var h=a._decode(t,e);if(t.isError(h))return!1;i={type:s,value:h},n=!0}catch(e){return t.restore(o),!1}return!0}),this),n?i:t.error("Choice not matched")},u.prototype._createEncoderBuffer=function(t){return new n(t,this.reporter)},u.prototype._encode=function(t,e,r){var i=this._baseState;if(null===i.default||i.default!==t){var n=this._encodeValue(t,e,r);if(void 0!==n&&!this._skipDefault(n,e,r))return n}},u.prototype._encodeValue=function(t,e,r){var n=this._baseState;if(null===n.parent)return n.children[0]._encode(t,e||new i);var s=null;if(this.reporter=e,n.optional&&void 0===t){if(null===n.default)return;t=n.default}var o=null,a=!1;if(n.any)s=this._createEncoderBuffer(t);else if(n.choice)s=this._encodeChoice(t,e);else if(n.contains)o=this._getUse(n.contains,r)._encode(t,e),a=!0;else if(n.children)o=n.children.map((function(r){if("null_"===r._baseState.tag)return r._encode(null,e,t);if(null===r._baseState.key)return e.error("Child should have a key");var i=e.enterKey(r._baseState.key);if("object"!=typeof t)return e.error("Child expected, but input is not object");var n=r._encode(t[r._baseState.key],e,t);return e.leaveKey(i),n}),this).filter((function(t){return t})),o=this._createEncoderBuffer(o);else if("seqof"===n.tag||"setof"===n.tag){if(!n.args||1!==n.args.length)return e.error("Too many args for : "+n.tag);if(!Array.isArray(t))return e.error("seqof/setof, but data is not Array");var h=this.clone();h._baseState.implicit=null,o=this._createEncoderBuffer(t.map((function(r){var i=this._baseState;return this._getUse(i.args[0],t)._encode(r,e)}),h))}else null!==n.use?s=this._getUse(n.use,r)._encode(t,e):(o=this._encodePrimitive(n.tag,t),a=!0);if(!n.any&&null===n.choice){var u=null!==n.implicit?n.implicit:n.tag,c=null===n.implicit?"universal":"context";null===u?null===n.use&&e.error("Tag could be omitted only for .use()"):null===n.use&&(s=this._encodeComposite(u,a,c,o))}return null!==n.explicit&&(s=this._encodeComposite(n.explicit,!1,"context",s)),s},u.prototype._encodeChoice=function(t,e){var r=this._baseState,i=r.choice[t.type];return i||o(!1,t.type+" not found in "+JSON.stringify(Object.keys(r.choice))),i._encode(t.value,e)},u.prototype._encodePrimitive=function(t,e){var r=this._baseState;if(/str$/.test(t))return this._encodeStr(e,t);if("objid"===t&&r.args)return this._encodeObjid(e,r.reverseArgs[0],r.args[1]);if("objid"===t)return this._encodeObjid(e,null,null);if("gentime"===t||"utctime"===t)return this._encodeTime(e,t);if("null_"===t)return this._encodeNull();if("int"===t||"enum"===t)return this._encodeInt(e,r.args&&r.reverseArgs[0]);if("bool"===t)return this._encodeBool(e);if("objDesc"===t)return this._encodeStr(e,t);throw new Error("Unsupported tag: "+t)},u.prototype._isNumstr=function(t){return/^[0-9 ]*$/.test(t)},u.prototype._isPrintstr=function(t){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(t)}},9220:(t,e,r)=>{var i=r(6698);function n(t){this._reporterState={obj:null,path:[],options:t||{},errors:[]}}function s(t,e){this.path=t,this.rethrow(e)}e.a=n,n.prototype.isError=function(t){return t instanceof s},n.prototype.save=function(){var t=this._reporterState;return{obj:t.obj,pathLen:t.path.length}},n.prototype.restore=function(t){var e=this._reporterState;e.obj=t.obj,e.path=e.path.slice(0,t.pathLen)},n.prototype.enterKey=function(t){return this._reporterState.path.push(t)},n.prototype.exitKey=function(t){var e=this._reporterState;e.path=e.path.slice(0,t-1)},n.prototype.leaveKey=function(t,e,r){var i=this._reporterState;this.exitKey(t),null!==i.obj&&(i.obj[e]=r)},n.prototype.path=function(){return this._reporterState.path.join("/")},n.prototype.enterObject=function(){var t=this._reporterState,e=t.obj;return t.obj={},e},n.prototype.leaveObject=function(t){var e=this._reporterState,r=e.obj;return e.obj=t,r},n.prototype.error=function(t){var e,r=this._reporterState,i=t instanceof s;if(e=i?t:new s(r.path.map((function(t){return"["+JSON.stringify(t)+"]"})).join(""),t.message||t,t.stack),!r.options.partial)throw e;return i||r.errors.push(e),e},n.prototype.wrapResult=function(t){var e=this._reporterState;return e.options.partial?{result:this.isError(t)?null:t,errors:e.errors}:t},i(s,Error),s.prototype.rethrow=function(t){if(this.message=t+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,s),!this.stack)try{throw new Error(this.message)}catch(t){this.stack=t.stack}return this}},4598:(t,e,r)=>{var i=r(2153);e.tagClass={0:"universal",1:"application",2:"context",3:"private"},e.tagClassByName=i._reverse(e.tagClass),e.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},e.tagByName=i._reverse(e.tag)},2153:(t,e,r)=>{var i=e;i._reverse=function(t){var e={};return Object.keys(t).forEach((function(r){(0|r)==r&&(r|=0);var i=t[r];e[i]=r})),e},i.der=r(4598)},2010:(t,e,r)=>{var i=r(6698),n=r(7568),s=n.base,o=n.bignum,a=n.constants.der;function h(t){this.enc="der",this.name=t.name,this.entity=t,this.tree=new u,this.tree._init(t.body)}function u(t){s.Node.call(this,"der",t)}function c(t,e){var r=t.readUInt8(e);if(t.isError(r))return r;var i=a.tagClass[r>>6],n=!(32&r);if(31&~r)r&=31;else{var s=r;for(r=0;!(128&~s);){if(s=t.readUInt8(e),t.isError(s))return s;r<<=7,r|=127&s}}return{cls:i,primitive:n,tag:r,tagStr:a.tag[r]}}function l(t,e,r){var i=t.readUInt8(r);if(t.isError(i))return i;if(!e&&128===i)return null;if(!(128&i))return i;var n=127&i;if(n>4)return t.error("length octect is too long");i=0;for(var s=0;s<n;s++){i<<=8;var o=t.readUInt8(r);if(t.isError(o))return o;i|=o}return i}t.exports=h,h.prototype.decode=function(t,e){return t instanceof s.DecoderBuffer||(t=new s.DecoderBuffer(t,e)),this.tree._decode(t,e)},i(u,s.Node),u.prototype._peekTag=function(t,e,r){if(t.isEmpty())return!1;var i=t.save(),n=c(t,'Failed to peek tag: "'+e+'"');return t.isError(n)?n:(t.restore(i),n.tag===e||n.tagStr===e||n.tagStr+"of"===e||r)},u.prototype._decodeTag=function(t,e,r){var i=c(t,'Failed to decode tag of "'+e+'"');if(t.isError(i))return i;var n=l(t,i.primitive,'Failed to get length of "'+e+'"');if(t.isError(n))return n;if(!r&&i.tag!==e&&i.tagStr!==e&&i.tagStr+"of"!==e)return t.error('Failed to match tag: "'+e+'"');if(i.primitive||null!==n)return t.skip(n,'Failed to match body of: "'+e+'"');var s=t.save(),o=this._skipUntilEnd(t,'Failed to skip indefinite length body: "'+this.tag+'"');return t.isError(o)?o:(n=t.offset-s.offset,t.restore(s),t.skip(n,'Failed to match body of: "'+e+'"'))},u.prototype._skipUntilEnd=function(t,e){for(;;){var r=c(t,e);if(t.isError(r))return r;var i,n=l(t,r.primitive,e);if(t.isError(n))return n;if(i=r.primitive||null!==n?t.skip(n):this._skipUntilEnd(t,e),t.isError(i))return i;if("end"===r.tagStr)break}},u.prototype._decodeList=function(t,e,r,i){for(var n=[];!t.isEmpty();){var s=this._peekTag(t,"end");if(t.isError(s))return s;var o=r.decode(t,"der",i);if(t.isError(o)&&s)break;n.push(o)}return n},u.prototype._decodeStr=function(t,e){if("bitstr"===e){var r=t.readUInt8();return t.isError(r)?r:{unused:r,data:t.raw()}}if("bmpstr"===e){var i=t.raw();if(i.length%2==1)return t.error("Decoding of string type: bmpstr length mismatch");for(var n="",s=0;s<i.length/2;s++)n+=String.fromCharCode(i.readUInt16BE(2*s));return n}if("numstr"===e){var o=t.raw().toString("ascii");return this._isNumstr(o)?o:t.error("Decoding of string type: numstr unsupported characters")}if("octstr"===e)return t.raw();if("objDesc"===e)return t.raw();if("printstr"===e){var a=t.raw().toString("ascii");return this._isPrintstr(a)?a:t.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(e)?t.raw().toString():t.error("Decoding of string type: "+e+" unsupported")},u.prototype._decodeObjid=function(t,e,r){for(var i,n=[],s=0;!t.isEmpty();){var o=t.readUInt8();s<<=7,s|=127&o,128&o||(n.push(s),s=0)}128&o&&n.push(s);var a=n[0]/40|0,h=n[0]%40;if(i=r?n:[a,h].concat(n.slice(1)),e){var u=e[i.join(" ")];void 0===u&&(u=e[i.join(".")]),void 0!==u&&(i=u)}return i},u.prototype._decodeTime=function(t,e){var r=t.raw().toString();if("gentime"===e)var i=0|r.slice(0,4),n=0|r.slice(4,6),s=0|r.slice(6,8),o=0|r.slice(8,10),a=0|r.slice(10,12),h=0|r.slice(12,14);else{if("utctime"!==e)return t.error("Decoding "+e+" time is not supported yet");i=0|r.slice(0,2),n=0|r.slice(2,4),s=0|r.slice(4,6),o=0|r.slice(6,8),a=0|r.slice(8,10),h=0|r.slice(10,12),i=i<70?2e3+i:1900+i}return Date.UTC(i,n-1,s,o,a,h,0)},u.prototype._decodeNull=function(t){return null},u.prototype._decodeBool=function(t){var e=t.readUInt8();return t.isError(e)?e:0!==e},u.prototype._decodeInt=function(t,e){var r=t.raw(),i=new o(r);return e&&(i=e[i.toString(10)]||i),i},u.prototype._use=function(t,e){return"function"==typeof t&&(t=t(e)),t._getDecoder("der").tree}},2853:(t,e,r)=>{var i=e;i.der=r(2010),i.pem=r(8903)},8903:(t,e,r)=>{var i=r(6698),n=r(8287).Buffer,s=r(2010);function o(t){s.call(this,t),this.enc="pem"}i(o,s),t.exports=o,o.prototype.decode=function(t,e){for(var r=t.toString().split(/[\r\n]+/g),i=e.label.toUpperCase(),o=/^-----(BEGIN|END) ([^-]+)-----$/,a=-1,h=-1,u=0;u<r.length;u++){var c=r[u].match(o);if(null!==c&&c[2]===i){if(-1!==a){if("END"!==c[1])break;h=u;break}if("BEGIN"!==c[1])break;a=u}}if(-1===a||-1===h)throw new Error("PEM section not found for: "+i);var l=r.slice(a+1,h).join("");l.replace(/[^a-z0-9\+\/=]+/gi,"");var d=new n(l,"base64");return s.prototype.decode.call(this,d,e)}},82:(t,e,r)=>{var i=r(6698),n=r(8287).Buffer,s=r(7568),o=s.base,a=s.constants.der;function h(t){this.enc="der",this.name=t.name,this.entity=t,this.tree=new u,this.tree._init(t.body)}function u(t){o.Node.call(this,"der",t)}function c(t){return t<10?"0"+t:t}t.exports=h,h.prototype.encode=function(t,e){return this.tree._encode(t,e).join()},i(u,o.Node),u.prototype._encodeComposite=function(t,e,r,i){var s,o=function(t,e,r,i){var n;if("seqof"===t?t="seq":"setof"===t&&(t="set"),a.tagByName.hasOwnProperty(t))n=a.tagByName[t];else{if("number"!=typeof t||(0|t)!==t)return i.error("Unknown tag: "+t);n=t}return n>=31?i.error("Multi-octet tag encoding unsupported"):(e||(n|=32),n|=a.tagClassByName[r||"universal"]<<6)}(t,e,r,this.reporter);if(i.length<128)return(s=new n(2))[0]=o,s[1]=i.length,this._createEncoderBuffer([s,i]);for(var h=1,u=i.length;u>=256;u>>=8)h++;(s=new n(2+h))[0]=o,s[1]=128|h,u=1+h;for(var c=i.length;c>0;u--,c>>=8)s[u]=255&c;return this._createEncoderBuffer([s,i])},u.prototype._encodeStr=function(t,e){if("bitstr"===e)return this._createEncoderBuffer([0|t.unused,t.data]);if("bmpstr"===e){for(var r=new n(2*t.length),i=0;i<t.length;i++)r.writeUInt16BE(t.charCodeAt(i),2*i);return this._createEncoderBuffer(r)}return"numstr"===e?this._isNumstr(t)?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===e?this._isPrintstr(t)?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(e)||"objDesc"===e?this._createEncoderBuffer(t):this.reporter.error("Encoding of string type: "+e+" unsupported")},u.prototype._encodeObjid=function(t,e,r){if("string"==typeof t){if(!e)return this.reporter.error("string objid given, but no values map found");if(!e.hasOwnProperty(t))return this.reporter.error("objid not found in values map");t=e[t].split(/[\s\.]+/g);for(var i=0;i<t.length;i++)t[i]|=0}else if(Array.isArray(t))for(t=t.slice(),i=0;i<t.length;i++)t[i]|=0;if(!Array.isArray(t))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(t));if(!r){if(t[1]>=40)return this.reporter.error("Second objid identifier OOB");t.splice(0,2,40*t[0]+t[1])}var s=0;for(i=0;i<t.length;i++){var o=t[i];for(s++;o>=128;o>>=7)s++}var a=new n(s),h=a.length-1;for(i=t.length-1;i>=0;i--)for(o=t[i],a[h--]=127&o;(o>>=7)>0;)a[h--]=128|127&o;return this._createEncoderBuffer(a)},u.prototype._encodeTime=function(t,e){var r,i=new Date(t);return"gentime"===e?r=[c(i.getFullYear()),c(i.getUTCMonth()+1),c(i.getUTCDate()),c(i.getUTCHours()),c(i.getUTCMinutes()),c(i.getUTCSeconds()),"Z"].join(""):"utctime"===e?r=[c(i.getFullYear()%100),c(i.getUTCMonth()+1),c(i.getUTCDate()),c(i.getUTCHours()),c(i.getUTCMinutes()),c(i.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+e+" time is not supported yet"),this._encodeStr(r,"octstr")},u.prototype._encodeNull=function(){return this._createEncoderBuffer("")},u.prototype._encodeInt=function(t,e){if("string"==typeof t){if(!e)return this.reporter.error("String int or enum given, but no values map");if(!e.hasOwnProperty(t))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(t));t=e[t]}if("number"!=typeof t&&!n.isBuffer(t)){var r=t.toArray();!t.sign&&128&r[0]&&r.unshift(0),t=new n(r)}if(n.isBuffer(t)){var i=t.length;0===t.length&&i++;var s=new n(i);return t.copy(s),0===t.length&&(s[0]=0),this._createEncoderBuffer(s)}if(t<128)return this._createEncoderBuffer(t);if(t<256)return this._createEncoderBuffer([0,t]);i=1;for(var o=t;o>=256;o>>=8)i++;for(o=(s=new Array(i)).length-1;o>=0;o--)s[o]=255&t,t>>=8;return 128&s[0]&&s.unshift(0),this._createEncoderBuffer(new n(s))},u.prototype._encodeBool=function(t){return this._createEncoderBuffer(t?255:0)},u.prototype._use=function(t,e){return"function"==typeof t&&(t=t(e)),t._getEncoder("der").tree},u.prototype._skipDefault=function(t,e,r){var i,n=this._baseState;if(null===n.default)return!1;var s=t.join();if(void 0===n.defaultBuffer&&(n.defaultBuffer=this._encodeValue(n.default,e,r).join()),s.length!==n.defaultBuffer.length)return!1;for(i=0;i<s.length;i++)if(s[i]!==n.defaultBuffer[i])return!1;return!0}},4669:(t,e,r)=>{var i=e;i.der=r(82),i.pem=r(735)},735:(t,e,r)=>{var i=r(6698),n=r(82);function s(t){n.call(this,t),this.enc="pem"}i(s,n),t.exports=s,s.prototype.encode=function(t,e){for(var r=n.prototype.encode.call(this,t).toString("base64"),i=["-----BEGIN "+e.label+"-----"],s=0;s<r.length;s+=64)i.push(r.slice(s,s+64));return i.push("-----END "+e.label+"-----"),i.join("\n")}},2344:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(8982).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,i){for(var n=0,s=Math.min(t.length,r),o=e;o<s;o++){var a=t.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?c[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=l[t],f=d[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(t);r=(p=p.idivn(f)).isZero()?m+r:c[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return i(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,u=new t(s),c=this.clone();if(h){for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function m(t,e,r){return(new g).mulp(t,e,r)}function g(t,e){this.x=t,this.y=e}Math.imul||(p=f),s.prototype.mulTo=function(t,e){var r,i=this.length+t.length;return r=10===this.length&&10===t.length?p(this,t,e):i<63?f(this,t,e):i<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,t,e):m(this,t,e),r},g.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},g.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},g.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},g.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},g.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},g.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},g.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},g.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},g.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),m(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){i("number"==typeof t),i(t<67108864);for(var e=0,r=0;r<this.length;r++){var n=(0|this.words[r])*t,s=(67108863&n)+(67108863&e);e>>=26,e+=n/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=(t.words[i]&1<<n)>>>n}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a.strip(),i.strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){i(t<=67108863);for(var e=(1<<26)%t,r=0,n=this.length-1;n>=0;n--)r=(e*r+(0|this.words[n]))%t;return r},s.prototype.idivn=function(t){i(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*e;this.words[r]=n/t|0,e=n%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new S(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){S.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},n(v,y),v.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(w,y),n(M,y),n(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return b[t]=e,e},S.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},S.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},S.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},S.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},S.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},S.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},S.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},S.prototype.isqr=function(t){return this.imul(t,t.clone())},S.prototype.sqr=function(t){return this.mul(t,t)},S.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},S.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},S.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},S.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},S.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new E(t)},n(E,S),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},7526:(t,e)=>{"use strict";e.byteLength=function(t){var e=a(t),r=e[0],i=e[1];return 3*(r+i)/4-i},e.toByteArray=function(t){var e,r,s=a(t),o=s[0],h=s[1],u=new n(function(t,e,r){return 3*(e+r)/4-r}(0,o,h)),c=0,l=h>0?o-4:o;for(r=0;r<l;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],u[c++]=e>>16&255,u[c++]=e>>8&255,u[c++]=255&e;return 2===h&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,u[c++]=255&e),1===h&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,u[c++]=e>>8&255,u[c++]=255&e),u},e.fromByteArray=function(t){for(var e,i=t.length,n=i%3,s=[],o=16383,a=0,u=i-n;a<u;a+=o)s.push(h(t,a,a+o>u?u:a+o));return 1===n?(e=t[i-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===n&&(e=(t[i-2]<<8)+t[i-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=s[o],i[s.charCodeAt(o)]=o;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t,e,i){for(var n,s,o=[],a=e;a<i;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(r[(s=n)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},9404:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(7790).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=48&&r<=57?r-48:r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:void i(!1,"Invalid character in "+t)}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,n){for(var s=0,o=0,a=Math.min(t.length,r),h=e;h<a;h++){var u=t.charCodeAt(h)-48;s*=n,o=u>=49?u-49+10:u>=17?u-17+10:u,i(u>=0&&o<n,"Invalid character"),s+=o}return s}function c(t,e){t.words=e.words,t.length=e.length,t.negative=e.negative,t.red=e.red}if(s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this._strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this._strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this._strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype._move=function(t){c(t,this)},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for)try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=l}catch(t){s.prototype.inspect=l}else s.prototype.inspect=l;function l(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var d=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],f=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],p=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function m(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r._strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?d[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=f[t],c=p[t];r="";var l=this.clone();for(l.negative=0;!l.isZero();){var m=l.modrn(c).toString(t);r=(l=l.idivn(c)).isZero()?m+r:d[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(t,e){return this.toArrayLike(o,t,e)}),s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){this._strip();var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0");var o=function(t,e){return t.allocUnsafe?t.allocUnsafe(e):new t(e)}(t,s);return this["_toArrayLike"+("le"===e?"LE":"BE")](o,n),o},s.prototype._toArrayLikeLE=function(t,e){for(var r=0,i=0,n=0,s=0;n<this.length;n++){var o=this.words[n]<<s|i;t[r++]=255&o,r<t.length&&(t[r++]=o>>8&255),r<t.length&&(t[r++]=o>>16&255),6===s?(r<t.length&&(t[r++]=o>>24&255),i=0,s=0):(i=o>>>24,s+=2)}if(r<t.length)for(t[r++]=i;r<t.length;)t[r++]=0},s.prototype._toArrayLikeBE=function(t,e){for(var r=t.length-1,i=0,n=0,s=0;n<this.length;n++){var o=this.words[n]<<s|i;t[r--]=255&o,r>=0&&(t[r--]=o>>8&255),r>=0&&(t[r--]=o>>16&255),6===s?(r>=0&&(t[r--]=o>>24&255),i=0,s=0):(i=o>>>24,s+=2)}if(r>=0)for(t[r--]=i;r>=0;)t[r--]=0},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this._strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this._strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this._strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this._strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this._strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var g=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function b(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r._strip()}function y(t,e,r){return b(t,e,r)}function v(t,e){this.x=t,this.y=e}Math.imul||(g=m),s.prototype.mulTo=function(t,e){var r=this.length+t.length;return 10===this.length&&10===t.length?g(this,t,e):r<63?m(this,t,e):r<1024?b(this,t,e):y(this,t,e)},v.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},v.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},v.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},v.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},v.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},v.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},v.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},v.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},v.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},v.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r._strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),y(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){var e=t<0;e&&(t=-t),i("number"==typeof t),i(t<67108864);for(var r=0,n=0;n<this.length;n++){var s=(0|this.words[n])*t,o=(67108863&s)+(67108863&r);r>>=26,r+=s/67108864|0,r+=o>>>26,this.words[n]=67108863&o}return 0!==r&&(this.words[n]=r,this.length++),e?this.ineg():this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=t.words[i]>>>n&1}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this._strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this._strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<=t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this._strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this._strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this._strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a._strip(),i._strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modrn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modrn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modrn=function(t){var e=t<0;e&&(t=-t),i(t<=67108863);for(var r=(1<<26)%t,n=0,s=this.length-1;s>=0;s--)n=(r*n+(0|this.words[s]))%t;return e?-n:n},s.prototype.modn=function(t){return this.modrn(t)},s.prototype.idivn=function(t){var e=t<0;e&&(t=-t),i(t<=67108863);for(var r=0,n=this.length-1;n>=0;n--){var s=(0|this.words[n])+67108864*r;this.words[n]=s/t|0,r=s%t}return this._strip(),e?this.ineg():this},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this._strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new A(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var w={k256:null,p224:null,p192:null,p25519:null};function M(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function _(){M.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function S(){M.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function E(){M.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){M.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function A(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function I(t){A.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}M.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},M.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},M.prototype.split=function(t,e){t.iushrn(this.n,0,e)},M.prototype.imulK=function(t){return t.imul(this.k)},n(_,M),_.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},_.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(S,M),n(E,M),n(k,M),k.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(w[t])return w[t];var e;if("k256"===t)e=new _;else if("p224"===t)e=new S;else if("p192"===t)e=new E;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new k}return w[t]=e,e},A.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},A.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},A.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):(c(t,t.umod(this.m)._forceRed(this)),t)},A.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},A.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},A.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},A.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},A.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},A.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},A.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},A.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},A.prototype.isqr=function(t){return this.imul(t,t.clone())},A.prototype.sqr=function(t){return this.mul(t,t)},A.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},A.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},A.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},A.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},A.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new I(t)},n(I,A),I.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},I.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},I.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},I.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},I.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},5037:(t,e,r)=>{var i;function n(t){this.rand=t}if(t.exports=function(t){return i||(i=new n(null)),i.generate(t)},t.exports.Rand=n,n.prototype.generate=function(t){return this._rand(t)},n.prototype._rand=function(t){if(this.rand.getBytes)return this.rand.getBytes(t);for(var e=new Uint8Array(t),r=0;r<e.length;r++)e[r]=this.rand.getByte();return e},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?n.prototype._rand=function(t){var e=new Uint8Array(t);return self.crypto.getRandomValues(e),e}:self.msCrypto&&self.msCrypto.getRandomValues?n.prototype._rand=function(t){var e=new Uint8Array(t);return self.msCrypto.getRandomValues(e),e}:"object"==typeof window&&(n.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var s=r(3776);if("function"!=typeof s.randomBytes)throw new Error("Not supported");n.prototype._rand=function(t){return s.randomBytes(t)}}catch(t){}},462:(t,e,r)=>{var i=r(2861).Buffer;function n(t){i.isBuffer(t)||(t=i.from(t));for(var e=t.length/4|0,r=new Array(e),n=0;n<e;n++)r[n]=t.readUInt32BE(4*n);return r}function s(t){for(;0<t.length;t++)t[0]=0}function o(t,e,r,i,n){for(var s,o,a,h,u=r[0],c=r[1],l=r[2],d=r[3],f=t[0]^e[0],p=t[1]^e[1],m=t[2]^e[2],g=t[3]^e[3],b=4,y=1;y<n;y++)s=u[f>>>24]^c[p>>>16&255]^l[m>>>8&255]^d[255&g]^e[b++],o=u[p>>>24]^c[m>>>16&255]^l[g>>>8&255]^d[255&f]^e[b++],a=u[m>>>24]^c[g>>>16&255]^l[f>>>8&255]^d[255&p]^e[b++],h=u[g>>>24]^c[f>>>16&255]^l[p>>>8&255]^d[255&m]^e[b++],f=s,p=o,m=a,g=h;return s=(i[f>>>24]<<24|i[p>>>16&255]<<16|i[m>>>8&255]<<8|i[255&g])^e[b++],o=(i[p>>>24]<<24|i[m>>>16&255]<<16|i[g>>>8&255]<<8|i[255&f])^e[b++],a=(i[m>>>24]<<24|i[g>>>16&255]<<16|i[f>>>8&255]<<8|i[255&p])^e[b++],h=(i[g>>>24]<<24|i[f>>>16&255]<<16|i[p>>>8&255]<<8|i[255&m])^e[b++],[s>>>=0,o>>>=0,a>>>=0,h>>>=0]}var a=[0,1,2,4,8,16,32,64,128,27,54],h=function(){for(var t=new Array(256),e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;for(var r=[],i=[],n=[[],[],[],[]],s=[[],[],[],[]],o=0,a=0,h=0;h<256;++h){var u=a^a<<1^a<<2^a<<3^a<<4;u=u>>>8^255&u^99,r[o]=u,i[u]=o;var c=t[o],l=t[c],d=t[l],f=257*t[u]^16843008*u;n[0][o]=f<<24|f>>>8,n[1][o]=f<<16|f>>>16,n[2][o]=f<<8|f>>>24,n[3][o]=f,f=16843009*d^65537*l^257*c^16843008*o,s[0][u]=f<<24|f>>>8,s[1][u]=f<<16|f>>>16,s[2][u]=f<<8|f>>>24,s[3][u]=f,0===o?o=a=1:(o=c^t[t[t[d^c]]],a^=t[t[a]])}return{SBOX:r,INV_SBOX:i,SUB_MIX:n,INV_SUB_MIX:s}}();function u(t){this._key=n(t),this._reset()}u.blockSize=16,u.keySize=32,u.prototype.blockSize=u.blockSize,u.prototype.keySize=u.keySize,u.prototype._reset=function(){for(var t=this._key,e=t.length,r=e+6,i=4*(r+1),n=[],s=0;s<e;s++)n[s]=t[s];for(s=e;s<i;s++){var o=n[s-1];s%e==0?(o=o<<8|o>>>24,o=h.SBOX[o>>>24]<<24|h.SBOX[o>>>16&255]<<16|h.SBOX[o>>>8&255]<<8|h.SBOX[255&o],o^=a[s/e|0]<<24):e>6&&s%e==4&&(o=h.SBOX[o>>>24]<<24|h.SBOX[o>>>16&255]<<16|h.SBOX[o>>>8&255]<<8|h.SBOX[255&o]),n[s]=n[s-e]^o}for(var u=[],c=0;c<i;c++){var l=i-c,d=n[l-(c%4?0:4)];u[c]=c<4||l<=4?d:h.INV_SUB_MIX[0][h.SBOX[d>>>24]]^h.INV_SUB_MIX[1][h.SBOX[d>>>16&255]]^h.INV_SUB_MIX[2][h.SBOX[d>>>8&255]]^h.INV_SUB_MIX[3][h.SBOX[255&d]]}this._nRounds=r,this._keySchedule=n,this._invKeySchedule=u},u.prototype.encryptBlockRaw=function(t){return o(t=n(t),this._keySchedule,h.SUB_MIX,h.SBOX,this._nRounds)},u.prototype.encryptBlock=function(t){var e=this.encryptBlockRaw(t),r=i.allocUnsafe(16);return r.writeUInt32BE(e[0],0),r.writeUInt32BE(e[1],4),r.writeUInt32BE(e[2],8),r.writeUInt32BE(e[3],12),r},u.prototype.decryptBlock=function(t){var e=(t=n(t))[1];t[1]=t[3],t[3]=e;var r=o(t,this._invKeySchedule,h.INV_SUB_MIX,h.INV_SBOX,this._nRounds),s=i.allocUnsafe(16);return s.writeUInt32BE(r[0],0),s.writeUInt32BE(r[3],4),s.writeUInt32BE(r[2],8),s.writeUInt32BE(r[1],12),s},u.prototype.scrub=function(){s(this._keySchedule),s(this._invKeySchedule),s(this._key)},t.exports.AES=u},2356:(t,e,r)=>{var i=r(462),n=r(2861).Buffer,s=r(6168),o=r(6698),a=r(5892),h=r(295),u=r(5122);function c(t,e,r,o){s.call(this);var h=n.alloc(4,0);this._cipher=new i.AES(e);var c=this._cipher.encryptBlock(h);this._ghash=new a(c),r=function(t,e,r){if(12===e.length)return t._finID=n.concat([e,n.from([0,0,0,1])]),n.concat([e,n.from([0,0,0,2])]);var i=new a(r),s=e.length,o=s%16;i.update(e),o&&(o=16-o,i.update(n.alloc(o,0))),i.update(n.alloc(8,0));var h=8*s,c=n.alloc(8);c.writeUIntBE(h,0,8),i.update(c),t._finID=i.state;var l=n.from(t._finID);return u(l),l}(this,r,c),this._prev=n.from(r),this._cache=n.allocUnsafe(0),this._secCache=n.allocUnsafe(0),this._decrypt=o,this._alen=0,this._len=0,this._mode=t,this._authTag=null,this._called=!1}o(c,s),c.prototype._update=function(t){if(!this._called&&this._alen){var e=16-this._alen%16;e<16&&(e=n.alloc(e,0),this._ghash.update(e))}this._called=!0;var r=this._mode.encrypt(this,t);return this._decrypt?this._ghash.update(t):this._ghash.update(r),this._len+=t.length,r},c.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var t=h(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(t,e){var r=0;t.length!==e.length&&r++;for(var i=Math.min(t.length,e.length),n=0;n<i;++n)r+=t[n]^e[n];return r}(t,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=t,this._cipher.scrub()},c.prototype.getAuthTag=function(){if(this._decrypt||!n.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},c.prototype.setAuthTag=function(t){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=t},c.prototype.setAAD=function(t){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(t),this._alen+=t.length},t.exports=c},1241:(t,e,r)=>{var i=r(5799),n=r(6171),s=r(3219);e.createCipher=e.Cipher=i.createCipher,e.createCipheriv=e.Cipheriv=i.createCipheriv,e.createDecipher=e.Decipher=n.createDecipher,e.createDecipheriv=e.Decipheriv=n.createDecipheriv,e.listCiphers=e.getCiphers=function(){return Object.keys(s)}},6171:(t,e,r)=>{var i=r(2356),n=r(2861).Buffer,s=r(530),o=r(650),a=r(6168),h=r(462),u=r(8078);function c(t,e,r){a.call(this),this._cache=new l,this._last=void 0,this._cipher=new h.AES(e),this._prev=n.from(r),this._mode=t,this._autopadding=!0}function l(){this.cache=n.allocUnsafe(0)}function d(t,e,r){var a=s[t.toLowerCase()];if(!a)throw new TypeError("invalid suite type");if("string"==typeof r&&(r=n.from(r)),"GCM"!==a.mode&&r.length!==a.iv)throw new TypeError("invalid iv length "+r.length);if("string"==typeof e&&(e=n.from(e)),e.length!==a.key/8)throw new TypeError("invalid key length "+e.length);return"stream"===a.type?new o(a.module,e,r,!0):"auth"===a.type?new i(a.module,e,r,!0):new c(a.module,e,r)}r(6698)(c,a),c.prototype._update=function(t){var e,r;this._cache.add(t);for(var i=[];e=this._cache.get(this._autopadding);)r=this._mode.decrypt(this,e),i.push(r);return n.concat(i)},c.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return function(t){var e=t[15];if(e<1||e>16)throw new Error("unable to decrypt data");for(var r=-1;++r<e;)if(t[r+(16-e)]!==e)throw new Error("unable to decrypt data");if(16!==e)return t.slice(0,16-e)}(this._mode.decrypt(this,t));if(t)throw new Error("data not multiple of block length")},c.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},l.prototype.add=function(t){this.cache=n.concat([this.cache,t])},l.prototype.get=function(t){var e;if(t){if(this.cache.length>16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e}else if(this.cache.length>=16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e;return null},l.prototype.flush=function(){if(this.cache.length)return this.cache},e.createDecipher=function(t,e){var r=s[t.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var i=u(e,!1,r.key,r.iv);return d(t,i.key,i.iv)},e.createDecipheriv=d},5799:(t,e,r)=>{var i=r(530),n=r(2356),s=r(2861).Buffer,o=r(650),a=r(6168),h=r(462),u=r(8078);function c(t,e,r){a.call(this),this._cache=new d,this._cipher=new h.AES(e),this._prev=s.from(r),this._mode=t,this._autopadding=!0}r(6698)(c,a),c.prototype._update=function(t){var e,r;this._cache.add(t);for(var i=[];e=this._cache.get();)r=this._mode.encrypt(this,e),i.push(r);return s.concat(i)};var l=s.alloc(16,16);function d(){this.cache=s.allocUnsafe(0)}function f(t,e,r){var a=i[t.toLowerCase()];if(!a)throw new TypeError("invalid suite type");if("string"==typeof e&&(e=s.from(e)),e.length!==a.key/8)throw new TypeError("invalid key length "+e.length);if("string"==typeof r&&(r=s.from(r)),"GCM"!==a.mode&&r.length!==a.iv)throw new TypeError("invalid iv length "+r.length);return"stream"===a.type?new o(a.module,e,r):"auth"===a.type?new n(a.module,e,r):new c(a.module,e,r)}c.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return t=this._mode.encrypt(this,t),this._cipher.scrub(),t;if(!t.equals(l))throw this._cipher.scrub(),new Error("data not multiple of block length")},c.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},d.prototype.add=function(t){this.cache=s.concat([this.cache,t])},d.prototype.get=function(){if(this.cache.length>15){var t=this.cache.slice(0,16);return this.cache=this.cache.slice(16),t}return null},d.prototype.flush=function(){for(var t=16-this.cache.length,e=s.allocUnsafe(t),r=-1;++r<t;)e.writeUInt8(t,r);return s.concat([this.cache,e])},e.createCipheriv=f,e.createCipher=function(t,e){var r=i[t.toLowerCase()];if(!r)throw new TypeError("invalid suite type");var n=u(e,!1,r.key,r.iv);return f(t,n.key,n.iv)}},5892:(t,e,r)=>{var i=r(2861).Buffer,n=i.alloc(16,0);function s(t){var e=i.allocUnsafe(16);return e.writeUInt32BE(t[0]>>>0,0),e.writeUInt32BE(t[1]>>>0,4),e.writeUInt32BE(t[2]>>>0,8),e.writeUInt32BE(t[3]>>>0,12),e}function o(t){this.h=t,this.state=i.alloc(16,0),this.cache=i.allocUnsafe(0)}o.prototype.ghash=function(t){for(var e=-1;++e<t.length;)this.state[e]^=t[e];this._multiply()},o.prototype._multiply=function(){for(var t,e,r,i=[(t=this.h).readUInt32BE(0),t.readUInt32BE(4),t.readUInt32BE(8),t.readUInt32BE(12)],n=[0,0,0,0],o=-1;++o<128;){for(!!(this.state[~~(o/8)]&1<<7-o%8)&&(n[0]^=i[0],n[1]^=i[1],n[2]^=i[2],n[3]^=i[3]),r=!!(1&i[3]),e=3;e>0;e--)i[e]=i[e]>>>1|(1&i[e-1])<<31;i[0]=i[0]>>>1,r&&(i[0]=i[0]^225<<24)}this.state=s(n)},o.prototype.update=function(t){var e;for(this.cache=i.concat([this.cache,t]);this.cache.length>=16;)e=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(e)},o.prototype.final=function(t,e){return this.cache.length&&this.ghash(i.concat([this.cache,n],16)),this.ghash(s([0,t,0,e])),this.state},t.exports=o},5122:t=>{t.exports=function(t){for(var e,r=t.length;r--;){if(255!==(e=t.readUInt8(r))){e++,t.writeUInt8(e,r);break}t.writeUInt8(0,r)}}},2884:(t,e,r)=>{var i=r(295);e.encrypt=function(t,e){var r=i(e,t._prev);return t._prev=t._cipher.encryptBlock(r),t._prev},e.decrypt=function(t,e){var r=t._prev;t._prev=e;var n=t._cipher.decryptBlock(e);return i(n,r)}},6383:(t,e,r)=>{var i=r(2861).Buffer,n=r(295);function s(t,e,r){var s=e.length,o=n(e,t._cache);return t._cache=t._cache.slice(s),t._prev=i.concat([t._prev,r?e:o]),o}e.encrypt=function(t,e,r){for(var n,o=i.allocUnsafe(0);e.length;){if(0===t._cache.length&&(t._cache=t._cipher.encryptBlock(t._prev),t._prev=i.allocUnsafe(0)),!(t._cache.length<=e.length)){o=i.concat([o,s(t,e,r)]);break}n=t._cache.length,o=i.concat([o,s(t,e.slice(0,n),r)]),e=e.slice(n)}return o}},5264:(t,e,r)=>{var i=r(2861).Buffer;function n(t,e,r){for(var i,n,o=-1,a=0;++o<8;)i=e&1<<7-o?128:0,a+=(128&(n=t._cipher.encryptBlock(t._prev)[0]^i))>>o%8,t._prev=s(t._prev,r?i:n);return a}function s(t,e){var r=t.length,n=-1,s=i.allocUnsafe(t.length);for(t=i.concat([t,i.from([e])]);++n<r;)s[n]=t[n]<<1|t[n+1]>>7;return s}e.encrypt=function(t,e,r){for(var s=e.length,o=i.allocUnsafe(s),a=-1;++a<s;)o[a]=n(t,e[a],r);return o}},6975:(t,e,r)=>{var i=r(2861).Buffer;function n(t,e,r){var n=t._cipher.encryptBlock(t._prev)[0]^e;return t._prev=i.concat([t._prev.slice(1),i.from([r?e:n])]),n}e.encrypt=function(t,e,r){for(var s=e.length,o=i.allocUnsafe(s),a=-1;++a<s;)o[a]=n(t,e[a],r);return o}},3053:(t,e,r)=>{var i=r(295),n=r(2861).Buffer,s=r(5122);function o(t){var e=t._cipher.encryptBlockRaw(t._prev);return s(t._prev),e}e.encrypt=function(t,e){var r=Math.ceil(e.length/16),s=t._cache.length;t._cache=n.concat([t._cache,n.allocUnsafe(16*r)]);for(var a=0;a<r;a++){var h=o(t),u=s+16*a;t._cache.writeUInt32BE(h[0],u+0),t._cache.writeUInt32BE(h[1],u+4),t._cache.writeUInt32BE(h[2],u+8),t._cache.writeUInt32BE(h[3],u+12)}var c=t._cache.slice(0,e.length);return t._cache=t._cache.slice(e.length),i(e,c)}},2632:(t,e)=>{e.encrypt=function(t,e){return t._cipher.encryptBlock(e)},e.decrypt=function(t,e){return t._cipher.decryptBlock(e)}},530:(t,e,r)=>{var i={ECB:r(2632),CBC:r(2884),CFB:r(6383),CFB8:r(6975),CFB1:r(5264),OFB:r(6843),CTR:r(3053),GCM:r(3053)},n=r(3219);for(var s in n)n[s].module=i[n[s].mode];t.exports=n},6843:(t,e,r)=>{var i=r(8287).Buffer,n=r(295);function s(t){return t._prev=t._cipher.encryptBlock(t._prev),t._prev}e.encrypt=function(t,e){for(;t._cache.length<e.length;)t._cache=i.concat([t._cache,s(t)]);var r=t._cache.slice(0,e.length);return t._cache=t._cache.slice(e.length),n(e,r)}},650:(t,e,r)=>{var i=r(462),n=r(2861).Buffer,s=r(6168);function o(t,e,r,o){s.call(this),this._cipher=new i.AES(e),this._prev=n.from(r),this._cache=n.allocUnsafe(0),this._secCache=n.allocUnsafe(0),this._decrypt=o,this._mode=t}r(6698)(o,s),o.prototype._update=function(t){return this._mode.encrypt(this,t,this._decrypt)},o.prototype._final=function(){this._cipher.scrub()},t.exports=o},125:(t,e,r)=>{var i=r(4050),n=r(1241),s=r(530),o=r(2438),a=r(8078);function h(t,e,r){if(t=t.toLowerCase(),s[t])return n.createCipheriv(t,e,r);if(o[t])return new i({key:e,iv:r,mode:t});throw new TypeError("invalid suite type")}function u(t,e,r){if(t=t.toLowerCase(),s[t])return n.createDecipheriv(t,e,r);if(o[t])return new i({key:e,iv:r,mode:t,decrypt:!0});throw new TypeError("invalid suite type")}e.createCipher=e.Cipher=function(t,e){var r,i;if(t=t.toLowerCase(),s[t])r=s[t].key,i=s[t].iv;else{if(!o[t])throw new TypeError("invalid suite type");r=8*o[t].key,i=o[t].iv}var n=a(e,!1,r,i);return h(t,n.key,n.iv)},e.createCipheriv=e.Cipheriv=h,e.createDecipher=e.Decipher=function(t,e){var r,i;if(t=t.toLowerCase(),s[t])r=s[t].key,i=s[t].iv;else{if(!o[t])throw new TypeError("invalid suite type");r=8*o[t].key,i=o[t].iv}var n=a(e,!1,r,i);return u(t,n.key,n.iv)},e.createDecipheriv=e.Decipheriv=u,e.listCiphers=e.getCiphers=function(){return Object.keys(o).concat(n.getCiphers())}},4050:(t,e,r)=>{var i=r(6168),n=r(9560),s=r(6698),o=r(2861).Buffer,a={"des-ede3-cbc":n.CBC.instantiate(n.EDE),"des-ede3":n.EDE,"des-ede-cbc":n.CBC.instantiate(n.EDE),"des-ede":n.EDE,"des-cbc":n.CBC.instantiate(n.DES),"des-ecb":n.DES};function h(t){i.call(this);var e,r=t.mode.toLowerCase(),n=a[r];e=t.decrypt?"decrypt":"encrypt";var s=t.key;o.isBuffer(s)||(s=o.from(s)),"des-ede"!==r&&"des-ede-cbc"!==r||(s=o.concat([s,s.slice(0,8)]));var h=t.iv;o.isBuffer(h)||(h=o.from(h)),this._des=n.create({key:s,iv:h,type:e})}a.des=a["des-cbc"],a.des3=a["des-ede3-cbc"],t.exports=h,s(h,i),h.prototype._update=function(t){return o.from(this._des.update(t))},h.prototype._final=function(){return o.from(this._des.final())}},2438:(t,e)=>{e["des-ecb"]={key:8,iv:0},e["des-cbc"]=e.des={key:8,iv:8},e["des-ede3-cbc"]=e.des3={key:24,iv:8},e["des-ede3"]={key:24,iv:0},e["des-ede-cbc"]={key:16,iv:8},e["des-ede"]={key:16,iv:0}},7332:(t,e,r)=>{"use strict";var i=r(9404),n=r(3209),s=r(2861).Buffer;function o(t){var e,r=t.modulus.byteLength();do{e=new i(n(r))}while(e.cmp(t.modulus)>=0||!e.umod(t.prime1)||!e.umod(t.prime2));return e}function a(t,e){var r=function(t){var e=o(t);return{blinder:e.toRed(i.mont(t.modulus)).redPow(new i(t.publicExponent)).fromRed(),unblinder:e.invm(t.modulus)}}(e),n=e.modulus.byteLength(),a=new i(t).mul(r.blinder).umod(e.modulus),h=a.toRed(i.mont(e.prime1)),u=a.toRed(i.mont(e.prime2)),c=e.coefficient,l=e.prime1,d=e.prime2,f=h.redPow(e.exponent1).fromRed(),p=u.redPow(e.exponent2).fromRed(),m=f.isub(p).imul(c).umod(l).imul(d);return p.iadd(m).imul(r.unblinder).umod(e.modulus).toArrayLike(s,"be",n)}a.getr=o,t.exports=a},5715:(t,e,r)=>{"use strict";t.exports=r(2951)},20:(t,e,r)=>{"use strict";var i=r(2861).Buffer,n=r(7108),s=r(6737),o=r(6698),a=r(5359),h=r(4847),u=r(2951);function c(t){s.Writable.call(this);var e=u[t];if(!e)throw new Error("Unknown message digest");this._hashType=e.hash,this._hash=n(e.hash),this._tag=e.id,this._signType=e.sign}function l(t){s.Writable.call(this);var e=u[t];if(!e)throw new Error("Unknown message digest");this._hash=n(e.hash),this._tag=e.id,this._signType=e.sign}function d(t){return new c(t)}function f(t){return new l(t)}Object.keys(u).forEach((function(t){u[t].id=i.from(u[t].id,"hex"),u[t.toLowerCase()]=u[t]})),o(c,s.Writable),c.prototype._write=function(t,e,r){this._hash.update(t),r()},c.prototype.update=function(t,e){return this._hash.update("string"==typeof t?i.from(t,e):t),this},c.prototype.sign=function(t,e){this.end();var r=this._hash.digest(),i=a(r,t,this._hashType,this._signType,this._tag);return e?i.toString(e):i},o(l,s.Writable),l.prototype._write=function(t,e,r){this._hash.update(t),r()},l.prototype.update=function(t,e){return this._hash.update("string"==typeof t?i.from(t,e):t),this},l.prototype.verify=function(t,e,r){var n="string"==typeof e?i.from(e,r):e;this.end();var s=this._hash.digest();return h(n,s,t,this._signType,this._tag)},t.exports={Sign:d,Verify:f,createSign:d,createVerify:f}},5359:(t,e,r)=>{"use strict";var i=r(2861).Buffer,n=r(3507),s=r(7332),o=r(6729).ec,a=r(9404),h=r(8170),u=r(4589);function c(t,e,r,s){if((t=i.from(t.toArray())).length<e.byteLength()){var o=i.alloc(e.byteLength()-t.length);t=i.concat([o,t])}var a=r.length,h=function(t,e){t=(t=l(t,e)).mod(e);var r=i.from(t.toArray());if(r.length<e.byteLength()){var n=i.alloc(e.byteLength()-r.length);r=i.concat([n,r])}return r}(r,e),u=i.alloc(a);u.fill(1);var c=i.alloc(a);return c=n(s,c).update(u).update(i.from([0])).update(t).update(h).digest(),u=n(s,c).update(u).digest(),{k:c=n(s,c).update(u).update(i.from([1])).update(t).update(h).digest(),v:u=n(s,c).update(u).digest()}}function l(t,e){var r=new a(t),i=(t.length<<3)-e.bitLength();return i>0&&r.ishrn(i),r}function d(t,e,r){var s,o;do{for(s=i.alloc(0);8*s.length<t.bitLength();)e.v=n(r,e.k).update(e.v).digest(),s=i.concat([s,e.v]);o=l(s,t),e.k=n(r,e.k).update(e.v).update(i.from([0])).digest(),e.v=n(r,e.k).update(e.v).digest()}while(-1!==o.cmp(t));return o}function f(t,e,r,i){return t.toRed(a.mont(r)).redPow(e).fromRed().mod(i)}t.exports=function(t,e,r,n,p){var m=h(e);if(m.curve){if("ecdsa"!==n&&"ecdsa/rsa"!==n)throw new Error("wrong private key type");return function(t,e){var r=u[e.curve.join(".")];if(!r)throw new Error("unknown curve "+e.curve.join("."));var n=new o(r).keyFromPrivate(e.privateKey).sign(t);return i.from(n.toDER())}(t,m)}if("dsa"===m.type){if("dsa"!==n)throw new Error("wrong private key type");return function(t,e,r){for(var n,s=e.params.priv_key,o=e.params.p,h=e.params.q,u=e.params.g,p=new a(0),m=l(t,h).mod(h),g=!1,b=c(s,h,t,r);!1===g;)p=f(u,n=d(h,b,r),o,h),0===(g=n.invm(h).imul(m.add(s.mul(p))).mod(h)).cmpn(0)&&(g=!1,p=new a(0));return function(t,e){t=t.toArray(),e=e.toArray(),128&t[0]&&(t=[0].concat(t)),128&e[0]&&(e=[0].concat(e));var r=[48,t.length+e.length+4,2,t.length];return r=r.concat(t,[2,e.length],e),i.from(r)}(p,g)}(t,m,r)}if("rsa"!==n&&"ecdsa/rsa"!==n)throw new Error("wrong private key type");if(void 0!==e.padding&&1!==e.padding)throw new Error("illegal or unsupported padding mode");t=i.concat([p,t]);for(var g=m.modulus.byteLength(),b=[0,1];t.length+b.length+1<g;)b.push(255);b.push(0);for(var y=-1;++y<t.length;)b.push(t[y]);return s(b,m)},t.exports.getKey=c,t.exports.makeKey=d},4847:(t,e,r)=>{"use strict";var i=r(2861).Buffer,n=r(9404),s=r(6729).ec,o=r(8170),a=r(4589);function h(t,e){if(t.cmpn(0)<=0)throw new Error("invalid sig");if(t.cmp(e)>=0)throw new Error("invalid sig")}t.exports=function(t,e,r,u,c){var l=o(r);if("ec"===l.type){if("ecdsa"!==u&&"ecdsa/rsa"!==u)throw new Error("wrong public key type");return function(t,e,r){var i=a[r.data.algorithm.curve.join(".")];if(!i)throw new Error("unknown curve "+r.data.algorithm.curve.join("."));var n=new s(i),o=r.data.subjectPrivateKey.data;return n.verify(e,t,o)}(t,e,l)}if("dsa"===l.type){if("dsa"!==u)throw new Error("wrong public key type");return function(t,e,r){var i=r.data.p,s=r.data.q,a=r.data.g,u=r.data.pub_key,c=o.signature.decode(t,"der"),l=c.s,d=c.r;h(l,s),h(d,s);var f=n.mont(i),p=l.invm(s);return 0===a.toRed(f).redPow(new n(e).mul(p).mod(s)).fromRed().mul(u.toRed(f).redPow(d.mul(p).mod(s)).fromRed()).mod(i).mod(s).cmp(d)}(t,e,l)}if("rsa"!==u&&"ecdsa/rsa"!==u)throw new Error("wrong public key type");e=i.concat([c,e]);for(var d=l.modulus.byteLength(),f=[1],p=0;e.length+f.length+2<d;)f.push(255),p+=1;f.push(0);for(var m=-1;++m<e.length;)f.push(e[m]);f=i.from(f);var g=n.mont(l.modulus);t=(t=new n(t).toRed(g)).redPow(new n(l.publicExponent)),t=i.from(t.fromRed().toArray());var b=p<8?1:0;for(d=Math.min(t.length,f.length),t.length!==f.length&&(b=1),m=-1;++m<d;)b|=t[m]^f[m];return 0===b}},6248:(t,e,r)=>{"use strict";var i=r(3225),n=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};t.exports=l;var s=Object.create(r(5622));s.inherits=r(6698);var o=r(206),a=r(7314);s.inherits(l,o);for(var h=n(a.prototype),u=0;u<h.length;u++){var c=h[u];l.prototype[c]||(l.prototype[c]=a.prototype[c])}function l(t){if(!(this instanceof l))return new l(t);o.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",d)}function d(){this.allowHalfOpen||this._writableState.ended||i.nextTick(f,this)}function f(t){t.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),l.prototype._destroy=function(t,e){this.push(null),this.end(),i.nextTick(e,t)}},5242:(t,e,r)=>{"use strict";t.exports=s;var i=r(1816),n=Object.create(r(5622));function s(t){if(!(this instanceof s))return new s(t);i.call(this,t)}n.inherits=r(6698),n.inherits(s,i),s.prototype._transform=function(t,e,r){r(null,t)}},206:(t,e,r)=>{"use strict";var i=r(5606),n=r(3225);t.exports=v;var s,o=r(4634);v.ReadableState=y,r(7007).EventEmitter;var a=function(t,e){return t.listeners(e).length},h=r(5567),u=r(4116).Buffer,c=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},l=Object.create(r(5622));l.inherits=r(6698);var d=r(2668),f=void 0;f=d&&d.debuglog?d.debuglog("stream"):function(){};var p,m=r(672),g=r(6278);l.inherits(v,h);var b=["error","close","destroy","pause","resume"];function y(t,e){t=t||{};var i=e instanceof(s=s||r(6248));this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,o=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:i&&(o||0===o)?o:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(p||(p=r(6427).I),this.decoder=new p(t.encoding),this.encoding=t.encoding)}function v(t){if(s=s||r(6248),!(this instanceof v))return new v(t);this._readableState=new y(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),h.call(this)}function w(t,e,r,i,n){var s,o=t._readableState;return null===e?(o.reading=!1,function(t,e){if(!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,E(t)}}(t,o)):(n||(s=function(t,e){var r,i;return i=e,u.isBuffer(i)||i instanceof c||"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r}(o,e)),s?t.emit("error",s):o.objectMode||e&&e.length>0?("string"==typeof e||o.objectMode||Object.getPrototypeOf(e)===u.prototype||(e=function(t){return u.from(t)}(e)),i?o.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):M(t,o,e,!0):o.ended?t.emit("error",new Error("stream.push() after EOF")):(o.reading=!1,o.decoder&&!r?(e=o.decoder.write(e),o.objectMode||0!==e.length?M(t,o,e,!1):A(t,o)):M(t,o,e,!1))):i||(o.reading=!1)),function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(o)}function M(t,e,r,i){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&E(t)),A(t,e)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(t,e){this.push(null),e(t)},v.prototype.push=function(t,e){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof t&&((e=e||i.defaultEncoding)!==i.encoding&&(t=u.from(t,e),e=""),r=!0),w(this,t,e,!1,r)},v.prototype.unshift=function(t){return w(this,t,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(t){return p||(p=r(6427).I),this._readableState.decoder=new p(t),this._readableState.encoding=t,this};var _=8388608;function S(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=_?t=_:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function E(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?n.nextTick(k,t):k(t))}function k(t){f("emit readable"),t.emit("readable"),T(t)}function A(t,e){e.readingMore||(e.readingMore=!0,n.nextTick(I,t,e))}function I(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function x(t){f("readable nexttick read 0"),t.read(0)}function C(t,e){e.reading||(f("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),T(t),e.flowing&&!e.reading&&t.read(0)}function T(t){var e=t._readableState;for(f("flow",e.flowing);e.flowing&&null!==t.read(););}function P(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=function(t,e,r){var i;return t<e.head.data.length?(i=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):i=t===e.head.data.length?e.shift():r?function(t,e){var r=e.head,i=1,n=r.data;for(t-=n.length;r=r.next;){var s=r.data,o=t>s.length?s.length:t;if(o===s.length?n+=s:n+=s.slice(0,t),0==(t-=o)){o===s.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=s.slice(o));break}++i}return e.length-=i,n}(t,e):function(t,e){var r=u.allocUnsafe(t),i=e.head,n=1;for(i.data.copy(r),t-=i.data.length;i=i.next;){var s=i.data,o=t>s.length?s.length:t;if(s.copy(r,r.length-t,0,o),0==(t-=o)){o===s.length?(++n,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=s.slice(o));break}++n}return e.length-=n,r}(t,e),i}(t,e.buffer,e.decoder),r);var r}function B(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,n.nextTick(R,e,t))}function R(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function D(t,e){for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}v.prototype.read=function(t){f("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?B(this):E(this),null;if(0===(t=S(t,e))&&e.ended)return 0===e.length&&B(this),null;var i,n=e.needReadable;return f("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&f("length less than watermark",n=!0),e.ended||e.reading?f("reading or ended",n=!1):n&&(f("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=S(r,e))),null===(i=t>0?P(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&B(this)),null!==i&&this.emit("data",i),i},v.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(t,e){var r=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=t;break;case 1:s.pipes=[s.pipes,t];break;default:s.pipes.push(t)}s.pipesCount+=1,f("pipe count=%d opts=%j",s.pipesCount,e);var h=e&&!1===e.end||t===i.stdout||t===i.stderr?y:u;function u(){f("onend"),t.end()}s.endEmitted?n.nextTick(h):r.once("end",h),t.on("unpipe",(function e(i,n){f("onunpipe"),i===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,f("cleanup"),t.removeListener("close",g),t.removeListener("finish",b),t.removeListener("drain",c),t.removeListener("error",m),t.removeListener("unpipe",e),r.removeListener("end",u),r.removeListener("end",y),r.removeListener("data",p),l=!0,!s.awaitDrain||t._writableState&&!t._writableState.needDrain||c())}));var c=function(t){return function(){var e=t._readableState;f("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,"data")&&(e.flowing=!0,T(t))}}(r);t.on("drain",c);var l=!1,d=!1;function p(e){f("ondata"),d=!1,!1!==t.write(e)||d||((1===s.pipesCount&&s.pipes===t||s.pipesCount>1&&-1!==D(s.pipes,t))&&!l&&(f("false write response, pause",s.awaitDrain),s.awaitDrain++,d=!0),r.pause())}function m(e){f("onerror",e),y(),t.removeListener("error",m),0===a(t,"error")&&t.emit("error",e)}function g(){t.removeListener("finish",b),y()}function b(){f("onfinish"),t.removeListener("close",g),y()}function y(){f("unpipe"),r.unpipe(t)}return r.on("data",p),function(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?o(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}(t,"error",m),t.once("close",g),t.once("finish",b),t.emit("pipe",r),s.flowing||(f("pipe resume"),r.resume()),t},v.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var i=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)i[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=D(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},v.prototype.on=function(t,e){var r=h.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&E(this):n.nextTick(x,this))}return r},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var t=this._readableState;return t.flowing||(f("resume"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,n.nextTick(C,t,e))}(this,t)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(t){var e=this,r=this._readableState,i=!1;for(var n in t.on("end",(function(){if(f("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(n){f("wrapped data"),r.decoder&&(n=r.decoder.write(n)),r.objectMode&&null==n||(r.objectMode||n&&n.length)&&(e.push(n)||(i=!0,t.pause()))})),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));for(var s=0;s<b.length;s++)t.on(b[s],this.emit.bind(this,b[s]));return this._read=function(e){f("wrapped _read",e),i&&(i=!1,t.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=P},1816:(t,e,r)=>{"use strict";t.exports=o;var i=r(6248),n=Object.create(r(5622));function s(t,e){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(!i)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=e&&this.push(e),i(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function o(t){if(!(this instanceof o))return new o(t);i.call(this,t),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var t=this;"function"==typeof this._flush?this._flush((function(e,r){h(t,e,r)})):h(this,null,null)}function h(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}n.inherits=r(6698),n.inherits(o,i),o.prototype.push=function(t,e){return this._transformState.needTransform=!1,i.prototype.push.call(this,t,e)},o.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},o.prototype._write=function(t,e,r){var i=this._transformState;if(i.writecb=r,i.writechunk=t,i.writeencoding=e,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},o.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},o.prototype._destroy=function(t,e){var r=this;i.prototype._destroy.call(this,t,(function(t){e(t),r.emit("close")}))}},7314:(t,e,r)=>{"use strict";var i=r(5606),n=r(3225);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(undefined),r=r.next}e.corkedRequestsFree.next=t}(e,t)}}t.exports=b;var o,a=!i.browser&&["v0.10","v0.9."].indexOf(i.version.slice(0,5))>-1?setImmediate:n.nextTick;b.WritableState=g;var h=Object.create(r(5622));h.inherits=r(6698);var u,c={deprecate:r(4643)},l=r(5567),d=r(4116).Buffer,f=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},p=r(6278);function m(){}function g(t,e){o=o||r(6248),t=t||{};var i=e instanceof o;this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var h=t.highWaterMark,u=t.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=h||0===h?h:i&&(u||0===u)?u:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===t.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var r=t._writableState,i=r.sync,s=r.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),e)!function(t,e,r,i,s){--e.pendingcb,r?(n.nextTick(s,i),n.nextTick(S,t,e),t._writableState.errorEmitted=!0,t.emit("error",i)):(s(i),t._writableState.errorEmitted=!0,t.emit("error",i),S(t,e))}(t,r,i,e,s);else{var o=M(r);o||r.corked||r.bufferProcessing||!r.bufferedRequest||w(t,r),i?a(v,t,r,o,s):v(t,r,o,s)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function b(t){if(o=o||r(6248),!(u.call(b,this)||this instanceof o))return new b(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function y(t,e,r,i,n,s,o){e.writelen=i,e.writecb=o,e.writing=!0,e.sync=!0,r?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function v(t,e,r,i){r||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,i(),S(t,e)}function w(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var i=e.bufferedRequestCount,n=new Array(i),o=e.corkedRequestsFree;o.entry=r;for(var a=0,h=!0;r;)n[a]=r,r.isBuf||(h=!1),r=r.next,a+=1;n.allBuffers=h,y(t,e,!0,e.length,n,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,l=r.callback;if(y(t,e,!1,e.objectMode?1:u.length,u,c,l),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function M(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function _(t,e){t._final((function(r){e.pendingcb--,r&&t.emit("error",r),e.prefinished=!0,t.emit("prefinish"),S(t,e)}))}function S(t,e){var r=M(e);return r&&(function(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,n.nextTick(_,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}h.inherits(b,l),g.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(g.prototype,"buffer",{get:c.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(t){return!!u.call(this,t)||this===b&&t&&t._writableState instanceof g}})):u=function(t){return t instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(t,e,r){var i,s=this._writableState,o=!1,a=!s.objectMode&&(i=t,d.isBuffer(i)||i instanceof f);return a&&!d.isBuffer(t)&&(t=function(t){return d.from(t)}(t)),"function"==typeof e&&(r=e,e=null),a?e="buffer":e||(e=s.defaultEncoding),"function"!=typeof r&&(r=m),s.ended?function(t,e){var r=new Error("write after end");t.emit("error",r),n.nextTick(e,r)}(this,r):(a||function(t,e,r,i){var s=!0,o=!1;return null===r?o=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),n.nextTick(i,o),s=!1),s}(this,s,t,r))&&(s.pendingcb++,o=function(t,e,r,i,n,s){if(!r){var o=function(t,e,r){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=d.from(e,r)),e}(e,i,n);i!==o&&(r=!0,n="buffer",i=o)}var a=e.objectMode?1:i.length;e.length+=a;var h=e.length<e.highWaterMark;if(h||(e.needDrain=!0),e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:s,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else y(t,e,!1,a,i,n,s);return h}(this,s,a,t,e,r)),o},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||w(this,t))},b.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(t,e,r){var i=this._writableState;"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||function(t,e,r){e.ending=!0,S(t,e),r&&(e.finished?n.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}(this,i,r)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),b.prototype.destroy=p.destroy,b.prototype._undestroy=p.undestroy,b.prototype._destroy=function(t,e){this.end(),e(t)}},672:(t,e,r)=>{"use strict";var i=r(4116).Buffer,n=r(1638);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},t.prototype.concat=function(t){if(0===this.length)return i.alloc(0);for(var e,r,n=i.allocUnsafe(t>>>0),s=this.head,o=0;s;)e=n,r=o,s.data.copy(e,r),o+=s.data.length,s=s.next;return n},t}(),n&&n.inspect&&n.inspect.custom&&(t.exports.prototype[n.inspect.custom]=function(){var t=n.inspect({length:this.length});return this.constructor.name+" "+t})},6278:(t,e,r)=>{"use strict";var i=r(3225);function n(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var r=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(n,this,t)):i.nextTick(n,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?r._writableState?r._writableState.errorEmitted||(r._writableState.errorEmitted=!0,i.nextTick(n,r,t)):i.nextTick(n,r,t):e&&e(t)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},5567:(t,e,r)=>{t.exports=r(7007).EventEmitter},4116:(t,e,r)=>{var i=r(8287),n=i.Buffer;function s(t,e){for(var r in t)e[r]=t[r]}function o(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=i:(s(i,e),e.Buffer=o),s(n,o),o.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},o.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=n(t);return void 0!==e?"string"==typeof r?i.fill(e,r):i.fill(e):i.fill(0),i},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i.SlowBuffer(t)}},6737:(t,e,r)=>{(e=t.exports=r(206)).Stream=e,e.Readable=e,e.Writable=r(7314),e.Duplex=r(6248),e.Transform=r(1816),e.PassThrough=r(5242)},6427:(t,e,r)=>{"use strict";var i=r(8393).Buffer,n=i.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(i.isEncoding===n||!n(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=h,this.end=u,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=c,this.end=l,e=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,r=function(t,e){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function h(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function u(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function c(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function l(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function d(t){return t.toString(this.encoding)}function f(t){return t&&t.length?this.write(t):""}e.I=s,s.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},s.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},s.prototype.text=function(t,e){var r=function(t,e,r){var i=e.length-1;if(i<r)return 0;var n=o(e[i]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--i<r||-2===n?0:(n=o(e[i]))>=0?(n>0&&(t.lastNeed=n-2),n):--i<r||-2===n?0:(n=o(e[i]))>=0?(n>0&&(2===n?n=0:t.lastNeed=n-3),n):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var i=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)},s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},8393:(t,e,r)=>{var i=r(8287),n=i.Buffer;function s(t,e){for(var r in t)e[r]=t[r]}function o(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=i:(s(i,e),e.Buffer=o),s(n,o),o.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},o.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=n(t);return void 0!==e?"string"==typeof r?i.fill(e,r):i.fill(e):i.fill(0),i},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i.SlowBuffer(t)}},295:(t,e,r)=>{var i=r(8287).Buffer;t.exports=function(t,e){for(var r=Math.min(t.length,e.length),n=new i(r),s=0;s<r;++s)n[s]=t[s]^e[s];return n}},8287:(t,e,r)=>{"use strict";const i=r(7526),n=r(251),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=h,e.SlowBuffer=function(t){return+t!=t&&(t=0),h.alloc(+t)},e.INSPECT_MAX_BYTES=50;const o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,h.prototype),e}function h(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return u(t,e,r)}function u(t,e,r){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!h.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=0|m(t,e);let i=a(r);const n=i.write(t,e);return n!==r&&(i=i.slice(0,n)),i}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Z(t,Uint8Array)){const e=new Uint8Array(t);return f(e.buffer,e.byteOffset,e.byteLength)}return d(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Z(t,ArrayBuffer)||t&&Z(t.buffer,ArrayBuffer))return f(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(Z(t,SharedArrayBuffer)||t&&Z(t.buffer,SharedArrayBuffer)))return f(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return h.from(i,e,r);const n=function(t){if(h.isBuffer(t)){const e=0|p(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||Y(t.length)?a(0):d(t):"Buffer"===t.type&&Array.isArray(t.data)?d(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return h.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return c(t),a(t<0?0:0|p(t))}function d(t){const e=t.length<0?0:0|p(t.length),r=a(e);for(let i=0;i<e;i+=1)r[i]=255&t[i];return r}function f(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(i,h.prototype),i}function p(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function m(t,e){if(h.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const r=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return K(t).length;default:if(n)return i?-1:W(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){let i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,r);case"utf8":case"utf-8":return A(this,e,r);case"ascii":return x(this,e,r);case"latin1":case"binary":return C(this,e,r);case"base64":return k(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function b(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function y(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Y(r=+r)&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=h.from(e,i)),h.isBuffer(e))return 0===e.length?-1:v(t,e,r,i,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,i,n){let s,o=1,a=t.length,h=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,r/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){let i=-1;for(s=r;s<a;s++)if(u(t,s)===u(e,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===h)return i*o}else-1!==i&&(s-=s-i),i=-1}else for(r+h>a&&(r=a-h),s=r;s>=0;s--){let r=!0;for(let i=0;i<h;i++)if(u(t,s+i)!==u(e,i)){r=!1;break}if(r)return s}return-1}function w(t,e,r,i){r=Number(r)||0;const n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;const s=e.length;let o;for(i>s/2&&(i=s/2),o=0;o<i;++o){const i=parseInt(e.substr(2*o,2),16);if(Y(i))return o;t[r+o]=i}return o}function M(t,e,r,i){return G(W(e,t.length-r),t,r,i)}function _(t,e,r,i){return G(function(t){const e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function S(t,e,r,i){return G(K(e),t,r,i)}function E(t,e,r,i){return G(function(t,e){let r,i,n;const s=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),i=r>>8,n=r%256,s.push(n),s.push(i);return s}(e,t.length-r),t,r,i)}function k(t,e,r){return 0===e&&r===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,r))}function A(t,e,r){r=Math.min(t.length,r);const i=[];let n=e;for(;n<r;){const e=t[n];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(n+o<=r){let r,i,a,h;switch(o){case 1:e<128&&(s=e);break;case 2:r=t[n+1],128==(192&r)&&(h=(31&e)<<6|63&r,h>127&&(s=h));break;case 3:r=t[n+1],i=t[n+2],128==(192&r)&&128==(192&i)&&(h=(15&e)<<12|(63&r)<<6|63&i,h>2047&&(h<55296||h>57343)&&(s=h));break;case 4:r=t[n+1],i=t[n+2],a=t[n+3],128==(192&r)&&128==(192&i)&&128==(192&a)&&(h=(15&e)<<18|(63&r)<<12|(63&i)<<6|63&a,h>65535&&h<1114112&&(s=h))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),n+=o}return function(t){const e=t.length;if(e<=I)return String.fromCharCode.apply(String,t);let r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=I));return r}(i)}e.kMaxLength=o,h.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),h.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(t,e,r){return function(t,e,r){return c(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},h.allocUnsafe=function(t){return l(t)},h.allocUnsafeSlow=function(t){return l(t)},h.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==h.prototype},h.compare=function(t,e){if(Z(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),Z(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,i=e.length;for(let n=0,s=Math.min(r,i);n<s;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;const i=h.allocUnsafe(e);let n=0;for(r=0;r<t.length;++r){let e=t[r];if(Z(e,Uint8Array))n+e.length>i.length?(h.isBuffer(e)||(e=h.from(e)),e.copy(i,n)):Uint8Array.prototype.set.call(i,e,n);else{if(!h.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(i,n)}n+=e.length}return i},h.byteLength=m,h.prototype._isBuffer=!0,h.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)b(this,e,e+1);return this},h.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},h.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},h.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?A(this,0,t):g.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){let t="";const r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(h.prototype[s]=h.prototype.inspect),h.prototype.compare=function(t,e,r,i,n){if(Z(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return-1;if(e>=r)return 1;if(this===t)return 0;let s=(n>>>=0)-(i>>>=0),o=(r>>>=0)-(e>>>=0);const a=Math.min(s,o),u=this.slice(i,n),c=t.slice(e,r);for(let t=0;t<a;++t)if(u[t]!==c[t]){s=u[t],o=c[t];break}return s<o?-1:o<s?1:0},h.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},h.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},h.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},h.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}const n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let s=!1;for(;;)switch(i){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return M(this,t,e,r);case"ascii":case"latin1":case"binary":return _(this,t,e,r);case"base64":return S(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const I=4096;function x(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function C(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function T(t,e,r){const i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=e;i<r;++i)n+=J[t[i]];return n}function P(t,e,r){const i=t.slice(e,r);let n="";for(let t=0;t<i.length-1;t+=2)n+=String.fromCharCode(i[t]+256*i[t+1]);return n}function B(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,r,i,n,s){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function D(t,e,r,i,n){q(e,i,n,t,r,7);let s=Number(e&BigInt(4294967295));t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,r}function N(t,e,r,i,n){q(e,i,n,t,r,7);let s=Number(e&BigInt(4294967295));t[r+7]=s,s>>=8,t[r+6]=s,s>>=8,t[r+5]=s,s>>=8,t[r+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=o,o>>=8,t[r+2]=o,o>>=8,t[r+1]=o,o>>=8,t[r]=o,r+8}function L(t,e,r,i,n,s){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(t,e,r,i,s){return e=+e,r>>>=0,s||L(t,0,r,4),n.write(t,e,r,i,23,4),r+4}function U(t,e,r,i,s){return e=+e,r>>>=0,s||L(t,0,r,8),n.write(t,e,r,i,52,8),r+8}h.prototype.slice=function(t,e){const r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);const i=this.subarray(t,e);return Object.setPrototypeOf(i,h.prototype),i},h.prototype.readUintLE=h.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=this[t],n=1,s=0;for(;++s<e&&(n*=256);)i+=this[t+s]*n;return i},h.prototype.readUintBE=h.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=this[t+--e],n=1;for(;e>0&&(n*=256);)i+=this[t+--e]*n;return i},h.prototype.readUint8=h.prototype.readUInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),this[t]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readBigUInt64LE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,n=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(i)+(BigInt(n)<<BigInt(32))})),h.prototype.readBigUInt64BE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=e*2**24+65536*this[++t]+256*this[++t]+this[++t],n=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)})),h.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=this[t],n=1,s=0;for(;++s<e&&(n*=256);)i+=this[t+s]*n;return n*=128,i>=n&&(i-=Math.pow(2,8*e)),i},h.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=e,n=1,s=this[t+--i];for(;i>0&&(n*=256);)s+=this[t+--i]*n;return n*=128,s>=n&&(s-=Math.pow(2,8*e)),s},h.prototype.readInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){t>>>=0,e||B(t,2,this.length);const r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(t,e){t>>>=0,e||B(t,2,this.length);const r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readBigInt64LE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24);return(BigInt(i)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),h.prototype.readBigInt64BE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(i)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)})),h.prototype.readFloatLE=function(t,e){return t>>>=0,e||B(t,4,this.length),n.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return t>>>=0,e||B(t,4,this.length),n.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return t>>>=0,e||B(t,8,this.length),n.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return t>>>=0,e||B(t,8,this.length),n.read(this,t,!1,52,8)},h.prototype.writeUintLE=h.prototype.writeUIntLE=function(t,e,r,i){t=+t,e>>>=0,r>>>=0,i||R(this,t,e,r,Math.pow(2,8*r)-1,0);let n=1,s=0;for(this[e]=255&t;++s<r&&(n*=256);)this[e+s]=t/n&255;return e+r},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(t,e,r,i){t=+t,e>>>=0,r>>>=0,i||R(this,t,e,r,Math.pow(2,8*r)-1,0);let n=r-1,s=1;for(this[e+n]=255&t;--n>=0&&(s*=256);)this[e+n]=t/s&255;return e+r},h.prototype.writeUint8=h.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,1,255,0),this[e]=255&t,e+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeBigUInt64LE=X((function(t,e=0){return D(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),h.prototype.writeBigUInt64BE=X((function(t,e=0){return N(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),h.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){const i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}let n=0,s=1,o=0;for(this[e]=255&t;++n<r&&(s*=256);)t<0&&0===o&&0!==this[e+n-1]&&(o=1),this[e+n]=(t/s|0)-o&255;return e+r},h.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){const i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}let n=r-1,s=1,o=0;for(this[e+n]=255&t;--n>=0&&(s*=256);)t<0&&0===o&&0!==this[e+n+1]&&(o=1),this[e+n]=(t/s|0)-o&255;return e+r},h.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},h.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeBigInt64LE=X((function(t,e=0){return D(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),h.prototype.writeBigInt64BE=X((function(t,e=0){return N(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),h.prototype.writeFloatLE=function(t,e,r){return O(this,t,e,!0,r)},h.prototype.writeFloatBE=function(t,e,r){return O(this,t,e,!1,r)},h.prototype.writeDoubleLE=function(t,e,r){return U(this,t,e,!0,r)},h.prototype.writeDoubleBE=function(t,e,r){return U(this,t,e,!1,r)},h.prototype.copy=function(t,e,r,i){if(!h.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);const n=i-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),n},h.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!h.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){const e=t.charCodeAt(0);("utf8"===i&&e<128||"latin1"===i)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let n;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(n=e;n<r;++n)this[n]=t;else{const s=h.isBuffer(t)?t:h.from(t,i),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<r-e;++n)this[n+e]=s[n%o]}return this};const F={};function j(t,e,r){F[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function V(t){let e="",r=t.length;const i="-"===t[0]?1:0;for(;r>=i+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function q(t,e,r,i,n,s){if(t>r||t<e){const i="bigint"==typeof e?"n":"";let n;throw n=s>3?0===e||e===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(s+1)}${i}`:`>= -(2${i} ** ${8*(s+1)-1}${i}) and < 2 ** ${8*(s+1)-1}${i}`:`>= ${e}${i} and <= ${r}${i}`,new F.ERR_OUT_OF_RANGE("value",n,t)}!function(t,e,r){z(e,"offset"),void 0!==t[e]&&void 0!==t[e+r]||H(e,t.length-(r+1))}(i,n,s)}function z(t,e){if("number"!=typeof t)throw new F.ERR_INVALID_ARG_TYPE(e,"number",t)}function H(t,e,r){if(Math.floor(t)!==t)throw z(t,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}j("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),j("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),j("ERR_OUT_OF_RANGE",(function(t,e,r){let i=`The value of "${t}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>2**32?n=V(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=V(n)),n+="n"),i+=` It must be ${e}. Received ${n}`,i}),RangeError);const $=/[^+/0-9A-Za-z-_]/g;function W(t,e){let r;e=e||1/0;const i=t.length;let n=null;const s=[];for(let o=0;o<i;++o){if(r=t.charCodeAt(o),r>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(e-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function K(t){return i.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace($,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,r,i){let n;for(n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function Z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Y(t){return t!=t}const J=function(){const t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){const i=16*r;for(let n=0;n<16;++n)e[i+n]=t[r]+t[n]}return e}();function X(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},6168:(t,e,r)=>{"use strict";var i=r(2861).Buffer,n=r(8310).Transform,s=r(3141).I;function o(t){n.call(this),this.hashMode="string"==typeof t,this.hashMode?this[t]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}r(6698)(o,n);var a="undefined"!=typeof Uint8Array,h="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&ArrayBuffer.isView&&(i.prototype instanceof Uint8Array||i.TYPED_ARRAY_SUPPORT);o.prototype.update=function(t,e,r){var n=function(t,e){if(t instanceof i)return t;if("string"==typeof t)return i.from(t,e);if(h&&ArrayBuffer.isView(t)){if(0===t.byteLength)return i.alloc(0);var r=i.from(t.buffer,t.byteOffset,t.byteLength);if(r.byteLength===t.byteLength)return r}if(a&&t instanceof Uint8Array)return i.from(t);if(i.isBuffer(t)&&t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))return i.from(t);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}(t,e),s=this._update(n);return this.hashMode?this:(r&&(s=this._toString(s,r)),s)},o.prototype.setAutoPadding=function(){},o.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},o.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},o.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},o.prototype._transform=function(t,e,r){var i;try{this.hashMode?this._update(t):this.push(this._update(t))}catch(t){i=t}finally{r(i)}},o.prototype._flush=function(t){var e;try{this.push(this.__final())}catch(t){e=t}t(e)},o.prototype._finalOrDigest=function(t){var e=this.__final()||i.alloc(0);return t&&(e=this._toString(e,t,!0)),e},o.prototype._toString=function(t,e,r){if(this._decoder||(this._decoder=new s(e),this._encoding=e),this._encoding!==e)throw new Error("cant switch encodings");var i=this._decoder.write(t);return r&&(i+=this._decoder.end()),i},t.exports=o},5622:(t,e,r)=>{function i(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===i(t)},e.isBoolean=function(t){return"boolean"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return"number"==typeof t},e.isString=function(t){return"string"==typeof t},e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return"[object RegExp]"===i(t)},e.isObject=function(t){return"object"==typeof t&&null!==t},e.isDate=function(t){return"[object Date]"===i(t)},e.isError=function(t){return"[object Error]"===i(t)||t instanceof Error},e.isFunction=function(t){return"function"==typeof t},e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(8287).Buffer.isBuffer},1324:(t,e,r)=>{var i=r(8287).Buffer,n=r(6729),s=r(5182);t.exports=function(t){return new a(t)};var o={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function a(t){this.curveType=o[t],this.curveType||(this.curveType={name:t}),this.curve=new n.ec(this.curveType.name),this.keys=void 0}function h(t,e,r){Array.isArray(t)||(t=t.toArray());var n=new i(t);if(r&&n.length<r){var s=new i(r-n.length);s.fill(0),n=i.concat([s,n])}return e?n.toString(e):n}o.p224=o.secp224r1,o.p256=o.secp256r1=o.prime256v1,o.p192=o.secp192r1=o.prime192v1,o.p384=o.secp384r1,o.p521=o.secp521r1,a.prototype.generateKeys=function(t,e){return this.keys=this.curve.genKeyPair(),this.getPublicKey(t,e)},a.prototype.computeSecret=function(t,e,r){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),h(this.curve.keyFromPublic(t).getPublic().mul(this.keys.getPrivate()).getX(),r,this.curveType.byteLength)},a.prototype.getPublicKey=function(t,e){var r=this.keys.getPublic("compressed"===e,!0);return"hybrid"===e&&(r[r.length-1]%2?r[0]=7:r[0]=6),h(r,t)},a.prototype.getPrivateKey=function(t){return h(this.keys.getPrivate(),t)},a.prototype.setPublicKey=function(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this.keys._importPublic(t),this},a.prototype.setPrivateKey=function(t,e){e=e||"utf8",i.isBuffer(t)||(t=new i(t,e));var r=new s(t);return r=r.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(r),this}},5182:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(7965).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,i){for(var n=0,s=Math.min(t.length,r),o=e;o<s;o++){var a=t.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?c[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=l[t],f=d[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(t);r=(p=p.idivn(f)).isZero()?m+r:c[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return i(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,u=new t(s),c=this.clone();if(h){for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function m(t,e,r){return(new g).mulp(t,e,r)}function g(t,e){this.x=t,this.y=e}Math.imul||(p=f),s.prototype.mulTo=function(t,e){var r,i=this.length+t.length;return r=10===this.length&&10===t.length?p(this,t,e):i<63?f(this,t,e):i<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,t,e):m(this,t,e),r},g.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},g.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},g.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},g.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},g.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},g.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},g.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},g.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},g.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),m(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){i("number"==typeof t),i(t<67108864);for(var e=0,r=0;r<this.length;r++){var n=(0|this.words[r])*t,s=(67108863&n)+(67108863&e);e>>=26,e+=n/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=(t.words[i]&1<<n)>>>n}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a.strip(),i.strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){i(t<=67108863);for(var e=(1<<26)%t,r=0,n=this.length-1;n>=0;n--)r=(e*r+(0|this.words[n]))%t;return r},s.prototype.idivn=function(t){i(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*e;this.words[r]=n/t|0,e=n%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new S(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){S.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},n(v,y),v.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(w,y),n(M,y),n(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return b[t]=e,e},S.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},S.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},S.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},S.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},S.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},S.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},S.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},S.prototype.isqr=function(t){return this.imul(t,t.clone())},S.prototype.sqr=function(t){return this.mul(t,t)},S.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},S.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},S.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},S.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},S.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new E(t)},n(E,S),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},7108:(t,e,r)=>{"use strict";var i=r(6698),n=r(8276),s=r(6011),o=r(2802),a=r(6168);function h(t){a.call(this,"digest"),this._hash=t}i(h,a),h.prototype._update=function(t){this._hash.update(t)},h.prototype._final=function(){return this._hash.digest()},t.exports=function(t){return"md5"===(t=t.toLowerCase())?new n:"rmd160"===t||"ripemd160"===t?new s:new h(o(t))}},320:(t,e,r)=>{var i=r(8276);t.exports=function(t){return(new i).update(t).digest()}},3507:(t,e,r)=>{"use strict";var i=r(6698),n=r(1800),s=r(6168),o=r(2861).Buffer,a=r(320),h=r(6011),u=r(2802),c=o.alloc(128);function l(t,e){s.call(this,"digest"),"string"==typeof e&&(e=o.from(e));var r="sha512"===t||"sha384"===t?128:64;this._alg=t,this._key=e,e.length>r?e=("rmd160"===t?new h:u(t)).update(e).digest():e.length<r&&(e=o.concat([e,c],r));for(var i=this._ipad=o.allocUnsafe(r),n=this._opad=o.allocUnsafe(r),a=0;a<r;a++)i[a]=54^e[a],n[a]=92^e[a];this._hash="rmd160"===t?new h:u(t),this._hash.update(i)}i(l,s),l.prototype._update=function(t){this._hash.update(t)},l.prototype._final=function(){var t=this._hash.digest();return("rmd160"===this._alg?new h:u(this._alg)).update(this._opad).update(t).digest()},t.exports=function(t,e){return"rmd160"===(t=t.toLowerCase())||"ripemd160"===t?new l("rmd160",e):"md5"===t?new n(a,e):new l(t,e)}},1800:(t,e,r)=>{"use strict";var i=r(6698),n=r(2861).Buffer,s=r(6168),o=n.alloc(128),a=64;function h(t,e){s.call(this,"digest"),"string"==typeof e&&(e=n.from(e)),this._alg=t,this._key=e,e.length>a?e=t(e):e.length<a&&(e=n.concat([e,o],a));for(var r=this._ipad=n.allocUnsafe(a),i=this._opad=n.allocUnsafe(a),h=0;h<a;h++)r[h]=54^e[h],i[h]=92^e[h];this._hash=[r]}i(h,s),h.prototype._update=function(t){this._hash.push(t)},h.prototype._final=function(){var t=this._alg(n.concat(this._hash));return this._alg(n.concat([this._opad,t]))},t.exports=h},1565:(t,e,r)=>{"use strict";r(3209),e.n1=r(7108),r(3507);var i=r(5715),n=Object.keys(i),s=(["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(n),r(8396));s.pbkdf2,s.pbkdf2Sync;var o=r(125);o.Cipher,o.createCipher,o.Cipheriv,o.createCipheriv,o.Decipher,o.createDecipher,o.Decipheriv,o.createDecipheriv,o.getCiphers,o.listCiphers;var a=r(5380);a.DiffieHellmanGroup,a.createDiffieHellmanGroup,a.getDiffieHellman,a.createDiffieHellman,a.DiffieHellman;var h=r(20);h.createSign,h.Sign,h.createVerify,h.Verify,r(1324);var u=r(7168);u.publicEncrypt,u.privateEncrypt,u.publicDecrypt,u.privateDecrypt;var c=r(6983);c.randomFill,c.randomFillSync},9560:(t,e,r)=>{"use strict";e.utils=r(7626),e.Cipher=r(2808),e.DES=r(2211),e.CBC=r(3389),e.EDE=r(5279)},3389:(t,e,r)=>{"use strict";var i=r(3349),n=r(6698),s={};function o(t){i.equal(t.length,8,"Invalid IV length"),this.iv=new Array(8);for(var e=0;e<this.iv.length;e++)this.iv[e]=t[e]}e.instantiate=function(t){function e(e){t.call(this,e),this._cbcInit()}n(e,t);for(var r=Object.keys(s),i=0;i<r.length;i++){var o=r[i];e.prototype[o]=s[o]}return e.create=function(t){return new e(t)},e},s._cbcInit=function(){var t=new o(this.options.iv);this._cbcState=t},s._update=function(t,e,r,i){var n=this._cbcState,s=this.constructor.super_.prototype,o=n.iv;if("encrypt"===this.type){for(var a=0;a<this.blockSize;a++)o[a]^=t[e+a];for(s._update.call(this,o,0,r,i),a=0;a<this.blockSize;a++)o[a]=r[i+a]}else{for(s._update.call(this,t,e,r,i),a=0;a<this.blockSize;a++)r[i+a]^=o[a];for(a=0;a<this.blockSize;a++)o[a]=t[e+a]}}},2808:(t,e,r)=>{"use strict";var i=r(3349);function n(t){this.options=t,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0,this.padding=!1!==t.padding}t.exports=n,n.prototype._init=function(){},n.prototype.update=function(t){return 0===t.length?[]:"decrypt"===this.type?this._updateDecrypt(t):this._updateEncrypt(t)},n.prototype._buffer=function(t,e){for(var r=Math.min(this.buffer.length-this.bufferOff,t.length-e),i=0;i<r;i++)this.buffer[this.bufferOff+i]=t[e+i];return this.bufferOff+=r,r},n.prototype._flushBuffer=function(t,e){return this._update(this.buffer,0,t,e),this.bufferOff=0,this.blockSize},n.prototype._updateEncrypt=function(t){var e=0,r=0,i=(this.bufferOff+t.length)/this.blockSize|0,n=new Array(i*this.blockSize);0!==this.bufferOff&&(e+=this._buffer(t,e),this.bufferOff===this.buffer.length&&(r+=this._flushBuffer(n,r)));for(var s=t.length-(t.length-e)%this.blockSize;e<s;e+=this.blockSize)this._update(t,e,n,r),r+=this.blockSize;for(;e<t.length;e++,this.bufferOff++)this.buffer[this.bufferOff]=t[e];return n},n.prototype._updateDecrypt=function(t){for(var e=0,r=0,i=Math.ceil((this.bufferOff+t.length)/this.blockSize)-1,n=new Array(i*this.blockSize);i>0;i--)e+=this._buffer(t,e),r+=this._flushBuffer(n,r);return e+=this._buffer(t,e),n},n.prototype.final=function(t){var e,r;return t&&(e=this.update(t)),r="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),e?e.concat(r):r},n.prototype._pad=function(t,e){if(0===e)return!1;for(;e<t.length;)t[e++]=0;return!0},n.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var t=new Array(this.blockSize);return this._update(this.buffer,0,t,0),t},n.prototype._unpad=function(t){return t},n.prototype._finalDecrypt=function(){i.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var t=new Array(this.blockSize);return this._flushBuffer(t,0),this._unpad(t)}},2211:(t,e,r)=>{"use strict";var i=r(3349),n=r(6698),s=r(7626),o=r(2808);function a(){this.tmp=new Array(2),this.keys=null}function h(t){o.call(this,t);var e=new a;this._desState=e,this.deriveKeys(e,t.key)}n(h,o),t.exports=h,h.create=function(t){return new h(t)};var u=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];h.prototype.deriveKeys=function(t,e){t.keys=new Array(32),i.equal(e.length,this.blockSize,"Invalid key length");var r=s.readUInt32BE(e,0),n=s.readUInt32BE(e,4);s.pc1(r,n,t.tmp,0),r=t.tmp[0],n=t.tmp[1];for(var o=0;o<t.keys.length;o+=2){var a=u[o>>>1];r=s.r28shl(r,a),n=s.r28shl(n,a),s.pc2(r,n,t.keys,o)}},h.prototype._update=function(t,e,r,i){var n=this._desState,o=s.readUInt32BE(t,e),a=s.readUInt32BE(t,e+4);s.ip(o,a,n.tmp,0),o=n.tmp[0],a=n.tmp[1],"encrypt"===this.type?this._encrypt(n,o,a,n.tmp,0):this._decrypt(n,o,a,n.tmp,0),o=n.tmp[0],a=n.tmp[1],s.writeUInt32BE(r,o,i),s.writeUInt32BE(r,a,i+4)},h.prototype._pad=function(t,e){if(!1===this.padding)return!1;for(var r=t.length-e,i=e;i<t.length;i++)t[i]=r;return!0},h.prototype._unpad=function(t){if(!1===this.padding)return t;for(var e=t[t.length-1],r=t.length-e;r<t.length;r++)i.equal(t[r],e);return t.slice(0,t.length-e)},h.prototype._encrypt=function(t,e,r,i,n){for(var o=e,a=r,h=0;h<t.keys.length;h+=2){var u=t.keys[h],c=t.keys[h+1];s.expand(a,t.tmp,0),u^=t.tmp[0],c^=t.tmp[1];var l=s.substitute(u,c),d=a;a=(o^s.permute(l))>>>0,o=d}s.rip(a,o,i,n)},h.prototype._decrypt=function(t,e,r,i,n){for(var o=r,a=e,h=t.keys.length-2;h>=0;h-=2){var u=t.keys[h],c=t.keys[h+1];s.expand(o,t.tmp,0),u^=t.tmp[0],c^=t.tmp[1];var l=s.substitute(u,c),d=o;o=(a^s.permute(l))>>>0,a=d}s.rip(o,a,i,n)}},5279:(t,e,r)=>{"use strict";var i=r(3349),n=r(6698),s=r(2808),o=r(2211);function a(t,e){i.equal(e.length,24,"Invalid key length");var r=e.slice(0,8),n=e.slice(8,16),s=e.slice(16,24);this.ciphers="encrypt"===t?[o.create({type:"encrypt",key:r}),o.create({type:"decrypt",key:n}),o.create({type:"encrypt",key:s})]:[o.create({type:"decrypt",key:s}),o.create({type:"encrypt",key:n}),o.create({type:"decrypt",key:r})]}function h(t){s.call(this,t);var e=new a(this.type,this.options.key);this._edeState=e}n(h,s),t.exports=h,h.create=function(t){return new h(t)},h.prototype._update=function(t,e,r,i){var n=this._edeState;n.ciphers[0]._update(t,e,r,i),n.ciphers[1]._update(r,i,r,i),n.ciphers[2]._update(r,i,r,i)},h.prototype._pad=o.prototype._pad,h.prototype._unpad=o.prototype._unpad},7626:(t,e)=>{"use strict";e.readUInt32BE=function(t,e){return(t[0+e]<<24|t[1+e]<<16|t[2+e]<<8|t[3+e])>>>0},e.writeUInt32BE=function(t,e,r){t[0+r]=e>>>24,t[1+r]=e>>>16&255,t[2+r]=e>>>8&255,t[3+r]=255&e},e.ip=function(t,e,r,i){for(var n=0,s=0,o=6;o>=0;o-=2){for(var a=0;a<=24;a+=8)n<<=1,n|=e>>>a+o&1;for(a=0;a<=24;a+=8)n<<=1,n|=t>>>a+o&1}for(o=6;o>=0;o-=2){for(a=1;a<=25;a+=8)s<<=1,s|=e>>>a+o&1;for(a=1;a<=25;a+=8)s<<=1,s|=t>>>a+o&1}r[i+0]=n>>>0,r[i+1]=s>>>0},e.rip=function(t,e,r,i){for(var n=0,s=0,o=0;o<4;o++)for(var a=24;a>=0;a-=8)n<<=1,n|=e>>>a+o&1,n<<=1,n|=t>>>a+o&1;for(o=4;o<8;o++)for(a=24;a>=0;a-=8)s<<=1,s|=e>>>a+o&1,s<<=1,s|=t>>>a+o&1;r[i+0]=n>>>0,r[i+1]=s>>>0},e.pc1=function(t,e,r,i){for(var n=0,s=0,o=7;o>=5;o--){for(var a=0;a<=24;a+=8)n<<=1,n|=e>>a+o&1;for(a=0;a<=24;a+=8)n<<=1,n|=t>>a+o&1}for(a=0;a<=24;a+=8)n<<=1,n|=e>>a+o&1;for(o=1;o<=3;o++){for(a=0;a<=24;a+=8)s<<=1,s|=e>>a+o&1;for(a=0;a<=24;a+=8)s<<=1,s|=t>>a+o&1}for(a=0;a<=24;a+=8)s<<=1,s|=t>>a+o&1;r[i+0]=n>>>0,r[i+1]=s>>>0},e.r28shl=function(t,e){return t<<e&268435455|t>>>28-e};var r=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];e.pc2=function(t,e,i,n){for(var s=0,o=0,a=r.length>>>1,h=0;h<a;h++)s<<=1,s|=t>>>r[h]&1;for(h=a;h<r.length;h++)o<<=1,o|=e>>>r[h]&1;i[n+0]=s>>>0,i[n+1]=o>>>0},e.expand=function(t,e,r){var i=0,n=0;i=(1&t)<<5|t>>>27;for(var s=23;s>=15;s-=4)i<<=6,i|=t>>>s&63;for(s=11;s>=3;s-=4)n|=t>>>s&63,n<<=6;n|=(31&t)<<1|t>>>31,e[r+0]=i>>>0,e[r+1]=n>>>0};var i=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];e.substitute=function(t,e){for(var r=0,n=0;n<4;n++)r<<=4,r|=i[64*n+(t>>>18-6*n&63)];for(n=0;n<4;n++)r<<=4,r|=i[256+64*n+(e>>>18-6*n&63)];return r>>>0};var n=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];e.permute=function(t){for(var e=0,r=0;r<n.length;r++)e<<=1,e|=t>>>n[r]&1;return e>>>0},e.padSplit=function(t,e,r){for(var i=t.toString(2);i.length<e;)i="0"+i;for(var n=[],s=0;s<e;s+=r)n.push(i.slice(s,s+r));return n.join(" ")}},5380:(t,e,r)=>{var i=r(8287).Buffer,n=r(4934),s=r(3241),o=r(4910),a={binary:!0,hex:!0,base64:!0};e.DiffieHellmanGroup=e.createDiffieHellmanGroup=e.getDiffieHellman=function(t){var e=new i(s[t].prime,"hex"),r=new i(s[t].gen,"hex");return new o(e,r)},e.createDiffieHellman=e.DiffieHellman=function t(e,r,s,h){return i.isBuffer(r)||void 0===a[r]?t(e,"binary",r,s):(r=r||"binary",h=h||"binary",s=s||new i([2]),i.isBuffer(s)||(s=new i(s,h)),"number"==typeof e?new o(n(e,s),s,!0):(i.isBuffer(e)||(e=new i(e,r)),new o(e,s,!0)))}},4910:(t,e,r)=>{var i=r(8287).Buffer,n=r(6473),s=new(r(2244)),o=new n(24),a=new n(11),h=new n(10),u=new n(3),c=new n(7),l=r(4934),d=r(3209);function f(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this._pub=new n(t),this}function p(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this._priv=new n(t),this}t.exports=g;var m={};function g(t,e,r){this.setGenerator(e),this.__prime=new n(t),this._prime=n.mont(this.__prime),this._primeLen=t.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,r?(this.setPublicKey=f,this.setPrivateKey=p):this._primeCode=8}function b(t,e){var r=new i(t.toArray());return e?r.toString(e):r}Object.defineProperty(g.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(t,e){var r=e.toString("hex"),i=[r,t.toString(16)].join("_");if(i in m)return m[i];var n,d=0;if(t.isEven()||!l.simpleSieve||!l.fermatTest(t)||!s.test(t))return d+=1,d+="02"===r||"05"===r?8:4,m[i]=d,d;switch(s.test(t.shrn(1))||(d+=2),r){case"02":t.mod(o).cmp(a)&&(d+=8);break;case"05":(n=t.mod(h)).cmp(u)&&n.cmp(c)&&(d+=8);break;default:d+=4}return m[i]=d,d}(this.__prime,this.__gen)),this._primeCode}}),g.prototype.generateKeys=function(){return this._priv||(this._priv=new n(d(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},g.prototype.computeSecret=function(t){var e=(t=(t=new n(t)).toRed(this._prime)).redPow(this._priv).fromRed(),r=new i(e.toArray()),s=this.getPrime();if(r.length<s.length){var o=new i(s.length-r.length);o.fill(0),r=i.concat([o,r])}return r},g.prototype.getPublicKey=function(t){return b(this._pub,t)},g.prototype.getPrivateKey=function(t){return b(this._priv,t)},g.prototype.getPrime=function(t){return b(this.__prime,t)},g.prototype.getGenerator=function(t){return b(this._gen,t)},g.prototype.setGenerator=function(t,e){return e=e||"utf8",i.isBuffer(t)||(t=new i(t,e)),this.__gen=t,this._gen=new n(t),this}},4934:(t,e,r)=>{var i=r(3209);t.exports=y,y.simpleSieve=g,y.fermatTest=b;var n=r(6473),s=new n(24),o=new(r(2244)),a=new n(1),h=new n(2),u=new n(5),c=(new n(16),new n(8),new n(10)),l=new n(3),d=(new n(7),new n(11)),f=new n(4),p=(new n(12),null);function m(){if(null!==p)return p;var t=[];t[0]=2;for(var e=1,r=3;r<1048576;r+=2){for(var i=Math.ceil(Math.sqrt(r)),n=0;n<e&&t[n]<=i&&r%t[n]!=0;n++);e!==n&&t[n]<=i||(t[e++]=r)}return p=t,t}function g(t){for(var e=m(),r=0;r<e.length;r++)if(0===t.modn(e[r]))return 0===t.cmpn(e[r]);return!0}function b(t){var e=n.mont(t);return 0===h.toRed(e).redPow(t.subn(1)).fromRed().cmpn(1)}function y(t,e){if(t<16)return new n(2===e||5===e?[140,123]:[140,39]);var r,p;for(e=new n(e);;){for(r=new n(i(Math.ceil(t/8)));r.bitLength()>t;)r.ishrn(1);if(r.isEven()&&r.iadd(a),r.testn(1)||r.iadd(h),e.cmp(h)){if(!e.cmp(u))for(;r.mod(c).cmp(l);)r.iadd(f)}else for(;r.mod(s).cmp(d);)r.iadd(f);if(g(p=r.shrn(1))&&g(r)&&b(p)&&b(r)&&o.test(p)&&o.test(r))return r}}},6473:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(6089).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,i){for(var n=0,s=Math.min(t.length,r),o=e;o<s;o++){var a=t.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?c[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=l[t],f=d[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(t);r=(p=p.idivn(f)).isZero()?m+r:c[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return i(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,u=new t(s),c=this.clone();if(h){for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function m(t,e,r){return(new g).mulp(t,e,r)}function g(t,e){this.x=t,this.y=e}Math.imul||(p=f),s.prototype.mulTo=function(t,e){var r,i=this.length+t.length;return r=10===this.length&&10===t.length?p(this,t,e):i<63?f(this,t,e):i<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,t,e):m(this,t,e),r},g.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},g.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},g.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},g.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},g.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},g.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},g.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},g.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},g.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),m(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){i("number"==typeof t),i(t<67108864);for(var e=0,r=0;r<this.length;r++){var n=(0|this.words[r])*t,s=(67108863&n)+(67108863&e);e>>=26,e+=n/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=(t.words[i]&1<<n)>>>n}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a.strip(),i.strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){i(t<=67108863);for(var e=(1<<26)%t,r=0,n=this.length-1;n>=0;n--)r=(e*r+(0|this.words[n]))%t;return r},s.prototype.idivn=function(t){i(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*e;this.words[r]=n/t|0,e=n%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new S(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){S.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},n(v,y),v.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(w,y),n(M,y),n(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return b[t]=e,e},S.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},S.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},S.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},S.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},S.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},S.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},S.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},S.prototype.isqr=function(t){return this.imul(t,t.clone())},S.prototype.sqr=function(t){return this.mul(t,t)},S.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},S.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},S.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},S.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},S.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new E(t)},n(E,S),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},6729:(t,e,r)=>{"use strict";var i=e;i.version=r(1636).rE,i.utils=r(7011),i.rand=r(5037),i.curve=r(894),i.curves=r(480),i.ec=r(7447),i.eddsa=r(8650)},6677:(t,e,r)=>{"use strict";var i=r(8490),n=r(7011),s=n.getNAF,o=n.getJSF,a=n.assert;function h(t,e){this.type=t,this.p=new i(e.p,16),this.red=e.prime?i.red(e.prime):i.mont(this.p),this.zero=new i(0).toRed(this.red),this.one=new i(1).toRed(this.red),this.two=new i(2).toRed(this.red),this.n=e.n&&new i(e.n,16),this.g=e.g&&this.pointFromJSON(e.g,e.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function u(t,e){this.curve=t,this.type=e,this.precomputed=null}t.exports=h,h.prototype.point=function(){throw new Error("Not implemented")},h.prototype.validate=function(){throw new Error("Not implemented")},h.prototype._fixedNafMul=function(t,e){a(t.precomputed);var r=t._getDoubles(),i=s(e,1,this._bitLength),n=(1<<r.step+1)-(r.step%2==0?2:1);n/=3;var o,h,u=[];for(o=0;o<i.length;o+=r.step){h=0;for(var c=o+r.step-1;c>=o;c--)h=(h<<1)+i[c];u.push(h)}for(var l=this.jpoint(null,null,null),d=this.jpoint(null,null,null),f=n;f>0;f--){for(o=0;o<u.length;o++)(h=u[o])===f?d=d.mixedAdd(r.points[o]):h===-f&&(d=d.mixedAdd(r.points[o].neg()));l=l.add(d)}return l.toP()},h.prototype._wnafMul=function(t,e){var r=4,i=t._getNAFPoints(r);r=i.wnd;for(var n=i.points,o=s(e,r,this._bitLength),h=this.jpoint(null,null,null),u=o.length-1;u>=0;u--){for(var c=0;u>=0&&0===o[u];u--)c++;if(u>=0&&c++,h=h.dblp(c),u<0)break;var l=o[u];a(0!==l),h="affine"===t.type?l>0?h.mixedAdd(n[l-1>>1]):h.mixedAdd(n[-l-1>>1].neg()):l>0?h.add(n[l-1>>1]):h.add(n[-l-1>>1].neg())}return"affine"===t.type?h.toP():h},h.prototype._wnafMulAdd=function(t,e,r,i,n){var a,h,u,c=this._wnafT1,l=this._wnafT2,d=this._wnafT3,f=0;for(a=0;a<i;a++){var p=(u=e[a])._getNAFPoints(t);c[a]=p.wnd,l[a]=p.points}for(a=i-1;a>=1;a-=2){var m=a-1,g=a;if(1===c[m]&&1===c[g]){var b=[e[m],null,null,e[g]];0===e[m].y.cmp(e[g].y)?(b[1]=e[m].add(e[g]),b[2]=e[m].toJ().mixedAdd(e[g].neg())):0===e[m].y.cmp(e[g].y.redNeg())?(b[1]=e[m].toJ().mixedAdd(e[g]),b[2]=e[m].add(e[g].neg())):(b[1]=e[m].toJ().mixedAdd(e[g]),b[2]=e[m].toJ().mixedAdd(e[g].neg()));var y=[-3,-1,-5,-7,0,7,5,1,3],v=o(r[m],r[g]);for(f=Math.max(v[0].length,f),d[m]=new Array(f),d[g]=new Array(f),h=0;h<f;h++){var w=0|v[0][h],M=0|v[1][h];d[m][h]=y[3*(w+1)+(M+1)],d[g][h]=0,l[m]=b}}else d[m]=s(r[m],c[m],this._bitLength),d[g]=s(r[g],c[g],this._bitLength),f=Math.max(d[m].length,f),f=Math.max(d[g].length,f)}var _=this.jpoint(null,null,null),S=this._wnafT4;for(a=f;a>=0;a--){for(var E=0;a>=0;){var k=!0;for(h=0;h<i;h++)S[h]=0|d[h][a],0!==S[h]&&(k=!1);if(!k)break;E++,a--}if(a>=0&&E++,_=_.dblp(E),a<0)break;for(h=0;h<i;h++){var A=S[h];0!==A&&(A>0?u=l[h][A-1>>1]:A<0&&(u=l[h][-A-1>>1].neg()),_="affine"===u.type?_.mixedAdd(u):_.add(u))}}for(a=0;a<i;a++)l[a]=null;return n?_:_.toP()},h.BasePoint=u,u.prototype.eq=function(){throw new Error("Not implemented")},u.prototype.validate=function(){return this.curve.validate(this)},h.prototype.decodePoint=function(t,e){t=n.toArray(t,e);var r=this.p.byteLength();if((4===t[0]||6===t[0]||7===t[0])&&t.length-1==2*r)return 6===t[0]?a(t[t.length-1]%2==0):7===t[0]&&a(t[t.length-1]%2==1),this.point(t.slice(1,1+r),t.slice(1+r,1+2*r));if((2===t[0]||3===t[0])&&t.length-1===r)return this.pointFromX(t.slice(1,1+r),3===t[0]);throw new Error("Unknown point format")},u.prototype.encodeCompressed=function(t){return this.encode(t,!0)},u.prototype._encode=function(t){var e=this.curve.p.byteLength(),r=this.getX().toArray("be",e);return t?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",e))},u.prototype.encode=function(t,e){return n.encode(this._encode(e),t)},u.prototype.precompute=function(t){if(this.precomputed)return this;var e={doubles:null,naf:null,beta:null};return e.naf=this._getNAFPoints(8),e.doubles=this._getDoubles(4,t),e.beta=this._getBeta(),this.precomputed=e,this},u.prototype._hasDoubles=function(t){if(!this.precomputed)return!1;var e=this.precomputed.doubles;return!!e&&e.points.length>=Math.ceil((t.bitLength()+1)/e.step)},u.prototype._getDoubles=function(t,e){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],i=this,n=0;n<e;n+=t){for(var s=0;s<t;s++)i=i.dbl();r.push(i)}return{step:t,points:r}},u.prototype._getNAFPoints=function(t){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var e=[this],r=(1<<t)-1,i=1===r?null:this.dbl(),n=1;n<r;n++)e[n]=e[n-1].add(i);return{wnd:t,points:e}},u.prototype._getBeta=function(){return null},u.prototype.dblp=function(t){for(var e=this,r=0;r<t;r++)e=e.dbl();return e}},1298:(t,e,r)=>{"use strict";var i=r(7011),n=r(8490),s=r(6698),o=r(6677),a=i.assert;function h(t){this.twisted=1!=(0|t.a),this.mOneA=this.twisted&&-1==(0|t.a),this.extended=this.mOneA,o.call(this,"edwards",t),this.a=new n(t.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new n(t.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new n(t.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),a(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|t.c)}function u(t,e,r,i,s){o.BasePoint.call(this,t,"projective"),null===e&&null===r&&null===i?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new n(e,16),this.y=new n(r,16),this.z=i?new n(i,16):this.curve.one,this.t=s&&new n(s,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}s(h,o),t.exports=h,h.prototype._mulA=function(t){return this.mOneA?t.redNeg():this.a.redMul(t)},h.prototype._mulC=function(t){return this.oneC?t:this.c.redMul(t)},h.prototype.jpoint=function(t,e,r,i){return this.point(t,e,r,i)},h.prototype.pointFromX=function(t,e){(t=new n(t,16)).red||(t=t.toRed(this.red));var r=t.redSqr(),i=this.c2.redSub(this.a.redMul(r)),s=this.one.redSub(this.c2.redMul(this.d).redMul(r)),o=i.redMul(s.redInvm()),a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");var h=a.fromRed().isOdd();return(e&&!h||!e&&h)&&(a=a.redNeg()),this.point(t,a)},h.prototype.pointFromY=function(t,e){(t=new n(t,16)).red||(t=t.toRed(this.red));var r=t.redSqr(),i=r.redSub(this.c2),s=r.redMul(this.d).redMul(this.c2).redSub(this.a),o=i.redMul(s.redInvm());if(0===o.cmp(this.zero)){if(e)throw new Error("invalid point");return this.point(this.zero,t)}var a=o.redSqrt();if(0!==a.redSqr().redSub(o).cmp(this.zero))throw new Error("invalid point");return a.fromRed().isOdd()!==e&&(a=a.redNeg()),this.point(a,t)},h.prototype.validate=function(t){if(t.isInfinity())return!0;t.normalize();var e=t.x.redSqr(),r=t.y.redSqr(),i=e.redMul(this.a).redAdd(r),n=this.c2.redMul(this.one.redAdd(this.d.redMul(e).redMul(r)));return 0===i.cmp(n)},s(u,o.BasePoint),h.prototype.pointFromJSON=function(t){return u.fromJSON(this,t)},h.prototype.point=function(t,e,r,i){return new u(this,t,e,r,i)},u.fromJSON=function(t,e){return new u(t,e[0],e[1],e[2])},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},u.prototype._extDbl=function(){var t=this.x.redSqr(),e=this.y.redSqr(),r=this.z.redSqr();r=r.redIAdd(r);var i=this.curve._mulA(t),n=this.x.redAdd(this.y).redSqr().redISub(t).redISub(e),s=i.redAdd(e),o=s.redSub(r),a=i.redSub(e),h=n.redMul(o),u=s.redMul(a),c=n.redMul(a),l=o.redMul(s);return this.curve.point(h,u,l,c)},u.prototype._projDbl=function(){var t,e,r,i,n,s,o=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),h=this.y.redSqr();if(this.curve.twisted){var u=(i=this.curve._mulA(a)).redAdd(h);this.zOne?(t=o.redSub(a).redSub(h).redMul(u.redSub(this.curve.two)),e=u.redMul(i.redSub(h)),r=u.redSqr().redSub(u).redSub(u)):(n=this.z.redSqr(),s=u.redSub(n).redISub(n),t=o.redSub(a).redISub(h).redMul(s),e=u.redMul(i.redSub(h)),r=u.redMul(s))}else i=a.redAdd(h),n=this.curve._mulC(this.z).redSqr(),s=i.redSub(n).redSub(n),t=this.curve._mulC(o.redISub(i)).redMul(s),e=this.curve._mulC(i).redMul(a.redISub(h)),r=i.redMul(s);return this.curve.point(t,e,r)},u.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},u.prototype._extAdd=function(t){var e=this.y.redSub(this.x).redMul(t.y.redSub(t.x)),r=this.y.redAdd(this.x).redMul(t.y.redAdd(t.x)),i=this.t.redMul(this.curve.dd).redMul(t.t),n=this.z.redMul(t.z.redAdd(t.z)),s=r.redSub(e),o=n.redSub(i),a=n.redAdd(i),h=r.redAdd(e),u=s.redMul(o),c=a.redMul(h),l=s.redMul(h),d=o.redMul(a);return this.curve.point(u,c,d,l)},u.prototype._projAdd=function(t){var e,r,i=this.z.redMul(t.z),n=i.redSqr(),s=this.x.redMul(t.x),o=this.y.redMul(t.y),a=this.curve.d.redMul(s).redMul(o),h=n.redSub(a),u=n.redAdd(a),c=this.x.redAdd(this.y).redMul(t.x.redAdd(t.y)).redISub(s).redISub(o),l=i.redMul(h).redMul(c);return this.curve.twisted?(e=i.redMul(u).redMul(o.redSub(this.curve._mulA(s))),r=h.redMul(u)):(e=i.redMul(u).redMul(o.redSub(s)),r=this.curve._mulC(h).redMul(u)),this.curve.point(l,e,r)},u.prototype.add=function(t){return this.isInfinity()?t:t.isInfinity()?this:this.curve.extended?this._extAdd(t):this._projAdd(t)},u.prototype.mul=function(t){return this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve._wnafMul(this,t)},u.prototype.mulAdd=function(t,e,r){return this.curve._wnafMulAdd(1,[this,e],[t,r],2,!1)},u.prototype.jmulAdd=function(t,e,r){return this.curve._wnafMulAdd(1,[this,e],[t,r],2,!0)},u.prototype.normalize=function(){if(this.zOne)return this;var t=this.z.redInvm();return this.x=this.x.redMul(t),this.y=this.y.redMul(t),this.t&&(this.t=this.t.redMul(t)),this.z=this.curve.one,this.zOne=!0,this},u.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},u.prototype.getX=function(){return this.normalize(),this.x.fromRed()},u.prototype.getY=function(){return this.normalize(),this.y.fromRed()},u.prototype.eq=function(t){return this===t||0===this.getX().cmp(t.getX())&&0===this.getY().cmp(t.getY())},u.prototype.eqXToP=function(t){var e=t.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(e))return!0;for(var r=t.clone(),i=this.curve.redN.redMul(this.z);;){if(r.iadd(this.curve.n),r.cmp(this.curve.p)>=0)return!1;if(e.redIAdd(i),0===this.x.cmp(e))return!0}},u.prototype.toP=u.prototype.normalize,u.prototype.mixedAdd=u.prototype.add},894:(t,e,r)=>{"use strict";var i=e;i.base=r(6677),i.short=r(9188),i.mont=r(370),i.edwards=r(1298)},370:(t,e,r)=>{"use strict";var i=r(8490),n=r(6698),s=r(6677),o=r(7011);function a(t){s.call(this,"mont",t),this.a=new i(t.a,16).toRed(this.red),this.b=new i(t.b,16).toRed(this.red),this.i4=new i(4).toRed(this.red).redInvm(),this.two=new i(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function h(t,e,r){s.BasePoint.call(this,t,"projective"),null===e&&null===r?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new i(e,16),this.z=new i(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}n(a,s),t.exports=a,a.prototype.validate=function(t){var e=t.normalize().x,r=e.redSqr(),i=r.redMul(e).redAdd(r.redMul(this.a)).redAdd(e);return 0===i.redSqrt().redSqr().cmp(i)},n(h,s.BasePoint),a.prototype.decodePoint=function(t,e){return this.point(o.toArray(t,e),1)},a.prototype.point=function(t,e){return new h(this,t,e)},a.prototype.pointFromJSON=function(t){return h.fromJSON(this,t)},h.prototype.precompute=function(){},h.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},h.fromJSON=function(t,e){return new h(t,e[0],e[1]||t.one)},h.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},h.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},h.prototype.dbl=function(){var t=this.x.redAdd(this.z).redSqr(),e=this.x.redSub(this.z).redSqr(),r=t.redSub(e),i=t.redMul(e),n=r.redMul(e.redAdd(this.curve.a24.redMul(r)));return this.curve.point(i,n)},h.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.diffAdd=function(t,e){var r=this.x.redAdd(this.z),i=this.x.redSub(this.z),n=t.x.redAdd(t.z),s=t.x.redSub(t.z).redMul(r),o=n.redMul(i),a=e.z.redMul(s.redAdd(o).redSqr()),h=e.x.redMul(s.redISub(o).redSqr());return this.curve.point(a,h)},h.prototype.mul=function(t){for(var e=t.clone(),r=this,i=this.curve.point(null,null),n=[];0!==e.cmpn(0);e.iushrn(1))n.push(e.andln(1));for(var s=n.length-1;s>=0;s--)0===n[s]?(r=r.diffAdd(i,this),i=i.dbl()):(i=r.diffAdd(i,this),r=r.dbl());return i},h.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.eq=function(t){return 0===this.getX().cmp(t.getX())},h.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},h.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},9188:(t,e,r)=>{"use strict";var i=r(7011),n=r(8490),s=r(6698),o=r(6677),a=i.assert;function h(t){o.call(this,"short",t),this.a=new n(t.a,16).toRed(this.red),this.b=new n(t.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(t),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function u(t,e,r,i){o.BasePoint.call(this,t,"affine"),null===e&&null===r?(this.x=null,this.y=null,this.inf=!0):(this.x=new n(e,16),this.y=new n(r,16),i&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function c(t,e,r,i){o.BasePoint.call(this,t,"jacobian"),null===e&&null===r&&null===i?(this.x=this.curve.one,this.y=this.curve.one,this.z=new n(0)):(this.x=new n(e,16),this.y=new n(r,16),this.z=new n(i,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}s(h,o),t.exports=h,h.prototype._getEndomorphism=function(t){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var e,r;if(t.beta)e=new n(t.beta,16).toRed(this.red);else{var i=this._getEndoRoots(this.p);e=(e=i[0].cmp(i[1])<0?i[0]:i[1]).toRed(this.red)}if(t.lambda)r=new n(t.lambda,16);else{var s=this._getEndoRoots(this.n);0===this.g.mul(s[0]).x.cmp(this.g.x.redMul(e))?r=s[0]:(r=s[1],a(0===this.g.mul(r).x.cmp(this.g.x.redMul(e))))}return{beta:e,lambda:r,basis:t.basis?t.basis.map((function(t){return{a:new n(t.a,16),b:new n(t.b,16)}})):this._getEndoBasis(r)}}},h.prototype._getEndoRoots=function(t){var e=t===this.p?this.red:n.mont(t),r=new n(2).toRed(e).redInvm(),i=r.redNeg(),s=new n(3).toRed(e).redNeg().redSqrt().redMul(r);return[i.redAdd(s).fromRed(),i.redSub(s).fromRed()]},h.prototype._getEndoBasis=function(t){for(var e,r,i,s,o,a,h,u,c,l=this.n.ushrn(Math.floor(this.n.bitLength()/2)),d=t,f=this.n.clone(),p=new n(1),m=new n(0),g=new n(0),b=new n(1),y=0;0!==d.cmpn(0);){var v=f.div(d);u=f.sub(v.mul(d)),c=g.sub(v.mul(p));var w=b.sub(v.mul(m));if(!i&&u.cmp(l)<0)e=h.neg(),r=p,i=u.neg(),s=c;else if(i&&2==++y)break;h=u,f=d,d=u,g=p,p=c,b=m,m=w}o=u.neg(),a=c;var M=i.sqr().add(s.sqr());return o.sqr().add(a.sqr()).cmp(M)>=0&&(o=e,a=r),i.negative&&(i=i.neg(),s=s.neg()),o.negative&&(o=o.neg(),a=a.neg()),[{a:i,b:s},{a:o,b:a}]},h.prototype._endoSplit=function(t){var e=this.endo.basis,r=e[0],i=e[1],n=i.b.mul(t).divRound(this.n),s=r.b.neg().mul(t).divRound(this.n),o=n.mul(r.a),a=s.mul(i.a),h=n.mul(r.b),u=s.mul(i.b);return{k1:t.sub(o).sub(a),k2:h.add(u).neg()}},h.prototype.pointFromX=function(t,e){(t=new n(t,16)).red||(t=t.toRed(this.red));var r=t.redSqr().redMul(t).redIAdd(t.redMul(this.a)).redIAdd(this.b),i=r.redSqrt();if(0!==i.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var s=i.fromRed().isOdd();return(e&&!s||!e&&s)&&(i=i.redNeg()),this.point(t,i)},h.prototype.validate=function(t){if(t.inf)return!0;var e=t.x,r=t.y,i=this.a.redMul(e),n=e.redSqr().redMul(e).redIAdd(i).redIAdd(this.b);return 0===r.redSqr().redISub(n).cmpn(0)},h.prototype._endoWnafMulAdd=function(t,e,r){for(var i=this._endoWnafT1,n=this._endoWnafT2,s=0;s<t.length;s++){var o=this._endoSplit(e[s]),a=t[s],h=a._getBeta();o.k1.negative&&(o.k1.ineg(),a=a.neg(!0)),o.k2.negative&&(o.k2.ineg(),h=h.neg(!0)),i[2*s]=a,i[2*s+1]=h,n[2*s]=o.k1,n[2*s+1]=o.k2}for(var u=this._wnafMulAdd(1,i,n,2*s,r),c=0;c<2*s;c++)i[c]=null,n[c]=null;return u},s(u,o.BasePoint),h.prototype.point=function(t,e,r){return new u(this,t,e,r)},h.prototype.pointFromJSON=function(t,e){return u.fromJSON(this,t,e)},u.prototype._getBeta=function(){if(this.curve.endo){var t=this.precomputed;if(t&&t.beta)return t.beta;var e=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(t){var r=this.curve,i=function(t){return r.point(t.x.redMul(r.endo.beta),t.y)};t.beta=e,e.precomputed={beta:null,naf:t.naf&&{wnd:t.naf.wnd,points:t.naf.points.map(i)},doubles:t.doubles&&{step:t.doubles.step,points:t.doubles.points.map(i)}}}return e}},u.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},u.fromJSON=function(t,e,r){"string"==typeof e&&(e=JSON.parse(e));var i=t.point(e[0],e[1],r);if(!e[2])return i;function n(e){return t.point(e[0],e[1],r)}var s=e[2];return i.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[i].concat(s.doubles.points.map(n))},naf:s.naf&&{wnd:s.naf.wnd,points:[i].concat(s.naf.points.map(n))}},i},u.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},u.prototype.isInfinity=function(){return this.inf},u.prototype.add=function(t){if(this.inf)return t;if(t.inf)return this;if(this.eq(t))return this.dbl();if(this.neg().eq(t))return this.curve.point(null,null);if(0===this.x.cmp(t.x))return this.curve.point(null,null);var e=this.y.redSub(t.y);0!==e.cmpn(0)&&(e=e.redMul(this.x.redSub(t.x).redInvm()));var r=e.redSqr().redISub(this.x).redISub(t.x),i=e.redMul(this.x.redSub(r)).redISub(this.y);return this.curve.point(r,i)},u.prototype.dbl=function(){if(this.inf)return this;var t=this.y.redAdd(this.y);if(0===t.cmpn(0))return this.curve.point(null,null);var e=this.curve.a,r=this.x.redSqr(),i=t.redInvm(),n=r.redAdd(r).redIAdd(r).redIAdd(e).redMul(i),s=n.redSqr().redISub(this.x.redAdd(this.x)),o=n.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)},u.prototype.getX=function(){return this.x.fromRed()},u.prototype.getY=function(){return this.y.fromRed()},u.prototype.mul=function(t){return t=new n(t,16),this.isInfinity()?this:this._hasDoubles(t)?this.curve._fixedNafMul(this,t):this.curve.endo?this.curve._endoWnafMulAdd([this],[t]):this.curve._wnafMul(this,t)},u.prototype.mulAdd=function(t,e,r){var i=[this,e],n=[t,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n):this.curve._wnafMulAdd(1,i,n,2)},u.prototype.jmulAdd=function(t,e,r){var i=[this,e],n=[t,r];return this.curve.endo?this.curve._endoWnafMulAdd(i,n,!0):this.curve._wnafMulAdd(1,i,n,2,!0)},u.prototype.eq=function(t){return this===t||this.inf===t.inf&&(this.inf||0===this.x.cmp(t.x)&&0===this.y.cmp(t.y))},u.prototype.neg=function(t){if(this.inf)return this;var e=this.curve.point(this.x,this.y.redNeg());if(t&&this.precomputed){var r=this.precomputed,i=function(t){return t.neg()};e.precomputed={naf:r.naf&&{wnd:r.naf.wnd,points:r.naf.points.map(i)},doubles:r.doubles&&{step:r.doubles.step,points:r.doubles.points.map(i)}}}return e},u.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},s(c,o.BasePoint),h.prototype.jpoint=function(t,e,r){return new c(this,t,e,r)},c.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var t=this.z.redInvm(),e=t.redSqr(),r=this.x.redMul(e),i=this.y.redMul(e).redMul(t);return this.curve.point(r,i)},c.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},c.prototype.add=function(t){if(this.isInfinity())return t;if(t.isInfinity())return this;var e=t.z.redSqr(),r=this.z.redSqr(),i=this.x.redMul(e),n=t.x.redMul(r),s=this.y.redMul(e.redMul(t.z)),o=t.y.redMul(r.redMul(this.z)),a=i.redSub(n),h=s.redSub(o);if(0===a.cmpn(0))return 0!==h.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var u=a.redSqr(),c=u.redMul(a),l=i.redMul(u),d=h.redSqr().redIAdd(c).redISub(l).redISub(l),f=h.redMul(l.redISub(d)).redISub(s.redMul(c)),p=this.z.redMul(t.z).redMul(a);return this.curve.jpoint(d,f,p)},c.prototype.mixedAdd=function(t){if(this.isInfinity())return t.toJ();if(t.isInfinity())return this;var e=this.z.redSqr(),r=this.x,i=t.x.redMul(e),n=this.y,s=t.y.redMul(e).redMul(this.z),o=r.redSub(i),a=n.redSub(s);if(0===o.cmpn(0))return 0!==a.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=o.redSqr(),u=h.redMul(o),c=r.redMul(h),l=a.redSqr().redIAdd(u).redISub(c).redISub(c),d=a.redMul(c.redISub(l)).redISub(n.redMul(u)),f=this.z.redMul(o);return this.curve.jpoint(l,d,f)},c.prototype.dblp=function(t){if(0===t)return this;if(this.isInfinity())return this;if(!t)return this.dbl();var e;if(this.curve.zeroA||this.curve.threeA){var r=this;for(e=0;e<t;e++)r=r.dbl();return r}var i=this.curve.a,n=this.curve.tinv,s=this.x,o=this.y,a=this.z,h=a.redSqr().redSqr(),u=o.redAdd(o);for(e=0;e<t;e++){var c=s.redSqr(),l=u.redSqr(),d=l.redSqr(),f=c.redAdd(c).redIAdd(c).redIAdd(i.redMul(h)),p=s.redMul(l),m=f.redSqr().redISub(p.redAdd(p)),g=p.redISub(m),b=f.redMul(g);b=b.redIAdd(b).redISub(d);var y=u.redMul(a);e+1<t&&(h=h.redMul(d)),s=m,a=y,u=b}return this.curve.jpoint(s,u.redMul(n),a)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},c.prototype._zeroDbl=function(){var t,e,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),s=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(i).redISub(s);o=o.redIAdd(o);var a=i.redAdd(i).redIAdd(i),h=a.redSqr().redISub(o).redISub(o),u=s.redIAdd(s);u=(u=u.redIAdd(u)).redIAdd(u),t=h,e=a.redMul(o.redISub(h)).redISub(u),r=this.y.redAdd(this.y)}else{var c=this.x.redSqr(),l=this.y.redSqr(),d=l.redSqr(),f=this.x.redAdd(l).redSqr().redISub(c).redISub(d);f=f.redIAdd(f);var p=c.redAdd(c).redIAdd(c),m=p.redSqr(),g=d.redIAdd(d);g=(g=g.redIAdd(g)).redIAdd(g),t=m.redISub(f).redISub(f),e=p.redMul(f.redISub(t)).redISub(g),r=(r=this.y.redMul(this.z)).redIAdd(r)}return this.curve.jpoint(t,e,r)},c.prototype._threeDbl=function(){var t,e,r;if(this.zOne){var i=this.x.redSqr(),n=this.y.redSqr(),s=n.redSqr(),o=this.x.redAdd(n).redSqr().redISub(i).redISub(s);o=o.redIAdd(o);var a=i.redAdd(i).redIAdd(i).redIAdd(this.curve.a),h=a.redSqr().redISub(o).redISub(o);t=h;var u=s.redIAdd(s);u=(u=u.redIAdd(u)).redIAdd(u),e=a.redMul(o.redISub(h)).redISub(u),r=this.y.redAdd(this.y)}else{var c=this.z.redSqr(),l=this.y.redSqr(),d=this.x.redMul(l),f=this.x.redSub(c).redMul(this.x.redAdd(c));f=f.redAdd(f).redIAdd(f);var p=d.redIAdd(d),m=(p=p.redIAdd(p)).redAdd(p);t=f.redSqr().redISub(m),r=this.y.redAdd(this.z).redSqr().redISub(l).redISub(c);var g=l.redSqr();g=(g=(g=g.redIAdd(g)).redIAdd(g)).redIAdd(g),e=f.redMul(p.redISub(t)).redISub(g)}return this.curve.jpoint(t,e,r)},c.prototype._dbl=function(){var t=this.curve.a,e=this.x,r=this.y,i=this.z,n=i.redSqr().redSqr(),s=e.redSqr(),o=r.redSqr(),a=s.redAdd(s).redIAdd(s).redIAdd(t.redMul(n)),h=e.redAdd(e),u=(h=h.redIAdd(h)).redMul(o),c=a.redSqr().redISub(u.redAdd(u)),l=u.redISub(c),d=o.redSqr();d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var f=a.redMul(l).redISub(d),p=r.redAdd(r).redMul(i);return this.curve.jpoint(c,f,p)},c.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var t=this.x.redSqr(),e=this.y.redSqr(),r=this.z.redSqr(),i=e.redSqr(),n=t.redAdd(t).redIAdd(t),s=n.redSqr(),o=this.x.redAdd(e).redSqr().redISub(t).redISub(i),a=(o=(o=(o=o.redIAdd(o)).redAdd(o).redIAdd(o)).redISub(s)).redSqr(),h=i.redIAdd(i);h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var u=n.redIAdd(o).redSqr().redISub(s).redISub(a).redISub(h),c=e.redMul(u);c=(c=c.redIAdd(c)).redIAdd(c);var l=this.x.redMul(a).redISub(c);l=(l=l.redIAdd(l)).redIAdd(l);var d=this.y.redMul(u.redMul(h.redISub(u)).redISub(o.redMul(a)));d=(d=(d=d.redIAdd(d)).redIAdd(d)).redIAdd(d);var f=this.z.redAdd(o).redSqr().redISub(r).redISub(a);return this.curve.jpoint(l,d,f)},c.prototype.mul=function(t,e){return t=new n(t,e),this.curve._wnafMul(this,t)},c.prototype.eq=function(t){if("affine"===t.type)return this.eq(t.toJ());if(this===t)return!0;var e=this.z.redSqr(),r=t.z.redSqr();if(0!==this.x.redMul(r).redISub(t.x.redMul(e)).cmpn(0))return!1;var i=e.redMul(this.z),n=r.redMul(t.z);return 0===this.y.redMul(n).redISub(t.y.redMul(i)).cmpn(0)},c.prototype.eqXToP=function(t){var e=this.z.redSqr(),r=t.toRed(this.curve.red).redMul(e);if(0===this.x.cmp(r))return!0;for(var i=t.clone(),n=this.curve.redN.redMul(e);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(r.redIAdd(n),0===this.x.cmp(r))return!0}},c.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},480:(t,e,r)=>{"use strict";var i,n=e,s=r(7952),o=r(894),a=r(7011).assert;function h(t){"short"===t.type?this.curve=new o.short(t):"edwards"===t.type?this.curve=new o.edwards(t):this.curve=new o.mont(t),this.g=this.curve.g,this.n=this.curve.n,this.hash=t.hash,a(this.g.validate(),"Invalid curve"),a(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function u(t,e){Object.defineProperty(n,t,{configurable:!0,enumerable:!0,get:function(){var r=new h(e);return Object.defineProperty(n,t,{configurable:!0,enumerable:!0,value:r}),r}})}n.PresetCurve=h,u("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:s.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),u("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:s.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),u("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:s.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),u("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:s.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),u("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:s.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),u("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["9"]}),u("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{i=r(4011)}catch(t){i=void 0}u("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:s.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",i]})},7447:(t,e,r)=>{"use strict";var i=r(8490),n=r(2723),s=r(7011),o=r(480),a=r(5037),h=s.assert,u=r(1200),c=r(8545);function l(t){if(!(this instanceof l))return new l(t);"string"==typeof t&&(h(Object.prototype.hasOwnProperty.call(o,t),"Unknown curve "+t),t=o[t]),t instanceof o.PresetCurve&&(t={curve:t}),this.curve=t.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=t.curve.g,this.g.precompute(t.curve.n.bitLength()+1),this.hash=t.hash||t.curve.hash}t.exports=l,l.prototype.keyPair=function(t){return new u(this,t)},l.prototype.keyFromPrivate=function(t,e){return u.fromPrivate(this,t,e)},l.prototype.keyFromPublic=function(t,e){return u.fromPublic(this,t,e)},l.prototype.genKeyPair=function(t){t||(t={});for(var e=new n({hash:this.hash,pers:t.pers,persEnc:t.persEnc||"utf8",entropy:t.entropy||a(this.hash.hmacStrength),entropyEnc:t.entropy&&t.entropyEnc||"utf8",nonce:this.n.toArray()}),r=this.n.byteLength(),s=this.n.sub(new i(2));;){var o=new i(e.generate(r));if(!(o.cmp(s)>0))return o.iaddn(1),this.keyFromPrivate(o)}},l.prototype._truncateToN=function(t,e,r){var n;if(i.isBN(t)||"number"==typeof t)n=(t=new i(t,16)).byteLength();else if("object"==typeof t)n=t.length,t=new i(t,16);else{var s=t.toString();n=s.length+1>>>1,t=new i(s,16)}"number"!=typeof r&&(r=8*n);var o=r-this.n.bitLength();return o>0&&(t=t.ushrn(o)),!e&&t.cmp(this.n)>=0?t.sub(this.n):t},l.prototype.sign=function(t,e,r,s){if("object"==typeof r&&(s=r,r=null),s||(s={}),"string"!=typeof t&&"number"!=typeof t&&!i.isBN(t)){h("object"==typeof t&&t&&"number"==typeof t.length,"Expected message to be an array-like, a hex string, or a BN instance"),h(t.length>>>0===t.length);for(var o=0;o<t.length;o++)h((255&t[o])===t[o])}e=this.keyFromPrivate(e,r),t=this._truncateToN(t,!1,s.msgBitLength),h(!t.isNeg(),"Can not sign a negative message");var a=this.n.byteLength(),u=e.getPrivate().toArray("be",a),l=t.toArray("be",a);h(new i(l).eq(t),"Can not sign message");for(var d=new n({hash:this.hash,entropy:u,nonce:l,pers:s.pers,persEnc:s.persEnc||"utf8"}),f=this.n.sub(new i(1)),p=0;;p++){var m=s.k?s.k(p):new i(d.generate(this.n.byteLength()));if(!((m=this._truncateToN(m,!0)).cmpn(1)<=0||m.cmp(f)>=0)){var g=this.g.mul(m);if(!g.isInfinity()){var b=g.getX(),y=b.umod(this.n);if(0!==y.cmpn(0)){var v=m.invm(this.n).mul(y.mul(e.getPrivate()).iadd(t));if(0!==(v=v.umod(this.n)).cmpn(0)){var w=(g.getY().isOdd()?1:0)|(0!==b.cmp(y)?2:0);return s.canonical&&v.cmp(this.nh)>0&&(v=this.n.sub(v),w^=1),new c({r:y,s:v,recoveryParam:w})}}}}}},l.prototype.verify=function(t,e,r,i,n){n||(n={}),t=this._truncateToN(t,!1,n.msgBitLength),r=this.keyFromPublic(r,i);var s=(e=new c(e,"hex")).r,o=e.s;if(s.cmpn(1)<0||s.cmp(this.n)>=0)return!1;if(o.cmpn(1)<0||o.cmp(this.n)>=0)return!1;var a,h=o.invm(this.n),u=h.mul(t).umod(this.n),l=h.mul(s).umod(this.n);return this.curve._maxwellTrick?!(a=this.g.jmulAdd(u,r.getPublic(),l)).isInfinity()&&a.eqXToP(s):!(a=this.g.mulAdd(u,r.getPublic(),l)).isInfinity()&&0===a.getX().umod(this.n).cmp(s)},l.prototype.recoverPubKey=function(t,e,r,n){h((3&r)===r,"The recovery param is more than two bits"),e=new c(e,n);var s=this.n,o=new i(t),a=e.r,u=e.s,l=1&r,d=r>>1;if(a.cmp(this.curve.p.umod(this.curve.n))>=0&&d)throw new Error("Unable to find sencond key candinate");a=d?this.curve.pointFromX(a.add(this.curve.n),l):this.curve.pointFromX(a,l);var f=e.r.invm(s),p=s.sub(o).mul(f).umod(s),m=u.mul(f).umod(s);return this.g.mulAdd(p,a,m)},l.prototype.getKeyRecoveryParam=function(t,e,r,i){if(null!==(e=new c(e,i)).recoveryParam)return e.recoveryParam;for(var n=0;n<4;n++){var s;try{s=this.recoverPubKey(t,e,n)}catch(t){continue}if(s.eq(r))return n}throw new Error("Unable to find valid recovery factor")}},1200:(t,e,r)=>{"use strict";var i=r(8490),n=r(7011).assert;function s(t,e){this.ec=t,this.priv=null,this.pub=null,e.priv&&this._importPrivate(e.priv,e.privEnc),e.pub&&this._importPublic(e.pub,e.pubEnc)}t.exports=s,s.fromPublic=function(t,e,r){return e instanceof s?e:new s(t,{pub:e,pubEnc:r})},s.fromPrivate=function(t,e,r){return e instanceof s?e:new s(t,{priv:e,privEnc:r})},s.prototype.validate=function(){var t=this.getPublic();return t.isInfinity()?{result:!1,reason:"Invalid public key"}:t.validate()?t.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},s.prototype.getPublic=function(t,e){return"string"==typeof t&&(e=t,t=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),e?this.pub.encode(e,t):this.pub},s.prototype.getPrivate=function(t){return"hex"===t?this.priv.toString(16,2):this.priv},s.prototype._importPrivate=function(t,e){this.priv=new i(t,e||16),this.priv=this.priv.umod(this.ec.curve.n)},s.prototype._importPublic=function(t,e){if(t.x||t.y)return"mont"===this.ec.curve.type?n(t.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||n(t.x&&t.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(t.x,t.y));this.pub=this.ec.curve.decodePoint(t,e)},s.prototype.derive=function(t){return t.validate()||n(t.validate(),"public point not validated"),t.mul(this.priv).getX()},s.prototype.sign=function(t,e,r){return this.ec.sign(t,this,e,r)},s.prototype.verify=function(t,e,r){return this.ec.verify(t,e,this,void 0,r)},s.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},8545:(t,e,r)=>{"use strict";var i=r(8490),n=r(7011),s=n.assert;function o(t,e){if(t instanceof o)return t;this._importDER(t,e)||(s(t.r&&t.s,"Signature without r or s"),this.r=new i(t.r,16),this.s=new i(t.s,16),void 0===t.recoveryParam?this.recoveryParam=null:this.recoveryParam=t.recoveryParam)}function a(){this.place=0}function h(t,e){var r=t[e.place++];if(!(128&r))return r;var i=15&r;if(0===i||i>4)return!1;if(0===t[e.place])return!1;for(var n=0,s=0,o=e.place;s<i;s++,o++)n<<=8,n|=t[o],n>>>=0;return!(n<=127)&&(e.place=o,n)}function u(t){for(var e=0,r=t.length-1;!t[e]&&!(128&t[e+1])&&e<r;)e++;return 0===e?t:t.slice(e)}function c(t,e){if(e<128)t.push(e);else{var r=1+(Math.log(e)/Math.LN2>>>3);for(t.push(128|r);--r;)t.push(e>>>(r<<3)&255);t.push(e)}}t.exports=o,o.prototype._importDER=function(t,e){t=n.toArray(t,e);var r=new a;if(48!==t[r.place++])return!1;var s=h(t,r);if(!1===s)return!1;if(s+r.place!==t.length)return!1;if(2!==t[r.place++])return!1;var o=h(t,r);if(!1===o)return!1;if(128&t[r.place])return!1;var u=t.slice(r.place,o+r.place);if(r.place+=o,2!==t[r.place++])return!1;var c=h(t,r);if(!1===c)return!1;if(t.length!==c+r.place)return!1;if(128&t[r.place])return!1;var l=t.slice(r.place,c+r.place);if(0===u[0]){if(!(128&u[1]))return!1;u=u.slice(1)}if(0===l[0]){if(!(128&l[1]))return!1;l=l.slice(1)}return this.r=new i(u),this.s=new i(l),this.recoveryParam=null,!0},o.prototype.toDER=function(t){var e=this.r.toArray(),r=this.s.toArray();for(128&e[0]&&(e=[0].concat(e)),128&r[0]&&(r=[0].concat(r)),e=u(e),r=u(r);!(r[0]||128&r[1]);)r=r.slice(1);var i=[2];c(i,e.length),(i=i.concat(e)).push(2),c(i,r.length);var s=i.concat(r),o=[48];return c(o,s.length),o=o.concat(s),n.encode(o,t)}},8650:(t,e,r)=>{"use strict";var i=r(7952),n=r(480),s=r(7011),o=s.assert,a=s.parseBytes,h=r(6661),u=r(220);function c(t){if(o("ed25519"===t,"only tested with ed25519 so far"),!(this instanceof c))return new c(t);t=n[t].curve,this.curve=t,this.g=t.g,this.g.precompute(t.n.bitLength()+1),this.pointClass=t.point().constructor,this.encodingLength=Math.ceil(t.n.bitLength()/8),this.hash=i.sha512}t.exports=c,c.prototype.sign=function(t,e){t=a(t);var r=this.keyFromSecret(e),i=this.hashInt(r.messagePrefix(),t),n=this.g.mul(i),s=this.encodePoint(n),o=this.hashInt(s,r.pubBytes(),t).mul(r.priv()),h=i.add(o).umod(this.curve.n);return this.makeSignature({R:n,S:h,Rencoded:s})},c.prototype.verify=function(t,e,r){if(t=a(t),(e=this.makeSignature(e)).S().gte(e.eddsa.curve.n)||e.S().isNeg())return!1;var i=this.keyFromPublic(r),n=this.hashInt(e.Rencoded(),i.pubBytes(),t),s=this.g.mul(e.S());return e.R().add(i.pub().mul(n)).eq(s)},c.prototype.hashInt=function(){for(var t=this.hash(),e=0;e<arguments.length;e++)t.update(arguments[e]);return s.intFromLE(t.digest()).umod(this.curve.n)},c.prototype.keyFromPublic=function(t){return h.fromPublic(this,t)},c.prototype.keyFromSecret=function(t){return h.fromSecret(this,t)},c.prototype.makeSignature=function(t){return t instanceof u?t:new u(this,t)},c.prototype.encodePoint=function(t){var e=t.getY().toArray("le",this.encodingLength);return e[this.encodingLength-1]|=t.getX().isOdd()?128:0,e},c.prototype.decodePoint=function(t){var e=(t=s.parseBytes(t)).length-1,r=t.slice(0,e).concat(-129&t[e]),i=!!(128&t[e]),n=s.intFromLE(r);return this.curve.pointFromY(n,i)},c.prototype.encodeInt=function(t){return t.toArray("le",this.encodingLength)},c.prototype.decodeInt=function(t){return s.intFromLE(t)},c.prototype.isPoint=function(t){return t instanceof this.pointClass}},6661:(t,e,r)=>{"use strict";var i=r(7011),n=i.assert,s=i.parseBytes,o=i.cachedProperty;function a(t,e){this.eddsa=t,this._secret=s(e.secret),t.isPoint(e.pub)?this._pub=e.pub:this._pubBytes=s(e.pub)}a.fromPublic=function(t,e){return e instanceof a?e:new a(t,{pub:e})},a.fromSecret=function(t,e){return e instanceof a?e:new a(t,{secret:e})},a.prototype.secret=function(){return this._secret},o(a,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),o(a,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),o(a,"privBytes",(function(){var t=this.eddsa,e=this.hash(),r=t.encodingLength-1,i=e.slice(0,t.encodingLength);return i[0]&=248,i[r]&=127,i[r]|=64,i})),o(a,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),o(a,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),o(a,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),a.prototype.sign=function(t){return n(this._secret,"KeyPair can only verify"),this.eddsa.sign(t,this)},a.prototype.verify=function(t,e){return this.eddsa.verify(t,e,this)},a.prototype.getSecret=function(t){return n(this._secret,"KeyPair is public only"),i.encode(this.secret(),t)},a.prototype.getPublic=function(t){return i.encode(this.pubBytes(),t)},t.exports=a},220:(t,e,r)=>{"use strict";var i=r(8490),n=r(7011),s=n.assert,o=n.cachedProperty,a=n.parseBytes;function h(t,e){this.eddsa=t,"object"!=typeof e&&(e=a(e)),Array.isArray(e)&&(s(e.length===2*t.encodingLength,"Signature has invalid size"),e={R:e.slice(0,t.encodingLength),S:e.slice(t.encodingLength)}),s(e.R&&e.S,"Signature without R or S"),t.isPoint(e.R)&&(this._R=e.R),e.S instanceof i&&(this._S=e.S),this._Rencoded=Array.isArray(e.R)?e.R:e.Rencoded,this._Sencoded=Array.isArray(e.S)?e.S:e.Sencoded}o(h,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),o(h,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),o(h,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),o(h,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),h.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},h.prototype.toHex=function(){return n.encode(this.toBytes(),"hex").toUpperCase()},t.exports=h},4011:t=>{t.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},7011:(t,e,r)=>{"use strict";var i=e,n=r(8490),s=r(3349),o=r(4367);i.assert=s,i.toArray=o.toArray,i.zero2=o.zero2,i.toHex=o.toHex,i.encode=o.encode,i.getNAF=function(t,e,r){var i,n=new Array(Math.max(t.bitLength(),r)+1);for(i=0;i<n.length;i+=1)n[i]=0;var s=1<<e+1,o=t.clone();for(i=0;i<n.length;i++){var a,h=o.andln(s-1);o.isOdd()?(a=h>(s>>1)-1?(s>>1)-h:h,o.isubn(a)):a=0,n[i]=a,o.iushrn(1)}return n},i.getJSF=function(t,e){var r=[[],[]];t=t.clone(),e=e.clone();for(var i,n=0,s=0;t.cmpn(-n)>0||e.cmpn(-s)>0;){var o,a,h=t.andln(3)+n&3,u=e.andln(3)+s&3;3===h&&(h=-1),3===u&&(u=-1),o=1&h?3!=(i=t.andln(7)+n&7)&&5!==i||2!==u?h:-h:0,r[0].push(o),a=1&u?3!=(i=e.andln(7)+s&7)&&5!==i||2!==h?u:-u:0,r[1].push(a),2*n===o+1&&(n=1-n),2*s===a+1&&(s=1-s),t.iushrn(1),e.iushrn(1)}return r},i.cachedProperty=function(t,e,r){var i="_"+e;t.prototype[e]=function(){return void 0!==this[i]?this[i]:this[i]=r.call(this)}},i.parseBytes=function(t){return"string"==typeof t?i.toArray(t,"hex"):t},i.intFromLE=function(t){return new n(t,"hex","le")}},8490:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(9368).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,i){for(var n=0,s=Math.min(t.length,r),o=e;o<s;o++){var a=t.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?c[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=l[t],f=d[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(t);r=(p=p.idivn(f)).isZero()?m+r:c[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return i(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,u=new t(s),c=this.clone();if(h){for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function m(t,e,r){return(new g).mulp(t,e,r)}function g(t,e){this.x=t,this.y=e}Math.imul||(p=f),s.prototype.mulTo=function(t,e){var r,i=this.length+t.length;return r=10===this.length&&10===t.length?p(this,t,e):i<63?f(this,t,e):i<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,t,e):m(this,t,e),r},g.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},g.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},g.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},g.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},g.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},g.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},g.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},g.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},g.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),m(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){i("number"==typeof t),i(t<67108864);for(var e=0,r=0;r<this.length;r++){var n=(0|this.words[r])*t,s=(67108863&n)+(67108863&e);e>>=26,e+=n/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=(t.words[i]&1<<n)>>>n}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a.strip(),i.strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){i(t<=67108863);for(var e=(1<<26)%t,r=0,n=this.length-1;n>=0;n--)r=(e*r+(0|this.words[n]))%t;return r},s.prototype.idivn=function(t){i(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*e;this.words[r]=n/t|0,e=n%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new S(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){S.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},n(v,y),v.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(w,y),n(M,y),n(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return b[t]=e,e},S.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},S.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},S.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},S.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},S.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},S.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},S.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},S.prototype.isqr=function(t){return this.imul(t,t.clone())},S.prototype.sqr=function(t){return this.mul(t,t)},S.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},S.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},S.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},S.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},S.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new E(t)},n(E,S),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},7007:t=>{"use strict";var e,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};e=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}t.exports=s,t.exports.once=function(t,e){return new Promise((function(r,i){function n(r){t.removeListener(e,s),i(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",n),r([].slice.call(arguments))}m(t,e,s,{once:!0}),"error"!==e&&function(t,e){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,n)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function u(t,e,r,i){var n,s,o,u;if(a(r),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),o=s[e]),void 0===o)o=s[e]=r,++t._eventsCount;else if("function"==typeof o?o=s[e]=i?[r,o]:[o,r]:i?o.unshift(r):o.push(r),(n=h(t))>0&&o.length>n&&!o.warned){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=o.length,u=c,console&&console.warn&&console.warn(u)}return t}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=c.bind(i);return n.listener=r,i.wrapFn=n,n}function d(t,e,r){var i=t._events;if(void 0===i)return[];var n=i[e];return void 0===n?[]:"function"==typeof n?r?[n.listener||n]:[n]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(n):p(n,n.length)}function f(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function p(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function m(t,e,r,i){if("function"==typeof t.on)i.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function n(s){i.once&&t.removeEventListener(e,n),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return h(this)},s.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=s[t];if(void 0===h)return!1;if("function"==typeof h)i(h,this,e);else{var u=h.length,c=p(h,u);for(r=0;r<u;++r)i(c[r],this,e)}return!0},s.prototype.addListener=function(t,e){return u(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return u(this,t,e,!0)},s.prototype.once=function(t,e){return a(e),this.on(t,l(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,l(this,t,e)),this},s.prototype.removeListener=function(t,e){var r,i,n,s,o;if(a(e),void 0===(i=this._events))return this;if(void 0===(r=i[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(n=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){o=r[s].listener,n=s;break}if(n<0)return this;0===n?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,n),1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,o||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var n,s=Object.keys(r);for(i=0;i<s.length;++i)"removeListener"!==(n=s[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},s.prototype.listeners=function(t){return d(this,t,!0)},s.prototype.rawListeners=function(t){return d(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},8078:(t,e,r)=>{var i=r(2861).Buffer,n=r(8276);t.exports=function(t,e,r,s){if(i.isBuffer(t)||(t=i.from(t,"binary")),e&&(i.isBuffer(e)||(e=i.from(e,"binary")),8!==e.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var o=r/8,a=i.alloc(o),h=i.alloc(s||0),u=i.alloc(0);o>0||s>0;){var c=new n;c.update(u),c.update(t),e&&c.update(e),u=c.digest();var l=0;if(o>0){var d=a.length-o;l=Math.min(o,u.length),u.copy(a,d,0,l),o-=l}if(l<u.length&&s>0){var f=h.length-s,p=Math.min(s,u.length-l);u.copy(h,f,l,l+p),s-=p}}return u.fill(0),{key:a,iv:h}}},4729:(t,e,r)=>{"use strict";var i=r(2861).Buffer,n=r(8310).Transform;function s(t){n.call(this),this._block=i.allocUnsafe(t),this._blockSize=t,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}r(6698)(s,n),s.prototype._transform=function(t,e,r){var i=null;try{this.update(t,e)}catch(t){i=t}r(i)},s.prototype._flush=function(t){var e=null;try{this.push(this.digest())}catch(t){e=t}t(e)};var o="undefined"!=typeof Uint8Array,a="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&ArrayBuffer.isView&&(i.prototype instanceof Uint8Array||i.TYPED_ARRAY_SUPPORT);s.prototype.update=function(t,e){if(this._finalized)throw new Error("Digest already called");t=function(t,e){if(t instanceof i)return t;if("string"==typeof t)return i.from(t,e);if(a&&ArrayBuffer.isView(t)){if(0===t.byteLength)return i.alloc(0);var r=i.from(t.buffer,t.byteOffset,t.byteLength);if(r.byteLength===t.byteLength)return r}if(o&&t instanceof Uint8Array)return i.from(t);if(i.isBuffer(t)&&t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t))return i.from(t);throw new TypeError('The "data" argument must be of type string or an instance of Buffer, TypedArray, or DataView.')}(t,e);for(var r=this._block,n=0;this._blockOffset+t.length-n>=this._blockSize;){for(var s=this._blockOffset;s<this._blockSize;)r[s++]=t[n++];this._update(),this._blockOffset=0}for(;n<t.length;)r[this._blockOffset++]=t[n++];for(var h=0,u=8*t.length;u>0;++h)this._length[h]+=u,(u=this._length[h]/4294967296|0)>0&&(this._length[h]-=4294967296*u);return this},s.prototype._update=function(){throw new Error("_update is not implemented")},s.prototype.digest=function(t){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var e=this._digest();void 0!==t&&(e=e.toString(t)),this._block.fill(0),this._blockOffset=0;for(var r=0;r<4;++r)this._length[r]=0;return e},s.prototype._digest=function(){throw new Error("_digest is not implemented")},t.exports=s},7952:(t,e,r)=>{var i=e;i.utils=r(7426),i.common=r(6166),i.sha=r(6229),i.ripemd=r(6784),i.hmac=r(8948),i.sha1=i.sha.sha1,i.sha256=i.sha.sha256,i.sha224=i.sha.sha224,i.sha384=i.sha.sha384,i.sha512=i.sha.sha512,i.ripemd160=i.ripemd.ripemd160},6166:(t,e,r)=>{"use strict";var i=r(7426),n=r(3349);function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}e.BlockHash=s,s.prototype.update=function(t,e){if(t=i.toArray(t,e),this.pending?this.pending=this.pending.concat(t):this.pending=t,this.pendingTotal+=t.length,this.pending.length>=this._delta8){var r=(t=this.pending).length%this._delta8;this.pending=t.slice(t.length-r,t.length),0===this.pending.length&&(this.pending=null),t=i.join32(t,0,t.length-r,this.endian);for(var n=0;n<t.length;n+=this._delta32)this._update(t,n,n+this._delta32)}return this},s.prototype.digest=function(t){return this.update(this._pad()),n(null===this.pending),this._digest(t)},s.prototype._pad=function(){var t=this.pendingTotal,e=this._delta8,r=e-(t+this.padLength)%e,i=new Array(r+this.padLength);i[0]=128;for(var n=1;n<r;n++)i[n]=0;if(t<<=3,"big"===this.endian){for(var s=8;s<this.padLength;s++)i[n++]=0;i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=t>>>24&255,i[n++]=t>>>16&255,i[n++]=t>>>8&255,i[n++]=255&t}else for(i[n++]=255&t,i[n++]=t>>>8&255,i[n++]=t>>>16&255,i[n++]=t>>>24&255,i[n++]=0,i[n++]=0,i[n++]=0,i[n++]=0,s=8;s<this.padLength;s++)i[n++]=0;return i}},8948:(t,e,r)=>{"use strict";var i=r(7426),n=r(3349);function s(t,e,r){if(!(this instanceof s))return new s(t,e,r);this.Hash=t,this.blockSize=t.blockSize/8,this.outSize=t.outSize/8,this.inner=null,this.outer=null,this._init(i.toArray(e,r))}t.exports=s,s.prototype._init=function(t){t.length>this.blockSize&&(t=(new this.Hash).update(t).digest()),n(t.length<=this.blockSize);for(var e=t.length;e<this.blockSize;e++)t.push(0);for(e=0;e<t.length;e++)t[e]^=54;for(this.inner=(new this.Hash).update(t),e=0;e<t.length;e++)t[e]^=106;this.outer=(new this.Hash).update(t)},s.prototype.update=function(t,e){return this.inner.update(t,e),this},s.prototype.digest=function(t){return this.outer.update(this.inner.digest()),this.outer.digest(t)}},6784:(t,e,r)=>{"use strict";var i=r(7426),n=r(6166),s=i.rotl32,o=i.sum32,a=i.sum32_3,h=i.sum32_4,u=n.BlockHash;function c(){if(!(this instanceof c))return new c;u.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function l(t,e,r,i){return t<=15?e^r^i:t<=31?e&r|~e&i:t<=47?(e|~r)^i:t<=63?e&i|r&~i:e^(r|~i)}function d(t){return t<=15?0:t<=31?1518500249:t<=47?1859775393:t<=63?2400959708:2840853838}function f(t){return t<=15?1352829926:t<=31?1548603684:t<=47?1836072691:t<=63?2053994217:0}i.inherits(c,u),e.ripemd160=c,c.blockSize=512,c.outSize=160,c.hmacStrength=192,c.padLength=64,c.prototype._update=function(t,e){for(var r=this.h[0],i=this.h[1],n=this.h[2],u=this.h[3],c=this.h[4],y=r,v=i,w=n,M=u,_=c,S=0;S<80;S++){var E=o(s(h(r,l(S,i,n,u),t[p[S]+e],d(S)),g[S]),c);r=c,c=u,u=s(n,10),n=i,i=E,E=o(s(h(y,l(79-S,v,w,M),t[m[S]+e],f(S)),b[S]),_),y=_,_=M,M=s(w,10),w=v,v=E}E=a(this.h[1],n,M),this.h[1]=a(this.h[2],u,_),this.h[2]=a(this.h[3],c,y),this.h[3]=a(this.h[4],r,v),this.h[4]=a(this.h[0],i,w),this.h[0]=E},c.prototype._digest=function(t){return"hex"===t?i.toHex32(this.h,"little"):i.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],m=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],g=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],b=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},6229:(t,e,r)=>{"use strict";e.sha1=r(3917),e.sha224=r(7714),e.sha256=r(2287),e.sha384=r(1911),e.sha512=r(7766)},3917:(t,e,r)=>{"use strict";var i=r(7426),n=r(6166),s=r(6225),o=i.rotl32,a=i.sum32,h=i.sum32_5,u=s.ft_1,c=n.BlockHash,l=[1518500249,1859775393,2400959708,3395469782];function d(){if(!(this instanceof d))return new d;c.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}i.inherits(d,c),t.exports=d,d.blockSize=512,d.outSize=160,d.hmacStrength=80,d.padLength=64,d.prototype._update=function(t,e){for(var r=this.W,i=0;i<16;i++)r[i]=t[e+i];for(;i<r.length;i++)r[i]=o(r[i-3]^r[i-8]^r[i-14]^r[i-16],1);var n=this.h[0],s=this.h[1],c=this.h[2],d=this.h[3],f=this.h[4];for(i=0;i<r.length;i++){var p=~~(i/20),m=h(o(n,5),u(p,s,c,d),f,r[i],l[p]);f=d,d=c,c=o(s,30),s=n,n=m}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],c),this.h[3]=a(this.h[3],d),this.h[4]=a(this.h[4],f)},d.prototype._digest=function(t){return"hex"===t?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},7714:(t,e,r)=>{"use strict";var i=r(7426),n=r(2287);function s(){if(!(this instanceof s))return new s;n.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}i.inherits(s,n),t.exports=s,s.blockSize=512,s.outSize=224,s.hmacStrength=192,s.padLength=64,s.prototype._digest=function(t){return"hex"===t?i.toHex32(this.h.slice(0,7),"big"):i.split32(this.h.slice(0,7),"big")}},2287:(t,e,r)=>{"use strict";var i=r(7426),n=r(6166),s=r(6225),o=r(3349),a=i.sum32,h=i.sum32_4,u=i.sum32_5,c=s.ch32,l=s.maj32,d=s.s0_256,f=s.s1_256,p=s.g0_256,m=s.g1_256,g=n.BlockHash,b=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function y(){if(!(this instanceof y))return new y;g.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=b,this.W=new Array(64)}i.inherits(y,g),t.exports=y,y.blockSize=512,y.outSize=256,y.hmacStrength=192,y.padLength=64,y.prototype._update=function(t,e){for(var r=this.W,i=0;i<16;i++)r[i]=t[e+i];for(;i<r.length;i++)r[i]=h(m(r[i-2]),r[i-7],p(r[i-15]),r[i-16]);var n=this.h[0],s=this.h[1],g=this.h[2],b=this.h[3],y=this.h[4],v=this.h[5],w=this.h[6],M=this.h[7];for(o(this.k.length===r.length),i=0;i<r.length;i++){var _=u(M,f(y),c(y,v,w),this.k[i],r[i]),S=a(d(n),l(n,s,g));M=w,w=v,v=y,y=a(b,_),b=g,g=s,s=n,n=a(_,S)}this.h[0]=a(this.h[0],n),this.h[1]=a(this.h[1],s),this.h[2]=a(this.h[2],g),this.h[3]=a(this.h[3],b),this.h[4]=a(this.h[4],y),this.h[5]=a(this.h[5],v),this.h[6]=a(this.h[6],w),this.h[7]=a(this.h[7],M)},y.prototype._digest=function(t){return"hex"===t?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},1911:(t,e,r)=>{"use strict";var i=r(7426),n=r(7766);function s(){if(!(this instanceof s))return new s;n.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}i.inherits(s,n),t.exports=s,s.blockSize=1024,s.outSize=384,s.hmacStrength=192,s.padLength=128,s.prototype._digest=function(t){return"hex"===t?i.toHex32(this.h.slice(0,12),"big"):i.split32(this.h.slice(0,12),"big")}},7766:(t,e,r)=>{"use strict";var i=r(7426),n=r(6166),s=r(3349),o=i.rotr64_hi,a=i.rotr64_lo,h=i.shr64_hi,u=i.shr64_lo,c=i.sum64,l=i.sum64_hi,d=i.sum64_lo,f=i.sum64_4_hi,p=i.sum64_4_lo,m=i.sum64_5_hi,g=i.sum64_5_lo,b=n.BlockHash,y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function v(){if(!(this instanceof v))return new v;b.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=y,this.W=new Array(160)}function w(t,e,r,i,n){var s=t&r^~t&n;return s<0&&(s+=4294967296),s}function M(t,e,r,i,n,s){var o=e&i^~e&s;return o<0&&(o+=4294967296),o}function _(t,e,r,i,n){var s=t&r^t&n^r&n;return s<0&&(s+=4294967296),s}function S(t,e,r,i,n,s){var o=e&i^e&s^i&s;return o<0&&(o+=4294967296),o}function E(t,e){var r=o(t,e,28)^o(e,t,2)^o(e,t,7);return r<0&&(r+=4294967296),r}function k(t,e){var r=a(t,e,28)^a(e,t,2)^a(e,t,7);return r<0&&(r+=4294967296),r}function A(t,e){var r=a(t,e,14)^a(t,e,18)^a(e,t,9);return r<0&&(r+=4294967296),r}function I(t,e){var r=o(t,e,1)^o(t,e,8)^h(t,e,7);return r<0&&(r+=4294967296),r}function x(t,e){var r=a(t,e,1)^a(t,e,8)^u(t,e,7);return r<0&&(r+=4294967296),r}function C(t,e){var r=a(t,e,19)^a(e,t,29)^u(t,e,6);return r<0&&(r+=4294967296),r}i.inherits(v,b),t.exports=v,v.blockSize=1024,v.outSize=512,v.hmacStrength=192,v.padLength=128,v.prototype._prepareBlock=function(t,e){for(var r=this.W,i=0;i<32;i++)r[i]=t[e+i];for(;i<r.length;i+=2){var n=(g=r[i-4],b=r[i-3],y=void 0,(y=o(g,b,19)^o(b,g,29)^h(g,b,6))<0&&(y+=4294967296),y),s=C(r[i-4],r[i-3]),a=r[i-14],u=r[i-13],c=I(r[i-30],r[i-29]),l=x(r[i-30],r[i-29]),d=r[i-32],m=r[i-31];r[i]=f(n,s,a,u,c,l,d,m),r[i+1]=p(n,s,a,u,c,l,d,m)}var g,b,y},v.prototype._update=function(t,e){this._prepareBlock(t,e);var r,i,n,a=this.W,h=this.h[0],u=this.h[1],f=this.h[2],p=this.h[3],b=this.h[4],y=this.h[5],v=this.h[6],I=this.h[7],x=this.h[8],C=this.h[9],T=this.h[10],P=this.h[11],B=this.h[12],R=this.h[13],D=this.h[14],N=this.h[15];s(this.k.length===a.length);for(var L=0;L<a.length;L+=2){var O=D,U=N,F=(n=void 0,(n=o(r=x,i=C,14)^o(r,i,18)^o(i,r,9))<0&&(n+=4294967296),n),j=A(x,C),V=w(x,0,T,0,B),q=M(0,C,0,P,0,R),z=this.k[L],H=this.k[L+1],$=a[L],W=a[L+1],K=m(O,U,F,j,V,q,z,H,$,W),G=g(O,U,F,j,V,q,z,H,$,W);O=E(h,u),U=k(h,u),F=_(h,0,f,0,b),j=S(0,u,0,p,0,y);var Z=l(O,U,F,j),Y=d(O,U,F,j);D=B,N=R,B=T,R=P,T=x,P=C,x=l(v,I,K,G),C=d(I,I,K,G),v=b,I=y,b=f,y=p,f=h,p=u,h=l(K,G,Z,Y),u=d(K,G,Z,Y)}c(this.h,0,h,u),c(this.h,2,f,p),c(this.h,4,b,y),c(this.h,6,v,I),c(this.h,8,x,C),c(this.h,10,T,P),c(this.h,12,B,R),c(this.h,14,D,N)},v.prototype._digest=function(t){return"hex"===t?i.toHex32(this.h,"big"):i.split32(this.h,"big")}},6225:(t,e,r)=>{"use strict";var i=r(7426).rotr32;function n(t,e,r){return t&e^~t&r}function s(t,e,r){return t&e^t&r^e&r}function o(t,e,r){return t^e^r}e.ft_1=function(t,e,r,i){return 0===t?n(e,r,i):1===t||3===t?o(e,r,i):2===t?s(e,r,i):void 0},e.ch32=n,e.maj32=s,e.p32=o,e.s0_256=function(t){return i(t,2)^i(t,13)^i(t,22)},e.s1_256=function(t){return i(t,6)^i(t,11)^i(t,25)},e.g0_256=function(t){return i(t,7)^i(t,18)^t>>>3},e.g1_256=function(t){return i(t,17)^i(t,19)^t>>>10}},7426:(t,e,r)=>{"use strict";var i=r(3349),n=r(6698);function s(t,e){return 55296==(64512&t.charCodeAt(e))&&!(e<0||e+1>=t.length)&&56320==(64512&t.charCodeAt(e+1))}function o(t){return(t>>>24|t>>>8&65280|t<<8&16711680|(255&t)<<24)>>>0}function a(t){return 1===t.length?"0"+t:t}function h(t){return 7===t.length?"0"+t:6===t.length?"00"+t:5===t.length?"000"+t:4===t.length?"0000"+t:3===t.length?"00000"+t:2===t.length?"000000"+t:1===t.length?"0000000"+t:t}e.inherits=n,e.toArray=function(t,e){if(Array.isArray(t))return t.slice();if(!t)return[];var r=[];if("string"==typeof t)if(e){if("hex"===e)for((t=t.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(t="0"+t),n=0;n<t.length;n+=2)r.push(parseInt(t[n]+t[n+1],16))}else for(var i=0,n=0;n<t.length;n++){var o=t.charCodeAt(n);o<128?r[i++]=o:o<2048?(r[i++]=o>>6|192,r[i++]=63&o|128):s(t,n)?(o=65536+((1023&o)<<10)+(1023&t.charCodeAt(++n)),r[i++]=o>>18|240,r[i++]=o>>12&63|128,r[i++]=o>>6&63|128,r[i++]=63&o|128):(r[i++]=o>>12|224,r[i++]=o>>6&63|128,r[i++]=63&o|128)}else for(n=0;n<t.length;n++)r[n]=0|t[n];return r},e.toHex=function(t){for(var e="",r=0;r<t.length;r++)e+=a(t[r].toString(16));return e},e.htonl=o,e.toHex32=function(t,e){for(var r="",i=0;i<t.length;i++){var n=t[i];"little"===e&&(n=o(n)),r+=h(n.toString(16))}return r},e.zero2=a,e.zero8=h,e.join32=function(t,e,r,n){var s=r-e;i(s%4==0);for(var o=new Array(s/4),a=0,h=e;a<o.length;a++,h+=4){var u;u="big"===n?t[h]<<24|t[h+1]<<16|t[h+2]<<8|t[h+3]:t[h+3]<<24|t[h+2]<<16|t[h+1]<<8|t[h],o[a]=u>>>0}return o},e.split32=function(t,e){for(var r=new Array(4*t.length),i=0,n=0;i<t.length;i++,n+=4){var s=t[i];"big"===e?(r[n]=s>>>24,r[n+1]=s>>>16&255,r[n+2]=s>>>8&255,r[n+3]=255&s):(r[n+3]=s>>>24,r[n+2]=s>>>16&255,r[n+1]=s>>>8&255,r[n]=255&s)}return r},e.rotr32=function(t,e){return t>>>e|t<<32-e},e.rotl32=function(t,e){return t<<e|t>>>32-e},e.sum32=function(t,e){return t+e>>>0},e.sum32_3=function(t,e,r){return t+e+r>>>0},e.sum32_4=function(t,e,r,i){return t+e+r+i>>>0},e.sum32_5=function(t,e,r,i,n){return t+e+r+i+n>>>0},e.sum64=function(t,e,r,i){var n=t[e],s=i+t[e+1]>>>0,o=(s<i?1:0)+r+n;t[e]=o>>>0,t[e+1]=s},e.sum64_hi=function(t,e,r,i){return(e+i>>>0<e?1:0)+t+r>>>0},e.sum64_lo=function(t,e,r,i){return e+i>>>0},e.sum64_4_hi=function(t,e,r,i,n,s,o,a){var h=0,u=e;return h+=(u=u+i>>>0)<e?1:0,h+=(u=u+s>>>0)<s?1:0,t+r+n+o+(h+=(u=u+a>>>0)<a?1:0)>>>0},e.sum64_4_lo=function(t,e,r,i,n,s,o,a){return e+i+s+a>>>0},e.sum64_5_hi=function(t,e,r,i,n,s,o,a,h,u){var c=0,l=e;return c+=(l=l+i>>>0)<e?1:0,c+=(l=l+s>>>0)<s?1:0,c+=(l=l+a>>>0)<a?1:0,t+r+n+o+h+(c+=(l=l+u>>>0)<u?1:0)>>>0},e.sum64_5_lo=function(t,e,r,i,n,s,o,a,h,u){return e+i+s+a+u>>>0},e.rotr64_hi=function(t,e,r){return(e<<32-r|t>>>r)>>>0},e.rotr64_lo=function(t,e,r){return(t<<32-r|e>>>r)>>>0},e.shr64_hi=function(t,e,r){return t>>>r},e.shr64_lo=function(t,e,r){return(t<<32-r|e>>>r)>>>0}},2723:(t,e,r)=>{"use strict";var i=r(7952),n=r(4367),s=r(3349);function o(t){if(!(this instanceof o))return new o(t);this.hash=t.hash,this.predResist=!!t.predResist,this.outLen=this.hash.outSize,this.minEntropy=t.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var e=n.toArray(t.entropy,t.entropyEnc||"hex"),r=n.toArray(t.nonce,t.nonceEnc||"hex"),i=n.toArray(t.pers,t.persEnc||"hex");s(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(e,r,i)}t.exports=o,o.prototype._init=function(t,e,r){var i=t.concat(e).concat(r);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var n=0;n<this.V.length;n++)this.K[n]=0,this.V[n]=1;this._update(i),this._reseed=1,this.reseedInterval=281474976710656},o.prototype._hmac=function(){return new i.hmac(this.hash,this.K)},o.prototype._update=function(t){var e=this._hmac().update(this.V).update([0]);t&&(e=e.update(t)),this.K=e.digest(),this.V=this._hmac().update(this.V).digest(),t&&(this.K=this._hmac().update(this.V).update([1]).update(t).digest(),this.V=this._hmac().update(this.V).digest())},o.prototype.reseed=function(t,e,r,i){"string"!=typeof e&&(i=r,r=e,e=null),t=n.toArray(t,e),r=n.toArray(r,i),s(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(t.concat(r||[])),this._reseed=1},o.prototype.generate=function(t,e,r,i){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof e&&(i=r,r=e,e=null),r&&(r=n.toArray(r,i||"hex"),this._update(r));for(var s=[];s.length<t;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var o=s.slice(0,t);return this._update(r),this._reseed++,n.encode(o,e)}},251:(t,e)=>{e.read=function(t,e,r,i,n){var s,o,a=8*n-i-1,h=(1<<a)-1,u=h>>1,c=-7,l=r?n-1:0,d=r?-1:1,f=t[e+l];for(l+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+t[e+l],l+=d,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=i;c>0;o=256*o+t[e+l],l+=d,c-=8);if(0===s)s=1-u;else{if(s===h)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=u}return(f?-1:1)*o*Math.pow(2,s-i)},e.write=function(t,e,r,i,n,s){var o,a,h,u=8*s-n-1,c=(1<<u)-1,l=c>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+l>=1?d/h:d*Math.pow(2,1-l))*h>=2&&(o++,h/=2),o+l>=c?(a=0,o=c):o+l>=1?(a=(e*h-1)*Math.pow(2,n),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;t[r+f]=255&a,f+=p,a/=256,n-=8);for(o=o<<n|a,u+=n;u>0;t[r+f]=255&o,f+=p,o/=256,u-=8);t[r+f-p]|=128*m}},6698:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}},4634:t=>{var e={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==e.call(t)}},8276:(t,e,r)=>{"use strict";var i=r(6698),n=r(4729),s=r(2861).Buffer,o=new Array(16);function a(){n.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function h(t,e){return t<<e|t>>>32-e}function u(t,e,r,i,n,s,o){return h(t+(e&r|~e&i)+n+s|0,o)+e|0}function c(t,e,r,i,n,s,o){return h(t+(e&i|r&~i)+n+s|0,o)+e|0}function l(t,e,r,i,n,s,o){return h(t+(e^r^i)+n+s|0,o)+e|0}function d(t,e,r,i,n,s,o){return h(t+(r^(e|~i))+n+s|0,o)+e|0}i(a,n),a.prototype._update=function(){for(var t=o,e=0;e<16;++e)t[e]=this._block.readInt32LE(4*e);var r=this._a,i=this._b,n=this._c,s=this._d;r=u(r,i,n,s,t[0],3614090360,7),s=u(s,r,i,n,t[1],3905402710,12),n=u(n,s,r,i,t[2],606105819,17),i=u(i,n,s,r,t[3],3250441966,22),r=u(r,i,n,s,t[4],4118548399,7),s=u(s,r,i,n,t[5],1200080426,12),n=u(n,s,r,i,t[6],2821735955,17),i=u(i,n,s,r,t[7],4249261313,22),r=u(r,i,n,s,t[8],1770035416,7),s=u(s,r,i,n,t[9],2336552879,12),n=u(n,s,r,i,t[10],4294925233,17),i=u(i,n,s,r,t[11],2304563134,22),r=u(r,i,n,s,t[12],1804603682,7),s=u(s,r,i,n,t[13],4254626195,12),n=u(n,s,r,i,t[14],2792965006,17),r=c(r,i=u(i,n,s,r,t[15],1236535329,22),n,s,t[1],4129170786,5),s=c(s,r,i,n,t[6],3225465664,9),n=c(n,s,r,i,t[11],643717713,14),i=c(i,n,s,r,t[0],3921069994,20),r=c(r,i,n,s,t[5],3593408605,5),s=c(s,r,i,n,t[10],38016083,9),n=c(n,s,r,i,t[15],3634488961,14),i=c(i,n,s,r,t[4],3889429448,20),r=c(r,i,n,s,t[9],568446438,5),s=c(s,r,i,n,t[14],3275163606,9),n=c(n,s,r,i,t[3],4107603335,14),i=c(i,n,s,r,t[8],1163531501,20),r=c(r,i,n,s,t[13],2850285829,5),s=c(s,r,i,n,t[2],4243563512,9),n=c(n,s,r,i,t[7],1735328473,14),r=l(r,i=c(i,n,s,r,t[12],2368359562,20),n,s,t[5],4294588738,4),s=l(s,r,i,n,t[8],2272392833,11),n=l(n,s,r,i,t[11],1839030562,16),i=l(i,n,s,r,t[14],4259657740,23),r=l(r,i,n,s,t[1],2763975236,4),s=l(s,r,i,n,t[4],1272893353,11),n=l(n,s,r,i,t[7],4139469664,16),i=l(i,n,s,r,t[10],3200236656,23),r=l(r,i,n,s,t[13],681279174,4),s=l(s,r,i,n,t[0],3936430074,11),n=l(n,s,r,i,t[3],3572445317,16),i=l(i,n,s,r,t[6],76029189,23),r=l(r,i,n,s,t[9],3654602809,4),s=l(s,r,i,n,t[12],3873151461,11),n=l(n,s,r,i,t[15],530742520,16),r=d(r,i=l(i,n,s,r,t[2],3299628645,23),n,s,t[0],4096336452,6),s=d(s,r,i,n,t[7],1126891415,10),n=d(n,s,r,i,t[14],2878612391,15),i=d(i,n,s,r,t[5],4237533241,21),r=d(r,i,n,s,t[12],1700485571,6),s=d(s,r,i,n,t[3],2399980690,10),n=d(n,s,r,i,t[10],4293915773,15),i=d(i,n,s,r,t[1],2240044497,21),r=d(r,i,n,s,t[8],1873313359,6),s=d(s,r,i,n,t[15],4264355552,10),n=d(n,s,r,i,t[6],2734768916,15),i=d(i,n,s,r,t[13],1309151649,21),r=d(r,i,n,s,t[4],4149444226,6),s=d(s,r,i,n,t[11],3174756917,10),n=d(n,s,r,i,t[2],718787259,15),i=d(i,n,s,r,t[9],3951481745,21),this._a=this._a+r|0,this._b=this._b+i|0,this._c=this._c+n|0,this._d=this._d+s|0},a.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var t=s.allocUnsafe(16);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t},t.exports=a},2244:(t,e,r)=>{var i=r(1158),n=r(5037);function s(t){this.rand=t||new n.Rand}t.exports=s,s.create=function(t){return new s(t)},s.prototype._randbelow=function(t){var e=t.bitLength(),r=Math.ceil(e/8);do{var n=new i(this.rand.generate(r))}while(n.cmp(t)>=0);return n},s.prototype._randrange=function(t,e){var r=e.sub(t);return t.add(this._randbelow(r))},s.prototype.test=function(t,e,r){var n=t.bitLength(),s=i.mont(t),o=new i(1).toRed(s);e||(e=Math.max(1,n/48|0));for(var a=t.subn(1),h=0;!a.testn(h);h++);for(var u=t.shrn(h),c=a.toRed(s);e>0;e--){var l=this._randrange(new i(2),a);r&&r(l);var d=l.toRed(s).redPow(u);if(0!==d.cmp(o)&&0!==d.cmp(c)){for(var f=1;f<h;f++){if(0===(d=d.redSqr()).cmp(o))return!1;if(0===d.cmp(c))break}if(f===h)return!1}}return!0},s.prototype.getDivisor=function(t,e){var r=t.bitLength(),n=i.mont(t),s=new i(1).toRed(n);e||(e=Math.max(1,r/48|0));for(var o=t.subn(1),a=0;!o.testn(a);a++);for(var h=t.shrn(a),u=o.toRed(n);e>0;e--){var c=this._randrange(new i(2),o),l=t.gcd(c);if(0!==l.cmpn(1))return l;var d=c.toRed(n).redPow(h);if(0!==d.cmp(s)&&0!==d.cmp(u)){for(var f=1;f<a;f++){if(0===(d=d.redSqr()).cmp(s))return d.fromRed().subn(1).gcd(t);if(0===d.cmp(u))break}if(f===a)return(d=d.redSqr()).fromRed().subn(1).gcd(t)}}return!1}},1158:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(4688).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,i){for(var n=0,s=Math.min(t.length,r),o=e;o<s;o++){var a=t.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?c[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=l[t],f=d[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(t);r=(p=p.idivn(f)).isZero()?m+r:c[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return i(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,u=new t(s),c=this.clone();if(h){for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function m(t,e,r){return(new g).mulp(t,e,r)}function g(t,e){this.x=t,this.y=e}Math.imul||(p=f),s.prototype.mulTo=function(t,e){var r,i=this.length+t.length;return r=10===this.length&&10===t.length?p(this,t,e):i<63?f(this,t,e):i<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,t,e):m(this,t,e),r},g.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},g.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},g.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},g.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},g.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},g.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},g.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},g.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},g.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),m(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){i("number"==typeof t),i(t<67108864);for(var e=0,r=0;r<this.length;r++){var n=(0|this.words[r])*t,s=(67108863&n)+(67108863&e);e>>=26,e+=n/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=(t.words[i]&1<<n)>>>n}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a.strip(),i.strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){i(t<=67108863);for(var e=(1<<26)%t,r=0,n=this.length-1;n>=0;n--)r=(e*r+(0|this.words[n]))%t;return r},s.prototype.idivn=function(t){i(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*e;this.words[r]=n/t|0,e=n%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new S(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){S.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},n(v,y),v.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(w,y),n(M,y),n(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return b[t]=e,e},S.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},S.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},S.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},S.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},S.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},S.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},S.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},S.prototype.isqr=function(t){return this.imul(t,t.clone())},S.prototype.sqr=function(t){return this.mul(t,t)},S.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},S.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},S.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},S.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},S.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new E(t)},n(E,S),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},3349:t=>{function e(t,e){if(!t)throw new Error(e||"Assertion failed")}t.exports=e,e.equal=function(t,e,r){if(t!=e)throw new Error(r||"Assertion failed: "+t+" != "+e)}},4367:(t,e)=>{"use strict";var r=e;function i(t){return 1===t.length?"0"+t:t}function n(t){for(var e="",r=0;r<t.length;r++)e+=i(t[r].toString(16));return e}r.toArray=function(t,e){if(Array.isArray(t))return t.slice();if(!t)return[];var r=[];if("string"!=typeof t){for(var i=0;i<t.length;i++)r[i]=0|t[i];return r}if("hex"===e)for((t=t.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(t="0"+t),i=0;i<t.length;i+=2)r.push(parseInt(t[i]+t[i+1],16));else for(i=0;i<t.length;i++){var n=t.charCodeAt(i),s=n>>8,o=255&n;s?r.push(s,o):r.push(o)}return r},r.zero2=i,r.toHex=n,r.encode=function(t,e){return"hex"===e?n(t):t}},1137:(t,e,r)=>{"use strict";var i=r(7568);e.certificate=r(6413);var n=i.define("RSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}));e.RSAPrivateKey=n;var s=i.define("RSAPublicKey",(function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}));e.RSAPublicKey=s;var o=i.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())})),a=i.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())}));e.PublicKey=a;var h=i.define("PrivateKeyInfo",(function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(o),this.key("subjectPrivateKey").octstr())}));e.PrivateKey=h;var u=i.define("EncryptedPrivateKeyInfo",(function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}));e.EncryptedPrivateKey=u;var c=i.define("DSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}));e.DSAPrivateKey=c,e.DSAparam=i.define("DSAparam",(function(){this.int()}));var l=i.define("ECParameters",(function(){this.choice({namedCurve:this.objid()})})),d=i.define("ECPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(l),this.key("publicKey").optional().explicit(1).bitstr())}));e.ECPrivateKey=d,e.signature=i.define("signature",(function(){this.seq().obj(this.key("r").int(),this.key("s").int())}))},6413:(t,e,r)=>{"use strict";var i=r(7568),n=i.define("Time",(function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})),s=i.define("AttributeTypeValue",(function(){this.seq().obj(this.key("type").objid(),this.key("value").any())})),o=i.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())})),a=i.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())})),h=i.define("RelativeDistinguishedName",(function(){this.setof(s)})),u=i.define("RDNSequence",(function(){this.seqof(h)})),c=i.define("Name",(function(){this.choice({rdnSequence:this.use(u)})})),l=i.define("Validity",(function(){this.seq().obj(this.key("notBefore").use(n),this.key("notAfter").use(n))})),d=i.define("Extension",(function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())})),f=i.define("TBSCertificate",(function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(o),this.key("issuer").use(c),this.key("validity").use(l),this.key("subject").use(c),this.key("subjectPublicKeyInfo").use(a),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(d).optional())})),p=i.define("X509Certificate",(function(){this.seq().obj(this.key("tbsCertificate").use(f),this.key("signatureAlgorithm").use(o),this.key("signatureValue").bitstr())}));t.exports=p},4101:(t,e,r)=>{"use strict";var i=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,n=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,s=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,o=r(8078),a=r(1241),h=r(2861).Buffer;t.exports=function(t,e){var r,u=t.toString(),c=u.match(i);if(c){var l="aes"+c[1],d=h.from(c[2],"hex"),f=h.from(c[3].replace(/[\r\n]/g,""),"base64"),p=o(e,d.slice(0,8),parseInt(c[1],10)).key,m=[],g=a.createDecipheriv(l,p,d);m.push(g.update(f)),m.push(g.final()),r=h.concat(m)}else{var b=u.match(s);r=h.from(b[2].replace(/[\r\n]/g,""),"base64")}return{tag:u.match(n)[1],data:r}}},8170:(t,e,r)=>{"use strict";var i=r(1137),n=r(5579),s=r(4101),o=r(1241),a=r(8396),h=r(2861).Buffer;function u(t){var e;"object"!=typeof t||h.isBuffer(t)||(e=t.passphrase,t=t.key),"string"==typeof t&&(t=h.from(t));var r,u,c=s(t,e),l=c.tag,d=c.data;switch(l){case"CERTIFICATE":u=i.certificate.decode(d,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(u||(u=i.PublicKey.decode(d,"der")),r=u.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return i.RSAPublicKey.decode(u.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return u.subjectPrivateKey=u.subjectPublicKey,{type:"ec",data:u};case"1.2.840.10040.4.1":return u.algorithm.params.pub_key=i.DSAparam.decode(u.subjectPublicKey.data,"der"),{type:"dsa",data:u.algorithm.params};default:throw new Error("unknown key id "+r)}case"ENCRYPTED PRIVATE KEY":d=function(t,e){var r=t.algorithm.decrypt.kde.kdeparams.salt,i=parseInt(t.algorithm.decrypt.kde.kdeparams.iters.toString(),10),s=n[t.algorithm.decrypt.cipher.algo.join(".")],u=t.algorithm.decrypt.cipher.iv,c=t.subjectPrivateKey,l=parseInt(s.split("-")[1],10)/8,d=a.pbkdf2Sync(e,r,i,l,"sha1"),f=o.createDecipheriv(s,d,u),p=[];return p.push(f.update(c)),p.push(f.final()),h.concat(p)}(d=i.EncryptedPrivateKey.decode(d,"der"),e);case"PRIVATE KEY":switch(r=(u=i.PrivateKey.decode(d,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return i.RSAPrivateKey.decode(u.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:u.algorithm.curve,privateKey:i.ECPrivateKey.decode(u.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return u.algorithm.params.priv_key=i.DSAparam.decode(u.subjectPrivateKey,"der"),{type:"dsa",params:u.algorithm.params};default:throw new Error("unknown key id "+r)}case"RSA PUBLIC KEY":return i.RSAPublicKey.decode(d,"der");case"RSA PRIVATE KEY":return i.RSAPrivateKey.decode(d,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:i.DSAPrivateKey.decode(d,"der")};case"EC PRIVATE KEY":return{curve:(d=i.ECPrivateKey.decode(d,"der")).parameters.value,privateKey:d.privateKey};default:throw new Error("unknown key type "+l)}}u.signature=i.signature,t.exports=u},8396:(t,e,r)=>{e.pbkdf2=r(3832),e.pbkdf2Sync=r(1352)},3832:(t,e,r)=>{var i,n,s=r(2861).Buffer,o=r(4196),a=r(2455),h=r(1352),u=r(3382),c=r.g.crypto&&r.g.crypto.subtle,l={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},d=[];function f(){return n||(n=r.g.process&&r.g.process.nextTick?r.g.process.nextTick:r.g.queueMicrotask?r.g.queueMicrotask:r.g.setImmediate?r.g.setImmediate:r.g.setTimeout)}function p(t,e,r,i,n){return c.importKey("raw",t,{name:"PBKDF2"},!1,["deriveBits"]).then((function(t){return c.deriveBits({name:"PBKDF2",salt:e,iterations:r,hash:{name:n}},t,i<<3)})).then((function(t){return s.from(t)}))}t.exports=function(t,e,n,m,g,b){"function"==typeof g&&(b=g,g=void 0);var y=l[(g=g||"sha1").toLowerCase()];if(y&&"function"==typeof r.g.Promise){if(o(n,m),t=u(t,a,"Password"),e=u(e,a,"Salt"),"function"!=typeof b)throw new Error("No callback provided to pbkdf2");!function(t,e){t.then((function(t){f()((function(){e(null,t)}))}),(function(t){f()((function(){e(t)}))}))}(function(t){if(r.g.process&&!r.g.process.browser)return Promise.resolve(!1);if(!c||!c.importKey||!c.deriveBits)return Promise.resolve(!1);if(void 0!==d[t])return d[t];var e=p(i=i||s.alloc(8),i,10,128,t).then((function(){return!0})).catch((function(){return!1}));return d[t]=e,e}(y).then((function(r){return r?p(t,e,n,m,y):h(t,e,n,m,g)})),b)}else f()((function(){var r;try{r=h(t,e,n,m,g)}catch(t){return b(t)}b(null,r)}))}},2455:(t,e,r)=>{var i,n=r(5606);i=r.g.process&&r.g.process.browser?"utf-8":r.g.process&&r.g.process.version?parseInt(n.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary":"utf-8",t.exports=i},4196:t=>{var e=Math.pow(2,30)-1;t.exports=function(t,r){if("number"!=typeof t)throw new TypeError("Iterations not a number");if(t<0)throw new TypeError("Bad iterations");if("number"!=typeof r)throw new TypeError("Key length not a number");if(r<0||r>e||r!=r)throw new TypeError("Bad key length")}},1352:(t,e,r)=>{var i=r(320),n=r(6011),s=r(2802),o=r(2861).Buffer,a=r(4196),h=r(2455),u=r(3382),c=o.alloc(128),l={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function d(t,e,r){var a=function(t){return"rmd160"===t||"ripemd160"===t?function(t){return(new n).update(t).digest()}:"md5"===t?i:function(e){return s(t).update(e).digest()}}(t),h="sha512"===t||"sha384"===t?128:64;e.length>h?e=a(e):e.length<h&&(e=o.concat([e,c],h));for(var u=o.allocUnsafe(h+l[t]),d=o.allocUnsafe(h+l[t]),f=0;f<h;f++)u[f]=54^e[f],d[f]=92^e[f];var p=o.allocUnsafe(h+r+4);u.copy(p,0,0,h),this.ipad1=p,this.ipad2=u,this.opad=d,this.alg=t,this.blocksize=h,this.hash=a,this.size=l[t]}d.prototype.run=function(t,e){return t.copy(e,this.blocksize),this.hash(e).copy(this.opad,this.blocksize),this.hash(this.opad)},t.exports=function(t,e,r,i,n){a(r,i);var s=new d(n=n||"sha1",t=u(t,h,"Password"),(e=u(e,h,"Salt")).length),c=o.allocUnsafe(i),f=o.allocUnsafe(e.length+4);e.copy(f,0,0,e.length);for(var p=0,m=l[n],g=Math.ceil(i/m),b=1;b<=g;b++){f.writeUInt32BE(b,e.length);for(var y=s.run(f,s.ipad1),v=y,w=1;w<r;w++){v=s.run(v,s.ipad2);for(var M=0;M<m;M++)y[M]^=v[M]}y.copy(c,p),p+=m}return c}},3382:(t,e,r)=>{var i=r(2861).Buffer;t.exports=function(t,e,r){if(i.isBuffer(t))return t;if("string"==typeof t)return i.from(t,e);if(ArrayBuffer.isView(t))return i.from(t.buffer);throw new TypeError(r+" must be a string, a Buffer, a typed array or a DataView")}},6645:(t,e,r)=>{"use strict";r.r(e),r.d(e,{PerfectCursor:()=>a});var i=class{static clamp(t,e,r){return Math.max(e,void 0!==r?Math.min(t,r):t)}static clampV(t,e,r){return t.map((t=>r?i.clamp(t,e,r):i.clamp(t,e)))}static cross(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])}static snap(t,e=1){return[Math.round(t[0]/e)*e,Math.round(t[1]/e)*e]}},n=i;n.neg=t=>[-t[0],-t[1]],n.add=(t,e)=>[t[0]+e[0],t[1]+e[1]],n.addScalar=(t,e)=>[t[0]+e,t[1]+e],n.sub=(t,e)=>[t[0]-e[0],t[1]-e[1]],n.subScalar=(t,e)=>[t[0]-e,t[1]-e],n.vec=(t,e)=>[e[0]-t[0],e[1]-t[1]],n.mul=(t,e)=>[t[0]*e,t[1]*e],n.mulV=(t,e)=>[t[0]*e[0],t[1]*e[1]],n.div=(t,e)=>[t[0]/e,t[1]/e],n.divV=(t,e)=>[t[0]/e[0],t[1]/e[1]],n.per=t=>[t[1],-t[0]],n.dpr=(t,e)=>t[0]*e[0]+t[1]*e[1],n.cpr=(t,e)=>t[0]*e[1]-e[0]*t[1],n.len2=t=>t[0]*t[0]+t[1]*t[1],n.len=t=>Math.hypot(t[0],t[1]),n.pry=(t,e)=>i.dpr(t,e)/i.len(e),n.uni=t=>i.div(t,i.len(t)),n.normalize=t=>i.uni(t),n.tangent=(t,e)=>i.uni(i.sub(t,e)),n.dist2=(t,e)=>i.len2(i.sub(t,e)),n.dist=(t,e)=>Math.hypot(t[1]-e[1],t[0]-e[0]),n.fastDist=(t,e)=>{const r=[e[0]-t[0],e[1]-t[1]],i=[Math.abs(r[0]),Math.abs(r[1])];let n=1/Math.max(i[0],i[1]);return n*=1.29289-(i[0]+i[1])*n*.29289,[r[0]*n,r[1]*n]},n.ang=(t,e)=>Math.atan2(i.cpr(t,e),i.dpr(t,e)),n.angle=(t,e)=>Math.atan2(e[1]-t[1],e[0]-t[0]),n.med=(t,e)=>i.mul(i.add(t,e),.5),n.rot=(t,e=0)=>[t[0]*Math.cos(e)-t[1]*Math.sin(e),t[0]*Math.sin(e)+t[1]*Math.cos(e)],n.rotWith=(t,e,r=0)=>{if(0===r)return t;const i=Math.sin(r),n=Math.cos(r),s=t[0]-e[0],o=t[1]-e[1],a=s*i+o*n;return[s*n-o*i+e[0],a+e[1]]},n.isEqual=(t,e)=>t[0]===e[0]&&t[1]===e[1],n.lrp=(t,e,r)=>i.add(t,i.mul(i.sub(e,t),r)),n.int=(t,e,r,n,s=1)=>{const o=(i.clamp(r,n)-r)/(n-r);return i.add(i.mul(t,1-o),i.mul(e,s))},n.ang3=(t,e,r)=>{const n=i.vec(e,t),s=i.vec(e,r);return i.ang(n,s)},n.abs=t=>[Math.abs(t[0]),Math.abs(t[1])],n.rescale=(t,e)=>{const r=i.len(t);return[e*t[0]/r,e*t[1]/r]},n.isLeft=(t,e,r)=>(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1]),n.clockwise=(t,e,r)=>i.isLeft(t,e,r)>0,n.toFixed=(t,e=2)=>t.map((t=>+t.toFixed(e))),n.nearestPointOnLineThroughPoint=(t,e,r)=>i.add(t,i.mul(e,i.pry(i.sub(r,t),e))),n.distanceToLineThroughPoint=(t,e,r)=>i.dist(r,i.nearestPointOnLineThroughPoint(t,e,r)),n.nearestPointOnLineSegment=(t,e,r,n=!0)=>{const s=i.uni(i.sub(e,t)),o=i.add(t,i.mul(s,i.pry(i.sub(r,t),s)));if(n){if(o[0]<Math.min(t[0],e[0]))return t[0]<e[0]?t:e;if(o[0]>Math.max(t[0],e[0]))return t[0]>e[0]?t:e;if(o[1]<Math.min(t[1],e[1]))return t[1]<e[1]?t:e;if(o[1]>Math.max(t[1],e[1]))return t[1]>e[1]?t:e}return o},n.distanceToLineSegment=(t,e,r,n=!0)=>i.dist(r,i.nearestPointOnLineSegment(t,e,r,n)),n.nudge=(t,e,r)=>i.isEqual(t,e)?t:i.add(t,i.mul(i.uni(i.sub(e,t)),r)),n.nudgeAtAngle=(t,e,r)=>[Math.cos(e)*r+t[0],Math.sin(e)*r+t[1]],n.toPrecision=(t,e=4)=>[+t[0].toPrecision(e),+t[1].toPrecision(e)],n.pointsBetween=(t,e,r=6)=>Array.from(Array(r)).map(((n,s)=>{const o=s/(r-1),a=Math.min(1,.5+Math.abs(.5-o));return[...i.lrp(t,e,o),a]})),n.slope=(t,e)=>t[0]===e[0]?NaN:(t[1]-e[1])/(t[0]-e[0]),n.max=(...t)=>[Math.max(...t.map((t=>t[0]))),Math.max(...t.map((t=>t[1])))],n.min=(...t)=>[Math.max(...t.map((t=>t[0]))),Math.max(...t.map((t=>t[1])))];var s=class{constructor(t=[]){this.points=[],this.lengths=[],this.totalLength=0,this.addPoint=t=>{if(this.prev){const e=n.dist(this.prev,t);this.lengths.push(e),this.totalLength+=e,this.points.push(t)}this.prev=t},this.clear=()=>{this.points=this.prev?[this.prev]:[],this.totalLength=0},this.getSplinePoint=t=>{const{points:e}=this,r=e.length-1,i=Math.trunc(t),n=Math.min(i+1,r),s=Math.min(n+1,r),o=Math.min(s+1,r),a=n-1,h=t-i,u=h*h,c=u*h,l=2*u-c-h,d=3*c-5*u+2,f=-3*c+4*u+h,p=c-u;return[(e[a][0]*l+e[n][0]*d+e[s][0]*f+e[o][0]*p)/2,(e[a][1]*l+e[n][1]*d+e[s][1]*f+e[o][1]*p)/2]},this.points=t,this.lengths=t.map(((t,e,r)=>0===e?0:n.dist(t,r[e-1]))),this.totalLength=this.lengths.reduce(((t,e)=>t+e),0)}},o=class{constructor(t){this.state="idle",this.queue=[],this.timestamp=performance.now(),this.lastRequestId=0,this.timeoutId=0,this.spline=new s,this.addPoint=t=>{clearTimeout(this.timeoutId);const e=performance.now(),r=Math.min(e-this.timestamp,o.MAX_INTERVAL);if(!this.prevPoint)return this.spline.clear(),this.prevPoint=t,this.spline.addPoint(t),this.cb(t),void(this.state="stopped");if("stopped"===this.state){if(n.dist(this.prevPoint,t)<4)return void this.cb(t);this.spline.clear(),this.spline.addPoint(this.prevPoint),this.spline.addPoint(this.prevPoint),this.spline.addPoint(t),this.state="idle"}else this.spline.addPoint(t);if(r<16)return this.prevPoint=t,this.timestamp=e,void this.cb(t);const i={start:this.spline.points.length-3,from:this.prevPoint,to:t,duration:r};switch(this.prevPoint=t,this.timestamp=e,this.state){case"idle":this.state="animating",this.animateNext(i);break;case"animating":this.queue.push(i)}},this.animateNext=t=>{const e=performance.now(),r=()=>{const i=(performance.now()-e)/t.duration;if(i<=1&&this.spline.points.length>0){try{this.cb(this.spline.getSplinePoint(i+t.start))}catch(t){console.warn(t)}return void(this.lastRequestId=requestAnimationFrame(r))}const n=this.queue.shift();n?(this.state="animating",this.animateNext(n)):(this.state="idle",this.timeoutId=setTimeout((()=>{this.state="stopped"}),o.MAX_INTERVAL))};r()},this.dispose=()=>{clearTimeout(this.timeoutId)},this.cb=t}},a=o;a.MAX_INTERVAL=300},3225:(t,e,r)=>{"use strict";var i=r(5606);void 0===i||!i.version||0===i.version.indexOf("v0.")||0===i.version.indexOf("v1.")&&0!==i.version.indexOf("v1.8.")?t.exports={nextTick:function(t,e,r,n){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var s,o,a=arguments.length;switch(a){case 0:case 1:return i.nextTick(t);case 2:return i.nextTick((function(){t.call(null,e)}));case 3:return i.nextTick((function(){t.call(null,e,r)}));case 4:return i.nextTick((function(){t.call(null,e,r,n)}));default:for(s=new Array(a-1),o=0;o<s.length;)s[o++]=arguments[o];return i.nextTick((function(){t.apply(null,s)}))}}}:t.exports=i},5606:t=>{var e,r,i=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===n||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:n}catch(t){e=n}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(t){r=s}}();var a,h=[],u=!1,c=-1;function l(){u&&a&&(u=!1,a.length?h=a.concat(h):c=-1,h.length&&d())}function d(){if(!u){var t=o(l);u=!0;for(var e=h.length;e;){for(a=h,h=[];++c<e;)a&&a[c].run();c=-1,e=h.length}a=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{return r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new f(t,e)),1!==h.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=p,i.addListener=p,i.once=p,i.off=p,i.removeListener=p,i.removeAllListeners=p,i.emit=p,i.prependListener=p,i.prependOnceListener=p,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},7168:(t,e,r)=>{e.publicEncrypt=r(8902),e.privateDecrypt=r(7362),e.privateEncrypt=function(t,r){return e.publicEncrypt(t,r,!0)},e.publicDecrypt=function(t,r){return e.privateDecrypt(t,r,!0)}},8206:(t,e,r)=>{var i=r(7108),n=r(2861).Buffer;function s(t){var e=n.allocUnsafe(4);return e.writeUInt32BE(t,0),e}t.exports=function(t,e){for(var r,o=n.alloc(0),a=0;o.length<e;)r=s(a++),o=n.concat([o,i("sha1").update(t).update(r).digest()]);return o.slice(0,e)}},2509:function(t,e,r){!function(t,e){"use strict";function i(t,e){if(!t)throw new Error(e||"Assertion failed")}function n(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}function s(t,e,r){if(s.isBN(t))return t;this.negative=0,this.words=null,this.length=0,this.red=null,null!==t&&("le"!==e&&"be"!==e||(r=e,e=10),this._init(t||0,e||10,r||"be"))}var o;"object"==typeof t?t.exports=s:e.BN=s,s.BN=s,s.wordSize=26;try{o="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:r(1069).Buffer}catch(t){}function a(t,e){var r=t.charCodeAt(e);return r>=65&&r<=70?r-55:r>=97&&r<=102?r-87:r-48&15}function h(t,e,r){var i=a(t,r);return r-1>=e&&(i|=a(t,r-1)<<4),i}function u(t,e,r,i){for(var n=0,s=Math.min(t.length,r),o=e;o<s;o++){var a=t.charCodeAt(o)-48;n*=i,n+=a>=49?a-49+10:a>=17?a-17+10:a}return n}s.isBN=function(t){return t instanceof s||null!==t&&"object"==typeof t&&t.constructor.wordSize===s.wordSize&&Array.isArray(t.words)},s.max=function(t,e){return t.cmp(e)>0?t:e},s.min=function(t,e){return t.cmp(e)<0?t:e},s.prototype._init=function(t,e,r){if("number"==typeof t)return this._initNumber(t,e,r);if("object"==typeof t)return this._initArray(t,e,r);"hex"===e&&(e=16),i(e===(0|e)&&e>=2&&e<=36);var n=0;"-"===(t=t.toString().replace(/\s+/g,""))[0]&&(n++,this.negative=1),n<t.length&&(16===e?this._parseHex(t,n,r):(this._parseBase(t,e,n),"le"===r&&this._initArray(this.toArray(),e,r)))},s.prototype._initNumber=function(t,e,r){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[67108863&t],this.length=1):t<4503599627370496?(this.words=[67108863&t,t/67108864&67108863],this.length=2):(i(t<9007199254740992),this.words=[67108863&t,t/67108864&67108863,1],this.length=3),"le"===r&&this._initArray(this.toArray(),e,r)},s.prototype._initArray=function(t,e,r){if(i("number"==typeof t.length),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var n=0;n<this.length;n++)this.words[n]=0;var s,o,a=0;if("be"===r)for(n=t.length-1,s=0;n>=0;n-=3)o=t[n]|t[n-1]<<8|t[n-2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);else if("le"===r)for(n=0,s=0;n<t.length;n+=3)o=t[n]|t[n+1]<<8|t[n+2]<<16,this.words[s]|=o<<a&67108863,this.words[s+1]=o>>>26-a&67108863,(a+=24)>=26&&(a-=26,s++);return this.strip()},s.prototype._parseHex=function(t,e,r){this.length=Math.ceil((t.length-e)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,s=0,o=0;if("be"===r)for(i=t.length-1;i>=e;i-=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;else for(i=(t.length-e)%2==0?e+1:e;i<t.length;i+=2)n=h(t,e,i)<<s,this.words[o]|=67108863&n,s>=18?(s-=18,o+=1,this.words[o]|=n>>>26):s+=8;this.strip()},s.prototype._parseBase=function(t,e,r){this.words=[0],this.length=1;for(var i=0,n=1;n<=67108863;n*=e)i++;i--,n=n/e|0;for(var s=t.length-r,o=s%i,a=Math.min(s,s-o)+r,h=0,c=r;c<a;c+=i)h=u(t,c,c+i,e),this.imuln(n),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==o){var l=1;for(h=u(t,c,t.length,e),c=0;c<o;c++)l*=e;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},s.prototype.copy=function(t){t.words=new Array(this.length);for(var e=0;e<this.length;e++)t.words[e]=this.words[e];t.length=this.length,t.negative=this.negative,t.red=this.red},s.prototype.clone=function(){var t=new s(null);return this.copy(t),t},s.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],d=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(t,e,r){r.negative=e.negative^t.negative;var i=t.length+e.length|0;r.length=i,i=i-1|0;var n=0|t.words[0],s=0|e.words[0],o=n*s,a=67108863&o,h=o/67108864|0;r.words[0]=a;for(var u=1;u<i;u++){for(var c=h>>>26,l=67108863&h,d=Math.min(u,e.length-1),f=Math.max(0,u-t.length+1);f<=d;f++){var p=u-f|0;c+=(o=(n=0|t.words[p])*(s=0|e.words[f])+l)/67108864|0,l=67108863&o}r.words[u]=0|l,h=0|c}return 0!==h?r.words[u]=0|h:r.length--,r.strip()}s.prototype.toString=function(t,e){var r;if(e=0|e||1,16===(t=t||10)||"hex"===t){r="";for(var n=0,s=0,o=0;o<this.length;o++){var a=this.words[o],h=(16777215&(a<<n|s)).toString(16);s=a>>>24-n&16777215,(n+=2)>=26&&(n-=26,o--),r=0!==s||o!==this.length-1?c[6-h.length]+h+r:h+r}for(0!==s&&(r=s.toString(16)+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}if(t===(0|t)&&t>=2&&t<=36){var u=l[t],f=d[t];r="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(t);r=(p=p.idivn(f)).isZero()?m+r:c[u-m.length]+m+r}for(this.isZero()&&(r="0"+r);r.length%e!=0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}i(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var t=this.words[0];return 2===this.length?t+=67108864*this.words[1]:3===this.length&&1===this.words[2]?t+=4503599627370496+67108864*this.words[1]:this.length>2&&i(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-t:t},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(t,e){return i(void 0!==o),this.toArrayLike(o,t,e)},s.prototype.toArray=function(t,e){return this.toArrayLike(Array,t,e)},s.prototype.toArrayLike=function(t,e,r){var n=this.byteLength(),s=r||Math.max(1,n);i(n<=s,"byte array longer than desired length"),i(s>0,"Requested array length <= 0"),this.strip();var o,a,h="le"===e,u=new t(s),c=this.clone();if(h){for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[a]=o;for(;a<s;a++)u[a]=0}else{for(a=0;a<s-n;a++)u[a]=0;for(a=0;!c.isZero();a++)o=c.andln(255),c.iushrn(8),u[s-a-1]=o}return u},Math.clz32?s.prototype._countBits=function(t){return 32-Math.clz32(t)}:s.prototype._countBits=function(t){var e=t,r=0;return e>=4096&&(r+=13,e>>>=13),e>=64&&(r+=7,e>>>=7),e>=8&&(r+=4,e>>>=4),e>=2&&(r+=2,e>>>=2),r+e},s.prototype._zeroBits=function(t){if(0===t)return 26;var e=t,r=0;return 8191&e||(r+=13,e>>>=13),127&e||(r+=7,e>>>=7),15&e||(r+=4,e>>>=4),3&e||(r+=2,e>>>=2),1&e||r++,r},s.prototype.bitLength=function(){var t=this.words[this.length-1],e=this._countBits(t);return 26*(this.length-1)+e},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,e=0;e<this.length;e++){var r=this._zeroBits(this.words[e]);if(t+=r,26!==r)break}return t},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(t){return 0!==this.negative?this.abs().inotn(t).iaddn(1):this.clone()},s.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var e=0;e<t.length;e++)this.words[e]=this.words[e]|t.words[e];return this.strip()},s.prototype.ior=function(t){return i(!(this.negative|t.negative)),this.iuor(t)},s.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},s.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},s.prototype.iuand=function(t){var e;e=this.length>t.length?t:this;for(var r=0;r<e.length;r++)this.words[r]=this.words[r]&t.words[r];return this.length=e.length,this.strip()},s.prototype.iand=function(t){return i(!(this.negative|t.negative)),this.iuand(t)},s.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},s.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},s.prototype.iuxor=function(t){var e,r;this.length>t.length?(e=this,r=t):(e=t,r=this);for(var i=0;i<r.length;i++)this.words[i]=e.words[i]^r.words[i];if(this!==e)for(;i<e.length;i++)this.words[i]=e.words[i];return this.length=e.length,this.strip()},s.prototype.ixor=function(t){return i(!(this.negative|t.negative)),this.iuxor(t)},s.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},s.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},s.prototype.inotn=function(t){i("number"==typeof t&&t>=0);var e=0|Math.ceil(t/26),r=t%26;this._expand(e),r>0&&e--;for(var n=0;n<e;n++)this.words[n]=67108863&~this.words[n];return r>0&&(this.words[n]=~this.words[n]&67108863>>26-r),this.strip()},s.prototype.notn=function(t){return this.clone().inotn(t)},s.prototype.setn=function(t,e){i("number"==typeof t&&t>=0);var r=t/26|0,n=t%26;return this._expand(r+1),this.words[r]=e?this.words[r]|1<<n:this.words[r]&~(1<<n),this.strip()},s.prototype.iadd=function(t){var e,r,i;if(0!==this.negative&&0===t.negative)return this.negative=0,e=this.isub(t),this.negative^=1,this._normSign();if(0===this.negative&&0!==t.negative)return t.negative=0,e=this.isub(t),t.negative=1,e._normSign();this.length>t.length?(r=this,i=t):(r=t,i=this);for(var n=0,s=0;s<i.length;s++)e=(0|r.words[s])+(0|i.words[s])+n,this.words[s]=67108863&e,n=e>>>26;for(;0!==n&&s<r.length;s++)e=(0|r.words[s])+n,this.words[s]=67108863&e,n=e>>>26;if(this.length=r.length,0!==n)this.words[this.length]=n,this.length++;else if(r!==this)for(;s<r.length;s++)this.words[s]=r.words[s];return this},s.prototype.add=function(t){var e;return 0!==t.negative&&0===this.negative?(t.negative=0,e=this.sub(t),t.negative^=1,e):0===t.negative&&0!==this.negative?(this.negative=0,e=t.sub(this),this.negative=1,e):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},s.prototype.isub=function(t){if(0!==t.negative){t.negative=0;var e=this.iadd(t);return t.negative=1,e._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var r,i,n=this.cmp(t);if(0===n)return this.negative=0,this.length=1,this.words[0]=0,this;n>0?(r=this,i=t):(r=t,i=this);for(var s=0,o=0;o<i.length;o++)s=(e=(0|r.words[o])-(0|i.words[o])+s)>>26,this.words[o]=67108863&e;for(;0!==s&&o<r.length;o++)s=(e=(0|r.words[o])+s)>>26,this.words[o]=67108863&e;if(0===s&&o<r.length&&r!==this)for(;o<r.length;o++)this.words[o]=r.words[o];return this.length=Math.max(this.length,o),r!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(t){return this.clone().isub(t)};var p=function(t,e,r){var i,n,s,o=t.words,a=e.words,h=r.words,u=0,c=0|o[0],l=8191&c,d=c>>>13,f=0|o[1],p=8191&f,m=f>>>13,g=0|o[2],b=8191&g,y=g>>>13,v=0|o[3],w=8191&v,M=v>>>13,_=0|o[4],S=8191&_,E=_>>>13,k=0|o[5],A=8191&k,I=k>>>13,x=0|o[6],C=8191&x,T=x>>>13,P=0|o[7],B=8191&P,R=P>>>13,D=0|o[8],N=8191&D,L=D>>>13,O=0|o[9],U=8191&O,F=O>>>13,j=0|a[0],V=8191&j,q=j>>>13,z=0|a[1],H=8191&z,$=z>>>13,W=0|a[2],K=8191&W,G=W>>>13,Z=0|a[3],Y=8191&Z,J=Z>>>13,X=0|a[4],Q=8191&X,tt=X>>>13,et=0|a[5],rt=8191&et,it=et>>>13,nt=0|a[6],st=8191&nt,ot=nt>>>13,at=0|a[7],ht=8191&at,ut=at>>>13,ct=0|a[8],lt=8191&ct,dt=ct>>>13,ft=0|a[9],pt=8191&ft,mt=ft>>>13;r.negative=t.negative^e.negative,r.length=19;var gt=(u+(i=Math.imul(l,V))|0)+((8191&(n=(n=Math.imul(l,q))+Math.imul(d,V)|0))<<13)|0;u=((s=Math.imul(d,q))+(n>>>13)|0)+(gt>>>26)|0,gt&=67108863,i=Math.imul(p,V),n=(n=Math.imul(p,q))+Math.imul(m,V)|0,s=Math.imul(m,q);var bt=(u+(i=i+Math.imul(l,H)|0)|0)+((8191&(n=(n=n+Math.imul(l,$)|0)+Math.imul(d,H)|0))<<13)|0;u=((s=s+Math.imul(d,$)|0)+(n>>>13)|0)+(bt>>>26)|0,bt&=67108863,i=Math.imul(b,V),n=(n=Math.imul(b,q))+Math.imul(y,V)|0,s=Math.imul(y,q),i=i+Math.imul(p,H)|0,n=(n=n+Math.imul(p,$)|0)+Math.imul(m,H)|0,s=s+Math.imul(m,$)|0;var yt=(u+(i=i+Math.imul(l,K)|0)|0)+((8191&(n=(n=n+Math.imul(l,G)|0)+Math.imul(d,K)|0))<<13)|0;u=((s=s+Math.imul(d,G)|0)+(n>>>13)|0)+(yt>>>26)|0,yt&=67108863,i=Math.imul(w,V),n=(n=Math.imul(w,q))+Math.imul(M,V)|0,s=Math.imul(M,q),i=i+Math.imul(b,H)|0,n=(n=n+Math.imul(b,$)|0)+Math.imul(y,H)|0,s=s+Math.imul(y,$)|0,i=i+Math.imul(p,K)|0,n=(n=n+Math.imul(p,G)|0)+Math.imul(m,K)|0,s=s+Math.imul(m,G)|0;var vt=(u+(i=i+Math.imul(l,Y)|0)|0)+((8191&(n=(n=n+Math.imul(l,J)|0)+Math.imul(d,Y)|0))<<13)|0;u=((s=s+Math.imul(d,J)|0)+(n>>>13)|0)+(vt>>>26)|0,vt&=67108863,i=Math.imul(S,V),n=(n=Math.imul(S,q))+Math.imul(E,V)|0,s=Math.imul(E,q),i=i+Math.imul(w,H)|0,n=(n=n+Math.imul(w,$)|0)+Math.imul(M,H)|0,s=s+Math.imul(M,$)|0,i=i+Math.imul(b,K)|0,n=(n=n+Math.imul(b,G)|0)+Math.imul(y,K)|0,s=s+Math.imul(y,G)|0,i=i+Math.imul(p,Y)|0,n=(n=n+Math.imul(p,J)|0)+Math.imul(m,Y)|0,s=s+Math.imul(m,J)|0;var wt=(u+(i=i+Math.imul(l,Q)|0)|0)+((8191&(n=(n=n+Math.imul(l,tt)|0)+Math.imul(d,Q)|0))<<13)|0;u=((s=s+Math.imul(d,tt)|0)+(n>>>13)|0)+(wt>>>26)|0,wt&=67108863,i=Math.imul(A,V),n=(n=Math.imul(A,q))+Math.imul(I,V)|0,s=Math.imul(I,q),i=i+Math.imul(S,H)|0,n=(n=n+Math.imul(S,$)|0)+Math.imul(E,H)|0,s=s+Math.imul(E,$)|0,i=i+Math.imul(w,K)|0,n=(n=n+Math.imul(w,G)|0)+Math.imul(M,K)|0,s=s+Math.imul(M,G)|0,i=i+Math.imul(b,Y)|0,n=(n=n+Math.imul(b,J)|0)+Math.imul(y,Y)|0,s=s+Math.imul(y,J)|0,i=i+Math.imul(p,Q)|0,n=(n=n+Math.imul(p,tt)|0)+Math.imul(m,Q)|0,s=s+Math.imul(m,tt)|0;var Mt=(u+(i=i+Math.imul(l,rt)|0)|0)+((8191&(n=(n=n+Math.imul(l,it)|0)+Math.imul(d,rt)|0))<<13)|0;u=((s=s+Math.imul(d,it)|0)+(n>>>13)|0)+(Mt>>>26)|0,Mt&=67108863,i=Math.imul(C,V),n=(n=Math.imul(C,q))+Math.imul(T,V)|0,s=Math.imul(T,q),i=i+Math.imul(A,H)|0,n=(n=n+Math.imul(A,$)|0)+Math.imul(I,H)|0,s=s+Math.imul(I,$)|0,i=i+Math.imul(S,K)|0,n=(n=n+Math.imul(S,G)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,G)|0,i=i+Math.imul(w,Y)|0,n=(n=n+Math.imul(w,J)|0)+Math.imul(M,Y)|0,s=s+Math.imul(M,J)|0,i=i+Math.imul(b,Q)|0,n=(n=n+Math.imul(b,tt)|0)+Math.imul(y,Q)|0,s=s+Math.imul(y,tt)|0,i=i+Math.imul(p,rt)|0,n=(n=n+Math.imul(p,it)|0)+Math.imul(m,rt)|0,s=s+Math.imul(m,it)|0;var _t=(u+(i=i+Math.imul(l,st)|0)|0)+((8191&(n=(n=n+Math.imul(l,ot)|0)+Math.imul(d,st)|0))<<13)|0;u=((s=s+Math.imul(d,ot)|0)+(n>>>13)|0)+(_t>>>26)|0,_t&=67108863,i=Math.imul(B,V),n=(n=Math.imul(B,q))+Math.imul(R,V)|0,s=Math.imul(R,q),i=i+Math.imul(C,H)|0,n=(n=n+Math.imul(C,$)|0)+Math.imul(T,H)|0,s=s+Math.imul(T,$)|0,i=i+Math.imul(A,K)|0,n=(n=n+Math.imul(A,G)|0)+Math.imul(I,K)|0,s=s+Math.imul(I,G)|0,i=i+Math.imul(S,Y)|0,n=(n=n+Math.imul(S,J)|0)+Math.imul(E,Y)|0,s=s+Math.imul(E,J)|0,i=i+Math.imul(w,Q)|0,n=(n=n+Math.imul(w,tt)|0)+Math.imul(M,Q)|0,s=s+Math.imul(M,tt)|0,i=i+Math.imul(b,rt)|0,n=(n=n+Math.imul(b,it)|0)+Math.imul(y,rt)|0,s=s+Math.imul(y,it)|0,i=i+Math.imul(p,st)|0,n=(n=n+Math.imul(p,ot)|0)+Math.imul(m,st)|0,s=s+Math.imul(m,ot)|0;var St=(u+(i=i+Math.imul(l,ht)|0)|0)+((8191&(n=(n=n+Math.imul(l,ut)|0)+Math.imul(d,ht)|0))<<13)|0;u=((s=s+Math.imul(d,ut)|0)+(n>>>13)|0)+(St>>>26)|0,St&=67108863,i=Math.imul(N,V),n=(n=Math.imul(N,q))+Math.imul(L,V)|0,s=Math.imul(L,q),i=i+Math.imul(B,H)|0,n=(n=n+Math.imul(B,$)|0)+Math.imul(R,H)|0,s=s+Math.imul(R,$)|0,i=i+Math.imul(C,K)|0,n=(n=n+Math.imul(C,G)|0)+Math.imul(T,K)|0,s=s+Math.imul(T,G)|0,i=i+Math.imul(A,Y)|0,n=(n=n+Math.imul(A,J)|0)+Math.imul(I,Y)|0,s=s+Math.imul(I,J)|0,i=i+Math.imul(S,Q)|0,n=(n=n+Math.imul(S,tt)|0)+Math.imul(E,Q)|0,s=s+Math.imul(E,tt)|0,i=i+Math.imul(w,rt)|0,n=(n=n+Math.imul(w,it)|0)+Math.imul(M,rt)|0,s=s+Math.imul(M,it)|0,i=i+Math.imul(b,st)|0,n=(n=n+Math.imul(b,ot)|0)+Math.imul(y,st)|0,s=s+Math.imul(y,ot)|0,i=i+Math.imul(p,ht)|0,n=(n=n+Math.imul(p,ut)|0)+Math.imul(m,ht)|0,s=s+Math.imul(m,ut)|0;var Et=(u+(i=i+Math.imul(l,lt)|0)|0)+((8191&(n=(n=n+Math.imul(l,dt)|0)+Math.imul(d,lt)|0))<<13)|0;u=((s=s+Math.imul(d,dt)|0)+(n>>>13)|0)+(Et>>>26)|0,Et&=67108863,i=Math.imul(U,V),n=(n=Math.imul(U,q))+Math.imul(F,V)|0,s=Math.imul(F,q),i=i+Math.imul(N,H)|0,n=(n=n+Math.imul(N,$)|0)+Math.imul(L,H)|0,s=s+Math.imul(L,$)|0,i=i+Math.imul(B,K)|0,n=(n=n+Math.imul(B,G)|0)+Math.imul(R,K)|0,s=s+Math.imul(R,G)|0,i=i+Math.imul(C,Y)|0,n=(n=n+Math.imul(C,J)|0)+Math.imul(T,Y)|0,s=s+Math.imul(T,J)|0,i=i+Math.imul(A,Q)|0,n=(n=n+Math.imul(A,tt)|0)+Math.imul(I,Q)|0,s=s+Math.imul(I,tt)|0,i=i+Math.imul(S,rt)|0,n=(n=n+Math.imul(S,it)|0)+Math.imul(E,rt)|0,s=s+Math.imul(E,it)|0,i=i+Math.imul(w,st)|0,n=(n=n+Math.imul(w,ot)|0)+Math.imul(M,st)|0,s=s+Math.imul(M,ot)|0,i=i+Math.imul(b,ht)|0,n=(n=n+Math.imul(b,ut)|0)+Math.imul(y,ht)|0,s=s+Math.imul(y,ut)|0,i=i+Math.imul(p,lt)|0,n=(n=n+Math.imul(p,dt)|0)+Math.imul(m,lt)|0,s=s+Math.imul(m,dt)|0;var kt=(u+(i=i+Math.imul(l,pt)|0)|0)+((8191&(n=(n=n+Math.imul(l,mt)|0)+Math.imul(d,pt)|0))<<13)|0;u=((s=s+Math.imul(d,mt)|0)+(n>>>13)|0)+(kt>>>26)|0,kt&=67108863,i=Math.imul(U,H),n=(n=Math.imul(U,$))+Math.imul(F,H)|0,s=Math.imul(F,$),i=i+Math.imul(N,K)|0,n=(n=n+Math.imul(N,G)|0)+Math.imul(L,K)|0,s=s+Math.imul(L,G)|0,i=i+Math.imul(B,Y)|0,n=(n=n+Math.imul(B,J)|0)+Math.imul(R,Y)|0,s=s+Math.imul(R,J)|0,i=i+Math.imul(C,Q)|0,n=(n=n+Math.imul(C,tt)|0)+Math.imul(T,Q)|0,s=s+Math.imul(T,tt)|0,i=i+Math.imul(A,rt)|0,n=(n=n+Math.imul(A,it)|0)+Math.imul(I,rt)|0,s=s+Math.imul(I,it)|0,i=i+Math.imul(S,st)|0,n=(n=n+Math.imul(S,ot)|0)+Math.imul(E,st)|0,s=s+Math.imul(E,ot)|0,i=i+Math.imul(w,ht)|0,n=(n=n+Math.imul(w,ut)|0)+Math.imul(M,ht)|0,s=s+Math.imul(M,ut)|0,i=i+Math.imul(b,lt)|0,n=(n=n+Math.imul(b,dt)|0)+Math.imul(y,lt)|0,s=s+Math.imul(y,dt)|0;var At=(u+(i=i+Math.imul(p,pt)|0)|0)+((8191&(n=(n=n+Math.imul(p,mt)|0)+Math.imul(m,pt)|0))<<13)|0;u=((s=s+Math.imul(m,mt)|0)+(n>>>13)|0)+(At>>>26)|0,At&=67108863,i=Math.imul(U,K),n=(n=Math.imul(U,G))+Math.imul(F,K)|0,s=Math.imul(F,G),i=i+Math.imul(N,Y)|0,n=(n=n+Math.imul(N,J)|0)+Math.imul(L,Y)|0,s=s+Math.imul(L,J)|0,i=i+Math.imul(B,Q)|0,n=(n=n+Math.imul(B,tt)|0)+Math.imul(R,Q)|0,s=s+Math.imul(R,tt)|0,i=i+Math.imul(C,rt)|0,n=(n=n+Math.imul(C,it)|0)+Math.imul(T,rt)|0,s=s+Math.imul(T,it)|0,i=i+Math.imul(A,st)|0,n=(n=n+Math.imul(A,ot)|0)+Math.imul(I,st)|0,s=s+Math.imul(I,ot)|0,i=i+Math.imul(S,ht)|0,n=(n=n+Math.imul(S,ut)|0)+Math.imul(E,ht)|0,s=s+Math.imul(E,ut)|0,i=i+Math.imul(w,lt)|0,n=(n=n+Math.imul(w,dt)|0)+Math.imul(M,lt)|0,s=s+Math.imul(M,dt)|0;var It=(u+(i=i+Math.imul(b,pt)|0)|0)+((8191&(n=(n=n+Math.imul(b,mt)|0)+Math.imul(y,pt)|0))<<13)|0;u=((s=s+Math.imul(y,mt)|0)+(n>>>13)|0)+(It>>>26)|0,It&=67108863,i=Math.imul(U,Y),n=(n=Math.imul(U,J))+Math.imul(F,Y)|0,s=Math.imul(F,J),i=i+Math.imul(N,Q)|0,n=(n=n+Math.imul(N,tt)|0)+Math.imul(L,Q)|0,s=s+Math.imul(L,tt)|0,i=i+Math.imul(B,rt)|0,n=(n=n+Math.imul(B,it)|0)+Math.imul(R,rt)|0,s=s+Math.imul(R,it)|0,i=i+Math.imul(C,st)|0,n=(n=n+Math.imul(C,ot)|0)+Math.imul(T,st)|0,s=s+Math.imul(T,ot)|0,i=i+Math.imul(A,ht)|0,n=(n=n+Math.imul(A,ut)|0)+Math.imul(I,ht)|0,s=s+Math.imul(I,ut)|0,i=i+Math.imul(S,lt)|0,n=(n=n+Math.imul(S,dt)|0)+Math.imul(E,lt)|0,s=s+Math.imul(E,dt)|0;var xt=(u+(i=i+Math.imul(w,pt)|0)|0)+((8191&(n=(n=n+Math.imul(w,mt)|0)+Math.imul(M,pt)|0))<<13)|0;u=((s=s+Math.imul(M,mt)|0)+(n>>>13)|0)+(xt>>>26)|0,xt&=67108863,i=Math.imul(U,Q),n=(n=Math.imul(U,tt))+Math.imul(F,Q)|0,s=Math.imul(F,tt),i=i+Math.imul(N,rt)|0,n=(n=n+Math.imul(N,it)|0)+Math.imul(L,rt)|0,s=s+Math.imul(L,it)|0,i=i+Math.imul(B,st)|0,n=(n=n+Math.imul(B,ot)|0)+Math.imul(R,st)|0,s=s+Math.imul(R,ot)|0,i=i+Math.imul(C,ht)|0,n=(n=n+Math.imul(C,ut)|0)+Math.imul(T,ht)|0,s=s+Math.imul(T,ut)|0,i=i+Math.imul(A,lt)|0,n=(n=n+Math.imul(A,dt)|0)+Math.imul(I,lt)|0,s=s+Math.imul(I,dt)|0;var Ct=(u+(i=i+Math.imul(S,pt)|0)|0)+((8191&(n=(n=n+Math.imul(S,mt)|0)+Math.imul(E,pt)|0))<<13)|0;u=((s=s+Math.imul(E,mt)|0)+(n>>>13)|0)+(Ct>>>26)|0,Ct&=67108863,i=Math.imul(U,rt),n=(n=Math.imul(U,it))+Math.imul(F,rt)|0,s=Math.imul(F,it),i=i+Math.imul(N,st)|0,n=(n=n+Math.imul(N,ot)|0)+Math.imul(L,st)|0,s=s+Math.imul(L,ot)|0,i=i+Math.imul(B,ht)|0,n=(n=n+Math.imul(B,ut)|0)+Math.imul(R,ht)|0,s=s+Math.imul(R,ut)|0,i=i+Math.imul(C,lt)|0,n=(n=n+Math.imul(C,dt)|0)+Math.imul(T,lt)|0,s=s+Math.imul(T,dt)|0;var Tt=(u+(i=i+Math.imul(A,pt)|0)|0)+((8191&(n=(n=n+Math.imul(A,mt)|0)+Math.imul(I,pt)|0))<<13)|0;u=((s=s+Math.imul(I,mt)|0)+(n>>>13)|0)+(Tt>>>26)|0,Tt&=67108863,i=Math.imul(U,st),n=(n=Math.imul(U,ot))+Math.imul(F,st)|0,s=Math.imul(F,ot),i=i+Math.imul(N,ht)|0,n=(n=n+Math.imul(N,ut)|0)+Math.imul(L,ht)|0,s=s+Math.imul(L,ut)|0,i=i+Math.imul(B,lt)|0,n=(n=n+Math.imul(B,dt)|0)+Math.imul(R,lt)|0,s=s+Math.imul(R,dt)|0;var Pt=(u+(i=i+Math.imul(C,pt)|0)|0)+((8191&(n=(n=n+Math.imul(C,mt)|0)+Math.imul(T,pt)|0))<<13)|0;u=((s=s+Math.imul(T,mt)|0)+(n>>>13)|0)+(Pt>>>26)|0,Pt&=67108863,i=Math.imul(U,ht),n=(n=Math.imul(U,ut))+Math.imul(F,ht)|0,s=Math.imul(F,ut),i=i+Math.imul(N,lt)|0,n=(n=n+Math.imul(N,dt)|0)+Math.imul(L,lt)|0,s=s+Math.imul(L,dt)|0;var Bt=(u+(i=i+Math.imul(B,pt)|0)|0)+((8191&(n=(n=n+Math.imul(B,mt)|0)+Math.imul(R,pt)|0))<<13)|0;u=((s=s+Math.imul(R,mt)|0)+(n>>>13)|0)+(Bt>>>26)|0,Bt&=67108863,i=Math.imul(U,lt),n=(n=Math.imul(U,dt))+Math.imul(F,lt)|0,s=Math.imul(F,dt);var Rt=(u+(i=i+Math.imul(N,pt)|0)|0)+((8191&(n=(n=n+Math.imul(N,mt)|0)+Math.imul(L,pt)|0))<<13)|0;u=((s=s+Math.imul(L,mt)|0)+(n>>>13)|0)+(Rt>>>26)|0,Rt&=67108863;var Dt=(u+(i=Math.imul(U,pt))|0)+((8191&(n=(n=Math.imul(U,mt))+Math.imul(F,pt)|0))<<13)|0;return u=((s=Math.imul(F,mt))+(n>>>13)|0)+(Dt>>>26)|0,Dt&=67108863,h[0]=gt,h[1]=bt,h[2]=yt,h[3]=vt,h[4]=wt,h[5]=Mt,h[6]=_t,h[7]=St,h[8]=Et,h[9]=kt,h[10]=At,h[11]=It,h[12]=xt,h[13]=Ct,h[14]=Tt,h[15]=Pt,h[16]=Bt,h[17]=Rt,h[18]=Dt,0!==u&&(h[19]=u,r.length++),r};function m(t,e,r){return(new g).mulp(t,e,r)}function g(t,e){this.x=t,this.y=e}Math.imul||(p=f),s.prototype.mulTo=function(t,e){var r,i=this.length+t.length;return r=10===this.length&&10===t.length?p(this,t,e):i<63?f(this,t,e):i<1024?function(t,e,r){r.negative=e.negative^t.negative,r.length=t.length+e.length;for(var i=0,n=0,s=0;s<r.length-1;s++){var o=n;n=0;for(var a=67108863&i,h=Math.min(s,e.length-1),u=Math.max(0,s-t.length+1);u<=h;u++){var c=s-u,l=(0|t.words[c])*(0|e.words[u]),d=67108863&l;a=67108863&(d=d+a|0),n+=(o=(o=o+(l/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=a,i=o,o=n}return 0!==i?r.words[s]=i:r.length--,r.strip()}(this,t,e):m(this,t,e),r},g.prototype.makeRBT=function(t){for(var e=new Array(t),r=s.prototype._countBits(t)-1,i=0;i<t;i++)e[i]=this.revBin(i,r,t);return e},g.prototype.revBin=function(t,e,r){if(0===t||t===r-1)return t;for(var i=0,n=0;n<e;n++)i|=(1&t)<<e-n-1,t>>=1;return i},g.prototype.permute=function(t,e,r,i,n,s){for(var o=0;o<s;o++)i[o]=e[t[o]],n[o]=r[t[o]]},g.prototype.transform=function(t,e,r,i,n,s){this.permute(s,t,e,r,i,n);for(var o=1;o<n;o<<=1)for(var a=o<<1,h=Math.cos(2*Math.PI/a),u=Math.sin(2*Math.PI/a),c=0;c<n;c+=a)for(var l=h,d=u,f=0;f<o;f++){var p=r[c+f],m=i[c+f],g=r[c+f+o],b=i[c+f+o],y=l*g-d*b;b=l*b+d*g,g=y,r[c+f]=p+g,i[c+f]=m+b,r[c+f+o]=p-g,i[c+f+o]=m-b,f!==a&&(y=h*l-u*d,d=h*d+u*l,l=y)}},g.prototype.guessLen13b=function(t,e){var r=1|Math.max(e,t),i=1&r,n=0;for(r=r/2|0;r;r>>>=1)n++;return 1<<n+1+i},g.prototype.conjugate=function(t,e,r){if(!(r<=1))for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n,n=e[i],e[i]=-e[r-i-1],e[r-i-1]=-n}},g.prototype.normalize13b=function(t,e){for(var r=0,i=0;i<e/2;i++){var n=8192*Math.round(t[2*i+1]/e)+Math.round(t[2*i]/e)+r;t[i]=67108863&n,r=n<67108864?0:n/67108864|0}return t},g.prototype.convert13b=function(t,e,r,n){for(var s=0,o=0;o<e;o++)s+=0|t[o],r[2*o]=8191&s,s>>>=13,r[2*o+1]=8191&s,s>>>=13;for(o=2*e;o<n;++o)r[o]=0;i(0===s),i(!(-8192&s))},g.prototype.stub=function(t){for(var e=new Array(t),r=0;r<t;r++)e[r]=0;return e},g.prototype.mulp=function(t,e,r){var i=2*this.guessLen13b(t.length,e.length),n=this.makeRBT(i),s=this.stub(i),o=new Array(i),a=new Array(i),h=new Array(i),u=new Array(i),c=new Array(i),l=new Array(i),d=r.words;d.length=i,this.convert13b(t.words,t.length,o,i),this.convert13b(e.words,e.length,u,i),this.transform(o,s,a,h,i,n),this.transform(u,s,c,l,i,n);for(var f=0;f<i;f++){var p=a[f]*c[f]-h[f]*l[f];h[f]=a[f]*l[f]+h[f]*c[f],a[f]=p}return this.conjugate(a,h,i),this.transform(a,h,d,s,i,n),this.conjugate(d,s,i),this.normalize13b(d,i),r.negative=t.negative^e.negative,r.length=t.length+e.length,r.strip()},s.prototype.mul=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),this.mulTo(t,e)},s.prototype.mulf=function(t){var e=new s(null);return e.words=new Array(this.length+t.length),m(this,t,e)},s.prototype.imul=function(t){return this.clone().mulTo(t,this)},s.prototype.imuln=function(t){i("number"==typeof t),i(t<67108864);for(var e=0,r=0;r<this.length;r++){var n=(0|this.words[r])*t,s=(67108863&n)+(67108863&e);e>>=26,e+=n/67108864|0,e+=s>>>26,this.words[r]=67108863&s}return 0!==e&&(this.words[r]=e,this.length++),this},s.prototype.muln=function(t){return this.clone().imuln(t)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(t){var e=function(t){for(var e=new Array(t.bitLength()),r=0;r<e.length;r++){var i=r/26|0,n=r%26;e[r]=(t.words[i]&1<<n)>>>n}return e}(t);if(0===e.length)return new s(1);for(var r=this,i=0;i<e.length&&0===e[i];i++,r=r.sqr());if(++i<e.length)for(var n=r.sqr();i<e.length;i++,n=n.sqr())0!==e[i]&&(r=r.mul(n));return r},s.prototype.iushln=function(t){i("number"==typeof t&&t>=0);var e,r=t%26,n=(t-r)/26,s=67108863>>>26-r<<26-r;if(0!==r){var o=0;for(e=0;e<this.length;e++){var a=this.words[e]&s,h=(0|this.words[e])-a<<r;this.words[e]=h|o,o=a>>>26-r}o&&(this.words[e]=o,this.length++)}if(0!==n){for(e=this.length-1;e>=0;e--)this.words[e+n]=this.words[e];for(e=0;e<n;e++)this.words[e]=0;this.length+=n}return this.strip()},s.prototype.ishln=function(t){return i(0===this.negative),this.iushln(t)},s.prototype.iushrn=function(t,e,r){var n;i("number"==typeof t&&t>=0),n=e?(e-e%26)/26:0;var s=t%26,o=Math.min((t-s)/26,this.length),a=67108863^67108863>>>s<<s,h=r;if(n-=o,n=Math.max(0,n),h){for(var u=0;u<o;u++)h.words[u]=this.words[u];h.length=o}if(0===o);else if(this.length>o)for(this.length-=o,u=0;u<this.length;u++)this.words[u]=this.words[u+o];else this.words[0]=0,this.length=1;var c=0;for(u=this.length-1;u>=0&&(0!==c||u>=n);u--){var l=0|this.words[u];this.words[u]=c<<26-s|l>>>s,c=l&a}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(t,e,r){return i(0===this.negative),this.iushrn(t,e,r)},s.prototype.shln=function(t){return this.clone().ishln(t)},s.prototype.ushln=function(t){return this.clone().iushln(t)},s.prototype.shrn=function(t){return this.clone().ishrn(t)},s.prototype.ushrn=function(t){return this.clone().iushrn(t)},s.prototype.testn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26,n=1<<e;return!(this.length<=r||!(this.words[r]&n))},s.prototype.imaskn=function(t){i("number"==typeof t&&t>=0);var e=t%26,r=(t-e)/26;if(i(0===this.negative,"imaskn works only with positive numbers"),this.length<=r)return this;if(0!==e&&r++,this.length=Math.min(r,this.length),0!==e){var n=67108863^67108863>>>e<<e;this.words[this.length-1]&=n}return this.strip()},s.prototype.maskn=function(t){return this.clone().imaskn(t)},s.prototype.iaddn=function(t){return i("number"==typeof t),i(t<67108864),t<0?this.isubn(-t):0!==this.negative?1===this.length&&(0|this.words[0])<t?(this.words[0]=t-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},s.prototype._iaddn=function(t){this.words[0]+=t;for(var e=0;e<this.length&&this.words[e]>=67108864;e++)this.words[e]-=67108864,e===this.length-1?this.words[e+1]=1:this.words[e+1]++;return this.length=Math.max(this.length,e+1),this},s.prototype.isubn=function(t){if(i("number"==typeof t),i(t<67108864),t<0)return this.iaddn(-t);if(0!==this.negative)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var e=0;e<this.length&&this.words[e]<0;e++)this.words[e]+=67108864,this.words[e+1]-=1;return this.strip()},s.prototype.addn=function(t){return this.clone().iaddn(t)},s.prototype.subn=function(t){return this.clone().isubn(t)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(t,e,r){var n,s,o=t.length+r;this._expand(o);var a=0;for(n=0;n<t.length;n++){s=(0|this.words[n+r])+a;var h=(0|t.words[n])*e;a=((s-=67108863&h)>>26)-(h/67108864|0),this.words[n+r]=67108863&s}for(;n<this.length-r;n++)a=(s=(0|this.words[n+r])+a)>>26,this.words[n+r]=67108863&s;if(0===a)return this.strip();for(i(-1===a),a=0,n=0;n<this.length;n++)a=(s=-(0|this.words[n])+a)>>26,this.words[n]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(t,e){var r=(this.length,t.length),i=this.clone(),n=t,o=0|n.words[n.length-1];0!=(r=26-this._countBits(o))&&(n=n.ushln(r),i.iushln(r),o=0|n.words[n.length-1]);var a,h=i.length-n.length;if("mod"!==e){(a=new s(null)).length=h+1,a.words=new Array(a.length);for(var u=0;u<a.length;u++)a.words[u]=0}var c=i.clone()._ishlnsubmul(n,1,h);0===c.negative&&(i=c,a&&(a.words[h]=1));for(var l=h-1;l>=0;l--){var d=67108864*(0|i.words[n.length+l])+(0|i.words[n.length+l-1]);for(d=Math.min(d/o|0,67108863),i._ishlnsubmul(n,d,l);0!==i.negative;)d--,i.negative=0,i._ishlnsubmul(n,1,l),i.isZero()||(i.negative^=1);a&&(a.words[l]=d)}return a&&a.strip(),i.strip(),"div"!==e&&0!==r&&i.iushrn(r),{div:a||null,mod:i}},s.prototype.divmod=function(t,e,r){return i(!t.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===t.negative?(a=this.neg().divmod(t,e),"mod"!==e&&(n=a.div.neg()),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.iadd(t)),{div:n,mod:o}):0===this.negative&&0!==t.negative?(a=this.divmod(t.neg(),e),"mod"!==e&&(n=a.div.neg()),{div:n,mod:a.mod}):this.negative&t.negative?(a=this.neg().divmod(t.neg(),e),"div"!==e&&(o=a.mod.neg(),r&&0!==o.negative&&o.isub(t)),{div:a.div,mod:o}):t.length>this.length||this.cmp(t)<0?{div:new s(0),mod:this}:1===t.length?"div"===e?{div:this.divn(t.words[0]),mod:null}:"mod"===e?{div:null,mod:new s(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new s(this.modn(t.words[0]))}:this._wordDiv(t,e);var n,o,a},s.prototype.div=function(t){return this.divmod(t,"div",!1).div},s.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},s.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},s.prototype.divRound=function(t){var e=this.divmod(t);if(e.mod.isZero())return e.div;var r=0!==e.div.negative?e.mod.isub(t):e.mod,i=t.ushrn(1),n=t.andln(1),s=r.cmp(i);return s<0||1===n&&0===s?e.div:0!==e.div.negative?e.div.isubn(1):e.div.iaddn(1)},s.prototype.modn=function(t){i(t<=67108863);for(var e=(1<<26)%t,r=0,n=this.length-1;n>=0;n--)r=(e*r+(0|this.words[n]))%t;return r},s.prototype.idivn=function(t){i(t<=67108863);for(var e=0,r=this.length-1;r>=0;r--){var n=(0|this.words[r])+67108864*e;this.words[r]=n/t|0,e=n%t}return this.strip()},s.prototype.divn=function(t){return this.clone().idivn(t)},s.prototype.egcd=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n=new s(1),o=new s(0),a=new s(0),h=new s(1),u=0;e.isEven()&&r.isEven();)e.iushrn(1),r.iushrn(1),++u;for(var c=r.clone(),l=e.clone();!e.isZero();){for(var d=0,f=1;!(e.words[0]&f)&&d<26;++d,f<<=1);if(d>0)for(e.iushrn(d);d-- >0;)(n.isOdd()||o.isOdd())&&(n.iadd(c),o.isub(l)),n.iushrn(1),o.iushrn(1);for(var p=0,m=1;!(r.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(r.iushrn(p);p-- >0;)(a.isOdd()||h.isOdd())&&(a.iadd(c),h.isub(l)),a.iushrn(1),h.iushrn(1);e.cmp(r)>=0?(e.isub(r),n.isub(a),o.isub(h)):(r.isub(e),a.isub(n),h.isub(o))}return{a,b:h,gcd:r.iushln(u)}},s.prototype._invmp=function(t){i(0===t.negative),i(!t.isZero());var e=this,r=t.clone();e=0!==e.negative?e.umod(t):e.clone();for(var n,o=new s(1),a=new s(0),h=r.clone();e.cmpn(1)>0&&r.cmpn(1)>0;){for(var u=0,c=1;!(e.words[0]&c)&&u<26;++u,c<<=1);if(u>0)for(e.iushrn(u);u-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);for(var l=0,d=1;!(r.words[0]&d)&&l<26;++l,d<<=1);if(l>0)for(r.iushrn(l);l-- >0;)a.isOdd()&&a.iadd(h),a.iushrn(1);e.cmp(r)>=0?(e.isub(r),o.isub(a)):(r.isub(e),a.isub(o))}return(n=0===e.cmpn(1)?o:a).cmpn(0)<0&&n.iadd(t),n},s.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var e=this.clone(),r=t.clone();e.negative=0,r.negative=0;for(var i=0;e.isEven()&&r.isEven();i++)e.iushrn(1),r.iushrn(1);for(;;){for(;e.isEven();)e.iushrn(1);for(;r.isEven();)r.iushrn(1);var n=e.cmp(r);if(n<0){var s=e;e=r,r=s}else if(0===n||0===r.cmpn(1))break;e.isub(r)}return r.iushln(i)},s.prototype.invm=function(t){return this.egcd(t).a.umod(t)},s.prototype.isEven=function(){return!(1&this.words[0])},s.prototype.isOdd=function(){return!(1&~this.words[0])},s.prototype.andln=function(t){return this.words[0]&t},s.prototype.bincn=function(t){i("number"==typeof t);var e=t%26,r=(t-e)/26,n=1<<e;if(this.length<=r)return this._expand(r+1),this.words[r]|=n,this;for(var s=n,o=r;0!==s&&o<this.length;o++){var a=0|this.words[o];s=(a+=s)>>>26,a&=67108863,this.words[o]=a}return 0!==s&&(this.words[o]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(t){var e,r=t<0;if(0!==this.negative&&!r)return-1;if(0===this.negative&&r)return 1;if(this.strip(),this.length>1)e=1;else{r&&(t=-t),i(t<=67108863,"Number is too big");var n=0|this.words[0];e=n===t?0:n<t?-1:1}return 0!==this.negative?0|-e:e},s.prototype.cmp=function(t){if(0!==this.negative&&0===t.negative)return-1;if(0===this.negative&&0!==t.negative)return 1;var e=this.ucmp(t);return 0!==this.negative?0|-e:e},s.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var e=0,r=this.length-1;r>=0;r--){var i=0|this.words[r],n=0|t.words[r];if(i!==n){i<n?e=-1:i>n&&(e=1);break}}return e},s.prototype.gtn=function(t){return 1===this.cmpn(t)},s.prototype.gt=function(t){return 1===this.cmp(t)},s.prototype.gten=function(t){return this.cmpn(t)>=0},s.prototype.gte=function(t){return this.cmp(t)>=0},s.prototype.ltn=function(t){return-1===this.cmpn(t)},s.prototype.lt=function(t){return-1===this.cmp(t)},s.prototype.lten=function(t){return this.cmpn(t)<=0},s.prototype.lte=function(t){return this.cmp(t)<=0},s.prototype.eqn=function(t){return 0===this.cmpn(t)},s.prototype.eq=function(t){return 0===this.cmp(t)},s.red=function(t){return new S(t)},s.prototype.toRed=function(t){return i(!this.red,"Already a number in reduction context"),i(0===this.negative,"red works only with positives"),t.convertTo(this)._forceRed(t)},s.prototype.fromRed=function(){return i(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(t){return this.red=t,this},s.prototype.forceRed=function(t){return i(!this.red,"Already a number in reduction context"),this._forceRed(t)},s.prototype.redAdd=function(t){return i(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},s.prototype.redIAdd=function(t){return i(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},s.prototype.redSub=function(t){return i(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},s.prototype.redISub=function(t){return i(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},s.prototype.redShl=function(t){return i(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},s.prototype.redMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},s.prototype.redIMul=function(t){return i(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},s.prototype.redSqr=function(){return i(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return i(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return i(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return i(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return i(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(t){return i(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var b={k256:null,p224:null,p192:null,p25519:null};function y(t,e){this.name=t,this.p=new s(e,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){y.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){y.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function M(){y.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function _(){y.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function S(t){if("string"==typeof t){var e=s._prime(t);this.m=e.p,this.prime=e}else i(t.gtn(1),"modulus must be greater than 1"),this.m=t,this.prime=null}function E(t){S.call(this,t),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}y.prototype._tmp=function(){var t=new s(null);return t.words=new Array(Math.ceil(this.n/13)),t},y.prototype.ireduce=function(t){var e,r=t;do{this.split(r,this.tmp),e=(r=(r=this.imulK(r)).iadd(this.tmp)).bitLength()}while(e>this.n);var i=e<this.n?-1:r.ucmp(this.p);return 0===i?(r.words[0]=0,r.length=1):i>0?r.isub(this.p):void 0!==r.strip?r.strip():r._strip(),r},y.prototype.split=function(t,e){t.iushrn(this.n,0,e)},y.prototype.imulK=function(t){return t.imul(this.k)},n(v,y),v.prototype.split=function(t,e){for(var r=4194303,i=Math.min(t.length,9),n=0;n<i;n++)e.words[n]=t.words[n];if(e.length=i,t.length<=9)return t.words[0]=0,void(t.length=1);var s=t.words[9];for(e.words[e.length++]=s&r,n=10;n<t.length;n++){var o=0|t.words[n];t.words[n-10]=(o&r)<<4|s>>>22,s=o}s>>>=22,t.words[n-10]=s,0===s&&t.length>10?t.length-=10:t.length-=9},v.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var e=0,r=0;r<t.length;r++){var i=0|t.words[r];e+=977*i,t.words[r]=67108863&e,e=64*i+(e/67108864|0)}return 0===t.words[t.length-1]&&(t.length--,0===t.words[t.length-1]&&t.length--),t},n(w,y),n(M,y),n(_,y),_.prototype.imulK=function(t){for(var e=0,r=0;r<t.length;r++){var i=19*(0|t.words[r])+e,n=67108863&i;i>>>=26,t.words[r]=n,e=i}return 0!==e&&(t.words[t.length++]=e),t},s._prime=function(t){if(b[t])return b[t];var e;if("k256"===t)e=new v;else if("p224"===t)e=new w;else if("p192"===t)e=new M;else{if("p25519"!==t)throw new Error("Unknown prime "+t);e=new _}return b[t]=e,e},S.prototype._verify1=function(t){i(0===t.negative,"red works only with positives"),i(t.red,"red works only with red numbers")},S.prototype._verify2=function(t,e){i(!(t.negative|e.negative),"red works only with positives"),i(t.red&&t.red===e.red,"red works only with red numbers")},S.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},S.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},S.prototype.add=function(t,e){this._verify2(t,e);var r=t.add(e);return r.cmp(this.m)>=0&&r.isub(this.m),r._forceRed(this)},S.prototype.iadd=function(t,e){this._verify2(t,e);var r=t.iadd(e);return r.cmp(this.m)>=0&&r.isub(this.m),r},S.prototype.sub=function(t,e){this._verify2(t,e);var r=t.sub(e);return r.cmpn(0)<0&&r.iadd(this.m),r._forceRed(this)},S.prototype.isub=function(t,e){this._verify2(t,e);var r=t.isub(e);return r.cmpn(0)<0&&r.iadd(this.m),r},S.prototype.shl=function(t,e){return this._verify1(t),this.imod(t.ushln(e))},S.prototype.imul=function(t,e){return this._verify2(t,e),this.imod(t.imul(e))},S.prototype.mul=function(t,e){return this._verify2(t,e),this.imod(t.mul(e))},S.prototype.isqr=function(t){return this.imul(t,t.clone())},S.prototype.sqr=function(t){return this.mul(t,t)},S.prototype.sqrt=function(t){if(t.isZero())return t.clone();var e=this.m.andln(3);if(i(e%2==1),3===e){var r=this.m.add(new s(1)).iushrn(2);return this.pow(t,r)}for(var n=this.m.subn(1),o=0;!n.isZero()&&0===n.andln(1);)o++,n.iushrn(1);i(!n.isZero());var a=new s(1).toRed(this),h=a.redNeg(),u=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new s(2*c*c).toRed(this);0!==this.pow(c,u).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,n),d=this.pow(t,n.addn(1).iushrn(1)),f=this.pow(t,n),p=o;0!==f.cmp(a);){for(var m=f,g=0;0!==m.cmp(a);g++)m=m.redSqr();i(g<p);var b=this.pow(l,new s(1).iushln(p-g-1));d=d.redMul(b),l=b.redSqr(),f=f.redMul(l),p=g}return d},S.prototype.invm=function(t){var e=t._invmp(this.m);return 0!==e.negative?(e.negative=0,this.imod(e).redNeg()):this.imod(e)},S.prototype.pow=function(t,e){if(e.isZero())return new s(1).toRed(this);if(0===e.cmpn(1))return t.clone();var r=new Array(16);r[0]=new s(1).toRed(this),r[1]=t;for(var i=2;i<r.length;i++)r[i]=this.mul(r[i-1],t);var n=r[0],o=0,a=0,h=e.bitLength()%26;for(0===h&&(h=26),i=e.length-1;i>=0;i--){for(var u=e.words[i],c=h-1;c>=0;c--){var l=u>>c&1;n!==r[0]&&(n=this.sqr(n)),0!==l||0!==o?(o<<=1,o|=l,(4==++a||0===i&&0===c)&&(n=this.mul(n,r[o]),a=0,o=0)):a=0}h=26}return n},S.prototype.convertTo=function(t){var e=t.umod(this.m);return e===t?e.clone():e},S.prototype.convertFrom=function(t){var e=t.clone();return e.red=null,e},s.mont=function(t){return new E(t)},n(E,S),E.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},E.prototype.convertFrom=function(t){var e=this.imod(t.mul(this.rinv));return e.red=null,e},E.prototype.imul=function(t,e){if(t.isZero()||e.isZero())return t.words[0]=0,t.length=1,t;var r=t.imul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),s=n;return n.cmp(this.m)>=0?s=n.isub(this.m):n.cmpn(0)<0&&(s=n.iadd(this.m)),s._forceRed(this)},E.prototype.mul=function(t,e){if(t.isZero()||e.isZero())return new s(0)._forceRed(this);var r=t.mul(e),i=r.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),n=r.isub(i).iushrn(this.shift),o=n;return n.cmp(this.m)>=0?o=n.isub(this.m):n.cmpn(0)<0&&(o=n.iadd(this.m)),o._forceRed(this)},E.prototype.invm=function(t){return this.imod(t._invmp(this.m).mul(this.r2))._forceRed(this)}}(t=r.nmd(t),this)},7362:(t,e,r)=>{var i=r(8170),n=r(8206),s=r(2061),o=r(2509),a=r(7332),h=r(7108),u=r(9247),c=r(2861).Buffer;t.exports=function(t,e,r){var l;l=t.padding?t.padding:r?1:4;var d,f=i(t),p=f.modulus.byteLength();if(e.length>p||new o(e).cmp(f.modulus)>=0)throw new Error("decryption error");d=r?u(new o(e),f):a(e,f);var m=c.alloc(p-d.length);if(d=c.concat([m,d],p),4===l)return function(t,e){var r=t.modulus.byteLength(),i=h("sha1").update(c.alloc(0)).digest(),o=i.length;if(0!==e[0])throw new Error("decryption error");var a=e.slice(1,o+1),u=e.slice(o+1),l=s(a,n(u,o)),d=s(u,n(l,r-o-1));if(function(t,e){t=c.from(t),e=c.from(e);var r=0,i=t.length;t.length!==e.length&&(r++,i=Math.min(t.length,e.length));for(var n=-1;++n<i;)r+=t[n]^e[n];return r}(i,d.slice(0,o)))throw new Error("decryption error");for(var f=o;0===d[f];)f++;if(1!==d[f++])throw new Error("decryption error");return d.slice(f)}(f,d);if(1===l)return function(t,e,r){for(var i=e.slice(0,2),n=2,s=0;0!==e[n++];)if(n>=e.length){s++;break}var o=e.slice(2,n-1);if(("0002"!==i.toString("hex")&&!r||"0001"!==i.toString("hex")&&r)&&s++,o.length<8&&s++,s)throw new Error("decryption error");return e.slice(n)}(0,d,r);if(3===l)return d;throw new Error("unknown padding")}},8902:(t,e,r)=>{var i=r(8170),n=r(3209),s=r(7108),o=r(8206),a=r(2061),h=r(2509),u=r(9247),c=r(7332),l=r(2861).Buffer;t.exports=function(t,e,r){var d;d=t.padding?t.padding:r?1:4;var f,p=i(t);if(4===d)f=function(t,e){var r=t.modulus.byteLength(),i=e.length,u=s("sha1").update(l.alloc(0)).digest(),c=u.length,d=2*c;if(i>r-d-2)throw new Error("message too long");var f=l.alloc(r-i-d-2),p=r-c-1,m=n(c),g=a(l.concat([u,f,l.alloc(1,1),e],p),o(m,p)),b=a(m,o(g,c));return new h(l.concat([l.alloc(1),b,g],r))}(p,e);else if(1===d)f=function(t,e,r){var i,s=e.length,o=t.modulus.byteLength();if(s>o-11)throw new Error("message too long");return i=r?l.alloc(o-s-3,255):function(t){for(var e,r=l.allocUnsafe(t),i=0,s=n(2*t),o=0;i<t;)o===s.length&&(s=n(2*t),o=0),(e=s[o++])&&(r[i++]=e);return r}(o-s-3),new h(l.concat([l.from([0,r?1:2]),i,l.alloc(1),e],o))}(p,e,r);else{if(3!==d)throw new Error("unknown padding");if((f=new h(e)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return r?c(f,p):u(f,p)}},9247:(t,e,r)=>{var i=r(2509),n=r(2861).Buffer;t.exports=function(t,e){return n.from(t.toRed(i.mont(e.modulus)).redPow(new i(e.publicExponent)).fromRed().toArray())}},2061:t=>{t.exports=function(t,e){for(var r=t.length,i=-1;++i<r;)t[i]^=e[i];return t}},3209:(t,e,r)=>{"use strict";var i=r(5606),n=65536,s=r(2861).Buffer,o=r.g.crypto||r.g.msCrypto;o&&o.getRandomValues?t.exports=function(t,e){if(t>4294967295)throw new RangeError("requested too many random bytes");var r=s.allocUnsafe(t);if(t>0)if(t>n)for(var a=0;a<t;a+=n)o.getRandomValues(r.slice(a,a+n));else o.getRandomValues(r);return"function"==typeof e?i.nextTick((function(){e(null,r)})):r}:t.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},6983:(t,e,r)=>{"use strict";var i=r(5606);function n(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var s=r(2861),o=r(3209),a=s.Buffer,h=s.kMaxLength,u=r.g.crypto||r.g.msCrypto,c=Math.pow(2,32)-1;function l(t,e){if("number"!=typeof t||t!=t)throw new TypeError("offset must be a number");if(t>c||t<0)throw new TypeError("offset must be a uint32");if(t>h||t>e)throw new RangeError("offset out of range")}function d(t,e,r){if("number"!=typeof t||t!=t)throw new TypeError("size must be a number");if(t>c||t<0)throw new TypeError("size must be a uint32");if(t+e>r||t>h)throw new RangeError("buffer too small")}function f(t,e,r,n){if(i.browser){var s=t.buffer,a=new Uint8Array(s,e,r);return u.getRandomValues(a),n?void i.nextTick((function(){n(null,t)})):t}if(!n)return o(r).copy(t,e),t;o(r,(function(r,i){if(r)return n(r);i.copy(t,e),n(null,t)}))}u&&u.getRandomValues||!i.browser?(e.randomFill=function(t,e,i,n){if(!(a.isBuffer(t)||t instanceof r.g.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof e)n=e,e=0,i=t.length;else if("function"==typeof i)n=i,i=t.length-e;else if("function"!=typeof n)throw new TypeError('"cb" argument must be a function');return l(e,t.length),d(i,e,t.length),f(t,e,i,n)},e.randomFillSync=function(t,e,i){if(void 0===e&&(e=0),!(a.isBuffer(t)||t instanceof r.g.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return l(e,t.length),void 0===i&&(i=t.length-e),d(i,e,t.length),f(t,e,i)}):(e.randomFill=n,e.randomFillSync=n)},6048:t=>{"use strict";var e={};function r(t,r,i){i||(i=Error);var n=function(t){var e,i;function n(e,i,n){return t.call(this,function(t,e,i){return"string"==typeof r?r:r(t,e,i)}(e,i,n))||this}return i=t,(e=n).prototype=Object.create(i.prototype),e.prototype.constructor=e,e.__proto__=i,n}(i);n.prototype.name=i.name,n.prototype.code=t,e[t]=n}function i(t,e){if(Array.isArray(t)){var r=t.length;return t=t.map((function(t){return String(t)})),r>2?"one of ".concat(e," ").concat(t.slice(0,r-1).join(", "),", or ")+t[r-1]:2===r?"one of ".concat(e," ").concat(t[0]," or ").concat(t[1]):"of ".concat(e," ").concat(t[0])}return"of ".concat(e," ").concat(String(t))}r("ERR_INVALID_OPT_VALUE",(function(t,e){return'The value "'+e+'" is invalid for option "'+t+'"'}),TypeError),r("ERR_INVALID_ARG_TYPE",(function(t,e,r){var n,s,o,a,h;if("string"==typeof e&&(s="not ",e.substr(0,4)===s)?(n="must not be",e=e.replace(/^not /,"")):n="must be",function(t,e,r){return(void 0===r||r>t.length)&&(r=t.length),t.substring(r-9,r)===e}(t," argument"))o="The ".concat(t," ").concat(n," ").concat(i(e,"type"));else{var u=("number"!=typeof h&&(h=0),h+1>(a=t).length||-1===a.indexOf(".",h)?"argument":"property");o='The "'.concat(t,'" ').concat(u," ").concat(n," ").concat(i(e,"type"))}return o+". Received type ".concat(typeof r)}),TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",(function(t){return"The "+t+" method is not implemented"})),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",(function(t){return"Cannot call "+t+" after a stream was destroyed"})),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",(function(t){return"Unknown encoding: "+t}),TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),t.exports.F=e},5382:(t,e,r)=>{"use strict";var i=r(5606),n=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};t.exports=c;var s=r(5412),o=r(6708);r(6698)(c,s);for(var a=n(o.prototype),h=0;h<a.length;h++){var u=a[h];c.prototype[u]||(c.prototype[u]=o.prototype[u])}function c(t){if(!(this instanceof c))return new c(t);s.call(this,t),o.call(this,t),this.allowHalfOpen=!0,t&&(!1===t.readable&&(this.readable=!1),!1===t.writable&&(this.writable=!1),!1===t.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||i.nextTick(d,this)}function d(t){t.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}})},3600:(t,e,r)=>{"use strict";t.exports=n;var i=r(4610);function n(t){if(!(this instanceof n))return new n(t);i.call(this,t)}r(6698)(n,i),n.prototype._transform=function(t,e,r){r(null,t)}},5412:(t,e,r)=>{"use strict";var i,n=r(5606);t.exports=k,k.ReadableState=E,r(7007).EventEmitter;var s,o=function(t,e){return t.listeners(e).length},a=r(345),h=r(8287).Buffer,u=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},c=r(9838);s=c&&c.debuglog?c.debuglog("stream"):function(){};var l,d,f,p=r(2726),m=r(5896),g=r(5291).getHighWaterMark,b=r(6048).F,y=b.ERR_INVALID_ARG_TYPE,v=b.ERR_STREAM_PUSH_AFTER_EOF,w=b.ERR_METHOD_NOT_IMPLEMENTED,M=b.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(6698)(k,a);var _=m.errorOrDestroy,S=["error","close","destroy","pause","resume"];function E(t,e,n){i=i||r(5382),t=t||{},"boolean"!=typeof n&&(n=e instanceof i),this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.highWaterMark=g(this,t,"readableHighWaterMark",n),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(l||(l=r(3141).I),this.decoder=new l(t.encoding),this.encoding=t.encoding)}function k(t){if(i=i||r(5382),!(this instanceof k))return new k(t);var e=this instanceof i;this._readableState=new E(t,this,e),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),a.call(this)}function A(t,e,r,i,n){s("readableAddChunk",e);var o,a=t._readableState;if(null===e)a.reading=!1,function(t,e){if(s("onEofChunk"),!e.ended){if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,e.sync?T(t):(e.needReadable=!1,e.emittedReadable||(e.emittedReadable=!0,P(t)))}}(t,a);else if(n||(o=function(t,e){var r,i;return i=e,h.isBuffer(i)||i instanceof u||"string"==typeof e||void 0===e||t.objectMode||(r=new y("chunk",["string","Buffer","Uint8Array"],e)),r}(a,e)),o)_(t,o);else if(a.objectMode||e&&e.length>0)if("string"==typeof e||a.objectMode||Object.getPrototypeOf(e)===h.prototype||(e=function(t){return h.from(t)}(e)),i)a.endEmitted?_(t,new M):I(t,a,e,!0);else if(a.ended)_(t,new v);else{if(a.destroyed)return!1;a.reading=!1,a.decoder&&!r?(e=a.decoder.write(e),a.objectMode||0!==e.length?I(t,a,e,!1):B(t,a)):I(t,a,e,!1)}else i||(a.reading=!1,B(t,a));return!a.ended&&(a.length<a.highWaterMark||0===a.length)}function I(t,e,r,i){e.flowing&&0===e.length&&!e.sync?(e.awaitDrain=0,t.emit("data",r)):(e.length+=e.objectMode?1:r.length,i?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&T(t)),B(t,e)}Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),k.prototype.destroy=m.destroy,k.prototype._undestroy=m.undestroy,k.prototype._destroy=function(t,e){e(t)},k.prototype.push=function(t,e){var r,i=this._readableState;return i.objectMode?r=!0:"string"==typeof t&&((e=e||i.defaultEncoding)!==i.encoding&&(t=h.from(t,e),e=""),r=!0),A(this,t,e,!1,r)},k.prototype.unshift=function(t){return A(this,t,null,!0,!1)},k.prototype.isPaused=function(){return!1===this._readableState.flowing},k.prototype.setEncoding=function(t){l||(l=r(3141).I);var e=new l(t);this._readableState.decoder=e,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,n="";null!==i;)n+=e.write(i.data),i=i.next;return this._readableState.buffer.clear(),""!==n&&this._readableState.buffer.push(n),this._readableState.length=n.length,this};var x=1073741824;function C(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=x?t=x:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function T(t){var e=t._readableState;s("emitReadable",e.needReadable,e.emittedReadable),e.needReadable=!1,e.emittedReadable||(s("emitReadable",e.flowing),e.emittedReadable=!0,n.nextTick(P,t))}function P(t){var e=t._readableState;s("emitReadable_",e.destroyed,e.length,e.ended),e.destroyed||!e.length&&!e.ended||(t.emit("readable"),e.emittedReadable=!1),e.needReadable=!e.flowing&&!e.ended&&e.length<=e.highWaterMark,O(t)}function B(t,e){e.readingMore||(e.readingMore=!0,n.nextTick(R,t,e))}function R(t,e){for(;!e.reading&&!e.ended&&(e.length<e.highWaterMark||e.flowing&&0===e.length);){var r=e.length;if(s("maybeReadMore read 0"),t.read(0),r===e.length)break}e.readingMore=!1}function D(t){var e=t._readableState;e.readableListening=t.listenerCount("readable")>0,e.resumeScheduled&&!e.paused?e.flowing=!0:t.listenerCount("data")>0&&t.resume()}function N(t){s("readable nexttick read 0"),t.read(0)}function L(t,e){s("resume",e.reading),e.reading||t.read(0),e.resumeScheduled=!1,t.emit("resume"),O(t),e.flowing&&!e.reading&&t.read(0)}function O(t){var e=t._readableState;for(s("flow",e.flowing);e.flowing&&null!==t.read(););}function U(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.first():e.buffer.concat(e.length),e.buffer.clear()):r=e.buffer.consume(t,e.decoder),r);var r}function F(t){var e=t._readableState;s("endReadable",e.endEmitted),e.endEmitted||(e.ended=!0,n.nextTick(j,e,t))}function j(t,e){if(s("endReadableNT",t.endEmitted,t.length),!t.endEmitted&&0===t.length&&(t.endEmitted=!0,e.readable=!1,e.emit("end"),t.autoDestroy)){var r=e._writableState;(!r||r.autoDestroy&&r.finished)&&e.destroy()}}function V(t,e){for(var r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1}k.prototype.read=function(t){s("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&((0!==e.highWaterMark?e.length>=e.highWaterMark:e.length>0)||e.ended))return s("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?F(this):T(this),null;if(0===(t=C(t,e))&&e.ended)return 0===e.length&&F(this),null;var i,n=e.needReadable;return s("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&s("length less than watermark",n=!0),e.ended||e.reading?s("reading or ended",n=!1):n&&(s("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=C(r,e))),null===(i=t>0?U(t,e):null)?(e.needReadable=e.length<=e.highWaterMark,t=0):(e.length-=t,e.awaitDrain=0),0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&F(this)),null!==i&&this.emit("data",i),i},k.prototype._read=function(t){_(this,new w("_read()"))},k.prototype.pipe=function(t,e){var r=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=t;break;case 1:i.pipes=[i.pipes,t];break;default:i.pipes.push(t)}i.pipesCount+=1,s("pipe count=%d opts=%j",i.pipesCount,e);var a=e&&!1===e.end||t===n.stdout||t===n.stderr?m:h;function h(){s("onend"),t.end()}i.endEmitted?n.nextTick(a):r.once("end",a),t.on("unpipe",(function e(n,o){s("onunpipe"),n===r&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,s("cleanup"),t.removeListener("close",f),t.removeListener("finish",p),t.removeListener("drain",u),t.removeListener("error",d),t.removeListener("unpipe",e),r.removeListener("end",h),r.removeListener("end",m),r.removeListener("data",l),c=!0,!i.awaitDrain||t._writableState&&!t._writableState.needDrain||u())}));var u=function(t){return function(){var e=t._readableState;s("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&o(t,"data")&&(e.flowing=!0,O(t))}}(r);t.on("drain",u);var c=!1;function l(e){s("ondata");var n=t.write(e);s("dest.write",n),!1===n&&((1===i.pipesCount&&i.pipes===t||i.pipesCount>1&&-1!==V(i.pipes,t))&&!c&&(s("false write response, pause",i.awaitDrain),i.awaitDrain++),r.pause())}function d(e){s("onerror",e),m(),t.removeListener("error",d),0===o(t,"error")&&_(t,e)}function f(){t.removeListener("finish",p),m()}function p(){s("onfinish"),t.removeListener("close",f),m()}function m(){s("unpipe"),r.unpipe(t)}return r.on("data",l),function(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}(t,"error",d),t.once("close",f),t.once("finish",p),t.emit("pipe",r),i.flowing||(s("pipe resume"),r.resume()),t},k.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var i=e.pipes,n=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<n;s++)i[s].emit("unpipe",this,{hasUnpiped:!1});return this}var o=V(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},k.prototype.on=function(t,e){var r=a.prototype.on.call(this,t,e),i=this._readableState;return"data"===t?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===t&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,s("on readable",i.length,i.reading),i.length?T(this):i.reading||n.nextTick(N,this))),r},k.prototype.addListener=k.prototype.on,k.prototype.removeListener=function(t,e){var r=a.prototype.removeListener.call(this,t,e);return"readable"===t&&n.nextTick(D,this),r},k.prototype.removeAllListeners=function(t){var e=a.prototype.removeAllListeners.apply(this,arguments);return"readable"!==t&&void 0!==t||n.nextTick(D,this),e},k.prototype.resume=function(){var t=this._readableState;return t.flowing||(s("resume"),t.flowing=!t.readableListening,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,n.nextTick(L,t,e))}(this,t)),t.paused=!1,this},k.prototype.pause=function(){return s("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(s("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},k.prototype.wrap=function(t){var e=this,r=this._readableState,i=!1;for(var n in t.on("end",(function(){if(s("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&e.push(t)}e.push(null)})),t.on("data",(function(n){s("wrapped data"),r.decoder&&(n=r.decoder.write(n)),r.objectMode&&null==n||(r.objectMode||n&&n.length)&&(e.push(n)||(i=!0,t.pause()))})),t)void 0===this[n]&&"function"==typeof t[n]&&(this[n]=function(e){return function(){return t[e].apply(t,arguments)}}(n));for(var o=0;o<S.length;o++)t.on(S[o],this.emit.bind(this,S[o]));return this._read=function(e){s("wrapped _read",e),i&&(i=!1,t.resume())},this},"function"==typeof Symbol&&(k.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=r(2955)),d(this)}),Object.defineProperty(k.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(k.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(k.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(t){this._readableState&&(this._readableState.flowing=t)}}),k._fromList=U,Object.defineProperty(k.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(k.from=function(t,e){return void 0===f&&(f=r(5157)),f(k,t,e)})},4610:(t,e,r)=>{"use strict";t.exports=c;var i=r(6048).F,n=i.ERR_METHOD_NOT_IMPLEMENTED,s=i.ERR_MULTIPLE_CALLBACK,o=i.ERR_TRANSFORM_ALREADY_TRANSFORMING,a=i.ERR_TRANSFORM_WITH_LENGTH_0,h=r(5382);function u(t,e){var r=this._transformState;r.transforming=!1;var i=r.writecb;if(null===i)return this.emit("error",new s);r.writechunk=null,r.writecb=null,null!=e&&this.push(e),i(t);var n=this._readableState;n.reading=!1,(n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}function c(t){if(!(this instanceof c))return new c(t);h.call(this,t),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",l)}function l(){var t=this;"function"!=typeof this._flush||this._readableState.destroyed?d(this,null,null):this._flush((function(e,r){d(t,e,r)}))}function d(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new a;if(t._transformState.transforming)throw new o;return t.push(null)}r(6698)(c,h),c.prototype.push=function(t,e){return this._transformState.needTransform=!1,h.prototype.push.call(this,t,e)},c.prototype._transform=function(t,e,r){r(new n("_transform()"))},c.prototype._write=function(t,e,r){var i=this._transformState;if(i.writecb=r,i.writechunk=t,i.writeencoding=e,!i.transforming){var n=this._readableState;(i.needTransform||n.needReadable||n.length<n.highWaterMark)&&this._read(n.highWaterMark)}},c.prototype._read=function(t){var e=this._transformState;null===e.writechunk||e.transforming?e.needTransform=!0:(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform))},c.prototype._destroy=function(t,e){h.prototype._destroy.call(this,t,(function(t){e(t)}))}},6708:(t,e,r)=>{"use strict";var i,n=r(5606);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e){var r=t.entry;for(t.entry=null;r;){var i=r.callback;e.pendingcb--,i(undefined),r=r.next}e.corkedRequestsFree.next=t}(e,t)}}t.exports=k,k.WritableState=E;var o,a={deprecate:r(4643)},h=r(345),u=r(8287).Buffer,c=(void 0!==r.g?r.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).Uint8Array||function(){},l=r(5896),d=r(5291).getHighWaterMark,f=r(6048).F,p=f.ERR_INVALID_ARG_TYPE,m=f.ERR_METHOD_NOT_IMPLEMENTED,g=f.ERR_MULTIPLE_CALLBACK,b=f.ERR_STREAM_CANNOT_PIPE,y=f.ERR_STREAM_DESTROYED,v=f.ERR_STREAM_NULL_VALUES,w=f.ERR_STREAM_WRITE_AFTER_END,M=f.ERR_UNKNOWN_ENCODING,_=l.errorOrDestroy;function S(){}function E(t,e,o){i=i||r(5382),t=t||{},"boolean"!=typeof o&&(o=e instanceof i),this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=d(this,t,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===t.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var r=t._writableState,i=r.sync,s=r.writecb;if("function"!=typeof s)throw new g;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),e)!function(t,e,r,i,s){--e.pendingcb,r?(n.nextTick(s,i),n.nextTick(P,t,e),t._writableState.errorEmitted=!0,_(t,i)):(s(i),t._writableState.errorEmitted=!0,_(t,i),P(t,e))}(t,r,i,e,s);else{var o=C(r)||t.destroyed;o||r.corked||r.bufferProcessing||!r.bufferedRequest||x(t,r),i?n.nextTick(I,t,r,o,s):I(t,r,o,s)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==t.emitClose,this.autoDestroy=!!t.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function k(t){var e=this instanceof(i=i||r(5382));if(!e&&!o.call(k,this))return new k(t);this._writableState=new E(t,this,e),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),h.call(this)}function A(t,e,r,i,n,s,o){e.writelen=i,e.writecb=o,e.writing=!0,e.sync=!0,e.destroyed?e.onwrite(new y("write")):r?t._writev(n,e.onwrite):t._write(n,s,e.onwrite),e.sync=!1}function I(t,e,r,i){r||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,i(),P(t,e)}function x(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var i=e.bufferedRequestCount,n=new Array(i),o=e.corkedRequestsFree;o.entry=r;for(var a=0,h=!0;r;)n[a]=r,r.isBuf||(h=!1),r=r.next,a+=1;n.allBuffers=h,A(t,e,!0,e.length,n,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,l=r.callback;if(A(t,e,!1,e.objectMode?1:u.length,u,c,l),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function C(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function T(t,e){t._final((function(r){e.pendingcb--,r&&_(t,r),e.prefinished=!0,t.emit("prefinish"),P(t,e)}))}function P(t,e){var r=C(e);if(r&&(function(t,e){e.prefinished||e.finalCalled||("function"!=typeof t._final||e.destroyed?(e.prefinished=!0,t.emit("prefinish")):(e.pendingcb++,e.finalCalled=!0,n.nextTick(T,t,e)))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"),e.autoDestroy))){var i=t._readableState;(!i||i.autoDestroy&&i.endEmitted)&&t.destroy()}return r}r(6698)(k,h),E.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(E.prototype,"buffer",{get:a.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(o=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(t){return!!o.call(this,t)||this===k&&t&&t._writableState instanceof E}})):o=function(t){return t instanceof this},k.prototype.pipe=function(){_(this,new b)},k.prototype.write=function(t,e,r){var i,s=this._writableState,o=!1,a=!s.objectMode&&(i=t,u.isBuffer(i)||i instanceof c);return a&&!u.isBuffer(t)&&(t=function(t){return u.from(t)}(t)),"function"==typeof e&&(r=e,e=null),a?e="buffer":e||(e=s.defaultEncoding),"function"!=typeof r&&(r=S),s.ending?function(t,e){var r=new w;_(t,r),n.nextTick(e,r)}(this,r):(a||function(t,e,r,i){var s;return null===r?s=new v:"string"==typeof r||e.objectMode||(s=new p("chunk",["string","Buffer"],r)),!s||(_(t,s),n.nextTick(i,s),!1)}(this,s,t,r))&&(s.pendingcb++,o=function(t,e,r,i,n,s){if(!r){var o=function(t,e,r){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=u.from(e,r)),e}(e,i,n);i!==o&&(r=!0,n="buffer",i=o)}var a=e.objectMode?1:i.length;e.length+=a;var h=e.length<e.highWaterMark;if(h||(e.needDrain=!0),e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:i,encoding:n,isBuf:r,callback:s,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else A(t,e,!1,a,i,n,s);return h}(this,s,a,t,e,r)),o},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.bufferProcessing||!t.bufferedRequest||x(this,t))},k.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new M(t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),k.prototype._write=function(t,e,r){r(new m("_write()"))},k.prototype._writev=null,k.prototype.end=function(t,e,r){var i=this._writableState;return"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||function(t,e,r){e.ending=!0,P(t,e),r&&(e.finished?n.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}(this,i,r),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),k.prototype.destroy=l.destroy,k.prototype._undestroy=l.undestroy,k.prototype._destroy=function(t,e){e(t)}},2955:(t,e,r)=>{"use strict";var i,n=r(5606);function s(t,e,r){return(e=function(t){var e=function(t){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var o=r(6238),a=Symbol("lastResolve"),h=Symbol("lastReject"),u=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function p(t,e){return{value:t,done:e}}function m(t){var e=t[a];if(null!==e){var r=t[f].read();null!==r&&(t[l]=null,t[a]=null,t[h]=null,e(p(r,!1)))}}function g(t){n.nextTick(m,t)}var b=Object.getPrototypeOf((function(){})),y=Object.setPrototypeOf((s(i={get stream(){return this[f]},next:function(){var t=this,e=this[u];if(null!==e)return Promise.reject(e);if(this[c])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(e,r){n.nextTick((function(){t[u]?r(t[u]):e(p(void 0,!0))}))}));var r,i=this[l];if(i)r=new Promise(function(t,e){return function(r,i){t.then((function(){e[c]?r(p(void 0,!0)):e[d](r,i)}),i)}}(i,this));else{var s=this[f].read();if(null!==s)return Promise.resolve(p(s,!1));r=new Promise(this[d])}return this[l]=r,r}},Symbol.asyncIterator,(function(){return this})),s(i,"return",(function(){var t=this;return new Promise((function(e,r){t[f].destroy(null,(function(t){t?r(t):e(p(void 0,!0))}))}))})),i),b);t.exports=function(t){var e,r=Object.create(y,(s(e={},f,{value:t,writable:!0}),s(e,a,{value:null,writable:!0}),s(e,h,{value:null,writable:!0}),s(e,u,{value:null,writable:!0}),s(e,c,{value:t._readableState.endEmitted,writable:!0}),s(e,d,{value:function(t,e){var i=r[f].read();i?(r[l]=null,r[a]=null,r[h]=null,t(p(i,!1))):(r[a]=t,r[h]=e)},writable:!0}),e));return r[l]=null,o(t,(function(t){if(t&&"ERR_STREAM_PREMATURE_CLOSE"!==t.code){var e=r[h];return null!==e&&(r[l]=null,r[a]=null,r[h]=null,e(t)),void(r[u]=t)}var i=r[a];null!==i&&(r[l]=null,r[a]=null,r[h]=null,i(p(void 0,!0))),r[c]=!0})),t.on("readable",g.bind(null,r)),r}},2726:(t,e,r)=>{"use strict";function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function n(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(Object(r),!0).forEach((function(e){s(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(t,e,r){return(e=a(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,a(i.key),i)}}function a(t){var e=function(t){if("object"!=typeof t||null===t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}var h=r(8287).Buffer,u=r(5340).inspect,c=u&&u.custom||"inspect";t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.head=null,this.tail=null,this.length=0}var e,r;return e=t,(r=[{key:"push",value:function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length}},{key:"unshift",value:function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length}},{key:"shift",value:function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r}},{key:"concat",value:function(t){if(0===this.length)return h.alloc(0);for(var e,r,i,n=h.allocUnsafe(t>>>0),s=this.head,o=0;s;)e=s.data,r=n,i=o,h.prototype.copy.call(e,r,i),o+=s.data.length,s=s.next;return n}},{key:"consume",value:function(t,e){var r;return t<this.head.data.length?(r=this.head.data.slice(0,t),this.head.data=this.head.data.slice(t)):r=t===this.head.data.length?this.shift():e?this._getString(t):this._getBuffer(t),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(t){var e=this.head,r=1,i=e.data;for(t-=i.length;e=e.next;){var n=e.data,s=t>n.length?n.length:t;if(s===n.length?i+=n:i+=n.slice(0,t),0==(t-=s)){s===n.length?(++r,e.next?this.head=e.next:this.head=this.tail=null):(this.head=e,e.data=n.slice(s));break}++r}return this.length-=r,i}},{key:"_getBuffer",value:function(t){var e=h.allocUnsafe(t),r=this.head,i=1;for(r.data.copy(e),t-=r.data.length;r=r.next;){var n=r.data,s=t>n.length?n.length:t;if(n.copy(e,e.length-t,0,s),0==(t-=s)){s===n.length?(++i,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=n.slice(s));break}++i}return this.length-=i,e}},{key:c,value:function(t,e){return u(this,n(n({},e),{},{depth:0,customInspect:!1}))}}])&&o(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}()},5896:(t,e,r)=>{"use strict";var i=r(5606);function n(t,e){o(t,e),s(t)}function s(t){t._writableState&&!t._writableState.emitClose||t._readableState&&!t._readableState.emitClose||t.emit("close")}function o(t,e){t.emit("error",e)}t.exports={destroy:function(t,e){var r=this,a=this._readableState&&this._readableState.destroyed,h=this._writableState&&this._writableState.destroyed;return a||h?(e?e(t):t&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,i.nextTick(o,this,t)):i.nextTick(o,this,t)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!e&&t?r._writableState?r._writableState.errorEmitted?i.nextTick(s,r):(r._writableState.errorEmitted=!0,i.nextTick(n,r,t)):i.nextTick(n,r,t):e?(i.nextTick(s,r),e(t)):i.nextTick(s,r)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(t,e){var r=t._readableState,i=t._writableState;r&&r.autoDestroy||i&&i.autoDestroy?t.destroy(e):t.emit("error",e)}}},6238:(t,e,r)=>{"use strict";var i=r(6048).F.ERR_STREAM_PREMATURE_CLOSE;function n(){}t.exports=function t(e,r,s){if("function"==typeof r)return t(e,null,r);r||(r={}),s=function(t){var e=!1;return function(){if(!e){e=!0;for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];t.apply(this,i)}}}(s||n);var o=r.readable||!1!==r.readable&&e.readable,a=r.writable||!1!==r.writable&&e.writable,h=function(){e.writable||c()},u=e._writableState&&e._writableState.finished,c=function(){a=!1,u=!0,o||s.call(e)},l=e._readableState&&e._readableState.endEmitted,d=function(){o=!1,l=!0,a||s.call(e)},f=function(t){s.call(e,t)},p=function(){var t;return o&&!l?(e._readableState&&e._readableState.ended||(t=new i),s.call(e,t)):a&&!u?(e._writableState&&e._writableState.ended||(t=new i),s.call(e,t)):void 0},m=function(){e.req.on("finish",c)};return function(t){return t.setHeader&&"function"==typeof t.abort}(e)?(e.on("complete",c),e.on("abort",p),e.req?m():e.on("request",m)):a&&!e._writableState&&(e.on("end",h),e.on("close",h)),e.on("end",d),e.on("finish",c),!1!==r.error&&e.on("error",f),e.on("close",p),function(){e.removeListener("complete",c),e.removeListener("abort",p),e.removeListener("request",m),e.req&&e.req.removeListener("finish",c),e.removeListener("end",h),e.removeListener("close",h),e.removeListener("finish",c),e.removeListener("end",d),e.removeListener("error",f),e.removeListener("close",p)}}},5157:t=>{t.exports=function(){throw new Error("Readable.from is not available in the browser")}},7758:(t,e,r)=>{"use strict";var i,n=r(6048).F,s=n.ERR_MISSING_ARGS,o=n.ERR_STREAM_DESTROYED;function a(t){if(t)throw t}function h(t){t()}function u(t,e){return t.pipe(e)}t.exports=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var c,l=function(t){return t.length?"function"!=typeof t[t.length-1]?a:t.pop():a}(e);if(Array.isArray(e[0])&&(e=e[0]),e.length<2)throw new s("streams");var d=e.map((function(t,n){var s=n<e.length-1;return function(t,e,n,s){s=function(t){var e=!1;return function(){e||(e=!0,t.apply(void 0,arguments))}}(s);var a=!1;t.on("close",(function(){a=!0})),void 0===i&&(i=r(6238)),i(t,{readable:e,writable:n},(function(t){if(t)return s(t);a=!0,s()}));var h=!1;return function(e){if(!a&&!h)return h=!0,function(t){return t.setHeader&&"function"==typeof t.abort}(t)?t.abort():"function"==typeof t.destroy?t.destroy():void s(e||new o("pipe"))}}(t,s,n>0,(function(t){c||(c=t),t&&d.forEach(h),s||(d.forEach(h),l(c))}))}));return e.reduce(u)}},5291:(t,e,r)=>{"use strict";var i=r(6048).F.ERR_INVALID_OPT_VALUE;t.exports={getHighWaterMark:function(t,e,r,n){var s=function(t,e,r){return null!=t.highWaterMark?t.highWaterMark:e?t[r]:null}(e,n,r);if(null!=s){if(!isFinite(s)||Math.floor(s)!==s||s<0)throw new i(n?r:"highWaterMark",s);return Math.floor(s)}return t.objectMode?16:16384}}},345:(t,e,r)=>{t.exports=r(7007).EventEmitter},6011:(t,e,r)=>{"use strict";var i=r(8287).Buffer,n=r(6698),s=r(4729),o=new Array(16),a=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],h=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],u=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],c=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],l=[0,1518500249,1859775393,2400959708,2840853838],d=[1352829926,1548603684,1836072691,2053994217,0];function f(){s.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(t,e){return t<<e|t>>>32-e}function m(t,e,r,i,n,s,o,a){return p(t+(e^r^i)+s+o|0,a)+n|0}function g(t,e,r,i,n,s,o,a){return p(t+(e&r|~e&i)+s+o|0,a)+n|0}function b(t,e,r,i,n,s,o,a){return p(t+((e|~r)^i)+s+o|0,a)+n|0}function y(t,e,r,i,n,s,o,a){return p(t+(e&i|r&~i)+s+o|0,a)+n|0}function v(t,e,r,i,n,s,o,a){return p(t+(e^(r|~i))+s+o|0,a)+n|0}n(f,s),f.prototype._update=function(){for(var t=o,e=0;e<16;++e)t[e]=this._block.readInt32LE(4*e);for(var r=0|this._a,i=0|this._b,n=0|this._c,s=0|this._d,f=0|this._e,w=0|this._a,M=0|this._b,_=0|this._c,S=0|this._d,E=0|this._e,k=0;k<80;k+=1){var A,I;k<16?(A=m(r,i,n,s,f,t[a[k]],l[0],u[k]),I=v(w,M,_,S,E,t[h[k]],d[0],c[k])):k<32?(A=g(r,i,n,s,f,t[a[k]],l[1],u[k]),I=y(w,M,_,S,E,t[h[k]],d[1],c[k])):k<48?(A=b(r,i,n,s,f,t[a[k]],l[2],u[k]),I=b(w,M,_,S,E,t[h[k]],d[2],c[k])):k<64?(A=y(r,i,n,s,f,t[a[k]],l[3],u[k]),I=g(w,M,_,S,E,t[h[k]],d[3],c[k])):(A=v(r,i,n,s,f,t[a[k]],l[4],u[k]),I=m(w,M,_,S,E,t[h[k]],d[4],c[k])),r=f,f=s,s=p(n,10),n=i,i=A,w=E,E=S,S=p(_,10),_=M,M=I}var x=this._b+n+S|0;this._b=this._c+s+E|0,this._c=this._d+f+w|0,this._d=this._e+r+M|0,this._e=this._a+i+_|0,this._a=x},f.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var t=i.alloc?i.alloc(20):new i(20);return t.writeInt32LE(this._a,0),t.writeInt32LE(this._b,4),t.writeInt32LE(this._c,8),t.writeInt32LE(this._d,12),t.writeInt32LE(this._e,16),t},t.exports=f},2861:(t,e,r)=>{var i=r(8287),n=i.Buffer;function s(t,e){for(var r in t)e[r]=t[r]}function o(t,e,r){return n(t,e,r)}n.from&&n.alloc&&n.allocUnsafe&&n.allocUnsafeSlow?t.exports=i:(s(i,e),e.Buffer=o),o.prototype=Object.create(n.prototype),s(n,o),o.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return n(t,e,r)},o.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var i=n(t);return void 0!==e?"string"==typeof r?i.fill(e,r):i.fill(e):i.fill(0),i},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i.SlowBuffer(t)}},392:(t,e,r)=>{var i=r(2861).Buffer;function n(t,e){this._block=i.alloc(t),this._finalSize=e,this._blockSize=t,this._len=0}n.prototype.update=function(t,e){"string"==typeof t&&(e=e||"utf8",t=i.from(t,e));for(var r=this._block,n=this._blockSize,s=t.length,o=this._len,a=0;a<s;){for(var h=o%n,u=Math.min(s-a,n-h),c=0;c<u;c++)r[h+c]=t[a+c];a+=u,(o+=u)%n==0&&this._update(r)}return this._len+=s,this},n.prototype.digest=function(t){var e=this._len%this._blockSize;this._block[e]=128,this._block.fill(0,e+1),e>=this._finalSize&&(this._update(this._block),this._block.fill(0));var r=8*this._len;if(r<=4294967295)this._block.writeUInt32BE(r,this._blockSize-4);else{var i=(4294967295&r)>>>0,n=(r-i)/4294967296;this._block.writeUInt32BE(n,this._blockSize-8),this._block.writeUInt32BE(i,this._blockSize-4)}this._update(this._block);var s=this._hash();return t?s.toString(t):s},n.prototype._update=function(){throw new Error("_update must be implemented by subclass")},t.exports=n},2802:(t,e,r)=>{var i=t.exports=function(t){t=t.toLowerCase();var e=i[t];if(!e)throw new Error(t+" is not supported (we accept pull requests)");return new e};i.sha=r(7816),i.sha1=r(3737),i.sha224=r(6710),i.sha256=r(4107),i.sha384=r(2827),i.sha512=r(2890)},7816:(t,e,r)=>{var i=r(6698),n=r(392),s=r(2861).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function h(){this.init(),this._w=a,n.call(this,64,56)}function u(t){return t<<30|t>>>2}function c(t,e,r,i){return 0===t?e&r|~e&i:2===t?e&r|e&i|r&i:e^r^i}i(h,n),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(t){for(var e,r=this._w,i=0|this._a,n=0|this._b,s=0|this._c,a=0|this._d,h=0|this._e,l=0;l<16;++l)r[l]=t.readInt32BE(4*l);for(;l<80;++l)r[l]=r[l-3]^r[l-8]^r[l-14]^r[l-16];for(var d=0;d<80;++d){var f=~~(d/20),p=0|((e=i)<<5|e>>>27)+c(f,n,s,a)+h+r[d]+o[f];h=a,a=s,s=u(n),n=i,i=p}this._a=i+this._a|0,this._b=n+this._b|0,this._c=s+this._c|0,this._d=a+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var t=s.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t},t.exports=h},3737:(t,e,r)=>{var i=r(6698),n=r(392),s=r(2861).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],a=new Array(80);function h(){this.init(),this._w=a,n.call(this,64,56)}function u(t){return t<<5|t>>>27}function c(t){return t<<30|t>>>2}function l(t,e,r,i){return 0===t?e&r|~e&i:2===t?e&r|e&i|r&i:e^r^i}i(h,n),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(t){for(var e,r=this._w,i=0|this._a,n=0|this._b,s=0|this._c,a=0|this._d,h=0|this._e,d=0;d<16;++d)r[d]=t.readInt32BE(4*d);for(;d<80;++d)r[d]=(e=r[d-3]^r[d-8]^r[d-14]^r[d-16])<<1|e>>>31;for(var f=0;f<80;++f){var p=~~(f/20),m=u(i)+l(p,n,s,a)+h+r[f]+o[p]|0;h=a,a=s,s=c(n),n=i,i=m}this._a=i+this._a|0,this._b=n+this._b|0,this._c=s+this._c|0,this._d=a+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var t=s.allocUnsafe(20);return t.writeInt32BE(0|this._a,0),t.writeInt32BE(0|this._b,4),t.writeInt32BE(0|this._c,8),t.writeInt32BE(0|this._d,12),t.writeInt32BE(0|this._e,16),t},t.exports=h},6710:(t,e,r)=>{var i=r(6698),n=r(4107),s=r(392),o=r(2861).Buffer,a=new Array(64);function h(){this.init(),this._w=a,s.call(this,64,56)}i(h,n),h.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},h.prototype._hash=function(){var t=o.allocUnsafe(28);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t},t.exports=h},4107:(t,e,r)=>{var i=r(6698),n=r(392),s=r(2861).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=new Array(64);function h(){this.init(),this._w=a,n.call(this,64,56)}function u(t,e,r){return r^t&(e^r)}function c(t,e,r){return t&e|r&(t|e)}function l(t){return(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10)}function d(t){return(t>>>6|t<<26)^(t>>>11|t<<21)^(t>>>25|t<<7)}function f(t){return(t>>>7|t<<25)^(t>>>18|t<<14)^t>>>3}i(h,n),h.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},h.prototype._update=function(t){for(var e,r=this._w,i=0|this._a,n=0|this._b,s=0|this._c,a=0|this._d,h=0|this._e,p=0|this._f,m=0|this._g,g=0|this._h,b=0;b<16;++b)r[b]=t.readInt32BE(4*b);for(;b<64;++b)r[b]=0|(((e=r[b-2])>>>17|e<<15)^(e>>>19|e<<13)^e>>>10)+r[b-7]+f(r[b-15])+r[b-16];for(var y=0;y<64;++y){var v=g+d(h)+u(h,p,m)+o[y]+r[y]|0,w=l(i)+c(i,n,s)|0;g=m,m=p,p=h,h=a+v|0,a=s,s=n,n=i,i=v+w|0}this._a=i+this._a|0,this._b=n+this._b|0,this._c=s+this._c|0,this._d=a+this._d|0,this._e=h+this._e|0,this._f=p+this._f|0,this._g=m+this._g|0,this._h=g+this._h|0},h.prototype._hash=function(){var t=s.allocUnsafe(32);return t.writeInt32BE(this._a,0),t.writeInt32BE(this._b,4),t.writeInt32BE(this._c,8),t.writeInt32BE(this._d,12),t.writeInt32BE(this._e,16),t.writeInt32BE(this._f,20),t.writeInt32BE(this._g,24),t.writeInt32BE(this._h,28),t},t.exports=h},2827:(t,e,r)=>{var i=r(6698),n=r(2890),s=r(392),o=r(2861).Buffer,a=new Array(160);function h(){this.init(),this._w=a,s.call(this,128,112)}i(h,n),h.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},h.prototype._hash=function(){var t=o.allocUnsafe(48);function e(e,r,i){t.writeInt32BE(e,i),t.writeInt32BE(r,i+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),t},t.exports=h},2890:(t,e,r)=>{var i=r(6698),n=r(392),s=r(2861).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],a=new Array(160);function h(){this.init(),this._w=a,n.call(this,128,112)}function u(t,e,r){return r^t&(e^r)}function c(t,e,r){return t&e|r&(t|e)}function l(t,e){return(t>>>28|e<<4)^(e>>>2|t<<30)^(e>>>7|t<<25)}function d(t,e){return(t>>>14|e<<18)^(t>>>18|e<<14)^(e>>>9|t<<23)}function f(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^t>>>7}function p(t,e){return(t>>>1|e<<31)^(t>>>8|e<<24)^(t>>>7|e<<25)}function m(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^t>>>6}function g(t,e){return(t>>>19|e<<13)^(e>>>29|t<<3)^(t>>>6|e<<26)}function b(t,e){return t>>>0<e>>>0?1:0}i(h,n),h.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},h.prototype._update=function(t){for(var e=this._w,r=0|this._ah,i=0|this._bh,n=0|this._ch,s=0|this._dh,a=0|this._eh,h=0|this._fh,y=0|this._gh,v=0|this._hh,w=0|this._al,M=0|this._bl,_=0|this._cl,S=0|this._dl,E=0|this._el,k=0|this._fl,A=0|this._gl,I=0|this._hl,x=0;x<32;x+=2)e[x]=t.readInt32BE(4*x),e[x+1]=t.readInt32BE(4*x+4);for(;x<160;x+=2){var C=e[x-30],T=e[x-30+1],P=f(C,T),B=p(T,C),R=m(C=e[x-4],T=e[x-4+1]),D=g(T,C),N=e[x-14],L=e[x-14+1],O=e[x-32],U=e[x-32+1],F=B+L|0,j=P+N+b(F,B)|0;j=(j=j+R+b(F=F+D|0,D)|0)+O+b(F=F+U|0,U)|0,e[x]=j,e[x+1]=F}for(var V=0;V<160;V+=2){j=e[V],F=e[V+1];var q=c(r,i,n),z=c(w,M,_),H=l(r,w),$=l(w,r),W=d(a,E),K=d(E,a),G=o[V],Z=o[V+1],Y=u(a,h,y),J=u(E,k,A),X=I+K|0,Q=v+W+b(X,I)|0;Q=(Q=(Q=Q+Y+b(X=X+J|0,J)|0)+G+b(X=X+Z|0,Z)|0)+j+b(X=X+F|0,F)|0;var tt=$+z|0,et=H+q+b(tt,$)|0;v=y,I=A,y=h,A=k,h=a,k=E,a=s+Q+b(E=S+X|0,S)|0,s=n,S=_,n=i,_=M,i=r,M=w,r=Q+et+b(w=X+tt|0,X)|0}this._al=this._al+w|0,this._bl=this._bl+M|0,this._cl=this._cl+_|0,this._dl=this._dl+S|0,this._el=this._el+E|0,this._fl=this._fl+k|0,this._gl=this._gl+A|0,this._hl=this._hl+I|0,this._ah=this._ah+r+b(this._al,w)|0,this._bh=this._bh+i+b(this._bl,M)|0,this._ch=this._ch+n+b(this._cl,_)|0,this._dh=this._dh+s+b(this._dl,S)|0,this._eh=this._eh+a+b(this._el,E)|0,this._fh=this._fh+h+b(this._fl,k)|0,this._gh=this._gh+y+b(this._gl,A)|0,this._hh=this._hh+v+b(this._hl,I)|0},h.prototype._hash=function(){var t=s.allocUnsafe(64);function e(e,r,i){t.writeInt32BE(e,i),t.writeInt32BE(r,i+4)}return e(this._ah,this._al,0),e(this._bh,this._bl,8),e(this._ch,this._cl,16),e(this._dh,this._dl,24),e(this._eh,this._el,32),e(this._fh,this._fl,40),e(this._gh,this._gl,48),e(this._hh,this._hl,56),t},t.exports=h},8310:(t,e,r)=>{t.exports=n;var i=r(7007).EventEmitter;function n(){i.call(this)}r(6698)(n,i),n.Readable=r(5412),n.Writable=r(6708),n.Duplex=r(5382),n.Transform=r(4610),n.PassThrough=r(3600),n.finished=r(6238),n.pipeline=r(7758),n.Stream=n,n.prototype.pipe=function(t,e){var r=this;function n(e){t.writable&&!1===t.write(e)&&r.pause&&r.pause()}function s(){r.readable&&r.resume&&r.resume()}r.on("data",n),t.on("drain",s),t._isStdio||e&&!1===e.end||(r.on("end",a),r.on("close",h));var o=!1;function a(){o||(o=!0,t.end())}function h(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function u(t){if(c(),0===i.listenerCount(this,"error"))throw t}function c(){r.removeListener("data",n),t.removeListener("drain",s),r.removeListener("end",a),r.removeListener("close",h),r.removeListener("error",u),t.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),t.removeListener("close",c)}return r.on("error",u),t.on("error",u),r.on("end",c),r.on("close",c),t.on("close",c),t.emit("pipe",r),t}},3141:(t,e,r)=>{"use strict";var i=r(2861).Buffer,n=i.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(i.isEncoding===n||!n(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=h,this.end=u,e=4;break;case"utf8":this.fillLast=a,e=4;break;case"base64":this.text=c,this.end=l,e=3;break;default:return this.write=d,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,r=function(t,e){if(128!=(192&e[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,""}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function h(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var i=r.charCodeAt(r.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function u(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function c(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function l(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function d(t){return t.toString(this.encoding)}function f(t){return t&&t.length?this.write(t):""}e.I=s,s.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},s.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"":e},s.prototype.text=function(t,e){var r=function(t,e,r){var i=e.length-1;if(i<r)return 0;var n=o(e[i]);return n>=0?(n>0&&(t.lastNeed=n-1),n):--i<r||-2===n?0:(n=o(e[i]))>=0?(n>0&&(t.lastNeed=n-2),n):--i<r||-2===n?0:(n=o(e[i]))>=0?(n>0&&(2===n?n=0:t.lastNeed=n-3),n):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var i=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString("utf8",e,i)},s.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},1481:function(t,e,r){"use strict";var i=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{h(i.next(t))}catch(t){s(t)}}function a(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=r(4868),s=r(6436),o=r(8669),a=new Map,h=new n.CursorManager,u=new Map,c=new Map;let l=!1;function d(t){const e=c.get(t);if(!e)return null;const r=u.get(e);if(!r)return null;const i=r.drpObjects.get(t);return{peerId:r.node.networkNode.peerId,peers:r.node.networkNode.getAllPeers(),discoveryPeers:r.node.networkNode.getGroupPeers("drp::discovery"),drpId:i?i.id:null}}function f(t){const e=d(t);e&&function(t,e){chrome.runtime.sendMessage({type:"BROADCAST",message:t,tabId:e})}({type:"STATE_UPDATE",state:e},t)}function p(t,e,r){return i(this,void 0,void 0,(function*(){const i=u.get(t);if(!i)throw new Error("Node not found");const n=yield i.node.createObject(new o.CursorDRP,e);return i.drpObjects.set(r,n),i.node.objectStore.subscribe(n.id,((t,e)=>{const r=e.drp,n=r.getUsers();for(const t of n)if(t!==i.node.networkNode.peerId){const e=r.getCursorPosition(t);e&&l&&t!==i.node.networkNode.peerId&&(h.hasCursor(t)||h.createCursor(t),h.updateCursor(t,[e.x,e.y]))}})),yield f(r),n}))}function m(){for(const[t,e]of h.cursors)e.element.remove(),e.perfectCursor.dispose();h.cursors.clear()}chrome.runtime.onMessage.addListener(((t,e,r)=>i(void 0,void 0,void 0,(function*(){const{type:e,tabId:n}=t;if(!n)return console.error("No tabId",t),void r({error:!0,message:"No tabId"});switch(e){case"GET_STATE":return chrome.runtime.sendMessage({type:"GET_NODE_STATE"},r),!0;case"GO_LIVE":{l=!0;const t=`cursor-presence-${window.location.host}`,e=c.get(n);try{const i=yield p(e,t,n);r(i)}catch(t){r({error:t.message})}!function(t){const e=function(t){let e=0;return r=>{if(!l)return;if(!c.has(t))return;const i=u.get(c.get(t)),n=i.drpObjects.get(t);if(!n)return;const s=Date.now();s-e>50&&(e=s,n.drp.updateCursor(i.node.networkNode.peerId,{x:r.clientX,y:r.clientY}))}}(t);document.addEventListener("mousemove",e),a.set(t,e)}(n),r({isLive:!0});break}case"LEAVE_ROOM":{l=!1,chrome.runtime.sendMessage({type:"LEAVE_DRP_OBJECT"}),m();const t=a.get(n);t&&(document.removeEventListener("mousemove",t),a.delete(n));break}case"CURSOR_UPDATE":l&&t.userId!==t.currentPeerId&&(h.hasCursor(t.userId)||h.createCursor(t.userId),h.updateCursor(t.userId,[t.position.x,t.position.y]));break;case"PEER_LEFT":h.hasCursor(t.peerId)&&function(t){if(h.hasCursor(t)){const e=h.cursors.get(t);e&&(e.element.remove(),e.perfectCursor.dispose(),h.cursors.delete(t))}}(t.peerId);break;case"SELECT_NODE":c.set(n,t.nodeId),f(n),r({success:!0});break;case"GET_NODES":r({nodes:Array.from(u.keys()),activeNodeId:c.get(n)});break;case"GET_NODE_STATE":r(d(n));break;case"CREATE_DRP_OBJECT":{const e=c.get(n);if(!e)return void r({error:"No active node"});try{const i=yield p(e,t.drpId,n);r(i)}catch(t){r({error:t.message})}break}case"URL_CHANGED":if(l&&(m(),t.autoJoin)){const e=`cursor-presence-${new URL(t.url).host}`;try{const t=c.get(n),i=yield p(t,e,n);r(i)}catch(t){r({error:t.message})}}break;case"LEAVE_DRP_OBJECT":{if(!c.has(n))return void r({error:"No active node"});const t=u.get(c.get(n)),e=t.drpObjects.get(n);e&&(t.node.objectStore.unsubscribe(e.id),t.drpObjects.delete(n),f(n)),r({success:!0});break}case"CREATE_NODE":try{const t=yield function(t){return i(this,void 0,void 0,(function*(){const e=new s.DRPNode;yield e.start();const r=e.networkNode.peerId;return console.log("createNode",r),e.addCustomGroupMessageHandler("",(()=>{f(t)})),u.set(r,{node:e,drpObjects:new Map}),r}))}(n);c.set(n,t),r({nodeId:t})}catch(t){r({error:t.message})}return!0}}))))},8669:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CursorDRP=void 0,e.createCursorDRP=function(){return new n};const i=r(1132);class n{constructor(){this.operations=["updateCursor"],this.semanticsType=i.SemanticsType.pair,this.positions=new Map}updateCursor(t,e){this._updateCursor(t,e)}_updateCursor(t,e){this.positions.set(t,e)}getCursorPosition(t){return this.positions.get(t)}getUsers(){return[...this.positions.keys()]}resolveConflicts(t){return{action:i.ActionType.Nop}}}e.CursorDRP=n},4868:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CursorManager=void 0;const i=r(6645),n=r(5433);e.CursorManager=class{constructor(){this.cursors=new Map}hasCursor(t){return this.cursors.has(t)}createCursor(t){const e=document.createElement("div");e.className="cursor";const r=document.createElement("img");r.src=(0,n.getEmojiForNodeId)(t),r.style.width="32px",r.style.height="32px",r.style.position="absolute",r.style.transform="translate(-50%, -50%)",r.style.pointerEvents="none",r.style.borderRadius="50%",e.appendChild(r);const s=document.createElement("span");s.textContent=t.slice(-4),s.style.position="absolute",s.style.top="100%",s.style.transform="translateX(-50%) translateY(100%)",s.style.backgroundColor="rgba(0, 0, 0, 0.7)",s.style.color="white",s.style.padding="2px 4px",s.style.borderRadius="4px",s.style.fontSize="12px",e.appendChild(s),document.body.prepend(e);const o=new i.PerfectCursor((t=>{e.style.transform=`translate(${t[0]}px, ${t[1]}px)`}));this.cursors.set(t,{element:e,perfectCursor:o})}updateCursor(t,e){const r=this.cursors.get(t);r&&r.perfectCursor.addPoint(e)}removeCursor(t){const e=this.cursors.get(t);e&&(e.perfectCursor.dispose(),e.element.remove(),this.cursors.delete(t))}dispose(){for(const[t,e]of this.cursors)e.perfectCursor.dispose(),e.element.remove();this.cursors.clear()}}},5433:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getEmojiForNodeId=function(t){const e=t.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0)%r+1;return chrome.runtime.getURL(`src/images/${e}.gif`)};const r=500},4643:(t,e,r)=>{function i(t){try{if(!r.g.localStorage)return!1}catch(t){return!1}var e=r.g.localStorage[t];return null!=e&&"true"===String(e).toLowerCase()}t.exports=function(t,e){if(i("noDeprecation"))return t;var r=!1;return function(){if(!r){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}},8961:(__unused_webpack_module,exports)=>{var indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0;r<t.length;r++)if(t[r]===e)return r;return-1},Object_keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var r in t)e.push(r);return e},forEach=function(t,e){if(t.forEach)return t.forEach(e);for(var r=0;r<t.length;r++)e(t[r],r,t)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(t,e,r){Object.defineProperty(t,e,{writable:!0,enumerable:!1,configurable:!0,value:r})}}catch(t){return function(t,e,r){t[e]=r}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(t){if(!(this instanceof Script))return new Script(t);this.code=t};Script.prototype.runInContext=function(t){if(!(t instanceof Context))throw new TypeError("needs a 'context' argument.");var e=document.createElement("iframe");e.style||(e.style={}),e.style.display="none",document.body.appendChild(e);var r=e.contentWindow,i=r.eval,n=r.execScript;!i&&n&&(n.call(r,"null"),i=r.eval),forEach(Object_keys(t),(function(e){r[e]=t[e]})),forEach(globals,(function(e){t[e]&&(r[e]=t[e])}));var s=Object_keys(r),o=i.call(r,this.code);return forEach(Object_keys(r),(function(e){(e in t||-1===indexOf(s,e))&&(t[e]=r[e])})),forEach(globals,(function(e){e in t||defineProp(t,e,r[e])})),document.body.removeChild(e),o},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(t){var e=Script.createContext(t),r=this.runInContext(e);return t&&forEach(Object_keys(e),(function(r){t[r]=e[r]})),r},forEach(Object_keys(Script.prototype),(function(t){exports[t]=Script[t]=function(e){var r=Script(e);return r[t].apply(r,[].slice.call(arguments,1))}})),exports.isContext=function(t){return t instanceof Context},exports.createScript=function(t){return exports.Script(t)},exports.createContext=Script.createContext=function(t){var e=new Context;return"object"==typeof t&&forEach(Object_keys(t),(function(r){e[r]=t[r]})),e}},9095:(t,e)=>{"use strict";e.byteLength=function(t){var e=a(t),r=e[0],i=e[1];return 3*(r+i)/4-i},e.toByteArray=function(t){var e,r,s=a(t),o=s[0],h=s[1],u=new n(function(t,e,r){return 3*(e+r)/4-r}(0,o,h)),c=0,l=h>0?o-4:o;for(r=0;r<l;r+=4)e=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],u[c++]=e>>16&255,u[c++]=e>>8&255,u[c++]=255&e;return 2===h&&(e=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,u[c++]=255&e),1===h&&(e=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,u[c++]=e>>8&255,u[c++]=255&e),u},e.fromByteArray=function(t){for(var e,i=t.length,n=i%3,s=[],o=16383,a=0,u=i-n;a<u;a+=o)s.push(h(t,a,a+o>u?u:a+o));return 1===n?(e=t[i-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===n&&(e=(t[i-2]<<8)+t[i-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")};for(var r=[],i=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)r[o]=s[o],i[s.charCodeAt(o)]=o;function a(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t,e,i){for(var n,s,o=[],a=e;a<i;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),o.push(r[(s=n)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},2801:(t,e,r)=>{t.exports={RBTree:r(9101),BinTree:r(5096)}},5096:(t,e,r)=>{var i=r(8704);function n(t){this.data=t,this.left=null,this.right=null}function s(t){this._root=null,this._comparator=t,this.size=0}n.prototype.get_child=function(t){return t?this.right:this.left},n.prototype.set_child=function(t,e){t?this.right=e:this.left=e},s.prototype=new i,s.prototype.insert=function(t){if(null===this._root)return this._root=new n(t),this.size++,!0;for(var e=0,r=null,i=this._root;;){if(null===i)return i=new n(t),r.set_child(e,i),ret=!0,this.size++,!0;if(0===this._comparator(i.data,t))return!1;e=this._comparator(i.data,t)<0,r=i,i=i.get_child(e)}},s.prototype.remove=function(t){if(null===this._root)return!1;var e=new n(void 0),r=e;r.right=this._root;for(var i=null,s=null,o=1;null!==r.get_child(o);){i=r,r=r.get_child(o);var a=this._comparator(t,r.data);o=a>0,0===a&&(s=r)}return null!==s&&(s.data=r.data,i.set_child(i.right===r,r.get_child(null===r.left)),this._root=e.right,this.size--,!0)},t.exports=s},9101:(t,e,r)=>{var i=r(8704);function n(t){this.data=t,this.left=null,this.right=null,this.red=!0}function s(t){this._root=null,this._comparator=t,this.size=0}function o(t){return null!==t&&t.red}function a(t,e){var r=t.get_child(!e);return t.set_child(!e,r.get_child(e)),r.set_child(e,t),t.red=!0,r.red=!1,r}function h(t,e){return t.set_child(!e,a(t.get_child(!e),!e)),a(t,e)}n.prototype.get_child=function(t){return t?this.right:this.left},n.prototype.set_child=function(t,e){t?this.right=e:this.left=e},s.prototype=new i,s.prototype.insert=function(t){var e=!1;if(null===this._root)this._root=new n(t),e=!0,this.size++;else{var r=new n(void 0),i=0,s=0,u=null,c=r,l=null,d=this._root;for(c.right=this._root;;){if(null===d?(d=new n(t),l.set_child(i,d),e=!0,this.size++):o(d.left)&&o(d.right)&&(d.red=!0,d.left.red=!1,d.right.red=!1),o(d)&&o(l)){var f=c.right===u;d===l.get_child(s)?c.set_child(f,a(u,!s)):c.set_child(f,h(u,!s))}var p=this._comparator(d.data,t);if(0===p)break;s=i,i=p<0,null!==u&&(c=u),u=l,l=d,d=d.get_child(i)}this._root=r.right}return this._root.red=!1,e},s.prototype.remove=function(t){if(null===this._root)return!1;var e=new n(void 0),r=e;r.right=this._root;for(var i=null,s=null,u=null,c=1;null!==r.get_child(c);){var l=c;s=i,i=r,r=r.get_child(c);var d=this._comparator(t,r.data);if(c=d>0,0===d&&(u=r),!o(r)&&!o(r.get_child(c)))if(o(r.get_child(!c))){var f=a(r,c);i.set_child(l,f),i=f}else if(!o(r.get_child(!c))){var p=i.get_child(!l);if(null!==p)if(o(p.get_child(!l))||o(p.get_child(l))){var m=s.right===i;o(p.get_child(l))?s.set_child(m,h(i,l)):o(p.get_child(!l))&&s.set_child(m,a(i,l));var g=s.get_child(m);g.red=!0,r.red=!0,g.left.red=!1,g.right.red=!1}else i.red=!1,p.red=!0,r.red=!0}}return null!==u&&(u.data=r.data,i.set_child(i.right===r,r.get_child(null===r.left)),this.size--),this._root=e.right,null!==this._root&&(this._root.red=!1),null!==u},t.exports=s},8704:t=>{function e(){}function r(t){this._tree=t,this._ancestors=[],this._cursor=null}e.prototype.clear=function(){this._root=null,this.size=0},e.prototype.find=function(t){for(var e=this._root;null!==e;){var r=this._comparator(t,e.data);if(0===r)return e.data;e=e.get_child(r>0)}return null},e.prototype.findIter=function(t){for(var e=this._root,r=this.iterator();null!==e;){var i=this._comparator(t,e.data);if(0===i)return r._cursor=e,r;r._ancestors.push(e),e=e.get_child(i>0)}return null},e.prototype.lowerBound=function(t){for(var e=this._root,r=this.iterator(),i=this._comparator;null!==e;){var n=i(t,e.data);if(0===n)return r._cursor=e,r;r._ancestors.push(e),e=e.get_child(n>0)}for(var s=r._ancestors.length-1;s>=0;--s)if(i(t,(e=r._ancestors[s]).data)<0)return r._cursor=e,r._ancestors.length=s,r;return r._ancestors.length=0,r},e.prototype.upperBound=function(t){for(var e=this.lowerBound(t),r=this._comparator;null!==e.data()&&0===r(e.data(),t);)e.next();return e},e.prototype.min=function(){var t=this._root;if(null===t)return null;for(;null!==t.left;)t=t.left;return t.data},e.prototype.max=function(){var t=this._root;if(null===t)return null;for(;null!==t.right;)t=t.right;return t.data},e.prototype.iterator=function(){return new r(this)},e.prototype.each=function(t){for(var e,r=this.iterator();null!==(e=r.next());)if(!1===t(e))return},e.prototype.reach=function(t){for(var e,r=this.iterator();null!==(e=r.prev());)if(!1===t(e))return},r.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},r.prototype.next=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._minNode(t)}else{var e;if(null===this._cursor.right)do{if(e=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===e);else this._ancestors.push(this._cursor),this._minNode(this._cursor.right)}return null!==this._cursor?this._cursor.data:null},r.prototype.prev=function(){if(null===this._cursor){var t=this._tree._root;null!==t&&this._maxNode(t)}else{var e;if(null===this._cursor.left)do{if(e=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===e);else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left)}return null!==this._cursor?this._cursor.data:null},r.prototype._minNode=function(t){for(;null!==t.left;)this._ancestors.push(t),t=t.left;this._cursor=t},r.prototype._maxNode=function(t){for(;null!==t.right;)this._ancestors.push(t),t=t.right;this._cursor=t},t.exports=e},6879:(t,e,r)=>{"use strict";const i=r(9095),n=r(5614),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.hp=h,e.IS=50;const o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,h.prototype),e}function h(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return u(t,e,r)}function u(t,e,r){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!h.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const r=0|m(t,e);let i=a(r);const n=i.write(t,e);return n!==r&&(i=i.slice(0,n)),i}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Z(t,Uint8Array)){const e=new Uint8Array(t);return f(e.buffer,e.byteOffset,e.byteLength)}return d(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Z(t,ArrayBuffer)||t&&Z(t.buffer,ArrayBuffer))return f(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(Z(t,SharedArrayBuffer)||t&&Z(t.buffer,SharedArrayBuffer)))return f(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return h.from(i,e,r);const n=function(t){if(h.isBuffer(t)){const e=0|p(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||Y(t.length)?a(0):d(t):"Buffer"===t.type&&Array.isArray(t.data)?d(t.data):void 0}(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return h.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return c(t),a(t<0?0:0|p(t))}function d(t){const e=t.length<0?0:0|p(t.length),r=a(e);for(let i=0;i<e;i+=1)r[i]=255&t[i];return r}function f(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');let i;return i=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(i,h.prototype),i}function p(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function m(t,e){if(h.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const r=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===r)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return K(t).length;default:if(n)return i?-1:W(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){let i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,r);case"utf8":case"utf-8":return A(this,e,r);case"ascii":return x(this,e,r);case"latin1":case"binary":return C(this,e,r);case"base64":return k(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function b(t,e,r){const i=t[e];t[e]=t[r],t[r]=i}function y(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),Y(r=+r)&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=h.from(e,i)),h.isBuffer(e))return 0===e.length?-1:v(t,e,r,i,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,i,n){let s,o=1,a=t.length,h=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,r/=2}function u(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(n){let i=-1;for(s=r;s<a;s++)if(u(t,s)===u(e,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===h)return i*o}else-1!==i&&(s-=s-i),i=-1}else for(r+h>a&&(r=a-h),s=r;s>=0;s--){let r=!0;for(let i=0;i<h;i++)if(u(t,s+i)!==u(e,i)){r=!1;break}if(r)return s}return-1}function w(t,e,r,i){r=Number(r)||0;const n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;const s=e.length;let o;for(i>s/2&&(i=s/2),o=0;o<i;++o){const i=parseInt(e.substr(2*o,2),16);if(Y(i))return o;t[r+o]=i}return o}function M(t,e,r,i){return G(W(e,t.length-r),t,r,i)}function _(t,e,r,i){return G(function(t){const e=[];for(let r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,i)}function S(t,e,r,i){return G(K(e),t,r,i)}function E(t,e,r,i){return G(function(t,e){let r,i,n;const s=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),i=r>>8,n=r%256,s.push(n),s.push(i);return s}(e,t.length-r),t,r,i)}function k(t,e,r){return 0===e&&r===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,r))}function A(t,e,r){r=Math.min(t.length,r);const i=[];let n=e;for(;n<r;){const e=t[n];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(n+o<=r){let r,i,a,h;switch(o){case 1:e<128&&(s=e);break;case 2:r=t[n+1],128==(192&r)&&(h=(31&e)<<6|63&r,h>127&&(s=h));break;case 3:r=t[n+1],i=t[n+2],128==(192&r)&&128==(192&i)&&(h=(15&e)<<12|(63&r)<<6|63&i,h>2047&&(h<55296||h>57343)&&(s=h));break;case 4:r=t[n+1],i=t[n+2],a=t[n+3],128==(192&r)&&128==(192&i)&&128==(192&a)&&(h=(15&e)<<18|(63&r)<<12|(63&i)<<6|63&a,h>65535&&h<1114112&&(s=h))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),n+=o}return function(t){const e=t.length;if(e<=I)return String.fromCharCode.apply(String,t);let r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=I));return r}(i)}h.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),h.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.buffer}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){if(h.isBuffer(this))return this.byteOffset}}),h.poolSize=8192,h.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(h.prototype,Uint8Array.prototype),Object.setPrototypeOf(h,Uint8Array),h.alloc=function(t,e,r){return function(t,e,r){return c(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},h.allocUnsafe=function(t){return l(t)},h.allocUnsafeSlow=function(t){return l(t)},h.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==h.prototype},h.compare=function(t,e){if(Z(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),Z(e,Uint8Array)&&(e=h.from(e,e.offset,e.byteLength)),!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let r=t.length,i=e.length;for(let n=0,s=Math.min(r,i);n<s;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);let r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;const i=h.allocUnsafe(e);let n=0;for(r=0;r<t.length;++r){let e=t[r];if(Z(e,Uint8Array))n+e.length>i.length?(h.isBuffer(e)||(e=h.from(e)),e.copy(i,n)):Uint8Array.prototype.set.call(i,e,n);else{if(!h.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(i,n)}n+=e.length}return i},h.byteLength=m,h.prototype._isBuffer=!0,h.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)b(this,e,e+1);return this},h.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},h.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},h.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?A(this,0,t):g.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){let t="";const r=e.IS;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(h.prototype[s]=h.prototype.inspect),h.prototype.compare=function(t,e,r,i,n){if(Z(t,Uint8Array)&&(t=h.from(t,t.offset,t.byteLength)),!h.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return-1;if(e>=r)return 1;if(this===t)return 0;let s=(n>>>=0)-(i>>>=0),o=(r>>>=0)-(e>>>=0);const a=Math.min(s,o),u=this.slice(i,n),c=t.slice(e,r);for(let t=0;t<a;++t)if(u[t]!==c[t]){s=u[t],o=c[t];break}return s<o?-1:o<s?1:0},h.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},h.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},h.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},h.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}const n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let s=!1;for(;;)switch(i){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return M(this,t,e,r);case"ascii":case"latin1":case"binary":return _(this,t,e,r);case"base64":return S(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),s=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const I=4096;function x(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function C(t,e,r){let i="";r=Math.min(t.length,r);for(let n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function T(t,e,r){const i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);let n="";for(let i=e;i<r;++i)n+=J[t[i]];return n}function P(t,e,r){const i=t.slice(e,r);let n="";for(let t=0;t<i.length-1;t+=2)n+=String.fromCharCode(i[t]+256*i[t+1]);return n}function B(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,r,i,n,s){if(!h.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<s)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function D(t,e,r,i,n){q(e,i,n,t,r,7);let s=Number(e&BigInt(4294967295));t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s,s>>=8,t[r++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,o>>=8,t[r++]=o,r}function N(t,e,r,i,n){q(e,i,n,t,r,7);let s=Number(e&BigInt(4294967295));t[r+7]=s,s>>=8,t[r+6]=s,s>>=8,t[r+5]=s,s>>=8,t[r+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[r+3]=o,o>>=8,t[r+2]=o,o>>=8,t[r+1]=o,o>>=8,t[r]=o,r+8}function L(t,e,r,i,n,s){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function O(t,e,r,i,s){return e=+e,r>>>=0,s||L(t,0,r,4),n.write(t,e,r,i,23,4),r+4}function U(t,e,r,i,s){return e=+e,r>>>=0,s||L(t,0,r,8),n.write(t,e,r,i,52,8),r+8}h.prototype.slice=function(t,e){const r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);const i=this.subarray(t,e);return Object.setPrototypeOf(i,h.prototype),i},h.prototype.readUintLE=h.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=this[t],n=1,s=0;for(;++s<e&&(n*=256);)i+=this[t+s]*n;return i},h.prototype.readUintBE=h.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=this[t+--e],n=1;for(;e>0&&(n*=256);)i+=this[t+--e]*n;return i},h.prototype.readUint8=h.prototype.readUInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),this[t]},h.prototype.readUint16LE=h.prototype.readUInt16LE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUint16BE=h.prototype.readUInt16BE=function(t,e){return t>>>=0,e||B(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUint32LE=h.prototype.readUInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUint32BE=h.prototype.readUInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readBigUInt64LE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,n=this[++t]+256*this[++t]+65536*this[++t]+r*2**24;return BigInt(i)+(BigInt(n)<<BigInt(32))})),h.prototype.readBigUInt64BE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=e*2**24+65536*this[++t]+256*this[++t]+this[++t],n=this[++t]*2**24+65536*this[++t]+256*this[++t]+r;return(BigInt(i)<<BigInt(32))+BigInt(n)})),h.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=this[t],n=1,s=0;for(;++s<e&&(n*=256);)i+=this[t+s]*n;return n*=128,i>=n&&(i-=Math.pow(2,8*e)),i},h.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||B(t,e,this.length);let i=e,n=1,s=this[t+--i];for(;i>0&&(n*=256);)s+=this[t+--i]*n;return n*=128,s>=n&&(s-=Math.pow(2,8*e)),s},h.prototype.readInt8=function(t,e){return t>>>=0,e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){t>>>=0,e||B(t,2,this.length);const r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt16BE=function(t,e){t>>>=0,e||B(t,2,this.length);const r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},h.prototype.readInt32LE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return t>>>=0,e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readBigInt64LE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=this[t+4]+256*this[t+5]+65536*this[t+6]+(r<<24);return(BigInt(i)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),h.prototype.readBigInt64BE=X((function(t){z(t>>>=0,"offset");const e=this[t],r=this[t+7];void 0!==e&&void 0!==r||H(t,this.length-8);const i=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(i)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+r)})),h.prototype.readFloatLE=function(t,e){return t>>>=0,e||B(t,4,this.length),n.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return t>>>=0,e||B(t,4,this.length),n.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return t>>>=0,e||B(t,8,this.length),n.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return t>>>=0,e||B(t,8,this.length),n.read(this,t,!1,52,8)},h.prototype.writeUintLE=h.prototype.writeUIntLE=function(t,e,r,i){t=+t,e>>>=0,r>>>=0,i||R(this,t,e,r,Math.pow(2,8*r)-1,0);let n=1,s=0;for(this[e]=255&t;++s<r&&(n*=256);)this[e+s]=t/n&255;return e+r},h.prototype.writeUintBE=h.prototype.writeUIntBE=function(t,e,r,i){t=+t,e>>>=0,r>>>=0,i||R(this,t,e,r,Math.pow(2,8*r)-1,0);let n=r-1,s=1;for(this[e+n]=255&t;--n>=0&&(s*=256);)this[e+n]=t/s&255;return e+r},h.prototype.writeUint8=h.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,1,255,0),this[e]=255&t,e+1},h.prototype.writeUint16LE=h.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeUint16BE=h.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeUint32LE=h.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},h.prototype.writeUint32BE=h.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeBigUInt64LE=X((function(t,e=0){return D(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),h.prototype.writeBigUInt64BE=X((function(t,e=0){return N(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),h.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e>>>=0,!i){const i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}let n=0,s=1,o=0;for(this[e]=255&t;++n<r&&(s*=256);)t<0&&0===o&&0!==this[e+n-1]&&(o=1),this[e+n]=(t/s|0)-o&255;return e+r},h.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e>>>=0,!i){const i=Math.pow(2,8*r-1);R(this,t,e,r,i-1,-i)}let n=r-1,s=1,o=0;for(this[e+n]=255&t;--n>=0&&(s*=256);)t<0&&0===o&&0!==this[e+n+1]&&(o=1),this[e+n]=(t/s|0)-o&255;return e+r},h.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},h.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},h.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},h.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},h.prototype.writeBigInt64LE=X((function(t,e=0){return D(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),h.prototype.writeBigInt64BE=X((function(t,e=0){return N(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),h.prototype.writeFloatLE=function(t,e,r){return O(this,t,e,!0,r)},h.prototype.writeFloatBE=function(t,e,r){return O(this,t,e,!1,r)},h.prototype.writeDoubleLE=function(t,e,r){return U(this,t,e,!0,r)},h.prototype.writeDoubleBE=function(t,e,r){return U(this,t,e,!1,r)},h.prototype.copy=function(t,e,r,i){if(!h.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);const n=i-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,i):Uint8Array.prototype.set.call(t,this.subarray(r,i),e),n},h.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!h.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){const e=t.charCodeAt(0);("utf8"===i&&e<128||"latin1"===i)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;let n;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(n=e;n<r;++n)this[n]=t;else{const s=h.isBuffer(t)?t:h.from(t,i),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<r-e;++n)this[n+e]=s[n%o]}return this};const F={};function j(t,e,r){F[t]=class extends r{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function V(t){let e="",r=t.length;const i="-"===t[0]?1:0;for(;r>=i+4;r-=3)e=`_${t.slice(r-3,r)}${e}`;return`${t.slice(0,r)}${e}`}function q(t,e,r,i,n,s){if(t>r||t<e){const i="bigint"==typeof e?"n":"";let n;throw n=s>3?0===e||e===BigInt(0)?`>= 0${i} and < 2${i} ** ${8*(s+1)}${i}`:`>= -(2${i} ** ${8*(s+1)-1}${i}) and < 2 ** ${8*(s+1)-1}${i}`:`>= ${e}${i} and <= ${r}${i}`,new F.ERR_OUT_OF_RANGE("value",n,t)}!function(t,e,r){z(e,"offset"),void 0!==t[e]&&void 0!==t[e+r]||H(e,t.length-(r+1))}(i,n,s)}function z(t,e){if("number"!=typeof t)throw new F.ERR_INVALID_ARG_TYPE(e,"number",t)}function H(t,e,r){if(Math.floor(t)!==t)throw z(t,r),new F.ERR_OUT_OF_RANGE(r||"offset","an integer",t);if(e<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(r||"offset",`>= ${r?1:0} and <= ${e}`,t)}j("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),j("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),j("ERR_OUT_OF_RANGE",(function(t,e,r){let i=`The value of "${t}" is out of range.`,n=r;return Number.isInteger(r)&&Math.abs(r)>2**32?n=V(String(r)):"bigint"==typeof r&&(n=String(r),(r>BigInt(2)**BigInt(32)||r<-(BigInt(2)**BigInt(32)))&&(n=V(n)),n+="n"),i+=` It must be ${e}. Received ${n}`,i}),RangeError);const $=/[^+/0-9A-Za-z-_]/g;function W(t,e){let r;e=e||1/0;const i=t.length;let n=null;const s=[];for(let o=0;o<i;++o){if(r=t.charCodeAt(o),r>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===i){(e-=3)>-1&&s.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&s.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function K(t){return i.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace($,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function G(t,e,r,i){let n;for(n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function Z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Y(t){return t!=t}const J=function(){const t="0123456789abcdef",e=new Array(256);for(let r=0;r<16;++r){const i=16*r;for(let n=0;n<16;++n)e[i+n]=t[r]+t[n]}return e}();function X(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},6757:t=>{"use strict";function e(t,e){e=e||{},this._capacity=e.capacity,this._head=0,this._tail=0,Array.isArray(t)?this._fromArray(t):(this._capacityMask=3,this._list=new Array(4))}e.prototype.peekAt=function(t){var e=t;if(e===(0|e)){var r=this.size();if(!(e>=r||e<-r))return e<0&&(e+=r),e=this._head+e&this._capacityMask,this._list[e]}},e.prototype.get=function(t){return this.peekAt(t)},e.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},e.prototype.peekFront=function(){return this.peek()},e.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(e.prototype,"length",{get:function(){return this.size()}}),e.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.unshift=function(t){if(0===arguments.length)return this.size();var e=this._list.length;return this._head=this._head-1+e&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.shift=function(){var t=this._head;if(t!==this._tail){var e=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),e}},e.prototype.push=function(t){if(0===arguments.length)return this.size();var e=this._tail;return this._list[e]=t,this._tail=e+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},e.prototype.pop=function(){var t=this._tail;if(t!==this._head){var e=this._list.length;this._tail=t-1+e&this._capacityMask;var r=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=e>>>2&&this._shrinkArray(),r}},e.prototype.removeOne=function(t){var e=t;if(e===(0|e)&&this._head!==this._tail){var r=this.size(),i=this._list.length;if(!(e>=r||e<-r)){e<0&&(e+=r),e=this._head+e&this._capacityMask;var n,s=this._list[e];if(t<r/2){for(n=t;n>0;n--)this._list[e]=this._list[e=e-1+i&this._capacityMask];this._list[e]=void 0,this._head=this._head+1+i&this._capacityMask}else{for(n=r-1-t;n>0;n--)this._list[e]=this._list[e=e+1+i&this._capacityMask];this._list[e]=void 0,this._tail=this._tail-1+i&this._capacityMask}return s}}},e.prototype.remove=function(t,e){var r,i=t,n=e;if(i===(0|i)&&this._head!==this._tail){var s=this.size(),o=this._list.length;if(!(i>=s||i<-s||e<1)){if(i<0&&(i+=s),1===e||!e)return(r=new Array(1))[0]=this.removeOne(i),r;if(0===i&&i+e>=s)return r=this.toArray(),this.clear(),r;var a;for(i+e>s&&(e=s-i),r=new Array(e),a=0;a<e;a++)r[a]=this._list[this._head+i+a&this._capacityMask];if(i=this._head+i&this._capacityMask,t+e===s){for(this._tail=this._tail-e+o&this._capacityMask,a=e;a>0;a--)this._list[i=i+1+o&this._capacityMask]=void 0;return r}if(0===t){for(this._head=this._head+e+o&this._capacityMask,a=e-1;a>0;a--)this._list[i=i+1+o&this._capacityMask]=void 0;return r}if(i<s/2){for(this._head=this._head+t+e+o&this._capacityMask,a=t;a>0;a--)this.unshift(this._list[i=i-1+o&this._capacityMask]);for(i=this._head-1+o&this._capacityMask;n>0;)this._list[i=i-1+o&this._capacityMask]=void 0,n--;t<0&&(this._tail=i)}else{for(this._tail=i,i=i+e+o&this._capacityMask,a=s-(e+t);a>0;a--)this.push(this._list[i++]);for(i=this._tail;n>0;)this._list[i=i+1+o&this._capacityMask]=void 0,n--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),r}}},e.prototype.splice=function(t,e){var r=t;if(r===(0|r)){var i=this.size();if(r<0&&(r+=i),!(r>i)){if(arguments.length>2){var n,s,o,a=arguments.length,h=this._list.length,u=2;if(!i||r<i/2){for(s=new Array(r),n=0;n<r;n++)s[n]=this._list[this._head+n&this._capacityMask];for(0===e?(o=[],r>0&&(this._head=this._head+r+h&this._capacityMask)):(o=this.remove(r,e),this._head=this._head+r+h&this._capacityMask);a>u;)this.unshift(arguments[--a]);for(n=r;n>0;n--)this.unshift(s[n-1])}else{var c=(s=new Array(i-(r+e))).length;for(n=0;n<c;n++)s[n]=this._list[this._head+r+e+n&this._capacityMask];for(0===e?(o=[],r!=i&&(this._tail=this._head+r+h&this._capacityMask)):(o=this.remove(r,e),this._tail=this._tail-c+h&this._capacityMask);u<a;)this.push(arguments[u++]);for(n=0;n<c;n++)this.push(s[n])}return o}return this.remove(r,e)}}},e.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},e.prototype.isEmpty=function(){return this._head===this._tail},e.prototype.toArray=function(){return this._copyArray(!1)},e.prototype._fromArray=function(t){var e=t.length,r=this._nextPowerOf2(e);this._list=new Array(r),this._capacityMask=r-1,this._tail=e;for(var i=0;i<e;i++)this._list[i]=t[i]},e.prototype._copyArray=function(t,e){var r=this._list,i=r.length,n=this.length;if((e|=n)==n&&this._head<this._tail)return this._list.slice(this._head,this._tail);var s,o=new Array(e),a=0;if(t||this._head>this._tail){for(s=this._head;s<i;s++)o[a++]=r[s];for(s=0;s<this._tail;s++)o[a++]=r[s]}else for(s=this._head;s<this._tail;s++)o[a++]=r[s];return o},e.prototype._growArray=function(){if(0!=this._head){var t=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=t}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},e.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.prototype._nextPowerOf2=function(t){var e=1<<Math.log(t)/Math.log(2)+1;return Math.max(e,4)},t.exports=e},9106:(t,e,r)=>{"use strict";const i=r(6553);e.PP=i.EventIterator,i.EventIterator},6553:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(t){if(this.isStopped)return;const e={value:t,done:!1};if(this.pullQueue.length){const t=this.pullQueue.shift();t&&t.resolve(e)}else this.pushQueue.push(Promise.resolve(e)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const t of this.pullQueue)t.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(t){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const e of this.pullQueue)e.reject(t);this.pullQueue.length=0}else{const e=Promise.reject(t);e.catch((()=>{})),this.pushQueue.push(e)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:t=>{const e=this.pushQueue.shift();return e?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),e):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((t,e)=>{this.pullQueue.push({resolve:t,reject:e})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class i{constructor(t,{highWaterMark:e=100,lowWaterMark:i=1}={}){const n=new r;n.highWaterMark=e,n.lowWaterMark=i,n.removeCallback=t({push:t=>n.push(t),stop:()=>n.stop(),fail:t=>n.fail(t),on:(t,e)=>{n.eventHandlers[t]=e}})||(()=>{}),this[Symbol.asyncIterator]=()=>n[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=i,e.default=i},7178:t=>{"use strict";var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,i,s,o){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new n(i,s||t,o),h=r?r+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function a(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),a.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,o=new Array(s);n<s;n++)o[n]=i[n].fn;return o},a.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},a.prototype.emit=function(t,e,i,n,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var h,u,c=this._events[a],l=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,n),!0;case 5:return c.fn.call(c.context,e,i,n,s),!0;case 6:return c.fn.call(c.context,e,i,n,s,o),!0}for(u=1,h=new Array(l-1);u<l;u++)h[u-1]=arguments[u];c.fn.apply(c.context,h)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),l){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,i);break;case 4:c[u].fn.call(c[u].context,e,i,n);break;default:if(!h)for(d=1,h=new Array(l-1);d<l;d++)h[d-1]=arguments[d];c[u].fn.apply(c[u].context,h)}}return!0},a.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},a.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},a.prototype.removeListener=function(t,e,i,n){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||n&&!a.once||i&&a.context!==i||o(this,s);else{for(var h=0,u=[],c=a.length;h<c;h++)(a[h].fn!==e||n&&!a[h].once||i&&a[h].context!==i)&&u.push(a[h]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&o(this,e)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a},9991:t=>{t.exports=function(t){if(!t)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,r=Object.create(null),i=Object.create(null);function n(n,s){r[n]=s,++e>=t&&(e=0,i=r,r=Object.create(null))}return{has:function(t){return void 0!==r[t]||void 0!==i[t]},remove:function(t){void 0!==r[t]&&(r[t]=void 0),void 0!==i[t]&&(i[t]=void 0)},get:function(t){var e=r[t];return void 0!==e?e:void 0!==(e=i[t])?(n(t,e),e):void 0},set:function(t,e){void 0!==r[t]?r[t]=e:n(t,e)},clear:function(){r=Object.create(null),i=Object.create(null)}}}},5614:(t,e)=>{e.read=function(t,e,r,i,n){var s,o,a=8*n-i-1,h=(1<<a)-1,u=h>>1,c=-7,l=r?n-1:0,d=r?-1:1,f=t[e+l];for(l+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=256*s+t[e+l],l+=d,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=i;c>0;o=256*o+t[e+l],l+=d,c-=8);if(0===s)s=1-u;else{if(s===h)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=u}return(f?-1:1)*o*Math.pow(2,s-i)},e.write=function(t,e,r,i,n,s){var o,a,h,u=8*s-n-1,c=(1<<u)-1,l=c>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+l>=1?d/h:d*Math.pow(2,1-l))*h>=2&&(o++,h/=2),o+l>=c?(a=0,o=c):o+l>=1?(a=(e*h-1)*Math.pow(2,n),o+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,n),o=0));n>=8;t[r+f]=255&a,f+=p,a/=256,n-=8);for(o=o<<n|a,u+=n;u>0;t[r+f]=255&o,f+=p,o/=256,u-=8);t[r+f-p]|=128*m}},7144:(t,e,r)=>{var i=r(5606);t.exports=function(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!(void 0===i||"object"!=typeof i.versions||!i.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}},6437:t=>{"use strict";t.exports=t=>{if("[object Object]"!==Object.prototype.toString.call(t))return!1;const e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}},9085:function(t,e,r){var i,n;i=function(t){"use strict";var e,r,i={template:"[%t] %l:",levelFormatter:function(t){return t.toUpperCase()},nameFormatter:function(t){return t||"root"},timestampFormatter:function(t){return t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},format:void 0},n={},s={reg:function(t){if(!t||!t.getLogger)throw new TypeError("Argument is not a root logger");e=t},apply:function(t,r){if(!t||!t.setLevel)throw new TypeError("Argument is not a logger");var s=t.methodFactory,o=t.name||"",a=n[o]||n[""]||i;return n[o]||(t.methodFactory=function(t,e,r){var i=s(t,e,r),a=n[r]||n[""],h=-1!==a.template.indexOf("%t"),u=-1!==a.template.indexOf("%l"),c=-1!==a.template.indexOf("%n");return function(){for(var e="",s=arguments.length,l=Array(s),d=0;d<s;d++)l[d]=arguments[d];if(o||!n[r]){var f=a.timestampFormatter(new Date),p=a.levelFormatter(t),m=a.nameFormatter(r);a.format?e+=a.format(p,m,f):(e+=a.template,h&&(e=e.replace(/%t/,f)),u&&(e=e.replace(/%l/,p)),c&&(e=e.replace(/%n/,m))),l.length&&"string"==typeof l[0]?l[0]=e+" "+l[0]:l.unshift(e)}i.apply(void 0,l)}}),(r=r||{}).template&&(r.format=void 0),n[o]=function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(e in arguments[r])Object.prototype.hasOwnProperty.call(arguments[r],e)&&(t[e]=arguments[r][e]);return t}({},a,r),t.setLevel(t.getLevel()),e||t.warn("It is necessary to call the function reg() of loglevel-plugin-prefix before calling apply. From the next release, it will throw an error. See more: https://github.com/kutuluk/loglevel-plugin-prefix/blob/master/README.md"),t}};return t&&(r=t.prefix,s.noConflict=function(){return t.prefix===s&&(t.prefix=r),s}),s},void 0===(n=i.call(e,r,e,t))||(t.exports=n)},5808:function(t,e,r){var i,n;!function(){"use strict";i=function(){var t=function(){},e="undefined",r=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],n={},s=null;function o(t,e){var r=t[e];if("function"==typeof r.bind)return r.bind(t);try{return Function.prototype.bind.call(r,t)}catch(e){return function(){return Function.prototype.apply.apply(r,[t,arguments])}}}function a(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function h(){for(var r=this.getLevel(),n=0;n<i.length;n++){var s=i[n];this[s]=n<r?t:this.methodFactory(s,r,this.name)}if(this.log=this.debug,typeof console===e&&r<this.levels.SILENT)return"No console available for logging"}function u(t){return function(){typeof console!==e&&(h.call(this),this[t].apply(this,arguments))}}function c(i,n,s){return function(i){return"debug"===i&&(i="log"),typeof console!==e&&("trace"===i&&r?a:void 0!==console[i]?o(console,i):void 0!==console.log?o(console,"log"):t)}(i)||u.apply(this,arguments)}function l(t,r){var o,a,u,l=this,d="loglevel";function f(){var t;if(typeof window!==e&&d){try{t=window.localStorage[d]}catch(t){}if(typeof t===e)try{var r=window.document.cookie,i=encodeURIComponent(d),n=r.indexOf(i+"=");-1!==n&&(t=/^([^;]+)/.exec(r.slice(n+i.length+1))[1])}catch(t){}return void 0===l.levels[t]&&(t=void 0),t}}function p(t){var e=t;if("string"==typeof e&&void 0!==l.levels[e.toUpperCase()]&&(e=l.levels[e.toUpperCase()]),"number"==typeof e&&e>=0&&e<=l.levels.SILENT)return e;throw new TypeError("log.setLevel() called with invalid level: "+t)}"string"==typeof t?d+=":"+t:"symbol"==typeof t&&(d=void 0),l.name=t,l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=r||c,l.getLevel=function(){return null!=u?u:null!=a?a:o},l.setLevel=function(t,r){return u=p(t),!1!==r&&function(t){var r=(i[t]||"silent").toUpperCase();if(typeof window!==e&&d){try{return void(window.localStorage[d]=r)}catch(t){}try{window.document.cookie=encodeURIComponent(d)+"="+r+";"}catch(t){}}}(u),h.call(l)},l.setDefaultLevel=function(t){a=p(t),f()||l.setLevel(t,!1)},l.resetLevel=function(){u=null,function(){if(typeof window!==e&&d){try{window.localStorage.removeItem(d)}catch(t){}try{window.document.cookie=encodeURIComponent(d)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(t){}}}(),h.call(l)},l.enableAll=function(t){l.setLevel(l.levels.TRACE,t)},l.disableAll=function(t){l.setLevel(l.levels.SILENT,t)},l.rebuild=function(){if(s!==l&&(o=p(s.getLevel())),h.call(l),s===l)for(var t in n)n[t].rebuild()},o=p(s?s.getLevel():"WARN");var m=f();null!=m&&(u=p(m)),h.call(l)}(s=new l).getLogger=function(t){if("symbol"!=typeof t&&"string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=n[t];return e||(e=n[t]=new l(t,s.methodFactory)),e};var d=typeof window!==e?window.log:void 0;return s.noConflict=function(){return typeof window!==e&&window.log===s&&(window.log=d),s},s.getLoggers=function(){return n},s.default=s,s},void 0===(n=i.call(e,r,e,t))||(t.exports=n)}()},6965:function(t,e,r){"use strict";const i=r(6437),{hasOwnProperty:n}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(t,e,r)=>Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!0,configurable:!0}),a=this,h={concatArrays:!1,ignoreUndefined:!1},u=t=>{const e=[];for(const r in t)n.call(t,r)&&e.push(r);if(Object.getOwnPropertySymbols){const r=Object.getOwnPropertySymbols(t);for(const i of r)s.call(t,i)&&e.push(i)}return e};function c(t){return Array.isArray(t)?function(t){const e=t.slice(0,0);return u(t).forEach((r=>{o(e,r,c(t[r]))})),e}(t):i(t)?function(t){const e=null===Object.getPrototypeOf(t)?Object.create(null):{};return u(t).forEach((r=>{o(e,r,c(t[r]))})),e}(t):t}const l=(t,e,r,i)=>(r.forEach((r=>{void 0===e[r]&&i.ignoreUndefined||(r in t&&t[r]!==Object.getPrototypeOf(t)?o(t,r,f(t[r],e[r],i)):o(t,r,c(e[r])))})),t),d=(t,e,r)=>{let i=t.slice(0,0),s=0;return[t,e].forEach((e=>{const a=[];for(let r=0;r<e.length;r++)n.call(e,r)&&(a.push(String(r)),o(i,s++,e===t?e[r]:c(e[r])));i=l(i,e,u(e).filter((t=>!a.includes(t))),r)})),i};function f(t,e,r){return r.concatArrays&&Array.isArray(t)&&Array.isArray(e)?d(t,e,r):i(e)&&i(t)?l(t,e,u(e),r):c(e)}t.exports=function(...t){const e=f(c(h),this!==a&&this||{},h);let r={_:{}};for(const n of t)if(void 0!==n){if(!i(n))throw new TypeError("`"+n+"` is not an Option Object");r=f(r,{_:n},e)}return r._}},2511:(t,e,r)=>{t.exports=r(4629)},4629:function(t,e){!function(r,i){"use strict";var n={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(t){if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return!1;for(var e=0;e<t.length;e++)if(!Number.isInteger(t[e])||t[e]<0||t[e]>255)return!1;return!0}function o(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function a(t,e){return t<<e|t>>>32-e}function h(t){return t=o(t^=t>>>16,2246822507),(t=o(t^=t>>>13,3266489909))^t>>>16}function u(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var r=[0,0,0,0];return r[3]+=t[3]+e[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=t[2]+e[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=t[1]+e[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=t[0]+e[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function c(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var r=[0,0,0,0];return r[3]+=t[3]*e[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=t[2]*e[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=t[3]*e[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=t[1]*e[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=t[2]*e[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=t[3]*e[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=t[0]*e[3]+t[1]*e[2]+t[2]*e[1]+t[3]*e[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function l(t,e){return 32==(e%=64)?[t[1],t[0]]:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e|t[0]>>>32-e]:(e-=32,[t[1]<<e|t[0]>>>32-e,t[0]<<e|t[1]>>>32-e])}function d(t,e){return 0==(e%=64)?t:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e]:[t[1]<<e-32,0]}function f(t,e){return[t[0]^e[0],t[1]^e[1]]}function p(t){return t=f(t,[0,t[0]>>>1]),t=f(t=c(t,[4283543511,3981806797]),[0,t[0]>>>1]),f(t=c(t,[3301882366,444984403]),[0,t[0]>>>1])}n.x86.hash32=function(t,e){if(n.inputValidation&&!s(t))return i;e=e||0;for(var r=t.length%4,u=t.length-r,c=e,l=0,d=3432918353,f=461845907,p=0;p<u;p+=4)l=o(l=t[p]|t[p+1]<<8|t[p+2]<<16|t[p+3]<<24,d),l=o(l=a(l,15),f),c=o(c=a(c^=l,13),5)+3864292196;switch(l=0,r){case 3:l^=t[p+2]<<16;case 2:l^=t[p+1]<<8;case 1:l=o(l^=t[p],d),c^=l=o(l=a(l,15),f)}return(c=h(c^=t.length))>>>0},n.x86.hash128=function(t,e){if(n.inputValidation&&!s(t))return i;e=e||0;for(var r=t.length%16,u=t.length-r,c=e,l=e,d=e,f=e,p=0,m=0,g=0,b=0,y=597399067,v=2869860233,w=951274213,M=2716044179,_=0;_<u;_+=16)p=t[_]|t[_+1]<<8|t[_+2]<<16|t[_+3]<<24,m=t[_+4]|t[_+5]<<8|t[_+6]<<16|t[_+7]<<24,g=t[_+8]|t[_+9]<<8|t[_+10]<<16|t[_+11]<<24,b=t[_+12]|t[_+13]<<8|t[_+14]<<16|t[_+15]<<24,p=a(p=o(p,y),15),c=a(c^=p=o(p,v),19),c=o(c+=l,5)+1444728091,m=a(m=o(m,v),16),l=a(l^=m=o(m,w),17),l=o(l+=d,5)+197830471,g=a(g=o(g,w),17),d=a(d^=g=o(g,M),15),d=o(d+=f,5)+2530024501,b=a(b=o(b,M),18),f=a(f^=b=o(b,y),13),f=o(f+=c,5)+850148119;switch(p=0,m=0,g=0,b=0,r){case 15:b^=t[_+14]<<16;case 14:b^=t[_+13]<<8;case 13:b=o(b^=t[_+12],M),f^=b=o(b=a(b,18),y);case 12:g^=t[_+11]<<24;case 11:g^=t[_+10]<<16;case 10:g^=t[_+9]<<8;case 9:g=o(g^=t[_+8],w),d^=g=o(g=a(g,17),M);case 8:m^=t[_+7]<<24;case 7:m^=t[_+6]<<16;case 6:m^=t[_+5]<<8;case 5:m=o(m^=t[_+4],v),l^=m=o(m=a(m,16),w);case 4:p^=t[_+3]<<24;case 3:p^=t[_+2]<<16;case 2:p^=t[_+1]<<8;case 1:p=o(p^=t[_],y),c^=p=o(p=a(p,15),v)}return c^=t.length,c+=l^=t.length,c+=d^=t.length,l+=c+=f^=t.length,d+=c,f+=c,c=h(c),c+=l=h(l),c+=d=h(d),l+=c+=f=h(f),d+=c,f+=c,("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(l>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)},n.x64.hash128=function(t,e){if(n.inputValidation&&!s(t))return i;e=e||0;for(var r=t.length%16,o=t.length-r,a=[0,e],h=[0,e],m=[0,0],g=[0,0],b=[2277735313,289559509],y=[1291169091,658871167],v=0;v<o;v+=16)m=[t[v+4]|t[v+5]<<8|t[v+6]<<16|t[v+7]<<24,t[v]|t[v+1]<<8|t[v+2]<<16|t[v+3]<<24],g=[t[v+12]|t[v+13]<<8|t[v+14]<<16|t[v+15]<<24,t[v+8]|t[v+9]<<8|t[v+10]<<16|t[v+11]<<24],m=l(m=c(m,b),31),a=u(a=l(a=f(a,m=c(m,y)),27),h),a=u(c(a,[0,5]),[0,1390208809]),g=l(g=c(g,y),33),h=u(h=l(h=f(h,g=c(g,b)),31),a),h=u(c(h,[0,5]),[0,944331445]);switch(m=[0,0],g=[0,0],r){case 15:g=f(g,d([0,t[v+14]],48));case 14:g=f(g,d([0,t[v+13]],40));case 13:g=f(g,d([0,t[v+12]],32));case 12:g=f(g,d([0,t[v+11]],24));case 11:g=f(g,d([0,t[v+10]],16));case 10:g=f(g,d([0,t[v+9]],8));case 9:g=c(g=f(g,[0,t[v+8]]),y),h=f(h,g=c(g=l(g,33),b));case 8:m=f(m,d([0,t[v+7]],56));case 7:m=f(m,d([0,t[v+6]],48));case 6:m=f(m,d([0,t[v+5]],40));case 5:m=f(m,d([0,t[v+4]],32));case 4:m=f(m,d([0,t[v+3]],24));case 3:m=f(m,d([0,t[v+2]],16));case 2:m=f(m,d([0,t[v+1]],8));case 1:m=c(m=f(m,[0,t[v]]),b),a=f(a,m=c(m=l(m,31),y))}return a=u(a=f(a,[0,t.length]),h=f(h,[0,t.length])),h=u(h,a),a=u(a=p(a),h=p(h)),h=u(h,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(h[0]>>>0).toString(16)).slice(-8)+("00000000"+(h[1]>>>0).toString(16)).slice(-8)},t.exports&&(e=t.exports=n),e.murmurHash3=n}()},5905:function(t,e){(function(){var t,r,i,n,s,o,a,h;h=function(t){return[(t&255<<24)>>>24,(t&255<<16)>>>16,(65280&t)>>>8,255&t].join(".")},a=function(t){var e,i,n,s,o,a;for(e=[],n=s=0;s<=3&&0!==t.length;n=++s){if(n>0){if("."!==t[0])throw new Error("Invalid IP");t=t.substring(1)}o=(a=r(t))[0],i=a[1],t=t.substring(i),e.push(o)}if(0!==t.length)throw new Error("Invalid IP");switch(e.length){case 1:if(e[0]>4294967295)throw new Error("Invalid IP");return e[0]>>>0;case 2:if(e[0]>255||e[1]>16777215)throw new Error("Invalid IP");return(e[0]<<24|e[1])>>>0;case 3:if(e[0]>255||e[1]>255||e[2]>65535)throw new Error("Invalid IP");return(e[0]<<24|e[1]<<16|e[2])>>>0;case 4:if(e[0]>255||e[1]>255||e[2]>255||e[3]>255)throw new Error("Invalid IP");return(e[0]<<24|e[1]<<16|e[2]<<8|e[3])>>>0;default:throw new Error("Invalid IP")}},n=(i=function(t){return t.charCodeAt(0)})("0"),o=i("a"),s=i("A"),r=function(t){var e,r,a,h,u;for(h=0,e=10,r="9",a=0,t.length>1&&"0"===t[a]&&("x"===t[a+1]||"X"===t[a+1]?(a+=2,e=16):"0"<=t[a+1]&&t[a+1]<="9"&&(a++,e=8,r="7")),u=a;a<t.length;){if("0"<=t[a]&&t[a]<=r)h=h*e+(i(t[a])-n)>>>0;else{if(16!==e)break;if("a"<=t[a]&&t[a]<="f")h=h*e+(10+i(t[a])-o)>>>0;else{if(!("A"<=t[a]&&t[a]<="F"))break;h=h*e+(10+i(t[a])-s)>>>0}}if(h>4294967295)throw new Error("too large");a++}if(a===u)throw new Error("empty octet");return[h,a]},t=function(){function t(t,e){var r,i,n;if("string"!=typeof t)throw new Error("Missing `net' parameter");if(e||(n=t.split("/",2),t=n[0],e=n[1]),e||(e=32),"string"==typeof e&&e.indexOf(".")>-1){try{this.maskLong=a(e)}catch(t){throw new Error("Invalid mask: "+e)}for(r=i=32;i>=0;r=--i)if(this.maskLong===4294967295<<32-r>>>0){this.bitmask=r;break}}else{if(!e&&0!==e)throw new Error("Invalid mask: empty");this.bitmask=parseInt(e,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(t)&this.maskLong)>>>0}catch(e){throw new Error("Invalid net address: "+t)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+e);this.size=Math.pow(2,32-this.bitmask),this.base=h(this.netLong),this.mask=h(this.maskLong),this.hostmask=h(~this.maskLong),this.first=this.bitmask<=30?h(this.netLong+1):this.base,this.last=this.bitmask<=30?h(this.netLong+this.size-2):h(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?h(this.netLong+this.size-1):void 0}return t.prototype.contains=function(e){return"string"==typeof e&&(e.indexOf("/")>0||4!==e.split(".").length)&&(e=new t(e)),e instanceof t?this.contains(e.base)&&this.contains(e.broadcast||e.last):(a(e)&this.maskLong)>>>0==(this.netLong&this.maskLong)>>>0},t.prototype.next=function(e){return null==e&&(e=1),new t(h(this.netLong+this.size*e),this.mask)},t.prototype.forEach=function(t){var e,r,i;for(i=a(this.first),r=a(this.last),e=0;i<=r;)t(h(i),i,e),e++,i++},t.prototype.toString=function(){return this.base+"/"+this.bitmask},t}(),e.ip2long=a,e.long2ip=h,e.Netmask=t}).call(this)},3199:(t,e,r)=>{"use strict";var i=r(6879).hp;class n{static isArrayBuffer(t){return"[object ArrayBuffer]"===Object.prototype.toString.call(t)}static toArrayBuffer(t){return this.isArrayBuffer(t)?t:t.byteLength===t.buffer.byteLength||0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:this.toUint8Array(t.buffer).slice(t.byteOffset,t.byteOffset+t.byteLength).buffer}static toUint8Array(t){return this.toView(t,Uint8Array)}static toView(t,e){if(t.constructor===e)return t;if(this.isArrayBuffer(t))return new e(t);if(this.isArrayBufferView(t))return new e(t.buffer,t.byteOffset,t.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(t){return this.isArrayBufferView(t)||this.isArrayBuffer(t)}static isArrayBufferView(t){return ArrayBuffer.isView(t)||t&&this.isArrayBuffer(t.buffer)}static isEqual(t,e){const r=n.toUint8Array(t),i=n.toUint8Array(e);if(r.length!==i.byteLength)return!1;for(let t=0;t<r.length;t++)if(r[t]!==i[t])return!1;return!0}static concat(...t){let e;e=!Array.isArray(t[0])||t[1]instanceof Function?Array.isArray(t[0])&&t[1]instanceof Function?t[0]:t[t.length-1]instanceof Function?t.slice(0,t.length-1):t:t[0];let r=0;for(const t of e)r+=t.byteLength;const i=new Uint8Array(r);let n=0;for(const t of e){const e=this.toUint8Array(t);i.set(e,n),n+=e.length}return t[t.length-1]instanceof Function?this.toView(i,t[t.length-1]):i.buffer}}const s="string",o=/^[0-9a-f\s]+$/i,a=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,h=/^[a-zA-Z0-9-_]+$/;class u{static fromString(t){const e=unescape(encodeURIComponent(t)),r=new Uint8Array(e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r.buffer}static toString(t){const e=n.toUint8Array(t);let r="";for(let t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return decodeURIComponent(escape(r))}}class c{static toString(t,e=!1){const r=n.toArrayBuffer(t),i=new DataView(r);let s="";for(let t=0;t<r.byteLength;t+=2){const r=i.getUint16(t,e);s+=String.fromCharCode(r)}return s}static fromString(t,e=!1){const r=new ArrayBuffer(2*t.length),i=new DataView(r);for(let r=0;r<t.length;r++)i.setUint16(2*r,t.charCodeAt(r),e);return r}}class l{static isHex(t){return typeof t===s&&o.test(t)}static isBase64(t){return typeof t===s&&a.test(t)}static isBase64Url(t){return typeof t===s&&h.test(t)}static ToString(t,e="utf8"){const r=n.toUint8Array(t);switch(e.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return c.toString(r,!0);case"utf16":case"utf16be":return c.toString(r);default:throw new Error(`Unknown type of encoding '${e}'`)}}static FromString(t,e="utf8"){if(!t)return new ArrayBuffer(0);switch(e.toLowerCase()){case"utf8":return this.FromUtf8String(t);case"binary":return this.FromBinary(t);case"hex":return this.FromHex(t);case"base64":return this.FromBase64(t);case"base64url":return this.FromBase64Url(t);case"utf16le":return c.fromString(t,!0);case"utf16":case"utf16be":return c.fromString(t);default:throw new Error(`Unknown type of encoding '${e}'`)}}static ToBase64(t){const e=n.toUint8Array(t);if("undefined"!=typeof btoa){const t=this.ToString(e,"binary");return btoa(t)}return i.from(e).toString("base64")}static FromBase64(t){const e=this.formatString(t);if(!e)return new ArrayBuffer(0);if(!l.isBase64(e))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(e)):new Uint8Array(i.from(e,"base64")).buffer}static FromBase64Url(t){const e=this.formatString(t);if(!e)return new ArrayBuffer(0);if(!l.isBase64Url(e))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(e.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(t){return this.ToBase64(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(t,e=l.DEFAULT_UTF8_ENCODING){switch(e){case"ascii":return this.FromBinary(t);case"utf8":return u.fromString(t);case"utf16":case"utf16be":return c.fromString(t);case"utf16le":case"usc2":return c.fromString(t,!0);default:throw new Error(`Unknown type of encoding '${e}'`)}}static ToUtf8String(t,e=l.DEFAULT_UTF8_ENCODING){switch(e){case"ascii":return this.ToBinary(t);case"utf8":return u.toString(t);case"utf16":case"utf16be":return c.toString(t);case"utf16le":case"usc2":return c.toString(t,!0);default:throw new Error(`Unknown type of encoding '${e}'`)}}static FromBinary(t){const e=t.length,r=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t.charCodeAt(i);return r.buffer}static ToBinary(t){const e=n.toUint8Array(t);let r="";for(let t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}static ToHex(t){const e=n.toUint8Array(t);let r="";const i=e.length;for(let t=0;t<i;t++){const i=e[t];i<16&&(r+="0"),r+=i.toString(16)}return r}static FromHex(t){let e=this.formatString(t);if(!e)return new ArrayBuffer(0);if(!l.isHex(e))throw new TypeError("Argument 'hexString' is not HEX encoded");e.length%2&&(e=`0${e}`);const r=new Uint8Array(e.length/2);for(let t=0;t<e.length;t+=2){const i=e.slice(t,t+2);r[t/2]=parseInt(i,16)}return r.buffer}static ToUtf16String(t,e=!1){return c.toString(t,e)}static FromUtf16String(t,e=!1){return c.fromString(t,e)}static Base64Padding(t){const e=4-t.length%4;if(e<4)for(let r=0;r<e;r++)t+="=";return t}static formatString(t){return(null==t?void 0:t.replace(/[\n\r\t ]/g,""))||""}}l.DEFAULT_UTF8_ENCODING="utf8",e._H=n,e.U$=l},5765:(t,e,r)=>{t.exports=r(8763)},8763:(t,e,r)=>{var i=r(69);e.operation=function(t){var r=e.timeouts(t);return new i(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in t)e[r]=t[r];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],n=0;n<e.retries;n++)i.push(this.createTimeout(n,e));return t&&t.forever&&!i.length&&i.push(this.createTimeout(n,e)),i.sort((function(t,e){return t-e})),i},e.createTimeout=function(t,e){var r=e.randomize?Math.random()+1:1,i=Math.round(r*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return Math.min(i,e.maxTimeout)},e.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i)for(var n in i=[],t)"function"==typeof t[n]&&i.push(n);for(var s=0;s<i.length;s++){var o=i[s],a=t[o];t[o]=function(i){var n=e.operation(r),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push((function(t){n.retry(t)||(t&&(arguments[0]=n.mainError()),o.apply(this,arguments))})),n.attempt((function(){i.apply(t,s)}))}.bind(t,a),t[o].options=r}}},69:t=>{function e(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var i=this;return this._timer=setTimeout((function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout((function(){i._operationTimeoutCb(i._attempts)}),i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)}),r),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},e.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},e.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,r=0,i=0;i<this._errors.length;i++){var n=this._errors[i],s=n.message,o=(t[s]||0)+1;t[s]=o,o>=r&&(e=n,r=o)}return e}},5295:(t,e,r)=>{var i=r(2801).RBTree;function n(t,e,r){this.discrete=!1===t,this.delta=t||.01,this.K=void 0===e?25:e,this.CX=void 0===r?1.1:r,this.centroids=new i(s),this.nreset=0,this.reset()}function s(t,e){return t.mean>e.mean?1:t.mean<e.mean?-1:0}function o(t,e){return t.mean_cumn-e.mean_cumn}function a(t){this.config=t||{},this.mode=this.config.mode||"auto",n.call(this,"cont"===this.mode&&t.delta),this.digest_ratio=this.config.ratio||.9,this.digest_thresh=this.config.thresh||1e3,this.n_unique=0}n.prototype.reset=function(){this.centroids.clear(),this.n=0,this.nreset+=1,this.last_cumulate=0},n.prototype.size=function(){return this.centroids.size},n.prototype.toArray=function(t){var e=[];return t?(this._cumulate(!0),this.centroids.each((function(t){e.push(t)}))):this.centroids.each((function(t){e.push({mean:t.mean,n:t.n})})),e},n.prototype.summary=function(){return[(this.discrete?"exact ":"approximating ")+this.n+" samples using "+this.size()+" centroids","min = "+this.percentile(0),"Q1  = "+this.percentile(.25),"Q2  = "+this.percentile(.5),"Q3  = "+this.percentile(.75),"max = "+this.percentile(1)].join("\n")},n.prototype.push=function(t,e){e=e||1,t=Array.isArray(t)?t:[t];for(var r=0;r<t.length;r++)this._digest(t[r],e)},n.prototype.push_centroid=function(t){t=Array.isArray(t)?t:[t];for(var e=0;e<t.length;e++)this._digest(t[e].mean,t[e].n)},n.prototype._cumulate=function(t){if(!(this.n===this.last_cumulate||!t&&this.CX&&this.CX>this.n/this.last_cumulate)){var e=0;this.centroids.each((function(t){t.mean_cumn=e+t.n/2,e=t.cumn=e+t.n})),this.n=this.last_cumulate=e}},n.prototype.find_nearest=function(t){if(0===this.size())return null;var e=this.centroids.lowerBound({mean:t}),r=null===e.data()?e.prev():e.data();if(r.mean===t||this.discrete)return r;var i=e.prev();return i&&Math.abs(i.mean-t)<Math.abs(r.mean-t)?i:r},n.prototype._new_centroid=function(t,e,r){var i={mean:t,n:e,cumn:r};return this.centroids.insert(i),this.n+=e,i},n.prototype._addweight=function(t,e,r){e!==t.mean&&(t.mean+=r*(e-t.mean)/(t.n+r)),t.cumn+=r,t.mean_cumn+=r/2,t.n+=r,this.n+=r},n.prototype._digest=function(t,e){var r=this.centroids.min(),i=this.centroids.max(),n=this.find_nearest(t);if(n&&n.mean===t)this._addweight(n,t,e);else if(n===r)this._new_centroid(t,e,0);else if(n===i)this._new_centroid(t,e,this.n);else if(this.discrete)this._new_centroid(t,e,n.cumn);else{var s=n.mean_cumn/this.n;Math.floor(4*this.n*this.delta*s*(1-s))-n.n>=e?this._addweight(n,t,e):this._new_centroid(t,e,n.cumn)}this._cumulate(!1),!this.discrete&&this.K&&this.size()>this.K/this.delta&&this.compress()},n.prototype.bound_mean=function(t){var e=this.centroids.upperBound({mean:t}),r=e.prev();return[r,r.mean===t?r:e.next()]},n.prototype.p_rank=function(t){var e=(Array.isArray(t)?t:[t]).map(this._p_rank,this);return Array.isArray(t)?e:e[0]},n.prototype._p_rank=function(t){if(0!==this.size()){if(t<this.centroids.min().mean)return 0;if(t>this.centroids.max().mean)return 1;this._cumulate(!0);var e=this.bound_mean(t),r=e[0],i=e[1];if(this.discrete)return r.cumn/this.n;var n=r.mean_cumn;return r!==i&&(n+=(t-r.mean)*(i.mean_cumn-r.mean_cumn)/(i.mean-r.mean)),n/this.n}},n.prototype.bound_mean_cumn=function(t){this.centroids._comparator=o;var e=this.centroids.upperBound({mean_cumn:t});this.centroids._comparator=s;var r=e.prev();return[r,r&&r.mean_cumn===t?r:e.next()]},n.prototype.percentile=function(t){var e=(Array.isArray(t)?t:[t]).map(this._percentile,this);return Array.isArray(t)?e:e[0]},n.prototype._percentile=function(t){if(0!==this.size()){this._cumulate(!0);var e=this.n*t,r=this.bound_mean_cumn(e),i=r[0],n=r[1];return n===i||null===i||null===n?(i||n).mean:this.discrete?e<=i.cumn?i.mean:n.mean:i.mean+(e-i.mean_cumn)*(n.mean-i.mean)/(n.mean_cumn-i.mean_cumn)}},n.prototype.compress=function(){if(!this.compressing){var t,e,r=this.toArray();for(this.reset(),this.compressing=!0;r.length>0;)this.push_centroid((t=r,void 0,e=Math.floor(Math.random()*t.length),t.splice(e,1)[0]));this._cumulate(!0),this.compressing=!1}},a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.prototype.push=function(t){n.prototype.push.call(this,t),this.check_continuous()},a.prototype._new_centroid=function(t,e,r){this.n_unique+=1,n.prototype._new_centroid.call(this,t,e,r)},a.prototype._addweight=function(t,e,r){1===t.n&&(this.n_unique-=1),n.prototype._addweight.call(this,t,e,r)},a.prototype.check_continuous=function(){return!("auto"!==this.mode||this.size()<this.digest_thresh)&&this.n_unique/this.size()>this.digest_ratio&&(this.mode="cont",this.discrete=!1,this.delta=this.config.delta||.01,this.compress(),!0)},t.exports={TDigest:n,Digest:a}},8982:()=>{},7790:()=>{},3776:()=>{},1638:()=>{},2668:()=>{},7965:()=>{},6089:()=>{},9368:()=>{},4688:()=>{},1069:()=>{},5340:()=>{},9838:()=>{},2186:(t,e,r)=>{"use strict";function i(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(127&i)<<r,!(128&i))return this.assertBounds(),[t,e]}let r=this.buf[this.pos++];if(t|=(15&r)<<28,e=(112&r)>>4,!(128&r))return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(127&i)<<r,!(128&i))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function n(t,e,r){for(let i=0;i<28;i+=7){const n=t>>>i,s=!(n>>>7==0&&0==e),o=255&(s?128|n:n);if(r.push(o),!s)return}const i=t>>>28&15|(7&e)<<4,n=!!(e>>3);if(r.push(255&(n?128|i:i)),n){for(let t=3;t<31;t+=7){const i=e>>>t,n=!(i>>>7==0),s=255&(n?128|i:i);if(r.push(s),!n)return}r.push(e>>>31&1)}}r.d(e,{V5:()=>_,fI:()=>M});const s=4294967296;function o(t){const e="-"===t[0];e&&(t=t.slice(1));const r=1e6;let i=0,n=0;function o(e,o){const a=Number(t.slice(e,o));n*=r,i=i*r+a,i>=s&&(n+=i/s|0,i%=s)}return o(-24,-18),o(-18,-12),o(-12,-6),o(-6),e?u(i,n):h(i,n)}function a(t,e){if(({lo:t,hi:e}=function(t,e){return{lo:t>>>0,hi:e>>>0}}(t,e)),e<=2097151)return String(s*e+t);const r=16777215&(t>>>24|e<<8),i=e>>16&65535;let n=(16777215&t)+6777216*r+6710656*i,o=r+8147497*i,a=2*i;const h=1e7;return n>=h&&(o+=Math.floor(n/h),n%=h),o>=h&&(a+=Math.floor(o/h),o%=h),a.toString()+c(o)+c(n)}function h(t,e){return{lo:0|t,hi:0|e}}function u(t,e){return e=~e,t?t=1+~t:e+=1,h(t,e)}const c=t=>{const e=String(t);return"0000000".slice(e.length)+e};function l(t,e){if(t>=0){for(;t>127;)e.push(127&t|128),t>>>=7;e.push(t)}else{for(let r=0;r<9;r++)e.push(127&t|128),t>>=7;e.push(1)}}function d(){let t=this.buf[this.pos++],e=127&t;if(!(128&t))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(127&t)<<7,!(128&t))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(127&t)<<14,!(128&t))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(127&t)<<21,!(128&t))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(15&t)<<28;for(let e=5;128&t&&e<10;e++)t=this.buf[this.pos++];if(128&t)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var f=r(5606);const p=m();function m(){const t=new DataView(new ArrayBuffer(8));if("function"==typeof BigInt&&"function"==typeof t.getBigInt64&&"function"==typeof t.getBigUint64&&"function"==typeof t.setBigInt64&&"function"==typeof t.setBigUint64&&("object"!=typeof f||"object"!=typeof f.env||"1"!==f.env.BUF_BIGINT_DISABLE)){const e=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),i=BigInt("0"),n=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(t){const i="bigint"==typeof t?t:BigInt(t);if(i>r||i<e)throw new Error(`invalid int64: ${t}`);return i},uParse(t){const e="bigint"==typeof t?t:BigInt(t);if(e>n||e<i)throw new Error(`invalid uint64: ${t}`);return e},enc(e){return t.setBigInt64(0,this.parse(e),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(e){return t.setBigInt64(0,this.uParse(e),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec:(e,r)=>(t.setInt32(0,e,!0),t.setInt32(4,r,!0),t.getBigInt64(0,!0)),uDec:(e,r)=>(t.setInt32(0,e,!0),t.setInt32(4,r,!0),t.getBigUint64(0,!0))}}return{zero:"0",supported:!1,parse:t=>("string"!=typeof t&&(t=t.toString()),g(t),t),uParse:t=>("string"!=typeof t&&(t=t.toString()),b(t),t),enc:t=>("string"!=typeof t&&(t=t.toString()),g(t),o(t)),uEnc:t=>("string"!=typeof t&&(t=t.toString()),b(t),o(t)),dec:(t,e)=>function(t,e){let r=h(t,e);const i=2147483648&r.hi;i&&(r=u(r.lo,r.hi));const n=a(r.lo,r.hi);return i?"-"+n:n}(t,e),uDec:(t,e)=>a(t,e)}}function g(t){if(!/^-?[0-9]+$/.test(t))throw new Error("invalid int64: "+t)}function b(t){if(!/^[0-9]+$/.test(t))throw new Error("invalid uint64: "+t)}const y=Symbol.for("@bufbuild/protobuf/text-encoding");function v(){if(null==globalThis[y]){const t=new globalThis.TextEncoder,e=new globalThis.TextDecoder;globalThis[y]={encodeUtf8:e=>t.encode(e),decodeUtf8:t=>e.decode(t),checkUtf8(t){try{return encodeURIComponent(t),!0}catch(t){return!1}}}}return globalThis[y]}var w;!function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"}(w||(w={}));class M{constructor(t=v().encodeUtf8){this.encodeUtf8=t,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let t=0;for(let e=0;e<this.chunks.length;e++)t+=this.chunks[e].length;let e=new Uint8Array(t),r=0;for(let t=0;t<this.chunks.length;t++)e.set(this.chunks[t],r),r+=this.chunks[t].length;return this.chunks=[],e}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,e){return this.uint32((t<<3|e)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(E(t);t>127;)this.buf.push(127&t|128),t>>>=7;return this.buf.push(t),this}int32(t){return S(t),l(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let e=this.encodeUtf8(t);return this.uint32(e.byteLength),this.raw(e)}float(t){!function(t){if("string"==typeof t){const e=t;if(t=Number(t),isNaN(t)&&"NaN"!==e)throw new Error("invalid float32: "+e)}else if("number"!=typeof t)throw new Error("invalid float32: "+typeof t);if(Number.isFinite(t)&&(t>34028234663852886e22||t<-34028234663852886e22))throw new Error("invalid float32: "+t)}(t);let e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,t,!0),this.raw(e)}double(t){let e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t,!0),this.raw(e)}fixed32(t){E(t);let e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t,!0),this.raw(e)}sfixed32(t){S(t);let e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,t,!0),this.raw(e)}sint32(t){return S(t),l(t=(t<<1^t>>31)>>>0,this.buf),this}sfixed64(t){let e=new Uint8Array(8),r=new DataView(e.buffer),i=p.enc(t);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(e)}fixed64(t){let e=new Uint8Array(8),r=new DataView(e.buffer),i=p.uEnc(t);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(e)}int64(t){let e=p.enc(t);return n(e.lo,e.hi,this.buf),this}sint64(t){let e=p.enc(t),r=e.hi>>31;return n(e.lo<<1^r,(e.hi<<1|e.lo>>>31)^r,this.buf),this}uint64(t){let e=p.uEnc(t);return n(e.lo,e.hi,this.buf),this}}class _{constructor(t,e=v().decodeUtf8){this.decodeUtf8=e,this.varint64=i,this.uint32=d,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength)}tag(){let t=this.uint32(),e=t>>>3,r=7&t;if(e<=0||r<0||r>5)throw new Error("illegal tag: field no "+e+" wire type "+r);return[e,r]}skip(t,e){let r=this.pos;switch(t){case w.Varint:for(;128&this.buf[this.pos++];);break;case w.Bit64:this.pos+=4;case w.Bit32:this.pos+=4;break;case w.LengthDelimited:let r=this.uint32();this.pos+=r;break;case w.StartGroup:for(;;){const[t,r]=this.tag();if(r===w.EndGroup){if(void 0!==e&&t!==e)throw new Error("invalid end group tag");break}this.skip(r,t)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return 0|this.uint32()}sint32(){let t=this.uint32();return t>>>1^-(1&t)}int64(){return p.dec(...this.varint64())}uint64(){return p.uDec(...this.varint64())}sint64(){let[t,e]=this.varint64(),r=-(1&t);return t=(t>>>1|(1&e)<<31)^r,e=e>>>1^r,p.dec(t,e)}bool(){let[t,e]=this.varint64();return 0!==t||0!==e}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return p.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return p.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),e=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(e,e+t)}string(){return this.decodeUtf8(this.bytes())}}function S(t){if("string"==typeof t)t=Number(t);else if("number"!=typeof t)throw new Error("invalid int32: "+typeof t);if(!Number.isInteger(t)||t>2147483647||t<-2147483648)throw new Error("invalid int32: "+t)}function E(t){if("string"==typeof t)t=Number(t);else if("number"!=typeof t)throw new Error("invalid uint32: "+typeof t);if(!Number.isInteger(t)||t>4294967295||t<0)throw new Error("invalid uint32: "+t)}},3280:(t,e,r)=>{"use strict";r.d(e,{V:()=>s});var i=r(5808),n=r(9085);class s{log;constructor(t,e){this.log=i.getLogger(t),this.log.setLevel(e?.level||"info"),n.reg(i),n.apply(this.log,{template:"%n"});for(const t of Object.keys(this.log)){const e=this.log[t];"function"==typeof e&&(this[t]=e.bind(this.log))}}}},6436:(t,e,r)=>{"use strict";r.r(e),r.d(e,{DRPNode:()=>vS,log:()=>yS});var i={};r.r(i),r.d(i,{base58btc:()=>ct,base58flickr:()=>lt});var n={};r.r(n),r.d(n,{base32:()=>dt,base32hex:()=>gt,base32hexpad:()=>yt,base32hexpadupper:()=>vt,base32hexupper:()=>bt,base32pad:()=>pt,base32padupper:()=>mt,base32upper:()=>ft,base32z:()=>wt});var s={};r.r(s),r.d(s,{base36:()=>Mt,base36upper:()=>_t});var o={};r.r(o),r.d(o,{identity:()=>Qt});var a={};r.r(a),r.d(a,{aK:()=>$e,e8:()=>Ce,DO:()=>xe,dJ:()=>We,OG:()=>Ke,My:()=>Pe,Ph:()=>Oe,lX:()=>Ue,Id:()=>qe,fg:()=>Ye,qj:()=>Ve,aT:()=>Le,r4:()=>He,aY:()=>Ie,x:()=>Qe,lq:()=>Fe,z:()=>je,zW:()=>Be,Q5:()=>Xe});var h={};r.r(h),r.d(h,{base10:()=>Pi});var u={};r.r(u),r.d(u,{base16:()=>Bi,base16upper:()=>Ri});var c={};r.r(c),r.d(c,{base2:()=>Di});var l={};r.r(l),r.d(l,{base256emoji:()=>Ui});var d={};r.r(d),r.d(d,{base64:()=>Fi,base64pad:()=>ji,base64url:()=>Vi,base64urlpad:()=>qi});var f={};r.r(f),r.d(f,{base8:()=>zi});var p={};r.r(p),r.d(p,{identity:()=>Hi});var m={};r.r(m),r.d(m,{code:()=>Gi,decode:()=>Yi,encode:()=>Zi,name:()=>Ki});var g={};r.r(g),r.d(g,{code:()=>Xi,decode:()=>tn,encode:()=>Qi,name:()=>Ji});var b={};r.r(b),r.d(b,{sha256:()=>sn,sha512:()=>on});var y=r(3280);class v extends EventTarget{#t=new Map;constructor(){super()}listenerCount(t){const e=this.#t.get(t);return null==e?0:e.length}addEventListener(t,e,r){super.addEventListener(t,e,r);let i=this.#t.get(t);null==i&&(i=[],this.#t.set(t,i)),i.push({callback:e,once:(!0!==r&&!1!==r&&r?.once)??!1})}removeEventListener(t,e,r){super.removeEventListener(t.toString(),e??null,r);let i=this.#t.get(t);null!=i&&(i=i.filter((({callback:t})=>t!==e)),this.#t.set(t,i))}dispatchEvent(t){const e=super.dispatchEvent(t);let r=this.#t.get(t.type);return null==r||(r=r.filter((({once:t})=>!t)),this.#t.set(t.type,r)),e}safeDispatchEvent(t,e={}){return this.dispatchEvent(new CustomEvent(t,e))}}const w="StrictSign",M="StrictNoSign";var _;!function(t){t.Accept="accept",t.Ignore="ignore",t.Reject="reject"}(_||(_={}));const S=Symbol.for("@libp2p/pubsub");function E(t){return Boolean(t?.[S])}const k=Symbol.for("@libp2p/service-capabilities"),A=Symbol.for("@libp2p/service-dependencies");class I extends Error{static name="AbortError";constructor(t="The operation was aborted"){super(t),this.name="AbortError"}}class x extends Error{static name="UnexpectedPeerError";constructor(t="Unexpected Peer"){super(t),this.name="UnexpectedPeerError"}}class C extends Error{static name="InvalidCryptoExchangeError";constructor(t="Invalid crypto exchange"){super(t),this.name="InvalidCryptoExchangeError"}}class T extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}}class P extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}}class B extends Error{static name="InvalidPrivateKeyError";constructor(t="Invalid private key"){super(t),this.name="InvalidPrivateKeyError"}}Error;class R extends Error{static name="ConnectionClosingError";constructor(t="The connection is closing"){super(t),this.name="ConnectionClosingError"}}class D extends Error{static name="ConnectionClosedError";constructor(t="The connection is closed"){super(t),this.name="ConnectionClosedError"}}class N extends Error{static name="ConnectionFailedError";constructor(t="Connection failed"){super(t),this.name="ConnectionFailedError"}}class L extends Error{static name="MuxerClosedError";constructor(t="The muxer is closed"){super(t),this.name="MuxerClosedError"}}class O extends Error{static name="StreamResetError";constructor(t="The stream has been reset"){super(t),this.name="StreamResetError"}}class U extends Error{static name="StreamStateError";constructor(t="The stream is in an invalid state"){super(t),this.name="StreamStateError"}}class F extends Error{static name="NotFoundError";constructor(t="Not found"){super(t),this.name="NotFoundError"}}class j extends Error{static name="InvalidPeerIdError";constructor(t="Invalid PeerID"){super(t),this.name="InvalidPeerIdError"}}class V extends Error{static name="InvalidMultiaddrError";constructor(t="Invalid multiaddr"){super(t),this.name="InvalidMultiaddrError"}}class q extends Error{static name="InvalidCIDError";constructor(t="Invalid CID"){super(t),this.name="InvalidCIDError"}}class z extends Error{static name="InvalidMultihashError";constructor(t="Invalid Multihash"){super(t),this.name="InvalidMultihashError"}}class H extends Error{static name="UnsupportedProtocolError";constructor(t="Unsupported protocol error"){super(t),this.name="UnsupportedProtocolError"}}class $ extends Error{static name="InvalidMessageError";constructor(t="Invalid message"){super(t),this.name="InvalidMessageError"}}Error;class W extends Error{static name="TimeoutError";constructor(t="Timed out"){super(t),this.name="TimeoutError"}}class K extends Error{static name="NotStartedError";constructor(t="Not started"){super(t),this.name="NotStartedError"}}Error;class G extends Error{static name="DialError";constructor(t="Dial error"){super(t),this.name="DialError"}}class Z extends Error{static name="ListenError";constructor(t="Listen error"){super(t),this.name="ListenError"}}class Y extends Error{static name="LimitedConnectionError";constructor(t="Limited connection"){super(t),this.name="LimitedConnectionError"}}class J extends Error{static name="TooManyInboundProtocolStreamsError";constructor(t="Too many inbound protocol streams"){super(t),this.name="TooManyInboundProtocolStreamsError"}}class X extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(t="Too many outbound protocol streams"){super(t),this.name="TooManyOutboundProtocolStreamsError"}}class Q extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}}function tt(t){if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")}new Uint8Array(0);const et=function(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),o=s.charCodeAt(0);if(255!==r[o])throw new TypeError(s+" is ambiguous");r[o]=n}var a=t.length,h=t.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function l(t){if("string"!=typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;var e=0;if(" "!==t[e]){for(var i=0,n=0;t[e]===h;)i++,e++;for(var s=(t.length-e)*u+1>>>0,o=new Uint8Array(s);t[e];){var c=r[t.charCodeAt(e)];if(255===c)return;for(var l=0,d=s-1;(0!==c||l<n)&&-1!==d;d--,l++)c+=a*o[d]>>>0,o[d]=c%256>>>0,c=c/256>>>0;if(0!==c)throw new Error("Non-zero carry");n=l,e++}if(" "!==t[e]){for(var f=s-n;f!==s&&0===o[f];)f++;for(var p=new Uint8Array(i+(s-f)),m=i;f!==s;)p[m++]=o[f++];return p}}}return{encode:function(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";for(var r=0,i=0,n=0,s=e.length;n!==s&&0===e[n];)n++,r++;for(var o=(s-n)*c+1>>>0,u=new Uint8Array(o);n!==s;){for(var l=e[n],d=0,f=o-1;(0!==l||d<i)&&-1!==f;f--,d++)l+=256*u[f]>>>0,u[f]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");i=d,n++}for(var p=o-i;p!==o&&0===u[p];)p++;for(var m=h.repeat(r);p<o;++p)m+=t.charAt(u[p]);return m},decodeUnsafe:l,decode:function(t){var r=l(t);if(r)return r;throw new Error(`Non-${e} character`)}}};class rt{name;prefix;baseEncode;constructor(t,e,r){this.name=t,this.prefix=e,this.baseEncode=r}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class it{name;prefix;baseDecode;prefixCodePoint;constructor(t,e,r){this.name=t,this.prefix=e;const i=e.codePointAt(0);if(void 0===i)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=r}decode(t){if("string"==typeof t){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(t){return st(this,t)}}class nt{decoders;constructor(t){this.decoders=t}or(t){return st(this,t)}decode(t){const e=t[0],r=this.decoders[e];if(null!=r)return r.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function st(t,e){return new nt({...t.decoders??{[t.prefix]:t},...e.decoders??{[e.prefix]:e}})}class ot{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,e,r,i){this.name=t,this.prefix=e,this.baseEncode=r,this.baseDecode=i,this.encoder=new rt(t,e,r),this.decoder=new it(t,e,i)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}function at({name:t,prefix:e,encode:r,decode:i}){return new ot(t,e,r,i)}function ht({name:t,prefix:e,alphabet:r}){const{encode:i,decode:n}=et(r,t);return at({prefix:e,name:t,encode:i,decode:t=>tt(n(t))})}function ut({name:t,prefix:e,bitsPerChar:r,alphabet:i}){return at({prefix:e,name:t,encode:t=>function(t,e,r){const i="="===e[e.length-1],n=(1<<r)-1;let s="",o=0,a=0;for(let i=0;i<t.length;++i)for(a=a<<8|t[i],o+=8;o>r;)o-=r,s+=e[n&a>>o];if(0!==o&&(s+=e[n&a<<r-o]),i)for(;s.length*r&7;)s+="=";return s}(t,i,r),decode:e=>function(t,e,r,i){const n={};for(let t=0;t<e.length;++t)n[e[t]]=t;let s=t.length;for(;"="===t[s-1];)--s;const o=new Uint8Array(s*r/8|0);let a=0,h=0,u=0;for(let e=0;e<s;++e){const s=n[t[e]];if(void 0===s)throw new SyntaxError(`Non-${i} character`);h=h<<r|s,a+=r,a>=8&&(a-=8,o[u++]=255&h>>a)}if(a>=r||255&h<<8-a)throw new SyntaxError("Unexpected end of data");return o}(e,i,r,t)})}const ct=ht({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),lt=ht({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),dt=ut({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ft=ut({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pt=ut({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),mt=ut({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),gt=ut({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),bt=ut({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yt=ut({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vt=ut({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),wt=ut({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Mt=ht({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_t=ht({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var St=128,Et=-128,kt=Math.pow(2,31),At=128,It=127,xt=Math.pow(2,7),Ct=Math.pow(2,14),Tt=Math.pow(2,21),Pt=Math.pow(2,28),Bt=Math.pow(2,35),Rt=Math.pow(2,42),Dt=Math.pow(2,49),Nt=Math.pow(2,56),Lt=Math.pow(2,63);const Ot={encode:function t(e,r,i){r=r||[];for(var n=i=i||0;e>=kt;)r[i++]=255&e|St,e/=128;for(;e&Et;)r[i++]=255&e|St,e>>>=7;return r[i]=0|e,t.bytes=i-n+1,r},decode:function t(e,r){var i,n=0,s=0,o=r=r||0,a=e.length;do{if(o>=a)throw t.bytes=0,new RangeError("Could not decode varint");i=e[o++],n+=s<28?(i&It)<<s:(i&It)*Math.pow(2,s),s+=7}while(i>=At);return t.bytes=o-r,n},encodingLength:function(t){return t<xt?1:t<Ct?2:t<Tt?3:t<Pt?4:t<Bt?5:t<Rt?6:t<Dt?7:t<Nt?8:t<Lt?9:10}};function Ut(t,e=0){return[Ot.decode(t,e),Ot.decode.bytes]}function Ft(t,e,r=0){return Ot.encode(t,e,r),e}function jt(t){return Ot.encodingLength(t)}function Vt(t,e){const r=e.byteLength,i=jt(t),n=i+jt(r),s=new Uint8Array(n+r);return Ft(t,s,0),Ft(r,s,i),s.set(e,n),new zt(t,r,e,s)}function qt(t){const e=tt(t),[r,i]=Ut(e),[n,s]=Ut(e.subarray(i)),o=e.subarray(i+s);if(o.byteLength!==n)throw new Error("Incorrect length");return new zt(r,n,o,e)}class zt{code;size;digest;bytes;constructor(t,e,r,i){this.code=t,this.size=e,this.digest=r,this.bytes=i}}function Ht(t,e){const{bytes:r,version:i}=t;return 0===i?function(t,e,r){const{prefix:i}=r;if(i!==ct.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const n=e.get(i);if(null==n){const n=r.encode(t).slice(1);return e.set(i,n),n}return n}(r,Wt(t),e??ct.encoder):function(t,e,r){const{prefix:i}=r,n=e.get(i);if(null==n){const n=r.encode(t);return e.set(i,n),n}return n}(r,Wt(t),e??dt.encoder)}const $t=new WeakMap;function Wt(t){const e=$t.get(t);if(null==e){const e=new Map;return $t.set(t,e),e}return e}class Kt{code;version;multihash;bytes;"/";constructor(t,e,r,i){this.code=e,this.version=t,this.multihash=r,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:t,multihash:e}=this;if(t!==Gt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==Zt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Kt.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:t,digest:e}=this.multihash,r=Vt(t,e);return Kt.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return Kt.equals(this,t)}static equals(t,e){const r=e;return null!=r&&t.code===r.code&&t.version===r.version&&function(t,e){if(t===e)return!0;{const r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&function(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}(t.bytes,r.bytes)}}(t.multihash,r.multihash)}toString(t){return Ht(this,t)}toJSON(){return{"/":Ht(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(null==t)return null;const e=t;if(e instanceof Kt)return e;if(null!=e["/"]&&e["/"]===e.bytes||e.asCID===e){const{version:t,code:r,multihash:i,bytes:n}=e;return new Kt(t,r,i,n??Yt(t,r,i.bytes))}if(!0===e[Jt]){const{version:t,multihash:r,code:i}=e,n=qt(r);return Kt.create(t,i,n)}return null}static create(t,e,r){if("number"!=typeof e)throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:if(e!==Gt)throw new Error(`Version 0 CID must use dag-pb (code: ${Gt}) block encoding`);return new Kt(t,e,r,r.bytes);case 1:{const i=Yt(t,e,r.bytes);return new Kt(t,e,r,i)}default:throw new Error("Invalid version")}}static createV0(t){return Kt.create(0,Gt,t)}static createV1(t,e){return Kt.create(1,t,e)}static decode(t){const[e,r]=Kt.decodeFirst(t);if(0!==r.length)throw new Error("Incorrect length");return e}static decodeFirst(t){const e=Kt.inspectBytes(t),r=e.size-e.multihashSize,i=tt(t.subarray(r,r+e.multihashSize));if(i.byteLength!==e.multihashSize)throw new Error("Incorrect length");const n=i.subarray(e.multihashSize-e.digestSize),s=new zt(e.multihashCode,e.digestSize,n,i);return[0===e.version?Kt.createV0(s):Kt.createV1(e.codec,s),t.subarray(e.size)]}static inspectBytes(t){let e=0;const r=()=>{const[r,i]=Ut(t.subarray(e));return e+=i,r};let i=r(),n=Gt;if(18===i?(i=0,e=0):n=r(),0!==i&&1!==i)throw new RangeError(`Invalid CID version ${i}`);const s=e,o=r(),a=r(),h=e+a;return{version:i,codec:n,multihashCode:o,digestSize:a,multihashSize:h-s,size:h}}static parse(t,e){const[r,i]=function(t,e){switch(t[0]){case"Q":{const r=e??ct;return[ct.prefix,r.decode(`${ct.prefix}${t}`)]}case ct.prefix:{const r=e??ct;return[ct.prefix,r.decode(t)]}case dt.prefix:{const r=e??dt;return[dt.prefix,r.decode(t)]}case Mt.prefix:{const r=e??Mt;return[Mt.prefix,r.decode(t)]}default:if(null==e)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}(t,e),n=Kt.decode(i);if(0===n.version&&"Q"!==t[0])throw Error("Version 0 CID string must not include multibase prefix");return Wt(n).set(r,t),n}}const Gt=112,Zt=18;function Yt(t,e,r){const i=jt(t),n=i+jt(e),s=new Uint8Array(n+r.byteLength);return Ft(t,s,0),Ft(e,s,i),s.set(r,n),s}const Jt=Symbol.for("@ipld/js-cid/CID"),Xt=tt,Qt={code:0,name:"identity",encode:Xt,digest:function(t){return Vt(0,Xt(t))}};function te(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}function ee(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function re(t,...e){if(!((r=t)instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name))throw new Error("Uint8Array expected");var r;if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ie(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const ne="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,se=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),oe=(t,e)=>t<<32-e|t>>>e;function ae(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),re(t),t}class he{clone(){return this._cloneInto()}}function ue(t){const e=e=>t().update(ae(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function ce(t=32){if(ne&&"function"==typeof ne.getRandomValues)return ne.getRandomValues(new Uint8Array(t));if(ne&&"function"==typeof ne.randomBytes)return ne.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}const le=(t,e,r)=>t&e^t&r^e&r;class de extends he{constructor(t,e,r,i){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=se(this.buffer)}update(t){ie(this);const{view:e,buffer:r,blockLen:i}=this,n=(t=ae(t)).length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o!==i)r.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(e,0),this.pos=0);else{const e=se(t);for(;i<=n-s;s+=i)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){ie(this),function(t,e){re(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:i,isLE:n}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let t=s;t<i;t++)e[t]=0;!function(t,e,r,i){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),h=i?4:0,u=i?0:4;t.setUint32(e+h,o,i),t.setUint32(e+u,a,i)}(r,i-8,BigInt(8*this.length),n),this.process(r,0);const o=se(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=a/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<h;t++)o.setUint32(4*t,u[t],n)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:i,finished:n,destroyed:s,pos:o}=this;return t.length=i,t.pos=o,t.finished=n,t.destroyed=s,i%e&&t.buffer.set(r),t}}const fe=BigInt(2**32-1),pe=BigInt(32);function me(t,e=!1){return e?{h:Number(t&fe),l:Number(t>>pe&fe)}:{h:0|Number(t>>pe&fe),l:0|Number(t&fe)}}const ge={fromBig:me,split:function(t,e=!1){let r=new Uint32Array(t.length),i=new Uint32Array(t.length);for(let n=0;n<t.length;n++){const{h:s,l:o}=me(t[n],e);[r[n],i[n]]=[s,o]}return[r,i]},toBig:(t,e)=>BigInt(t>>>0)<<pe|BigInt(e>>>0),shrSH:(t,e,r)=>t>>>r,shrSL:(t,e,r)=>t<<32-r|e>>>r,rotrSH:(t,e,r)=>t>>>r|e<<32-r,rotrSL:(t,e,r)=>t<<32-r|e>>>r,rotrBH:(t,e,r)=>t<<64-r|e>>>r-32,rotrBL:(t,e,r)=>t>>>r-32|e<<64-r,rotr32H:(t,e)=>e,rotr32L:(t,e)=>t,rotlSH:(t,e,r)=>t<<r|e>>>32-r,rotlSL:(t,e,r)=>e<<r|t>>>32-r,rotlBH:(t,e,r)=>e<<r-32|t>>>64-r,rotlBL:(t,e,r)=>t<<r-32|e>>>64-r,add:function(t,e,r,i){const n=(e>>>0)+(i>>>0);return{h:t+r+(n/2**32|0)|0,l:0|n}},add3L:(t,e,r)=>(t>>>0)+(e>>>0)+(r>>>0),add3H:(t,e,r,i)=>e+r+i+(t/2**32|0)|0,add4L:(t,e,r,i)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0),add4H:(t,e,r,i,n)=>e+r+i+n+(t/2**32|0)|0,add5H:(t,e,r,i,n,s)=>e+r+i+n+s+(t/2**32|0)|0,add5L:(t,e,r,i,n)=>(t>>>0)+(e>>>0)+(r>>>0)+(i>>>0)+(n>>>0)},be=ge,[ye,ve]=(()=>be.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((t=>BigInt(t)))))(),we=new Uint32Array(80),Me=new Uint32Array(80);class _e extends de{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:r,Bl:i,Ch:n,Cl:s,Dh:o,Dl:a,Eh:h,El:u,Fh:c,Fl:l,Gh:d,Gl:f,Hh:p,Hl:m}=this;return[t,e,r,i,n,s,o,a,h,u,c,l,d,f,p,m]}set(t,e,r,i,n,s,o,a,h,u,c,l,d,f,p,m){this.Ah=0|t,this.Al=0|e,this.Bh=0|r,this.Bl=0|i,this.Ch=0|n,this.Cl=0|s,this.Dh=0|o,this.Dl=0|a,this.Eh=0|h,this.El=0|u,this.Fh=0|c,this.Fl=0|l,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|m}process(t,e){for(let r=0;r<16;r++,e+=4)we[r]=t.getUint32(e),Me[r]=t.getUint32(e+=4);for(let t=16;t<80;t++){const e=0|we[t-15],r=0|Me[t-15],i=be.rotrSH(e,r,1)^be.rotrSH(e,r,8)^be.shrSH(e,r,7),n=be.rotrSL(e,r,1)^be.rotrSL(e,r,8)^be.shrSL(e,r,7),s=0|we[t-2],o=0|Me[t-2],a=be.rotrSH(s,o,19)^be.rotrBH(s,o,61)^be.shrSH(s,o,6),h=be.rotrSL(s,o,19)^be.rotrBL(s,o,61)^be.shrSL(s,o,6),u=be.add4L(n,h,Me[t-7],Me[t-16]),c=be.add4H(u,i,a,we[t-7],we[t-16]);we[t]=0|c,Me[t]=0|u}let{Ah:r,Al:i,Bh:n,Bl:s,Ch:o,Cl:a,Dh:h,Dl:u,Eh:c,El:l,Fh:d,Fl:f,Gh:p,Gl:m,Hh:g,Hl:b}=this;for(let t=0;t<80;t++){const e=be.rotrSH(c,l,14)^be.rotrSH(c,l,18)^be.rotrBH(c,l,41),y=be.rotrSL(c,l,14)^be.rotrSL(c,l,18)^be.rotrBL(c,l,41),v=c&d^~c&p,w=l&f^~l&m,M=be.add5L(b,y,w,ve[t],Me[t]),_=be.add5H(M,g,e,v,ye[t],we[t]),S=0|M,E=be.rotrSH(r,i,28)^be.rotrBH(r,i,34)^be.rotrBH(r,i,39),k=be.rotrSL(r,i,28)^be.rotrBL(r,i,34)^be.rotrBL(r,i,39),A=r&n^r&o^n&o,I=i&s^i&a^s&a;g=0|p,b=0|m,p=0|d,m=0|f,d=0|c,f=0|l,({h:c,l}=be.add(0|h,0|u,0|_,0|S)),h=0|o,u=0|a,o=0|n,a=0|s,n=0|r,s=0|i;const x=be.add3L(S,k,I);r=be.add3H(x,_,E,A),i=0|x}({h:r,l:i}=be.add(0|this.Ah,0|this.Al,0|r,0|i)),({h:n,l:s}=be.add(0|this.Bh,0|this.Bl,0|n,0|s)),({h:o,l:a}=be.add(0|this.Ch,0|this.Cl,0|o,0|a)),({h,l:u}=be.add(0|this.Dh,0|this.Dl,0|h,0|u)),({h:c,l}=be.add(0|this.Eh,0|this.El,0|c,0|l)),({h:d,l:f}=be.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:m}=be.add(0|this.Gh,0|this.Gl,0|p,0|m)),({h:g,l:b}=be.add(0|this.Hh,0|this.Hl,0|g,0|b)),this.set(r,i,n,s,o,a,h,u,c,l,d,f,p,m,g,b)}roundClean(){we.fill(0),Me.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Se=ue((()=>new _e)),Ee=BigInt(0),ke=BigInt(1),Ae=BigInt(2);function Ie(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function xe(t){if(!Ie(t))throw new Error("Uint8Array expected")}function Ce(t,e){if("boolean"!=typeof e)throw new Error(t+" boolean expected, got "+e)}const Te=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Pe(t){xe(t);let e="";for(let r=0;r<t.length;r++)e+=Te[t[r]];return e}function Be(t){const e=t.toString(16);return 1&e.length?"0"+e:e}function Re(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return""===t?Ee:BigInt("0x"+t)}const De={_0:48,_9:57,A:65,F:70,a:97,f:102};function Ne(t){return t>=De._0&&t<=De._9?t-De._0:t>=De.A&&t<=De.F?t-(De.A-10):t>=De.a&&t<=De.f?t-(De.a-10):void 0}function Le(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(r);for(let e=0,n=0;e<r;e++,n+=2){const r=Ne(t.charCodeAt(n)),s=Ne(t.charCodeAt(n+1));if(void 0===r||void 0===s){const e=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+n)}i[e]=16*r+s}return i}function Oe(t){return Re(Pe(t))}function Ue(t){return xe(t),Re(Pe(Uint8Array.from(t).reverse()))}function Fe(t,e){return Le(t.toString(16).padStart(2*e,"0"))}function je(t,e){return Fe(t,e).reverse()}function Ve(t,e,r){let i;if("string"==typeof e)try{i=Le(e)}catch(e){throw new Error(t+" must be hex string or Uint8Array, cause: "+e)}else{if(!Ie(e))throw new Error(t+" must be hex string or Uint8Array");i=Uint8Array.from(e)}const n=i.length;if("number"==typeof r&&n!==r)throw new Error(t+" of length "+r+" expected, got "+n);return i}function qe(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];xe(i),e+=i.length}const r=new Uint8Array(e);for(let e=0,i=0;e<t.length;e++){const n=t[e];r.set(n,i),i+=n.length}return r}const ze=t=>"bigint"==typeof t&&Ee<=t;function He(t,e,r){return ze(t)&&ze(e)&&ze(r)&&e<=t&&t<r}function $e(t,e,r,i){if(!He(e,r,i))throw new Error("expected valid "+t+": "+r+" <= n < "+i+", got "+e)}function We(t){let e;for(e=0;t>Ee;t>>=ke,e+=1);return e}const Ke=t=>(Ae<<BigInt(t-1))-ke,Ge=t=>new Uint8Array(t),Ze=t=>Uint8Array.from(t);function Ye(t,e,r){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof r)throw new Error("hmacFn must be a function");let i=Ge(t),n=Ge(t),s=0;const o=()=>{i.fill(1),n.fill(0),s=0},a=(...t)=>r(n,i,...t),h=(t=Ge())=>{n=a(Ze([0]),t),i=a(),0!==t.length&&(n=a(Ze([1]),t),i=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const r=[];for(;t<e;){i=a();const e=i.slice();r.push(e),t+=i.length}return qe(...r)};return(t,e)=>{let r;for(o(),h(t);!(r=e(u()));)h();return o(),r}}const Je={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||Ie(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Xe(t,e,r={}){const i=(e,r,i)=>{const n=Je[r];if("function"!=typeof n)throw new Error("invalid validator function");const s=t[e];if(!(i&&void 0===s||n(s,t)))throw new Error("param "+String(e)+" is invalid. Expected "+r+", got "+s)};for(const[t,r]of Object.entries(e))i(t,r,!1);for(const[t,e]of Object.entries(r))i(t,e,!0);return t}function Qe(t){const e=new WeakMap;return(r,...i)=>{const n=e.get(r);if(void 0!==n)return n;const s=t(r,...i);return e.set(r,s),s}}const tr=BigInt(0),er=BigInt(1),rr=BigInt(2),ir=BigInt(3),nr=BigInt(4),sr=BigInt(5),or=BigInt(8);function ar(t,e){const r=t%e;return r>=tr?r:e+r}function hr(t,e,r){if(e<tr)throw new Error("invalid exponent, negatives unsupported");if(r<=tr)throw new Error("invalid modulus");if(r===er)return tr;let i=er;for(;e>tr;)e&er&&(i=i*t%r),t=t*t%r,e>>=er;return i}function ur(t,e,r){let i=t;for(;e-- >tr;)i*=i,i%=r;return i}function cr(t,e){if(t===tr)throw new Error("invert: expected non-zero number");if(e<=tr)throw new Error("invert: expected positive modulus, got "+e);let r=ar(t,e),i=e,n=tr,s=er,o=er,a=tr;for(;r!==tr;){const t=i/r,e=i%r,h=n-o*t,u=s-a*t;i=r,r=e,n=o,s=a,o=h,a=u}if(i!==er)throw new Error("invert: does not exist");return ar(n,e)}const lr=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function dr(t,e){const r=void 0!==e?e:t.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function fr(t,e,r=!1,i={}){if(t<=tr)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:n,nByteLength:s}=dr(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,BITS:n,BYTES:s,MASK:Ke(n),ZERO:tr,ONE:er,create:e=>ar(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("invalid field element: expected bigint, got "+typeof e);return tr<=e&&e<t},is0:t=>t===tr,isOdd:t=>(t&er)===er,neg:e=>ar(-e,t),eql:(t,e)=>t===e,sqr:e=>ar(e*e,t),add:(e,r)=>ar(e+r,t),sub:(e,r)=>ar(e-r,t),mul:(e,r)=>ar(e*r,t),pow:(t,e)=>function(t,e,r){if(r<tr)throw new Error("invalid exponent, negatives unsupported");if(r===tr)return t.ONE;if(r===er)return e;let i=t.ONE,n=e;for(;r>tr;)r&er&&(i=t.mul(i,n)),n=t.sqr(n),r>>=er;return i}(a,t,e),div:(e,r)=>ar(e*cr(r,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>cr(e,t),sqrt:i.sqrt||(e=>(o||(o=function(t){if(t%nr===ir){const e=(t+er)/nr;return function(t,r){const i=t.pow(r,e);if(!t.eql(t.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%or===sr){const e=(t-sr)/or;return function(t,r){const i=t.mul(r,rr),n=t.pow(i,e),s=t.mul(r,n),o=t.mul(t.mul(s,rr),n),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),r))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-er)/rr;let r,i,n;for(r=t-er,i=0;r%rr===tr;r/=rr,i++);for(n=rr;n<t&&hr(n,e,t)!==t-er;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===i){const e=(t+er)/nr;return function(t,r){const i=t.pow(r,e);if(!t.eql(t.sqr(i),r))throw new Error("Cannot find square root");return i}}const s=(r+er)/rr;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=i,h=t.pow(t.mul(t.ONE,n),r),u=t.pow(o,s),c=t.pow(o,r);for(;!t.eql(c,t.ONE);){if(t.eql(c,t.ZERO))return t.ZERO;let e=1;for(let r=t.sqr(c);e<a&&!t.eql(r,t.ONE);e++)r=t.sqr(r);const r=t.pow(h,er<<BigInt(a-e-1));h=t.sqr(r),u=t.mul(u,r),c=t.mul(c,h),a=e}return u}}(t)}(t)),o(a,e))),invertBatch:t=>function(t,e){const r=new Array(e.length),i=e.reduce(((e,i,n)=>t.is0(i)?e:(r[n]=e,t.mul(e,i))),t.ONE),n=t.inv(i);return e.reduceRight(((e,i,n)=>t.is0(i)?e:(r[n]=t.mul(e,r[n]),t.mul(e,i))),n),r}(a,t),cmov:(t,e,r)=>r?e:t,toBytes:t=>r?je(t,s):Fe(t,s),fromBytes:t=>{if(t.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+t.length);return r?Ue(t):Oe(t)}});return Object.freeze(a)}function pr(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function mr(t){const e=pr(t);return e+Math.ceil(e/2)}const gr=BigInt(0),br=BigInt(1);function yr(t,e){const r=e.negate();return t?r:e}function vr(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function wr(t,e){return vr(t,e),{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)}}const Mr=new WeakMap,_r=new WeakMap;function Sr(t){return _r.get(t)||1}function Er(t,e){return{constTimeNegate:yr,hasPrecomputes:t=>1!==Sr(t),unsafeLadder(e,r,i=t.ZERO){let n=e;for(;r>gr;)r&br&&(i=i.add(n)),n=n.double(),r>>=br;return i},precomputeWindow(t,r){const{windows:i,windowSize:n}=wr(r,e),s=[];let o=t,a=o;for(let t=0;t<i;t++){a=o,s.push(a);for(let t=1;t<n;t++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(r,i,n){const{windows:s,windowSize:o}=wr(r,e);let a=t.ZERO,h=t.BASE;const u=BigInt(2**r-1),c=2**r,l=BigInt(r);for(let t=0;t<s;t++){const e=t*o;let r=Number(n&u);n>>=l,r>o&&(r-=c,n+=br);const s=e,d=e+Math.abs(r)-1,f=t%2!=0,p=r<0;0===r?h=h.add(yr(f,i[s])):a=a.add(yr(p,i[d]))}return{p:a,f:h}},wNAFUnsafe(r,i,n,s=t.ZERO){const{windows:o,windowSize:a}=wr(r,e),h=BigInt(2**r-1),u=2**r,c=BigInt(r);for(let t=0;t<o;t++){const e=t*a;if(n===gr)break;let r=Number(n&h);if(n>>=c,r>a&&(r-=u,n+=br),0===r)continue;let o=i[e+Math.abs(r)-1];r<0&&(o=o.negate()),s=s.add(o)}return s},getPrecomputes(t,e,r){let i=Mr.get(e);return i||(i=this.precomputeWindow(e,t),1!==t&&Mr.set(e,r(i))),i},wNAFCached(t,e,r){const i=Sr(t);return this.wNAF(i,this.getPrecomputes(i,t,r),e)},wNAFCachedUnsafe(t,e,r,i){const n=Sr(t);return 1===n?this.unsafeLadder(t,e,i):this.wNAFUnsafe(n,this.getPrecomputes(n,t,r),e,i)},setWindowSize(t,r){vr(r,e),_r.set(t,r),Mr.delete(t)}}}function kr(t,e,r,i){if(function(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach(((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)}))}(r,t),function(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach(((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)}))}(i,e),r.length!==i.length)throw new Error("arrays of points and scalars must have equal length");const n=t.ZERO,s=We(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,h=new Array(a+1).fill(n);let u=n;for(let t=Math.floor((e.BITS-1)/o)*o;t>=0;t-=o){h.fill(n);for(let e=0;e<i.length;e++){const n=i[e],s=Number(n>>BigInt(t)&BigInt(a));h[s]=h[s].add(r[e])}let e=n;for(let t=h.length-1,r=n;t>0;t--)r=r.add(h[t]),e=e.add(r);if(u=u.add(e),0!==t)for(let t=0;t<o;t++)u=u.double()}return u}function Ar(t){return function(t){const e=lr.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});Xe(t,e)}(t.Fp),Xe(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...dr(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const Ir=BigInt(0),xr=BigInt(1),Cr=BigInt(2),Tr=BigInt(8),Pr={zip215:!0};const Br=BigInt(0),Rr=BigInt(1);const Dr=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Nr=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Lr=(BigInt(0),BigInt(1)),Or=BigInt(2),Ur=BigInt(3),Fr=BigInt(5),jr=BigInt(8);function Vr(t){const e=BigInt(10),r=BigInt(20),i=BigInt(40),n=BigInt(80),s=Dr,o=t*t%s*t%s,a=ur(o,Or,s)*o%s,h=ur(a,Lr,s)*t%s,u=ur(h,Fr,s)*h%s,c=ur(u,e,s)*u%s,l=ur(c,r,s)*c%s,d=ur(l,i,s)*l%s,f=ur(d,n,s)*d%s,p=ur(f,n,s)*d%s,m=ur(p,e,s)*u%s;return{pow_p_5_8:ur(m,Or,s)*t%s,b2:o}}function qr(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function zr(t,e){const r=Dr,i=ar(e*e*e,r),n=ar(i*i*e,r);let s=ar(t*i*Vr(t*n).pow_p_5_8,r);const o=ar(e*s*s,r),a=s,h=ar(s*Nr,r),u=o===t,c=o===ar(-t,r),l=o===ar(-t*Nr,r);return u&&(s=a),(c||l)&&(s=h),(ar(s,r)&er)===er&&(s=ar(-s,r)),{isValid:u||c,value:s}}const Hr=(()=>fr(Dr,void 0,!0))(),$r=(()=>({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Hr,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:jr,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Se,randomBytes:ce,adjustScalarBytes:qr,uvRatio:zr}))(),Wr=(()=>function(t){const e=function(t){const e=Ar(t);return Xe(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}(t),{Fp:r,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h}=e,u=Cr<<BigInt(8*a)-xr,c=r.create,l=fr(e.n,e.nBitLength),d=e.uvRatio||((t,e)=>{try{return{isValid:!0,value:r.sqrt(t*r.inv(e))}}catch(t){return{isValid:!1,value:Ir}}}),f=e.adjustScalarBytes||(t=>t),p=e.domain||((t,e,r)=>{if(Ce("phflag",r),e.length||r)throw new Error("Contexts/pre-hash are not supported");return t});function m(t,e){$e("coordinate "+t,e,Ir,u)}function g(t){if(!(t instanceof v))throw new Error("ExtendedPoint expected")}const b=Qe(((t,e)=>{const{ex:i,ey:n,ez:s}=t,o=t.is0();null==e&&(e=o?Tr:r.inv(s));const a=c(i*e),h=c(n*e),u=c(s*e);if(o)return{x:Ir,y:xr};if(u!==xr)throw new Error("invZ was invalid");return{x:a,y:h}})),y=Qe((t=>{const{a:r,d:i}=e;if(t.is0())throw new Error("bad point: ZERO");const{ex:n,ey:s,ez:o,et:a}=t,h=c(n*n),u=c(s*s),l=c(o*o),d=c(l*l),f=c(h*r);if(c(l*c(f+u))!==c(d+c(i*c(h*u))))throw new Error("bad point: equation left != right (1)");if(c(n*s)!==c(o*a))throw new Error("bad point: equation left != right (2)");return!0}));class v{constructor(t,e,r,i){this.ex=t,this.ey=e,this.ez=r,this.et=i,m("x",t),m("y",e),m("z",r),m("t",i),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(t){if(t instanceof v)throw new Error("extended point not allowed");const{x:e,y:r}=t||{};return m("x",e),m("y",r),new v(e,r,xr,c(e*r))}static normalizeZ(t){const e=r.invertBatch(t.map((t=>t.ez)));return t.map(((t,r)=>t.toAffine(e[r]))).map(v.fromAffine)}static msm(t,e){return kr(v,l,t,e)}_setWindowSize(t){_.setWindowSize(this,t)}assertValidity(){y(this)}equals(t){g(t);const{ex:e,ey:r,ez:i}=this,{ex:n,ey:s,ez:o}=t,a=c(e*o),h=c(n*i),u=c(r*o),l=c(s*i);return a===h&&u===l}is0(){return this.equals(v.ZERO)}negate(){return new v(c(-this.ex),this.ey,this.ez,c(-this.et))}double(){const{a:t}=e,{ex:r,ey:i,ez:n}=this,s=c(r*r),o=c(i*i),a=c(Cr*c(n*n)),h=c(t*s),u=r+i,l=c(c(u*u)-s-o),d=h+o,f=d-a,p=h-o,m=c(l*f),g=c(d*p),b=c(l*p),y=c(f*d);return new v(m,g,y,b)}add(t){g(t);const{a:r,d:i}=e,{ex:n,ey:s,ez:o,et:a}=this,{ex:h,ey:u,ez:l,et:d}=t;if(r===BigInt(-1)){const t=c((s-n)*(u+h)),e=c((s+n)*(u-h)),r=c(e-t);if(r===Ir)return this.double();const i=c(o*Cr*d),f=c(a*Cr*l),p=f+i,m=e+t,g=f-i,b=c(p*r),y=c(m*g),w=c(p*g),M=c(r*m);return new v(b,y,M,w)}const f=c(n*h),p=c(s*u),m=c(a*i*d),b=c(o*l),y=c((n+s)*(h+u)-f-p),w=b-m,M=b+m,_=c(p-r*f),S=c(y*w),E=c(M*_),k=c(y*_),A=c(w*M);return new v(S,E,A,k)}subtract(t){return this.add(t.negate())}wNAF(t){return _.wNAFCached(this,t,v.normalizeZ)}multiply(t){const e=t;$e("scalar",e,xr,i);const{p:r,f:n}=this.wNAF(e);return v.normalizeZ([r,n])[0]}multiplyUnsafe(t,e=v.ZERO){const r=t;return $e("scalar",r,Ir,i),r===Ir?M:this.is0()||r===xr?this:_.wNAFCachedUnsafe(this,r,v.normalizeZ,e)}isSmallOrder(){return this.multiplyUnsafe(h).is0()}isTorsionFree(){return _.unsafeLadder(this,i).is0()}toAffine(t){return b(this,t)}clearCofactor(){const{h:t}=e;return t===xr?this:this.multiplyUnsafe(t)}static fromHex(t,i=!1){const{d:n,a:s}=e,o=r.BYTES;t=Ve("pointHex",t,o),Ce("zip215",i);const a=t.slice(),h=t[o-1];a[o-1]=-129&h;const l=Ue(a),f=i?u:r.ORDER;$e("pointHex.y",l,Ir,f);const p=c(l*l),m=c(p-xr),g=c(n*p-s);let{isValid:b,value:y}=d(m,g);if(!b)throw new Error("Point.fromHex: invalid y coordinate");const w=(y&xr)===xr,M=!!(128&h);if(!i&&y===Ir&&M)throw new Error("Point.fromHex: x=0 and x_0=1");return M!==w&&(y=c(-y)),v.fromAffine({x:y,y:l})}static fromPrivateKey(t){return k(t).point}toRawBytes(){const{x:t,y:e}=this.toAffine(),i=je(e,r.BYTES);return i[i.length-1]|=t&xr?128:0,i}toHex(){return Pe(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,xr,c(e.Gx*e.Gy)),v.ZERO=new v(Ir,xr,xr,Ir);const{BASE:w,ZERO:M}=v,_=Er(v,8*a);function S(t){return ar(t,i)}function E(t){return S(Ue(t))}function k(t){const e=r.BYTES;t=Ve("private key",t,e);const i=Ve("hashed private key",s(t),2*e),n=f(i.slice(0,e)),o=i.slice(e,2*e),a=E(n),h=w.multiply(a),u=h.toRawBytes();return{head:n,prefix:o,scalar:a,point:h,pointBytes:u}}function A(t=new Uint8Array,...e){const r=qe(...e);return E(s(p(r,Ve("context",t),!!n)))}const I=Pr;return w._setWindowSize(8),{CURVE:e,getPublicKey:function(t){return k(t).pointBytes},sign:function(t,e,s={}){t=Ve("message",t),n&&(t=n(t));const{prefix:o,scalar:a,pointBytes:h}=k(e),u=A(s.context,o,t),c=w.multiply(u).toRawBytes(),l=S(u+A(s.context,c,h,t)*a);return $e("signature.s",l,Ir,i),Ve("result",qe(c,je(l,r.BYTES)),2*r.BYTES)},verify:function(t,e,i,s=I){const{context:o,zip215:a}=s,h=r.BYTES;t=Ve("signature",t,2*h),e=Ve("message",e),i=Ve("publicKey",i,h),void 0!==a&&Ce("zip215",a),n&&(e=n(e));const u=Ue(t.slice(h,2*h));let c,l,d;try{c=v.fromHex(i,a),l=v.fromHex(t.slice(0,h),a),d=w.multiplyUnsafe(u)}catch(t){return!1}if(!a&&c.isSmallOrder())return!1;const f=A(o,l.toRawBytes(),c.toRawBytes(),e);return l.add(c.multiplyUnsafe(f)).subtract(d).clearCofactor().equals(v.ZERO)},ExtendedPoint:v,utils:{getExtendedPublicKey:k,randomPrivateKey:()=>o(r.BYTES),precompute:(t=8,e=v.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)}}}($r))(),Kr=(()=>function(t){const e=(Xe(r=t,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...r}));var r;const{P:i}=e,n=t=>ar(t,i),s=e.montgomeryBits,o=Math.ceil(s/8),a=e.nByteLength,h=e.adjustScalarBytes||(t=>t),u=e.powPminus2||(t=>hr(t,i-BigInt(2),i));function c(t,e,r){const i=n(t*(e-r));return[e=n(e-i),r=n(r+i)]}const l=(e.a-BigInt(2))/BigInt(4);function d(t){return je(n(t),o)}function f(t,e){const r=function(t){const e=Ve("u coordinate",t,o);return 32===a&&(e[31]&=127),Ue(e)}(e),f=function(t){const e=Ve("scalar",t),r=e.length;if(r!==o&&r!==a)throw new Error("invalid scalar, expected "+o+" or "+a+" bytes, got "+r);return Ue(h(e))}(t),p=function(t,e){$e("u",t,Br,i),$e("scalar",e,Br,i);const r=e,o=t;let a,h=Rr,d=Br,f=t,p=Rr,m=Br;for(let t=BigInt(s-1);t>=Br;t--){const e=r>>t&Rr;m^=e,a=c(m,h,f),h=a[0],f=a[1],a=c(m,d,p),d=a[0],p=a[1],m=e;const i=h+d,s=n(i*i),u=h-d,g=n(u*u),b=s-g,y=f+p,v=n((f-p)*i),w=n(y*u),M=v+w,_=v-w;f=n(M*M),p=n(o*n(_*_)),h=n(s*g),d=n(b*(s+n(l*b)))}a=c(m,h,f),h=a[0],f=a[1],a=c(m,d,p),d=a[0],p=a[1];const g=u(d);return n(h*g)}(r,f);if(p===Br)throw new Error("invalid private or public key received");return d(p)}const p=d(e.Gu);function m(t){return f(t,p)}return{scalarMult:f,scalarMultBase:m,getSharedSecret:(t,e)=>f(t,e),getPublicKey:t=>m(t),utils:{randomPrivateKey:()=>e.randomBytes(e.nByteLength)},GuBytes:p}}({P:Dr,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:t=>{const e=Dr,{pow_p_5_8:r,b2:i}=Vr(t);return ar(ur(r,Ur,e)*i,e)},adjustScalarBytes:qr,randomBytes:ce}))();function Gr(t,e){const r=new Uint8Array(64);for(let i=0;i<32;i++)r[i]=t[i],r[32+i]=e[i];return r}class Zr{type="Ed25519";raw;constructor(t){this.raw=Xr(t,32)}toMultihash(){return Qt.digest($a(this))}toCID(){return Kt.createV1(114,this.toMultihash())}toString(){return ct.encode(this.toMultihash().bytes).substring(1)}equals(t){return null!=t&&t.raw instanceof Uint8Array&&te(this.raw,t.raw)}verify(t,e){return function(t,e,r){return Wr.verify(e,r instanceof Uint8Array?r:r.subarray(),t)}(this.raw,e,t)}}class Yr{type="Ed25519";raw;publicKey;constructor(t,e){this.raw=Xr(t,64),this.publicKey=new Zr(e)}equals(t){return null!=t&&t.raw instanceof Uint8Array&&te(this.raw,t.raw)}sign(t){return function(t,e){const r=t.subarray(0,32);return Wr.sign(e instanceof Uint8Array?e:e.subarray(),r)}(this.raw,t)}}function Jr(t){return t=Xr(t,32),new Zr(t)}function Xr(t,e){if((t=Uint8Array.from(t??[])).length!==e)throw new T(`Key must be a Uint8Array of length ${e}, got ${t.length}`);return t}function Qr(t=0){return new Uint8Array(t)}function ti(t=0){return new Uint8Array(t)}const ei=Math.pow(2,7),ri=Math.pow(2,14),ii=Math.pow(2,21),ni=Math.pow(2,28),si=Math.pow(2,35),oi=Math.pow(2,42),ai=Math.pow(2,49),hi=128,ui=127;function ci(t){if(t<ei)return 1;if(t<ri)return 2;if(t<ii)return 3;if(t<ni)return 4;if(t<si)return 5;if(t<oi)return 6;if(t<ai)return 7;if(null!=Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function li(t,e,r=0){switch(ci(t)){case 8:e[r++]=255&t|hi,t/=128;case 7:e[r++]=255&t|hi,t/=128;case 6:e[r++]=255&t|hi,t/=128;case 5:e[r++]=255&t|hi,t/=128;case 4:e[r++]=255&t|hi,t>>>=7;case 3:e[r++]=255&t|hi,t>>>=7;case 2:e[r++]=255&t|hi,t>>>=7;case 1:e[r++]=255&t,t>>>=7;break;default:throw new Error("unreachable")}return e}function di(t,e){let r=t[e],i=0;if(i+=r&ui,r<hi)return i;if(r=t[e+1],i+=(r&ui)<<7,r<hi)return i;if(r=t[e+2],i+=(r&ui)<<14,r<hi)return i;if(r=t[e+3],i+=(r&ui)<<21,r<hi)return i;if(r=t[e+4],i+=(r&ui)*ni,r<hi)return i;if(r=t[e+5],i+=(r&ui)*si,r<hi)return i;if(r=t[e+6],i+=(r&ui)*oi,r<hi)return i;if(r=t[e+7],i+=(r&ui)*ai,r<hi)return i;throw new RangeError("Could not decode varint")}function fi(t,e,r=0){return null==e&&(e=ti(ci(t))),e instanceof Uint8Array?li(t,e,r):function(t,e,r=0){switch(ci(t)){case 8:e.set(r++,255&t|hi),t/=128;case 7:e.set(r++,255&t|hi),t/=128;case 6:e.set(r++,255&t|hi),t/=128;case 5:e.set(r++,255&t|hi),t/=128;case 4:e.set(r++,255&t|hi),t>>>=7;case 3:e.set(r++,255&t|hi),t>>>=7;case 2:e.set(r++,255&t|hi),t>>>=7;case 1:e.set(r++,255&t),t>>>=7;break;default:throw new Error("unreachable")}return e}(t,e,r)}function pi(t,e=0){return t instanceof Uint8Array?di(t,e):function(t,e){let r=t.get(e),i=0;if(i+=r&ui,r<hi)return i;if(r=t.get(e+1),i+=(r&ui)<<7,r<hi)return i;if(r=t.get(e+2),i+=(r&ui)<<14,r<hi)return i;if(r=t.get(e+3),i+=(r&ui)<<21,r<hi)return i;if(r=t.get(e+4),i+=(r&ui)*ni,r<hi)return i;if(r=t.get(e+5),i+=(r&ui)*si,r<hi)return i;if(r=t.get(e+6),i+=(r&ui)*oi,r<hi)return i;if(r=t.get(e+7),i+=(r&ui)*ai,r<hi)return i;throw new RangeError("Could not decode varint")}(t,e)}const mi=new Float32Array([-0]),gi=new Uint8Array(mi.buffer);function bi(t,e,r){mi[0]=t,e[r]=gi[0],e[r+1]=gi[1],e[r+2]=gi[2],e[r+3]=gi[3]}const yi=new Float64Array([-0]),vi=new Uint8Array(yi.buffer);function wi(t,e,r){yi[0]=t,e[r]=vi[0],e[r+1]=vi[1],e[r+2]=vi[2],e[r+3]=vi[3],e[r+4]=vi[4],e[r+5]=vi[5],e[r+6]=vi[6],e[r+7]=vi[7]}const Mi=BigInt(Number.MAX_SAFE_INTEGER),_i=BigInt(Number.MIN_SAFE_INTEGER);class Si{lo;hi;constructor(t,e){this.lo=0|t,this.hi=0|e}toNumber(t=!1){if(!t&&this.hi>>>31>0){const t=1+~this.lo>>>0;let e=~this.hi>>>0;return 0===t&&(e=e+1>>>0),-(t+4294967296*e)}return this.lo+4294967296*this.hi}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!=0){const t=1+~this.lo>>>0;let e=~this.hi>>>0;return 0===t&&(e=e+1>>>0),-(BigInt(t)+(BigInt(e)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){const t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){const t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){const t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10}static fromBigInt(t){if(0n===t)return Ei;if(t<Mi&&t>_i)return this.fromNumber(Number(t));const e=t<0n;e&&(t=-t);let r=t>>32n,i=t-(r<<32n);return e&&(r=0n|~r,i=0n|~i,++i>ki&&(i=0n,++r>ki&&(r=0n))),new Si(Number(i),Number(r))}static fromNumber(t){if(0===t)return Ei;const e=t<0;e&&(t=-t);let r=t>>>0,i=(t-r)/4294967296>>>0;return e&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Si(r,i)}static from(t){return"number"==typeof t?Si.fromNumber(t):"bigint"==typeof t?Si.fromBigInt(t):"string"==typeof t?Si.fromBigInt(BigInt(t)):null!=t.low||null!=t.high?new Si(t.low>>>0,t.high>>>0):Ei}}const Ei=new Si(0,0);Ei.toBigInt=function(){return 0n},Ei.zzEncode=Ei.zzDecode=function(){return this},Ei.length=function(){return 1};const ki=4294967296n;function Ai(t,e,r){const i=r;let n,s;for(let i=0;i<t.length;++i)n=t.charCodeAt(i),n<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(s=t.charCodeAt(i+1)))?(n=65536+((1023&n)<<10)+(1023&s),++i,e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=63&n|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=63&n|128);return r-i}function Ii(t,e){return RangeError(`index out of range: ${t.pos} + ${e??1} > ${t.len}`)}function xi(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}class Ci{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,Ii(this,10);return t}int32(){return 0|this.uint32()}sint32(){const t=this.uint32();return t>>>1^-(1&t)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw Ii(this,4);return xi(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ii(this,4);return 0|xi(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw Ii(this,4);const t=function(t,e){return gi[0]=t[e],gi[1]=t[e+1],gi[2]=t[e+2],gi[3]=t[e+3],mi[0]}(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw Ii(this,4);const t=function(t,e){return vi[0]=t[e],vi[1]=t[e+1],vi[2]=t[e+2],vi[3]=t[e+3],vi[4]=t[e+4],vi[5]=t[e+5],vi[6]=t[e+6],vi[7]=t[e+7],yi[0]}(this.buf,this.pos);return this.pos+=8,t}bytes(){const t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw Ii(this,t);return this.pos+=t,e===r?new Uint8Array(0):this.buf.subarray(e,r)}string(){const t=this.bytes();return function(t,e,r){if(r-e<1)return"";let i;const n=[];let s,o=0;for(;e<r;)s=t[e++],s<128?n[o++]=s:s>191&&s<224?n[o++]=(31&s)<<6|63&t[e++]:s>239&&s<365?(s=((7&s)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,n[o++]=55296+(s>>10),n[o++]=56320+(1023&s)):n[o++]=(15&s)<<12|(63&t[e++])<<6|63&t[e++],o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,n)),o=0);return null!=i?(o>0&&i.push(String.fromCharCode.apply(String,n.slice(0,o))),i.join("")):String.fromCharCode.apply(String,n.slice(0,o))}(t,0,t.length)}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw Ii(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw Ii(this)}while(128&this.buf[this.pos++]);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){const t=new Si(0,0);let e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw Ii(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw Ii(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ii(this,8);const t=xi(this.buf,this.pos+=4),e=xi(this.buf,this.pos+=4);return new Si(t,e)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const t=di(this.buf,this.pos);return this.pos+=ci(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function Ti(t,e,r){const i=function(t){return new Ci(t instanceof Uint8Array?t:t.subarray())}(t);return e.decode(i,void 0,r)}const Pi=ht({prefix:"9",name:"base10",alphabet:"0123456789"}),Bi=ut({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ri=ut({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Di=ut({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Ni=Array.from(""),Li=Ni.reduce(((t,e,r)=>(t[r]=e,t)),[]),Oi=Ni.reduce(((t,e,r)=>{const i=e.codePointAt(0);if(null==i)throw new Error(`Invalid character: ${e}`);return t[i]=r,t}),[]),Ui=at({prefix:"",name:"base256emoji",encode:function(t){return t.reduce(((t,e)=>t+Li[e]),"")},decode:function(t){const e=[];for(const r of t){const t=r.codePointAt(0);if(null==t)throw new Error(`Invalid character: ${r}`);const i=Oi[t];if(null==i)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}}),Fi=ut({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ji=ut({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Vi=ut({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),qi=ut({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),zi=ut({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Hi=at({prefix:"\0",name:"identity",encode:t=>{return e=t,(new TextDecoder).decode(e);var e},decode:t=>function(t){return(new TextEncoder).encode(t)}(t)}),$i=new TextEncoder,Wi=new TextDecoder,Ki="json",Gi=512;function Zi(t){return $i.encode(JSON.stringify(t))}function Yi(t){return JSON.parse(Wi.decode(t))}const Ji="raw",Xi=85;function Qi(t){return tt(t)}function tn(t){return tt(t)}function en({name:t,code:e,encode:r}){return new rn(t,e,r)}class rn{name;code;encode;constructor(t,e,r){this.name=t,this.code=e,this.encode=r}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?Vt(this.code,e):e.then((t=>Vt(this.code,t)))}throw Error("Unknown type, must be binary type")}}function nn(t){return async e=>new Uint8Array(await crypto.subtle.digest(t,e))}const sn=en({name:"sha2-256",code:18,encode:nn("SHA-256")}),on=en({name:"sha2-512",code:19,encode:nn("SHA-512")}),an={...p,...c,...f,...h,...u,...n,...s,...i,...d,...l};function hn(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const un=hn("utf8","u",(t=>"u"+new TextDecoder("utf8").decode(t)),(t=>(new TextEncoder).encode(t.substring(1)))),cn=hn("ascii","a",(t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}),(t=>{const e=ti((t=t.substring(1)).length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e})),ln={utf8:un,"utf-8":un,hex:an.base16,latin1:cn,ascii:cn,binary:cn,...an};function dn(t,e="utf8"){const r=ln[e];if(null==r)throw new Error(`Unsupported encoding "${e}"`);return r.decoder.decode(`${r.prefix}${t}`)}class fn{fn;len;next;val;constructor(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}}function pn(){}class mn{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}}const gn=function(){const t=8192;let e,r=t;return function(i){if(i<1||i>4096)return ti(i);r+i>t&&(e=ti(t),r=0);const n=e.subarray(r,r+=i);return 7&r&&(r=1+(7|r)),n}}();class bn{len;head;tail;states;constructor(){this.len=0,this.head=new fn(pn,0,0),this.tail=this.head,this.states=null}_push(t,e,r){return this.tail=this.tail.next=new fn(t,e,r),this.len+=e,this}uint32(t){return this.len+=(this.tail=this.tail.next=new wn((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Mn,10,Si.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){const e=Si.fromBigInt(t);return this._push(Mn,e.length(),e)}uint64Number(t){return this._push(li,ci(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){const e=Si.fromBigInt(t).zzEncode();return this._push(Mn,e.length(),e)}sint64Number(t){const e=Si.fromNumber(t).zzEncode();return this._push(Mn,e.length(),e)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(yn,1,t?1:0)}fixed32(t){return this._push(_n,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){const e=Si.fromBigInt(t);return this._push(_n,4,e.lo)._push(_n,4,e.hi)}fixed64Number(t){const e=Si.fromNumber(t);return this._push(_n,4,e.lo)._push(_n,4,e.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(bi,4,t)}double(t){return this._push(wi,8,t)}bytes(t){const e=t.length>>>0;return 0===e?this._push(yn,1,0):this.uint32(e)._push(Sn,e,t)}string(t){const e=function(t){let e=0,r=0;for(let i=0;i<t.length;++i)r=t.charCodeAt(i),r<128?e+=1:r<2048?e+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e}(t);return 0!==e?this.uint32(e)._push(Ai,e,t):this._push(yn,1,0)}fork(){return this.states=new mn(this),this.head=this.tail=new fn(pn,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new fn(pn,0,0),this.len=0),this}ldelim(){const t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),0!==r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this}finish(){let t=this.head.next;const e=(r=this.len,null!=globalThis.Buffer?ti(r):gn(r));var r;let i=0;for(;null!=t;)t.fn(t.val,e,i),i+=t.len,t=t.next;return e}}function yn(t,e,r){e[r]=255&t}function vn(t,e,r){for(;t>127;)e[r++]=127&t|128,t>>>=7;e[r]=t}class wn extends fn{next;constructor(t,e){super(vn,t,e),this.next=void 0}}function Mn(t,e,r){for(;0!==t.hi;)e[r++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=127&t.lo|128,t.lo=t.lo>>>7;e[r++]=t.lo}function _n(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function Sn(t,e,r){e.set(t,r)}function En(t,e,r){e.set(t,r)}function kn(t,e,r){t.length<40?Ai(t,e,r):null!=e.utf8Write?e.utf8Write(t,r):e.set(dn(t),r)}function An(t,e){const r=new bn;return e.encode(t,r,{lengthDelimited:!1}),r.finish()}var In,xn,Cn,Tn,Pn;function Bn(t,e,r,i){return{name:t,type:e,encode:r,decode:i}}function Rn(t){function e(e){if(null==t[e.toString()])throw new Error("Invalid enum value");return t[e]}return Bn("enum",In.VARINT,(function(t,r){const i=e(t);r.int32(i)}),(function(t){return e(t.int32())}))}function Dn(t,e){return Bn("message",In.LENGTH_DELIMITED,t,e)}null!=globalThis.Buffer&&(bn.prototype.bytes=function(t){const e=t.length>>>0;return this.uint32(e),e>0&&this._push(En,e,t),this},bn.prototype.string=function(t){const e=globalThis.Buffer.byteLength(t);return this.uint32(e),e>0&&this._push(kn,e,t),this}),function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"}(In||(In={})),Error;class Nn extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class Ln extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}function On(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Un(t,...e){if(!((r=t)instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name))throw new Error("Uint8Array expected");var r;if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Fn(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");On(t.outputLen),On(t.blockLen)}function jn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}!function(t){t.RSA="RSA",t.Ed25519="Ed25519",t.secp256k1="secp256k1"}(xn||(xn={})),function(t){t[t.RSA=0]="RSA",t[t.Ed25519=1]="Ed25519",t[t.secp256k1=2]="secp256k1"}(Cn||(Cn={})),function(t){t.codec=()=>Rn(Cn)}(xn||(xn={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.Type&&(e.uint32(8),xn.codec().encode(t.Type,e)),null!=t.Data&&(e.uint32(18),e.bytes(t.Data)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.Type=xn.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Tn||(Tn={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.Type&&(e.uint32(8),xn.codec().encode(t.Type,e)),null!=t.Data&&(e.uint32(18),e.bytes(t.Data)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.Type=xn.codec().decode(t);break;case 2:i.Data=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Pn||(Pn={}));const Vn="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,qn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),zn=(t,e)=>t<<32-e|t>>>e;function Hn(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),Un(t),t}class $n{clone(){return this._cloneInto()}}function Wn(t){const e=e=>t().update(Hn(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}const Kn=(t,e,r)=>t&e^t&r^e&r;class Gn extends $n{constructor(t,e,r,i){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=qn(this.buffer)}update(t){jn(this);const{view:e,buffer:r,blockLen:i}=this,n=(t=Hn(t)).length;for(let s=0;s<n;){const o=Math.min(i-this.pos,n-s);if(o!==i)r.set(t.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(e,0),this.pos=0);else{const e=qn(t);for(;i<=n-s;s+=i)this.process(e,s)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){jn(this),function(t,e){Un(t);const r=e.outputLen;if(t.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(t,this),this.finished=!0;const{buffer:e,view:r,blockLen:i,isLE:n}=this;let{pos:s}=this;e[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(r,0),s=0);for(let t=s;t<i;t++)e[t]=0;!function(t,e,r,i){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),h=i?4:0,u=i?0:4;t.setUint32(e+h,o,i),t.setUint32(e+u,a,i)}(r,i-8,BigInt(8*this.length),n),this.process(r,0);const o=qn(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=a/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<h;t++)o.setUint32(4*t,u[t],n)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:i,finished:n,destroyed:s,pos:o}=this;return t.length=i,t.pos=o,t.finished=n,t.destroyed=s,i%e&&t.buffer.set(r),t}}const Zn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Yn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Jn=new Uint32Array(64);class Xn extends Gn{constructor(){super(64,32,8,!1),this.A=0|Yn[0],this.B=0|Yn[1],this.C=0|Yn[2],this.D=0|Yn[3],this.E=0|Yn[4],this.F=0|Yn[5],this.G=0|Yn[6],this.H=0|Yn[7]}get(){const{A:t,B:e,C:r,D:i,E:n,F:s,G:o,H:a}=this;return[t,e,r,i,n,s,o,a]}set(t,e,r,i,n,s,o,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)Jn[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=Jn[t-15],r=Jn[t-2],i=zn(e,7)^zn(e,18)^e>>>3,n=zn(r,17)^zn(r,19)^r>>>10;Jn[t]=n+Jn[t-7]+i+Jn[t-16]|0}let{A:r,B:i,C:n,D:s,E:o,F:a,G:h,H:u}=this;for(let t=0;t<64;t++){const e=u+(zn(o,6)^zn(o,11)^zn(o,25))+((c=o)&a^~c&h)+Zn[t]+Jn[t]|0,l=(zn(r,2)^zn(r,13)^zn(r,22))+Kn(r,i,n)|0;u=h,h=a,a=o,o=s+e|0,s=n,n=i,i=r,r=e+l|0}var c;r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(r,i,n,s,o,a,h,u)}roundClean(){Jn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Qn=Wn((()=>new Xn));var ts=r(3199);function es(t,e){let r=0;if(1===t.length)return t[0];for(let i=t.length-1;i>=0;i--)r+=t[t.length-1-i]*Math.pow(2,e*i);return r}function rs(t,e,r=-1){const i=r;let n=t,s=0,o=Math.pow(2,e);for(let r=1;r<8;r++){if(t<o){let t;if(i<0)t=new ArrayBuffer(r),s=r;else{if(i<r)return new ArrayBuffer(0);t=new ArrayBuffer(i),s=i}const o=new Uint8Array(t);for(let t=r-1;t>=0;t--){const r=Math.pow(2,t*e);o[s-t-1]=Math.floor(n/r),n-=o[s-t-1]*r}return t}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function is(...t){let e=0,r=0;for(const r of t)e+=r.length;const i=new ArrayBuffer(e),n=new Uint8Array(i);for(const e of t)n.set(e,r),r+=e.length;return n}function ns(){const t=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const e=255===t[0]&&128&t[1],r=0===t[0]&&!(128&t[1]);(e||r)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),r=new Uint8Array(e);for(let t=0;t<this.valueHex.byteLength;t++)r[t]=0;r[0]=128&t[0];const i=es(r,8),n=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(n);for(let e=0;e<this.valueHex.byteLength;e++)s[e]=t[e];return s[0]&=127,es(s,8)-i}function ss(t,e){const r=t.toString(10);if(e<r.length)return"";const i=e-r.length,n=new Array(i);for(let t=0;t<i;t++)n[t]="0";return n.join("").concat(r)}function os(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function as(t){let e=0,r=0;for(let r=0;r<t.length;r++)e+=t[r].byteLength;const i=new Uint8Array(e);for(let e=0;e<t.length;e++){const n=t[e];i.set(new Uint8Array(n),r),r+=n.byteLength}return i.buffer}function hs(t,e,r,i){return e instanceof Uint8Array?e.byteLength?r<0?(t.error="Wrong parameter: inputOffset less than zero",!1):i<0?(t.error="Wrong parameter: inputLength less than zero",!1):!(e.byteLength-r-i<0&&(t.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1)):(t.error="Wrong parameter: inputBuffer has zero length",!1):(t.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}Math.log(2);class us{constructor(){this.items=[]}write(t){this.items.push(t)}final(){return as(this.items)}}const cs=[new Uint8Array([1])],ls="0123456789",ds=new ArrayBuffer(0),fs=new Uint8Array(0),ps="EndOfContent",ms="OCTET STRING",gs="BIT STRING";function bs(t){var e;return(e=class extends t{constructor(...t){var e;super(...t);const r=t[0]||{};this.isHexOnly=null!==(e=r.isHexOnly)&&void 0!==e&&e,this.valueHexView=r.valueHex?ts._H.toUint8Array(r.valueHex):fs}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(t){this.valueHexView=new Uint8Array(t)}fromBER(t,e,r){const i=t instanceof ArrayBuffer?new Uint8Array(t):t;if(!hs(this,i,e,r))return-1;const n=e+r;return this.valueHexView=i.subarray(e,n),this.valueHexView.length?(this.blockLength=r,n):(this.warnings.push("Zero buffer length"),e)}toBER(t=!1){return this.isHexOnly?t?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ds)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:ts.U$.ToHex(this.valueHexView)}}}).NAME="hexBlock",e}class ys{constructor({blockLength:t=0,error:e="",warnings:r=[],valueBeforeDecode:i=fs}={}){this.blockLength=t,this.error=e,this.warnings=r,this.valueBeforeDecodeView=ts._H.toUint8Array(i)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(t){this.valueBeforeDecodeView=new Uint8Array(t)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:ts.U$.ToHex(this.valueBeforeDecodeView)}}}ys.NAME="baseBlock";class vs extends ys{fromBER(t,e,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(t,e){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}vs.NAME="valueBlock";class ws extends(bs(ys)){constructor({idBlock:t={}}={}){var e,r,i,n;super(),t?(this.isHexOnly=null!==(e=t.isHexOnly)&&void 0!==e&&e,this.valueHexView=t.valueHex?ts._H.toUint8Array(t.valueHex):fs,this.tagClass=null!==(r=t.tagClass)&&void 0!==r?r:-1,this.tagNumber=null!==(i=t.tagNumber)&&void 0!==i?i:-1,this.isConstructed=null!==(n=t.isConstructed)&&void 0!==n&&n):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(t=!1){let e=0;switch(this.tagClass){case 1:e|=0;break;case 2:e|=64;break;case 3:e|=128;break;case 4:e|=192;break;default:return this.error="Unknown tag class",ds}if(this.isConstructed&&(e|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!t){let t=this.tagNumber;t&=31,e|=t,r[0]=e}return r.buffer}if(!this.isHexOnly){const r=rs(this.tagNumber,7),i=new Uint8Array(r),n=r.byteLength,s=new Uint8Array(n+1);if(s[0]=31|e,!t){for(let t=0;t<n-1;t++)s[t+1]=128|i[t];s[n]=i[n-1]}return s.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=31|e,!t){const t=this.valueHexView;for(let e=0;e<t.length-1;e++)r[e+1]=128|t[e];r[this.valueHexView.byteLength]=t[t.length-1]}return r.buffer}fromBER(t,e,r){const i=ts._H.toUint8Array(t);if(!hs(this,i,e,r))return-1;const n=i.subarray(e,e+r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=!(32&~n[0]),this.isHexOnly=!1;const s=31&n[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{let t=1,e=this.valueHexView=new Uint8Array(255),r=255;for(;128&n[t];){if(e[t-1]=127&n[t],t++,t>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(t===r){r+=255;const t=new Uint8Array(r);for(let r=0;r<e.length;r++)t[r]=e[r];e=this.valueHexView=new Uint8Array(r)}}this.blockLength=t+1,e[t-1]=127&n[t];const i=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=e[r];e=this.valueHexView=new Uint8Array(t),e.set(i),this.blockLength<=9?this.tagNumber=es(e,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return e+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}ws.NAME="identificationBlock";class Ms extends ys{constructor({lenBlock:t={}}={}){var e,r,i;super(),this.isIndefiniteForm=null!==(e=t.isIndefiniteForm)&&void 0!==e&&e,this.longFormUsed=null!==(r=t.longFormUsed)&&void 0!==r&&r,this.length=null!==(i=t.length)&&void 0!==i?i:0}fromBER(t,e,r){const i=ts._H.toUint8Array(t);if(!hs(this,i,e,r))return-1;const n=i.subarray(e,e+r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],this.isIndefiniteForm)return this.blockLength=1,e+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,e+this.blockLength;const s=127&n[0];if(s>8)return this.error="Too big integer",-1;if(s+1>n.length)return this.error="End of input reached before message was fully decoded",-1;const o=e+1,a=i.subarray(o,o+s);return 0===a[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=es(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=s+1,e+this.blockLength}toBER(t=!1){let e,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===t&&(r=new Uint8Array(e),r[0]=128),e;if(this.longFormUsed){const i=rs(this.length,8);if(i.byteLength>127)return this.error="Too big length",ds;if(e=new ArrayBuffer(i.byteLength+1),t)return e;const n=new Uint8Array(i);r=new Uint8Array(e),r[0]=128|i.byteLength;for(let t=0;t<i.byteLength;t++)r[t+1]=n[t];return e}return e=new ArrayBuffer(1),!1===t&&(r=new Uint8Array(e),r[0]=this.length),e}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}Ms.NAME="lengthBlock";const _s={};class Ss extends ys{constructor({name:t="",optional:e=!1,primitiveSchema:r,...i}={},n){super(i),this.name=t,this.optional=e,r&&(this.primitiveSchema=r),this.idBlock=new ws(i),this.lenBlock=new Ms(i),this.valueBlock=n?new n(i):new vs(i)}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(t,e){const r=e||new us;e||Es(this);const i=this.idBlock.toBER(t);if(r.write(i),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(t,r),r.write(new ArrayBuffer(2));else{const e=this.valueBlock.toBER(t);this.lenBlock.length=e.byteLength;const i=this.lenBlock.toBER(t);r.write(i),r.write(e)}return e?ds:r.final()}toJSON(){const t={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(t.primitiveSchema=this.primitiveSchema.toJSON()),t}toString(t="ascii"){return"ascii"===t?this.onAsciiEncoding():ts.U$.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${ts.U$.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(t){return this===t||t instanceof this.constructor&&function(t,e){if(t.byteLength!==e.byteLength)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let t=0;t<r.length;t++)if(r[t]!==i[t])return!1;return!0}(this.toBER(),t.toBER())}}function Es(t){if(t instanceof _s.Constructed)for(const e of t.valueBlock.value)Es(e)&&(t.lenBlock.isIndefiniteForm=!0);return!!t.lenBlock.isIndefiniteForm}Ss.NAME="BaseBlock";class ks extends Ss{constructor({value:t="",...e}={},r){super(e,r),t&&this.fromString(t)}getValue(){return this.valueBlock.value}setValue(t){this.valueBlock.value=t}fromBER(t,e,r){const i=this.valueBlock.fromBER(t,e,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}ks.NAME="BaseStringBlock";class As extends(bs(vs)){constructor({isHexOnly:t=!0,...e}={}){super(e),this.isHexOnly=t}}var Is,xs,Cs,Ts,Ps,Bs,Rs,Ds,Ns,Ls,Os,Us,Fs,js,Vs,qs,zs,Hs,$s,Ws,Ks,Gs,Zs,Ys,Js,Xs,Qs,to,eo,ro,io,no,so;As.NAME="PrimitiveValueBlock";class oo extends Ss{constructor(t={}){super(t,As),this.idBlock.isConstructed=!1}}function ao(t,e=0,r=t.length){const i=e;let n=new Ss({},vs);const s=new ys;if(!hs(s,t,e,r))return n.error=s.error,{offset:-1,result:n};if(!t.subarray(e,e+r).length)return n.error="Zero buffer length",{offset:-1,result:n};let o=n.idBlock.fromBER(t,e,r);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===o)return n.error=n.idBlock.error,{offset:-1,result:n};if(e=o,r-=n.idBlock.blockLength,o=n.lenBlock.fromBER(t,e,r),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===o)return n.error=n.lenBlock.error,{offset:-1,result:n};if(e=o,r-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let a=Ss;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};a=_s.EndOfContent;break;case 1:a=_s.Boolean;break;case 2:a=_s.Integer;break;case 3:a=_s.BitString;break;case 4:a=_s.OctetString;break;case 5:a=_s.Null;break;case 6:a=_s.ObjectIdentifier;break;case 10:a=_s.Enumerated;break;case 12:a=_s.Utf8String;break;case 13:a=_s.RelativeObjectIdentifier;break;case 14:a=_s.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:a=_s.Sequence;break;case 17:a=_s.Set;break;case 18:a=_s.NumericString;break;case 19:a=_s.PrintableString;break;case 20:a=_s.TeletexString;break;case 21:a=_s.VideotexString;break;case 22:a=_s.IA5String;break;case 23:a=_s.UTCTime;break;case 24:a=_s.GeneralizedTime;break;case 25:a=_s.GraphicString;break;case 26:a=_s.VisibleString;break;case 27:a=_s.GeneralString;break;case 28:a=_s.UniversalString;break;case 29:a=_s.CharacterString;break;case 30:a=_s.BmpString;break;case 31:a=_s.DATE;break;case 32:a=_s.TimeOfDay;break;case 33:a=_s.DateTime;break;case 34:a=_s.Duration;break;default:{const t=n.idBlock.isConstructed?new _s.Constructed:new _s.Primitive;t.idBlock=n.idBlock,t.lenBlock=n.lenBlock,t.warnings=n.warnings,n=t}}}else a=n.idBlock.isConstructed?_s.Constructed:_s.Primitive;return n=function(t,e){if(t instanceof e)return t;const r=new e;return r.idBlock=t.idBlock,r.lenBlock=t.lenBlock,r.warnings=t.warnings,r.valueBeforeDecodeView=t.valueBeforeDecodeView,r}(n,a),o=n.fromBER(t,e,n.lenBlock.isIndefiniteForm?r:n.lenBlock.length),n.valueBeforeDecodeView=t.subarray(i,i+n.blockLength),{offset:o,result:n}}Is=oo,_s.Primitive=Is,oo.NAME="PRIMITIVE";class ho extends vs{constructor({value:t=[],isIndefiniteForm:e=!1,...r}={}){super(r),this.value=t,this.isIndefiniteForm=e}fromBER(t,e,r){const i=ts._H.toUint8Array(t);if(!hs(this,i,e,r))return-1;if(this.valueBeforeDecodeView=i.subarray(e,e+r),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),e;let n=e;for(;(this.isIndefiniteForm?1:r)>0;){const t=ao(i,n,r);if(-1===t.offset)return this.error=t.result.error,this.warnings.concat(t.result.warnings),-1;if(n=t.offset,this.blockLength+=t.result.blockLength,r-=t.result.blockLength,this.value.push(t.result),this.isIndefiniteForm&&t.result.constructor.NAME===ps)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===ps?this.value.pop():this.warnings.push("No EndOfContent block encoded")),n}toBER(t,e){const r=e||new us;for(let e=0;e<this.value.length;e++)this.value[e].toBER(t,r);return e?ds:r.final()}toJSON(){const t={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const e of this.value)t.value.push(e.toJSON());return t}}ho.NAME="ConstructedValueBlock";class uo extends Ss{constructor(t={}){super(t,ho),this.idBlock.isConstructed=!0}fromBER(t,e,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(t,e,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===i?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const t=[];for(const e of this.valueBlock.value)t.push(e.toString("ascii").split("\n").map((t=>`  ${t}`)).join("\n"));const e=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return t.length?`${e} :\n${t.join("\n")}`:`${e} :`}}xs=uo,_s.Constructed=xs,uo.NAME="CONSTRUCTED";class co extends vs{fromBER(t,e,r){return e}toBER(t){return ds}}co.override="EndOfContentValueBlock";class lo extends Ss{constructor(t={}){super(t,co),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Cs=lo,_s.EndOfContent=Cs,lo.NAME=ps;class fo extends Ss{constructor(t={}){super(t,vs),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(t,e,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,e+r>t.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):e+r}toBER(t,e){const r=new ArrayBuffer(2);if(!t){const t=new Uint8Array(r);t[0]=5,t[1]=0}return e&&e.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}Ts=fo,_s.Null=Ts,fo.NAME="NULL";class po extends(bs(vs)){constructor({value:t,...e}={}){super(e),e.valueHex?this.valueHexView=ts._H.toUint8Array(e.valueHex):this.valueHexView=new Uint8Array(1),t&&(this.value=t)}get value(){for(const t of this.valueHexView)if(t>0)return!0;return!1}set value(t){this.valueHexView[0]=t?255:0}fromBER(t,e,r){const i=ts._H.toUint8Array(t);return hs(this,i,e,r)?(this.valueHexView=i.subarray(e,e+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ns.call(this),this.blockLength=r,e+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}po.NAME="BooleanValueBlock";class mo extends Ss{constructor(t={}){super(t,po),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(t){this.valueBlock.value=t}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}Ps=mo,_s.Boolean=Ps,mo.NAME="BOOLEAN";class go extends(bs(ho)){constructor({isConstructed:t=!1,...e}={}){super(e),this.isConstructed=t}fromBER(t,e,r){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=ho.prototype.fromBER.call(this,t,e,r),-1===i)return i;for(let t=0;t<this.value.length;t++){const e=this.value[t].constructor.NAME;if(e===ps){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(e!==ms)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(t,e,r),this.blockLength=r;return i}toBER(t,e){return this.isConstructed?ho.prototype.toBER.call(this,t,e):t?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}go.NAME="OctetStringValueBlock";class bo extends Ss{constructor({idBlock:t={},lenBlock:e={},...r}={}){var i,n;null!==(i=r.isConstructed)&&void 0!==i||(r.isConstructed=!!(null===(n=r.value)||void 0===n?void 0:n.length)),super({idBlock:{isConstructed:r.isConstructed,...t},lenBlock:{...e,isIndefiniteForm:!!r.isIndefiniteForm},...r},go),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(t,e,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===r)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),e;if(!this.valueBlock.isConstructed){const i=(t instanceof ArrayBuffer?new Uint8Array(t):t).subarray(e,e+r);try{if(i.byteLength){const t=ao(i,0,i.byteLength);-1!==t.offset&&t.offset===r&&(this.valueBlock.value=[t.result])}}catch(t){}}return super.fromBER(t,e,r)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?uo.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${ts.U$.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const t=[];for(const e of this.valueBlock.value)e instanceof bo&&t.push(e.valueBlock.valueHexView);return ts._H.concat(t)}}Bs=bo,_s.OctetString=Bs,bo.NAME=ms;class yo extends(bs(ho)){constructor({unusedBits:t=0,isConstructed:e=!1,...r}={}){super(r),this.unusedBits=t,this.isConstructed=e,this.blockLength=this.valueHexView.byteLength}fromBER(t,e,r){if(!r)return e;let i=-1;if(this.isConstructed){if(i=ho.prototype.fromBER.call(this,t,e,r),-1===i)return i;for(const t of this.value){const e=t.constructor.NAME;if(e===ps){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(e!==gs)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const r=t.valueBlock;if(this.unusedBits>0&&r.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=r.unusedBits}return i}const n=ts._H.toUint8Array(t);if(!hs(this,n,e,r))return-1;const s=n.subarray(e,e+r);if(this.unusedBits=s[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const t=s.subarray(1);try{if(t.byteLength){const e=ao(t,0,t.byteLength);-1!==e.offset&&e.offset===r-1&&(this.value=[e.result])}}catch(t){}}return this.valueHexView=s.subarray(1),this.blockLength=s.length,e+r}toBER(t,e){if(this.isConstructed)return ho.prototype.toBER.call(this,t,e);if(t)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ds;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}yo.NAME="BitStringValueBlock";class vo extends Ss{constructor({idBlock:t={},lenBlock:e={},...r}={}){var i,n;null!==(i=r.isConstructed)&&void 0!==i||(r.isConstructed=!!(null===(n=r.value)||void 0===n?void 0:n.length)),super({idBlock:{isConstructed:r.isConstructed,...t},lenBlock:{...e,isIndefiniteForm:!!r.isIndefiniteForm},...r},yo),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(t,e,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(t,e,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return uo.prototype.onAsciiEncoding.call(this);{const t=[],e=this.valueBlock.valueHexView;for(const r of e)t.push(r.toString(2).padStart(8,"0"));const r=t.join("");return`${this.constructor.NAME} : ${r.substring(0,r.length-this.valueBlock.unusedBits)}`}}}function wo(t,e){const r=new Uint8Array([0]),i=new Uint8Array(t),n=new Uint8Array(e);let s=i.slice(0);const o=s.length-1,a=n.slice(0),h=a.length-1;let u=0,c=0;for(let t=h<o?o:h;t>=0;t--,c++)u=1==c<a.length?s[o-c]+a[h-c]+r[0]:s[o-c]+r[0],r[0]=u/10,1==c>=s.length?s=is(new Uint8Array([u%10]),s):s[o-c]=u%10;return r[0]>0&&(s=is(r,s)),s}function Mo(t){if(t>=cs.length)for(let e=cs.length;e<=t;e++){const t=new Uint8Array([0]);let r=cs[e-1].slice(0);for(let e=r.length-1;e>=0;e--){const i=new Uint8Array([(r[e]<<1)+t[0]]);t[0]=i[0]/10,r[e]=i[0]%10}t[0]>0&&(r=is(t,r)),cs.push(r)}return cs[t]}function _o(t,e){let r=0;const i=new Uint8Array(t),n=new Uint8Array(e),s=i.slice(0),o=s.length-1,a=n.slice(0),h=a.length-1;let u,c=0;for(let t=h;t>=0;t--,c++)u=s[o-c]-a[h-c]-r,1==u<0?(r=1,s[o-c]=u+10):(r=0,s[o-c]=u);if(r>0)for(let t=o-h+1;t>=0;t--,c++){if(u=s[o-c]-r,!(u<0)){r=0,s[o-c]=u;break}r=1,s[o-c]=u+10}return s.slice()}Rs=vo,_s.BitString=Rs,vo.NAME=gs;class So extends(bs(vs)){constructor({value:t,...e}={}){super(e),this._valueDec=0,e.valueHex&&this.setValueHex(),void 0!==t&&(this.valueDec=t)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ns.call(this)))}set valueDec(t){this._valueDec=t,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(t){const e=t<0?-1*t:t;let r=128;for(let i=1;i<8;i++){if(e<=r){if(t<0){const t=rs(r-e,8,i);return new Uint8Array(t)[0]|=128,t}let n=rs(e,8,i),s=new Uint8Array(n);if(128&s[0]){const t=n.slice(0),e=new Uint8Array(t);n=new ArrayBuffer(n.byteLength+1),s=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)s[r+1]=e[r];s[0]=0}return n}r*=Math.pow(2,8)}return new ArrayBuffer(0)}(t))}get valueDec(){return this._valueDec}fromDER(t,e,r,i=0){const n=this.fromBER(t,e,r);if(-1===n)return n;const s=this.valueHexView;return 0===s[0]&&128&s[1]?this.valueHexView=s.subarray(1):0!==i&&s.length<i&&(i-s.length>1&&(i=s.length+1),this.valueHexView=s.subarray(i-s.length)),n}toDER(t=!1){const e=this.valueHexView;switch(!0){case!!(128&e[0]):{const t=new Uint8Array(this.valueHexView.length+1);t[0]=0,t.set(e,1),this.valueHexView=t}break;case 0===e[0]&&!(128&e[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(t)}fromBER(t,e,r){const i=super.fromBER(t,e,r);return-1===i||this.setValueHex(),i}toBER(t){return t?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const t=8*this.valueHexView.length-1;let e,r=new Uint8Array(8*this.valueHexView.length/3),i=0;const n=this.valueHexView;let s="",o=!1;for(let o=n.byteLength-1;o>=0;o--){e=n[o];for(let n=0;n<8;n++)1&~e||(i===t?(r=_o(Mo(i),r),s="-"):r=wo(r,Mo(i))),i++,e>>=1}for(let t=0;t<r.length;t++)r[t]&&(o=!0),o&&(s+=ls.charAt(r[t]));return!1===o&&(s+=ls.charAt(0)),s}}Ds=So,So.NAME="IntegerValueBlock",Object.defineProperty(Ds.prototype,"valueHex",{set:function(t){this.valueHexView=new Uint8Array(t),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class Eo extends Ss{constructor(t={}){super(t,So),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return os(),BigInt(this.valueBlock.toString())}static fromBigInt(t){os();const e=BigInt(t),r=new us,i=e.toString(16).replace(/^-/,""),n=new Uint8Array(ts.U$.FromHex(i));if(e<0){const t=new Uint8Array(n.length+(128&n[0]?1:0));t[0]|=128;const i=BigInt(`0x${ts.U$.ToHex(t)}`)+e,s=ts._H.toUint8Array(ts.U$.FromHex(i.toString(16)));s[0]|=128,r.write(s)}else 128&n[0]&&r.write(new Uint8Array([0])),r.write(n);return new Eo({valueHex:r.final()})}convertToDER(){const t=new Eo({valueHex:this.valueBlock.valueHexView});return t.valueBlock.toDER(),t}convertFromDER(){return new Eo({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Ns=Eo,_s.Integer=Ns,Eo.NAME="INTEGER";class ko extends Eo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Ls=ko,_s.Enumerated=Ls,ko.NAME="ENUMERATED";class Ao extends(bs(vs)){constructor({valueDec:t=-1,isFirstSid:e=!1,...r}={}){super(r),this.valueDec=t,this.isFirstSid=e}fromBER(t,e,r){if(!r)return e;const i=ts._H.toUint8Array(t);if(!hs(this,i,e,r))return-1;const n=i.subarray(e,e+r);this.valueHexView=new Uint8Array(r);for(let t=0;t<r&&(this.valueHexView[t]=127&n[t],this.blockLength++,128&n[t]);t++);const s=new Uint8Array(this.blockLength);for(let t=0;t<this.blockLength;t++)s[t]=this.valueHexView[t];return this.valueHexView=s,128&n[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=es(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),e+this.blockLength)}set valueBigInt(t){os();let e=BigInt(t).toString(2);for(;e.length%7;)e="0"+e;const r=new Uint8Array(e.length/7);for(let t=0;t<r.length;t++)r[t]=parseInt(e.slice(7*t,7*t+7),2)+(t+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);const e=this.valueHexView,r=new Uint8Array(this.blockLength);for(let t=0;t<this.blockLength-1;t++)r[t]=128|e[t];return r[this.blockLength-1]=e[this.blockLength-1],r.buffer}const e=rs(this.valueDec,7);if(0===e.byteLength)return this.error="Error during encoding SID value",ds;const r=new Uint8Array(e.byteLength);if(!t){const t=new Uint8Array(e),i=e.byteLength-1;for(let e=0;e<i;e++)r[e]=128|t[e];r[i]=t[i]}return r}toString(){let t="";if(this.isHexOnly)t=ts.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let e=this.valueDec;this.valueDec<=39?t="0.":this.valueDec<=79?(t="1.",e-=40):(t="2.",e-=80),t+=e.toString()}else t=this.valueDec.toString();return t}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Ao.NAME="sidBlock";class Io extends vs{constructor({value:t="",...e}={}){super(e),this.value=[],t&&this.fromString(t)}fromBER(t,e,r){let i=e;for(;r>0;){const e=new Ao;if(i=e.fromBER(t,i,r),-1===i)return this.blockLength=0,this.error=e.error,i;0===this.value.length&&(e.isFirstSid=!0),this.blockLength+=e.blockLength,r-=e.blockLength,this.value.push(e)}return i}toBER(t){const e=[];for(let r=0;r<this.value.length;r++){const i=this.value[r].toBER(t);if(0===i.byteLength)return this.error=this.value[r].error,ds;e.push(i)}return as(e)}fromString(t){this.value=[];let e=0,r=0,i="",n=!1;do{if(r=t.indexOf(".",e),i=-1===r?t.substring(e):t.substring(e,r),e=r+1,n){const t=this.value[0];let e=0;switch(t.valueDec){case 0:break;case 1:e=40;break;case 2:e=80;break;default:return void(this.value=[])}const r=parseInt(i,10);if(isNaN(r))return;t.valueDec=r+e,n=!1}else{const t=new Ao;if(i>Number.MAX_SAFE_INTEGER){os();const e=BigInt(i);t.valueBigInt=e}else if(t.valueDec=parseInt(i,10),isNaN(t.valueDec))return;this.value.length||(t.isFirstSid=!0,n=!0),this.value.push(t)}}while(-1!==r)}toString(){let t="",e=!1;for(let r=0;r<this.value.length;r++){e=this.value[r].isHexOnly;let i=this.value[r].toString();0!==r&&(t=`${t}.`),e?(i=`{${i}}`,this.value[r].isFirstSid?t=`2.{${i} - 80}`:t+=i):t+=i}return t}toJSON(){const t={...super.toJSON(),value:this.toString(),sidArray:[]};for(let e=0;e<this.value.length;e++)t.sidArray.push(this.value[e].toJSON());return t}}Io.NAME="ObjectIdentifierValueBlock";class xo extends Ss{constructor(t={}){super(t,Io),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(t){this.valueBlock.fromString(t)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Os=xo,_s.ObjectIdentifier=Os,xo.NAME="OBJECT IDENTIFIER";class Co extends(bs(ys)){constructor({valueDec:t=0,...e}={}){super(e),this.valueDec=t}fromBER(t,e,r){if(0===r)return e;const i=ts._H.toUint8Array(t);if(!hs(this,i,e,r))return-1;const n=i.subarray(e,e+r);this.valueHexView=new Uint8Array(r);for(let t=0;t<r&&(this.valueHexView[t]=127&n[t],this.blockLength++,128&n[t]);t++);const s=new Uint8Array(this.blockLength);for(let t=0;t<this.blockLength;t++)s[t]=this.valueHexView[t];return this.valueHexView=s,128&n[this.blockLength-1]?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=es(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),e+this.blockLength)}toBER(t){if(this.isHexOnly){if(t)return new ArrayBuffer(this.valueHexView.byteLength);const e=this.valueHexView,r=new Uint8Array(this.blockLength);for(let t=0;t<this.blockLength-1;t++)r[t]=128|e[t];return r[this.blockLength-1]=e[this.blockLength-1],r.buffer}const e=rs(this.valueDec,7);if(0===e.byteLength)return this.error="Error during encoding SID value",ds;const r=new Uint8Array(e.byteLength);if(!t){const t=new Uint8Array(e),i=e.byteLength-1;for(let e=0;e<i;e++)r[e]=128|t[e];r[i]=t[i]}return r.buffer}toString(){let t="";return t=this.isHexOnly?ts.U$.ToHex(this.valueHexView):this.valueDec.toString(),t}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Co.NAME="relativeSidBlock";class To extends vs{constructor({value:t="",...e}={}){super(e),this.value=[],t&&this.fromString(t)}fromBER(t,e,r){let i=e;for(;r>0;){const e=new Co;if(i=e.fromBER(t,i,r),-1===i)return this.blockLength=0,this.error=e.error,i;this.blockLength+=e.blockLength,r-=e.blockLength,this.value.push(e)}return i}toBER(t,e){const r=[];for(let e=0;e<this.value.length;e++){const i=this.value[e].toBER(t);if(0===i.byteLength)return this.error=this.value[e].error,ds;r.push(i)}return as(r)}fromString(t){this.value=[];let e=0,r=0,i="";do{r=t.indexOf(".",e),i=-1===r?t.substring(e):t.substring(e,r),e=r+1;const n=new Co;if(n.valueDec=parseInt(i,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(-1!==r);return!0}toString(){let t="",e=!1;for(let r=0;r<this.value.length;r++){e=this.value[r].isHexOnly;let i=this.value[r].toString();0!==r&&(t=`${t}.`),e?(i=`{${i}}`,t+=i):t+=i}return t}toJSON(){const t={...super.toJSON(),value:this.toString(),sidArray:[]};for(let e=0;e<this.value.length;e++)t.sidArray.push(this.value[e].toJSON());return t}}To.NAME="RelativeObjectIdentifierValueBlock";class Po extends Ss{constructor(t={}){super(t,To),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(t){this.valueBlock.fromString(t)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Us=Po,_s.RelativeObjectIdentifier=Us,Po.NAME="RelativeObjectIdentifier";class Bo extends uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}Fs=Bo,_s.Sequence=Fs,Bo.NAME="SEQUENCE";class Ro extends uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}js=Ro,_s.Set=js,Ro.NAME="SET";class Do extends(bs(vs)){constructor({...t}={}){super(t),this.isHexOnly=!0,this.value=""}toJSON(){return{...super.toJSON(),value:this.value}}}Do.NAME="StringValueBlock";class No extends Do{}No.NAME="SimpleStringValueBlock";class Lo extends ks{constructor({...t}={}){super(t,No)}fromBuffer(t){this.valueBlock.value=String.fromCharCode.apply(null,ts._H.toUint8Array(t))}fromString(t){const e=t.length,r=this.valueBlock.valueHexView=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t.charCodeAt(i);this.valueBlock.value=t}}Lo.NAME="SIMPLE STRING";class Oo extends Lo{fromBuffer(t){this.valueBlock.valueHexView=ts._H.toUint8Array(t);try{this.valueBlock.value=ts.U$.ToUtf8String(t)}catch(e){this.warnings.push(`Error during "decodeURIComponent": ${e}, using raw string`),this.valueBlock.value=ts.U$.ToBinary(t)}}fromString(t){this.valueBlock.valueHexView=new Uint8Array(ts.U$.FromUtf8String(t)),this.valueBlock.value=t}}Oo.NAME="Utf8StringValueBlock";class Uo extends Oo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Vs=Uo,_s.Utf8String=Vs,Uo.NAME="UTF8String";class Fo extends Lo{fromBuffer(t){this.valueBlock.value=ts.U$.ToUtf16String(t),this.valueBlock.valueHexView=ts._H.toUint8Array(t)}fromString(t){this.valueBlock.value=t,this.valueBlock.valueHexView=new Uint8Array(ts.U$.FromUtf16String(t))}}Fo.NAME="BmpStringValueBlock";class jo extends Fo{constructor({...t}={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}qs=jo,_s.BmpString=qs,jo.NAME="BMPString";class Vo extends Lo{fromBuffer(t){const e=ArrayBuffer.isView(t)?t.slice().buffer:t.slice(0),r=new Uint8Array(e);for(let t=0;t<r.length;t+=4)r[t]=r[t+3],r[t+1]=r[t+2],r[t+2]=0,r[t+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(e))}fromString(t){const e=t.length,r=this.valueBlock.valueHexView=new Uint8Array(4*e);for(let i=0;i<e;i++){const e=rs(t.charCodeAt(i),8),n=new Uint8Array(e);if(n.length>4)continue;const s=4-n.length;for(let t=n.length-1;t>=0;t--)r[4*i+t+s]=n[t]}this.valueBlock.value=t}}Vo.NAME="UniversalStringValueBlock";class qo extends Vo{constructor({...t}={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}zs=qo,_s.UniversalString=zs,qo.NAME="UniversalString";class zo extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}Hs=zo,_s.NumericString=Hs,zo.NAME="NumericString";class Ho extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}$s=Ho,_s.PrintableString=$s,Ho.NAME="PrintableString";class $o extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Ws=$o,_s.TeletexString=Ws,$o.NAME="TeletexString";class Wo extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Ks=Wo,_s.VideotexString=Ks,Wo.NAME="VideotexString";class Ko extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Gs=Ko,_s.IA5String=Gs,Ko.NAME="IA5String";class Go extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}Zs=Go,_s.GraphicString=Zs,Go.NAME="GraphicString";class Zo extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Ys=Zo,_s.VisibleString=Ys,Zo.NAME="VisibleString";class Yo extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Js=Yo,_s.GeneralString=Js,Yo.NAME="GeneralString";class Jo extends Lo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Xs=Jo,_s.CharacterString=Xs,Jo.NAME="CharacterString";class Xo extends Zo{constructor({value:t,valueDate:e,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,t){this.fromString(t),this.valueBlock.valueHexView=new Uint8Array(t.length);for(let e=0;e<t.length;e++)this.valueBlock.valueHexView[e]=t.charCodeAt(e)}e&&(this.fromDate(e),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(t){this.fromString(String.fromCharCode.apply(null,ts._H.toUint8Array(t)))}toBuffer(){const t=this.toString(),e=new ArrayBuffer(t.length),r=new Uint8Array(e);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return e}fromDate(t){this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(t){const e=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(t);if(null===e)return void(this.error="Wrong input string for conversion");const r=parseInt(e[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(e[2],10),this.day=parseInt(e[3],10),this.hour=parseInt(e[4],10),this.minute=parseInt(e[5],10),this.second=parseInt(e[6],10)}toString(t="iso"){if("iso"===t){const t=new Array(7);return t[0]=ss(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=ss(this.month,2),t[2]=ss(this.day,2),t[3]=ss(this.hour,2),t[4]=ss(this.minute,2),t[5]=ss(this.second,2),t[6]="Z",t.join("")}return super.toString(t)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Qs=Xo,_s.UTCTime=Qs,Xo.NAME="UTCTime";class Qo extends Xo{constructor(t={}){var e;super(t),null!==(e=this.millisecond)&&void 0!==e||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(t){super.fromDate(t),this.millisecond=t.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(t){let e,r=!1,i="",n="",s=0,o=0,a=0;if("Z"===t[t.length-1])i=t.substring(0,t.length-1),r=!0;else{const e=new Number(t[t.length-1]);if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");i=t}if(r){if(-1!==i.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==i.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let t=1,e=i.indexOf("+"),r="";if(-1===e&&(e=i.indexOf("-"),t=-1),-1!==e){if(r=i.substring(e+1),i=i.substring(0,e),2!==r.length&&4!==r.length)throw new Error("Wrong input string for conversion");let n=parseInt(r.substring(0,2),10);if(isNaN(n.valueOf()))throw new Error("Wrong input string for conversion");if(o=t*n,4===r.length){if(n=parseInt(r.substring(2,4),10),isNaN(n.valueOf()))throw new Error("Wrong input string for conversion");a=t*n}}}let h=i.indexOf(".");if(-1===h&&(h=i.indexOf(",")),-1!==h){const t=new Number(`0${i.substring(h)}`);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");s=t.valueOf(),n=i.substring(0,h)}else n=i;switch(!0){case 8===n.length:if(e=/(\d{4})(\d{2})(\d{2})/gi,-1!==h)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(e=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==h){let t=60*s;this.minute=Math.floor(t),t=60*(t-this.minute),this.second=Math.floor(t),t=1e3*(t-this.second),this.millisecond=Math.floor(t)}break;case 12===n.length:if(e=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==h){let t=60*s;this.second=Math.floor(t),t=1e3*(t-this.second),this.millisecond=Math.floor(t)}break;case 14===n.length:if(e=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==h){const t=1e3*s;this.millisecond=Math.floor(t)}break;default:throw new Error("Wrong input string for conversion")}const u=e.exec(n);if(null===u)throw new Error("Wrong input string for conversion");for(let t=1;t<u.length;t++)switch(t){case 1:this.year=parseInt(u[t],10);break;case 2:this.month=parseInt(u[t],10);break;case 3:this.day=parseInt(u[t],10);break;case 4:this.hour=parseInt(u[t],10)+o;break;case 5:this.minute=parseInt(u[t],10)+a;break;case 6:this.second=parseInt(u[t],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===r){const t=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=t.getUTCFullYear(),this.month=t.getUTCMonth(),this.day=t.getUTCDay(),this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds(),this.millisecond=t.getUTCMilliseconds()}}toString(t="iso"){if("iso"===t){const t=[];return t.push(ss(this.year,4)),t.push(ss(this.month,2)),t.push(ss(this.day,2)),t.push(ss(this.hour,2)),t.push(ss(this.minute,2)),t.push(ss(this.second,2)),0!==this.millisecond&&(t.push("."),t.push(ss(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(t)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}to=Qo,_s.GeneralizedTime=to,Qo.NAME="GeneralizedTime";class ta extends Uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}eo=ta,_s.DATE=eo,ta.NAME="DATE";class ea extends Uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}ro=ea,_s.TimeOfDay=ro,ea.NAME="TimeOfDay";class ra extends Uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}io=ra,_s.DateTime=io,ra.NAME="DateTime";class ia extends Uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}no=ia,_s.Duration=no,ia.NAME="Duration";class na extends Uo{constructor(t={}){super(t),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}function sa(t,e="utf8"){const r=ln[e];if(null==r)throw new Error(`Unsupported encoding "${e}"`);return r.encoder.encode(t).substring(1)}so=na,_s.TIME=so,na.NAME="TIME";class oa extends Error{constructor(t="An error occurred while signing a message"){super(t),this.name="SigningError"}}class aa extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}}class ha extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}}const ua={get(t=globalThis){const e=t.crypto;if(null==e?.subtle)throw new ha("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};class ca{type="RSA";_key;_raw;_multihash;constructor(t,e){this._key=t,this._multihash=e}get raw(){return null==this._raw&&(this._raw=da(this._key)),this._raw}toMultihash(){return this._multihash}toCID(){return Kt.createV1(114,this._multihash)}toString(){return ct.encode(this.toMultihash().bytes).substring(1)}equals(t){return null!=t&&t.raw instanceof Uint8Array&&te(this.raw,t.raw)}verify(t,e){return async function(t,e,r){const i=await ua.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return ua.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},i,e,r instanceof Uint8Array?r:r.subarray())}(this._key,e,t)}}class la{type="RSA";_key;_raw;publicKey;constructor(t,e){this._key=t,this.publicKey=e}get raw(){return null==this._raw&&(this._raw=function(t){if(null==t.n||null==t.e||null==t.d||null==t.p||null==t.q||null==t.dp||null==t.dq||null==t.qi)throw new T("JWK was missing components");const e=new Bo({value:[new Eo({value:0}),Eo.fromBigInt(pa(dn(t.n,"base64url"))),Eo.fromBigInt(pa(dn(t.e,"base64url"))),Eo.fromBigInt(pa(dn(t.d,"base64url"))),Eo.fromBigInt(pa(dn(t.p,"base64url"))),Eo.fromBigInt(pa(dn(t.q,"base64url"))),Eo.fromBigInt(pa(dn(t.dp,"base64url"))),Eo.fromBigInt(pa(dn(t.dq,"base64url"))),Eo.fromBigInt(pa(dn(t.qi,"base64url")))]}).toBER();return new Uint8Array(e,0,e.byteLength)}(this._key)),this._raw}equals(t){return null!=t&&t.raw instanceof Uint8Array&&te(this.raw,t.raw)}sign(t){return async function(t,e){const r=await ua.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),i=await ua.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)}(this._key,t)}}function da(t){if(null==t.n||null==t.e)throw new T("JWK was missing components");const e=new Bo({value:[new Bo({value:[new xo({value:"1.2.840.113549.1.1.1"}),new fo]}),new vo({valueHex:new Bo({value:[Eo.fromBigInt(pa(dn(t.n,"base64url"))),Eo.fromBigInt(pa(dn(t.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(e,0,e.byteLength)}function fa(t){let e=t.valueBlock.valueHexView;for(;0===e[0];)e=e.subarray(1);return sa(e,"base64url")}function pa(t){const e=[];return t.forEach((function(t){let r=t.toString(16);r.length%2>0&&(r=`0${r}`),e.push(r)})),BigInt("0x"+e.join(""))}function ma(t){const e=function(t){const{result:e}=function(t){if(!t.byteLength){const t=new Ss({},vs);return t.error="Input buffer has zero length",{offset:-1,result:t}}return ao(ts._H.toUint8Array(t).slice(),0,t.byteLength)}(t),r=e.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:fa(r[0]),e:fa(r[1])}}(t);if(function(t){if("RSA"!==t.kty)throw new T("invalid key type");if(null==t.n)throw new T("invalid key modulus");return 8*dn(t.n,"base64url").length}(e)>8192)throw new P("Key size is too large");const r=Vt(18,Qn(Tn.encode({Type:xn.RSA,Data:t})));return new ca(e,r)}const ga=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ba=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ya=new Uint32Array(64);class va extends de{constructor(){super(64,32,8,!1),this.A=0|ba[0],this.B=0|ba[1],this.C=0|ba[2],this.D=0|ba[3],this.E=0|ba[4],this.F=0|ba[5],this.G=0|ba[6],this.H=0|ba[7]}get(){const{A:t,B:e,C:r,D:i,E:n,F:s,G:o,H:a}=this;return[t,e,r,i,n,s,o,a]}set(t,e,r,i,n,s,o,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|i,this.E=0|n,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)ya[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=ya[t-15],r=ya[t-2],i=oe(e,7)^oe(e,18)^e>>>3,n=oe(r,17)^oe(r,19)^r>>>10;ya[t]=n+ya[t-7]+i+ya[t-16]|0}let{A:r,B:i,C:n,D:s,E:o,F:a,G:h,H:u}=this;for(let t=0;t<64;t++){const e=u+(oe(o,6)^oe(o,11)^oe(o,25))+((c=o)&a^~c&h)+ga[t]+ya[t]|0,l=(oe(r,2)^oe(r,13)^oe(r,22))+le(r,i,n)|0;u=h,h=a,a=o,o=s+e|0,s=n,n=i,i=r,r=e+l|0}var c;r=r+this.A|0,i=i+this.B|0,n=n+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,h=h+this.G|0,u=u+this.H|0,this.set(r,i,n,s,o,a,h,u)}roundClean(){ya.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const wa=ue((()=>new va));class Ma extends he{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ee(t.outputLen),ee(t.blockLen)}(t);const r=ae(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?t.create().update(r).digest():r);for(let t=0;t<n.length;t++)n[t]^=54;this.iHash.update(n),this.oHash=t.create();for(let t=0;t<n.length;t++)n[t]^=106;this.oHash.update(n),n.fill(0)}update(t){return ie(this),this.iHash.update(t),this}digestInto(t){ie(this),re(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:i,destroyed:n,blockLen:s,outputLen:o}=this;return t.finished=i,t.destroyed=n,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const _a=(t,e,r)=>new Ma(t,e).update(r).digest();function Sa(t){void 0!==t.lowS&&Ce("lowS",t.lowS),void 0!==t.prehash&&Ce("prehash",t.prehash)}_a.create=(t,e)=>new Ma(t,e);const{Ph:Ea,aT:ka}=a,Aa={Err:class extends Error{constructor(t=""){super(t)}},_tlv:{encode:(t,e)=>{const{Err:r}=Aa;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(1&e.length)throw new r("tlv.encode: unpadded data");const i=e.length/2,n=Be(i);if(n.length/2&128)throw new r("tlv.encode: long form length too big");const s=i>127?Be(n.length/2|128):"";return Be(t)+s+n+e},decode(t,e){const{Err:r}=Aa;let i=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[i++]!==t)throw new r("tlv.decode: wrong tlv");const n=e[i++];let s=0;if(128&n){const t=127&n;if(!t)throw new r("tlv.decode(long): indefinite length not supported");if(t>4)throw new r("tlv.decode(long): byte length is too big");const o=e.subarray(i,i+t);if(o.length!==t)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(const t of o)s=s<<8|t;if(i+=t,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=n;const o=e.subarray(i,i+s);if(o.length!==s)throw new r("tlv.decode: wrong value length");return{v:o,l:e.subarray(i+s)}}},_int:{encode(t){const{Err:e}=Aa;if(t<Ia)throw new e("integer: negative integers are not allowed");let r=Be(t);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Aa;if(128&t[0])throw new e("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("invalid signature integer: unnecessary leading zero");return Ea(t)}},toSig(t){const{Err:e,_int:r,_tlv:i}=Aa,n="string"==typeof t?ka(t):t;xe(n);const{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:h}=i.decode(2,s),{v:u,l:c}=i.decode(2,h);if(c.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(u)}},hexFromSig(t){const{_tlv:e,_int:r}=Aa,i=e.encode(2,r.encode(t.r))+e.encode(2,r.encode(t.s));return e.encode(48,i)}},Ia=BigInt(0),xa=BigInt(1),Ca=(BigInt(2),BigInt(3));function Ta(t){const e=function(t){const e=Ar(t);return Xe(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:r,n:i}=e,n=r.BYTES+1,s=2*r.BYTES+1;function o(t){return ar(t,i)}function a(t){return cr(t,i)}const{ProjectivePoint:h,normPrivateKeyToScalar:u,weierstrassEquation:c,isWithinCurveOrder:l}=function(t){const e=function(t){const e=Ar(t);Xe(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:i,a:n}=e;if(r){if(!i.eql(n,i.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:r}=e,i=fr(e.n,e.nBitLength),n=e.toBytes||((t,e,i)=>{const n=e.toAffine();return qe(Uint8Array.from([4]),r.toBytes(n.x),r.toBytes(n.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:r.fromBytes(e.subarray(0,r.BYTES)),y:r.fromBytes(e.subarray(r.BYTES,2*r.BYTES))}});function o(t){const{a:i,b:n}=e,s=r.sqr(t),o=r.mul(s,t);return r.add(r.add(o,r.mul(t,i)),n)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(t){const{allowedPrivateKeyLengths:r,nByteLength:i,wrapPrivateKey:n,n:s}=e;if(r&&"bigint"!=typeof t){if(Ie(t)&&(t=Pe(t)),"string"!=typeof t||!r.includes(t.length))throw new Error("invalid private key");t=t.padStart(2*i,"0")}let o;try{o="bigint"==typeof t?t:Oe(Ve("private key",t,i))}catch(e){throw new Error("invalid private key, expected hex or "+i+" bytes, got "+typeof t)}return n&&(o=ar(o,s)),$e("private key",o,xa,s),o}function h(t){if(!(t instanceof l))throw new Error("ProjectivePoint expected")}const u=Qe(((t,e)=>{const{px:i,py:n,pz:s}=t;if(r.eql(s,r.ONE))return{x:i,y:n};const o=t.is0();null==e&&(e=o?r.ONE:r.inv(s));const a=r.mul(i,e),h=r.mul(n,e),u=r.mul(s,e);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(u,r.ONE))throw new Error("invZ was invalid");return{x:a,y:h}})),c=Qe((t=>{if(t.is0()){if(e.allowInfinityPoint&&!r.is0(t.py))return;throw new Error("bad point: ZERO")}const{x:i,y:n}=t.toAffine();if(!r.isValid(i)||!r.isValid(n))throw new Error("bad point: x or y not FE");const s=r.sqr(n),a=o(i);if(!r.eql(s,a))throw new Error("bad point: equation left != right");if(!t.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class l{constructor(t,e,i){if(this.px=t,this.py=e,this.pz=i,null==t||!r.isValid(t))throw new Error("x required");if(null==e||!r.isValid(e))throw new Error("y required");if(null==i||!r.isValid(i))throw new Error("z required");Object.freeze(this)}static fromAffine(t){const{x:e,y:i}=t||{};if(!t||!r.isValid(e)||!r.isValid(i))throw new Error("invalid affine point");if(t instanceof l)throw new Error("projective point not allowed");const n=t=>r.eql(t,r.ZERO);return n(e)&&n(i)?l.ZERO:new l(e,i,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=r.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(l.fromAffine)}static fromHex(t){const e=l.fromAffine(s(Ve("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return l.BASE.multiply(a(t))}static msm(t,e){return kr(l,i,t,e)}_setWindowSize(t){f.setWindowSize(this,t)}assertValidity(){c(this)}hasEvenY(){const{y:t}=this.toAffine();if(r.isOdd)return!r.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){h(t);const{px:e,py:i,pz:n}=this,{px:s,py:o,pz:a}=t,u=r.eql(r.mul(e,a),r.mul(s,n)),c=r.eql(r.mul(i,a),r.mul(o,n));return u&&c}negate(){return new l(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:i}=e,n=r.mul(i,Ca),{px:s,py:o,pz:a}=this;let h=r.ZERO,u=r.ZERO,c=r.ZERO,d=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),m=r.mul(s,o);return m=r.add(m,m),c=r.mul(s,a),c=r.add(c,c),h=r.mul(t,c),u=r.mul(n,p),u=r.add(h,u),h=r.sub(f,u),u=r.add(f,u),u=r.mul(h,u),h=r.mul(m,h),c=r.mul(n,c),p=r.mul(t,p),m=r.sub(d,p),m=r.mul(t,m),m=r.add(m,c),c=r.add(d,d),d=r.add(c,d),d=r.add(d,p),d=r.mul(d,m),u=r.add(u,d),p=r.mul(o,a),p=r.add(p,p),d=r.mul(p,m),h=r.sub(h,d),c=r.mul(p,f),c=r.add(c,c),c=r.add(c,c),new l(h,u,c)}add(t){h(t);const{px:i,py:n,pz:s}=this,{px:o,py:a,pz:u}=t;let c=r.ZERO,d=r.ZERO,f=r.ZERO;const p=e.a,m=r.mul(e.b,Ca);let g=r.mul(i,o),b=r.mul(n,a),y=r.mul(s,u),v=r.add(i,n),w=r.add(o,a);v=r.mul(v,w),w=r.add(g,b),v=r.sub(v,w),w=r.add(i,s);let M=r.add(o,u);return w=r.mul(w,M),M=r.add(g,y),w=r.sub(w,M),M=r.add(n,s),c=r.add(a,u),M=r.mul(M,c),c=r.add(b,y),M=r.sub(M,c),f=r.mul(p,w),c=r.mul(m,y),f=r.add(c,f),c=r.sub(b,f),f=r.add(b,f),d=r.mul(c,f),b=r.add(g,g),b=r.add(b,g),y=r.mul(p,y),w=r.mul(m,w),b=r.add(b,y),y=r.sub(g,y),y=r.mul(p,y),w=r.add(w,y),g=r.mul(b,w),d=r.add(d,g),g=r.mul(M,w),c=r.mul(v,c),c=r.sub(c,g),g=r.mul(v,b),f=r.mul(M,f),f=r.add(f,g),new l(c,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(l.ZERO)}wNAF(t){return f.wNAFCached(this,t,l.normalizeZ)}multiplyUnsafe(t){const{endo:i,n}=e;$e("scalar",t,Ia,n);const s=l.ZERO;if(t===Ia)return s;if(this.is0()||t===xa)return this;if(!i||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,t,l.normalizeZ);let{k1neg:o,k1:a,k2neg:h,k2:u}=i.splitScalar(t),c=s,d=s,p=this;for(;a>Ia||u>Ia;)a&xa&&(c=c.add(p)),u&xa&&(d=d.add(p)),p=p.double(),a>>=xa,u>>=xa;return o&&(c=c.negate()),h&&(d=d.negate()),d=new l(r.mul(d.px,i.beta),d.py,d.pz),c.add(d)}multiply(t){const{endo:i,n}=e;let s,o;if($e("scalar",t,xa,n),i){const{k1neg:e,k1:n,k2neg:a,k2:h}=i.splitScalar(t);let{p:u,f:c}=this.wNAF(n),{p:d,f:p}=this.wNAF(h);u=f.constTimeNegate(e,u),d=f.constTimeNegate(a,d),d=new l(r.mul(d.px,i.beta),d.py,d.pz),s=u.add(d),o=c.add(p)}else{const{p:e,f:r}=this.wNAF(t);s=e,o=r}return l.normalizeZ([s,o])[0]}multiplyAndAddUnsafe(t,e,r){const i=l.BASE,n=(t,e)=>e!==Ia&&e!==xa&&t.equals(i)?t.multiply(e):t.multiplyUnsafe(e),s=n(this,e).add(n(t,r));return s.is0()?void 0:s}toAffine(t){return u(this,t)}isTorsionFree(){const{h:t,isTorsionFree:r}=e;if(t===xa)return!0;if(r)return r(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:r}=e;return t===xa?this:r?r(l,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return Ce("isCompressed",t),this.assertValidity(),n(l,this,t)}toHex(t=!0){return Ce("isCompressed",t),Pe(this.toRawBytes(t))}}l.BASE=new l(e.Gx,e.Gy,r.ONE),l.ZERO=new l(r.ZERO,r.ONE,r.ZERO);const d=e.nBitLength,f=Er(l,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder:function(t){return He(t,xa,e.n)}}}({...e,toBytes(t,e,i){const n=e.toAffine(),s=r.toBytes(n.x),o=qe;return Ce("isCompressed",i),i?o(Uint8Array.from([e.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(n.y))},fromBytes(t){const e=t.length,i=t[0],o=t.subarray(1);if(e!==n||2!==i&&3!==i){if(e===s&&4===i)return{x:r.fromBytes(o.subarray(0,r.BYTES)),y:r.fromBytes(o.subarray(r.BYTES,2*r.BYTES))};throw new Error("invalid Point, expected length of "+n+", or uncompressed "+s+", got "+e)}{const t=Oe(o);if(!He(t,xa,r.ORDER))throw new Error("Point is not on curve");const e=c(t);let n;try{n=r.sqrt(e)}catch(t){const e=t instanceof Error?": "+t.message:"";throw new Error("Point is not on curve"+e)}return!(1&~i)!=((n&xa)===xa)&&(n=r.neg(n)),{x:t,y:n}}}}),d=t=>Pe(Fe(t,e.nByteLength));function f(t){return t>i>>xa}const p=(t,e,r)=>Oe(t.slice(e,r));class m{constructor(t,e,r){this.r=t,this.s=e,this.recovery=r,this.assertValidity()}static fromCompact(t){const r=e.nByteLength;return t=Ve("compactSignature",t,2*r),new m(p(t,0,r),p(t,r,2*r))}static fromDER(t){const{r:e,s:r}=Aa.toSig(Ve("DER",t));return new m(e,r)}assertValidity(){$e("r",this.r,xa,i),$e("s",this.s,xa,i)}addRecoveryBit(t){return new m(this.r,this.s,t)}recoverPublicKey(t){const{r:i,s:n,recovery:s}=this,u=v(Ve("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const c=2===s||3===s?i+e.n:i;if(c>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const l=1&s?"03":"02",f=h.fromHex(l+d(c)),p=a(c),m=o(-u*p),g=o(n*p),b=h.BASE.multiplyAndAddUnsafe(f,m,g);if(!b)throw new Error("point at infinify");return b.assertValidity(),b}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new m(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Le(this.toDERHex())}toDERHex(){return Aa.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Le(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const g={isValidPrivateKey(t){try{return u(t),!0}catch(t){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const t=mr(e.n);return function(t,e,r=!1){const i=t.length,n=pr(e),s=mr(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=ar(r?Oe(t):Ue(t),e-er)+er;return r?je(o,n):Fe(o,n)}(e.randomBytes(t),e.n)},precompute:(t=8,e=h.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function b(t){const e=Ie(t),r="string"==typeof t,i=(e||r)&&t.length;return e?i===n||i===s:r?i===2*n||i===2*s:t instanceof h}const y=e.bits2int||function(t){if(t.length>8192)throw new Error("input is too large");const r=Oe(t),i=8*t.length-e.nBitLength;return i>0?r>>BigInt(i):r},v=e.bits2int_modN||function(t){return o(y(t))},w=Ke(e.nBitLength);function M(t){return $e("num < 2^"+e.nBitLength,t,Ia,w),Fe(t,e.nByteLength)}const _={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};return h.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return h.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,r=!0){if(b(t))throw new Error("first arg must be private key");if(!b(e))throw new Error("second arg must be public key");return h.fromHex(e).multiply(u(t)).toRawBytes(r)},sign:function(t,i,n=_){const{seed:s,k2sig:c}=function(t,i,n=_){if(["recovered","canonical"].some((t=>t in n)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:c}=e;let{lowS:d,prehash:p,extraEntropy:g}=n;null==d&&(d=!0),t=Ve("msgHash",t),Sa(n),p&&(t=Ve("prehashed msgHash",s(t)));const b=v(t),w=u(i),S=[M(w),M(b)];if(null!=g&&!1!==g){const t=!0===g?c(r.BYTES):g;S.push(Ve("extraEntropy",t))}const E=qe(...S),k=b;return{seed:E,k2sig:function(t){const e=y(t);if(!l(e))return;const r=a(e),i=h.BASE.multiply(e).toAffine(),n=o(i.x);if(n===Ia)return;const s=o(r*o(k+n*w));if(s===Ia)return;let u=(i.x===n?0:2)|Number(i.y&xa),c=s;return d&&f(s)&&(c=function(t){return f(t)?o(-t):t}(s),u^=1),new m(n,c,u)}}}(t,i,n),d=e;return Ye(d.hash.outputLen,d.nByteLength,d.hmac)(s,c)},verify:function(t,r,i,n=S){const s=t;r=Ve("msgHash",r),i=Ve("publicKey",i);const{lowS:u,prehash:c,format:l}=n;if(Sa(n),"strict"in n)throw new Error("options.strict was renamed to lowS");if(void 0!==l&&"compact"!==l&&"der"!==l)throw new Error("format must be compact or der");const d="string"==typeof s||Ie(s),f=!d&&!l&&"object"==typeof s&&null!==s&&"bigint"==typeof s.r&&"bigint"==typeof s.s;if(!d&&!f)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,g;try{if(f&&(p=new m(s.r,s.s)),d){try{"compact"!==l&&(p=m.fromDER(s))}catch(t){if(!(t instanceof Aa.Err))throw t}p||"der"===l||(p=m.fromCompact(s))}g=h.fromHex(i)}catch(t){return!1}if(!p)return!1;if(u&&p.hasHighS())return!1;c&&(r=e.hash(r));const{r:b,s:y}=p,w=v(r),M=a(y),_=o(w*M),E=o(b*M),k=h.BASE.multiplyAndAddUnsafe(g,_,E)?.toAffine();return!!k&&o(k.x)===b},ProjectivePoint:h,Signature:m,utils:g}}function Pa(t){return{hash:t,hmac:(e,...r)=>_a(t,e,function(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];re(i),e+=i.length}const r=new Uint8Array(e);for(let e=0,i=0;e<t.length;e++){const n=t[e];r.set(n,i),i+=n.length}return r}(...r)),randomBytes:ce}}BigInt(4);const Ba=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ra=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Da=BigInt(1),Na=BigInt(2),La=(t,e)=>(t+e/Na)/e;const Oa=fr(Ba,void 0,void 0,{sqrt:function(t){const e=Ba,r=BigInt(3),i=BigInt(6),n=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),h=BigInt(88),u=t*t*t%e,c=u*u*t%e,l=ur(c,r,e)*c%e,d=ur(l,r,e)*c%e,f=ur(d,Na,e)*u%e,p=ur(f,n,e)*f%e,m=ur(p,s,e)*p%e,g=ur(m,a,e)*m%e,b=ur(g,h,e)*g%e,y=ur(b,a,e)*m%e,v=ur(y,r,e)*c%e,w=ur(v,o,e)*p%e,M=ur(w,i,e)*u%e,_=ur(M,Na,e);if(!Oa.eql(Oa.sqr(_),t))throw new Error("Cannot find square root");return _}}),Ua=function(t,e){const r=e=>Ta({...t,...Pa(e)});return Object.freeze({...r(e),create:r})}({a:BigInt(0),b:BigInt(7),Fp:Oa,n:Ra,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Ra,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-Da*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=La(s*t,e),h=La(-i*t,e);let u=ar(t-a*r-h*n,e),c=ar(-a*i-h*s,e);const l=u>o,d=c>o;if(l&&(u=e-u),d&&(c=e-c),u>o||c>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:l,k1:u,k2neg:d,k2:c}}}},wa);function Fa(t){return null!=t&&"function"==typeof t.then&&"function"==typeof t.catch&&"function"==typeof t.finally}BigInt(0),Ua.ProjectivePoint;class ja{type="secp256k1";raw;_key;constructor(t){this._key=function(t){try{return Ua.ProjectivePoint.fromHex(t),t}catch(t){throw new P(String(t))}}(t),this.raw=function(t){return Ua.ProjectivePoint.fromHex(t).toRawBytes(!0)}(this._key)}toMultihash(){return Qt.digest($a(this))}toCID(){return Kt.createV1(114,this.toMultihash())}toString(){return ct.encode(this.toMultihash().bytes).substring(1)}equals(t){return null!=t&&t.raw instanceof Uint8Array&&te(this.raw,t.raw)}verify(t,e){return function(t,e,r){const i=sn.digest(r instanceof Uint8Array?r:r.subarray());if(Fa(i))return i.then((({digest:r})=>Ua.verify(e,r,t))).catch((t=>{throw new aa(String(t))}));try{return Ua.verify(e,i.digest,t)}catch(t){throw new aa(String(t))}}(this._key,e,t)}}class Va{type="secp256k1";raw;publicKey;constructor(t,e){this.raw=function(t){try{return Ua.getPublicKey(t,!0),t}catch(t){throw new B(String(t))}}(t),this.publicKey=new ja(e??function(t){try{return Ua.getPublicKey(t,!0)}catch(t){throw new B(String(t))}}(t))}equals(t){return null!=t&&t.raw instanceof Uint8Array&&te(this.raw,t.raw)}sign(t){return function(t,e){const r=sn.digest(e instanceof Uint8Array?e:e.subarray());if(Fa(r))return r.then((({digest:e})=>Ua.sign(e,t).toDERRawBytes())).catch((t=>{throw new oa(String(t))}));try{return Ua.sign(r.digest,t).toDERRawBytes()}catch(t){throw new oa(String(t))}}(this.raw,t)}}function qa(t){return new ja(t)}async function za(t,e){if("Ed25519"===t)return async function(){const{privateKey:t,publicKey:e}=function(){const t=Wr.utils.randomPrivateKey(),e=Wr.getPublicKey(t);return{privateKey:Gr(t,e),publicKey:e}}();return new Yr(t,e)}();if("secp256k1"===t)return async function(){const t=Ua.utils.randomPrivateKey();return new Va(t)}();if("RSA"===t)return async function(t){if(t>8192)throw new T("Key size is too large");const e=await async function(t){const e=await ua.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await async function(t){if(null==t.privateKey||null==t.publicKey)throw new T("Private and public key are required");return Promise.all([ua.get().subtle.exportKey("jwk",t.privateKey),ua.get().subtle.exportKey("jwk",t.publicKey)])}(e);return{privateKey:r[0],publicKey:r[1]}}(t),r=Vt(18,Qn(Tn.encode({Type:xn.RSA,Data:da(e.publicKey)})));return new la(e.privateKey,new ca(e.publicKey,r))}(e??2048);throw new Q}function Ha(t){const{Type:e,Data:r}=Tn.decode(t),i=r??new Uint8Array;switch(e){case xn.RSA:return ma(i);case xn.Ed25519:return Jr(i);case xn.secp256k1:return qa(i);default:throw new Q}}function $a(t){return Tn.encode({Type:xn[t.type],Data:t.raw})}const Wa=Symbol.for("@libp2p/peer-id");function Ka(t){return Boolean(t?.[Wa])}const Ga=Symbol.for("nodejs.util.inspect.custom");class Za{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Wa]=!0;toString(){return null==this.string&&(this.string=ct.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Kt.createV1(114,this.multihash)}toJSON(){return this.toString()}equals(t){if(null==t)return!1;if(t instanceof Uint8Array)return te(this.multihash.bytes,t);if("string"==typeof t)return this.toString()===t;if(null!=t?.toMultihash()?.bytes)return te(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Ga](){return`PeerId(${this.toString()})`}}class Ya extends Za{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}}class Ja extends Za{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}}class Xa extends Za{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}}class Qa{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=Qt.digest(dn(this.url))}[Ga](){return`PeerId(${this.url})`}[Wa]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Kt.createV1(2336,this.toMultihash())}toJSON(){return this.toString()}equals(t){return null!=t&&(t instanceof Uint8Array&&(t=sa(t)),t.toString()===this.toString())}}function th(t,e){let r;if("1"===t.charAt(0)||"Q"===t.charAt(0))r=qt(ct.decode(`z${t}`));else{if(null==e)throw new T('Please pass a multibase decoder for strings that do not start with "1" or "Q"');r=qt(e.decode(t))}return rh(r)}function eh(t){if("Ed25519"===t.type)return new Ja({multihash:t.toCID().multihash,publicKey:t});if("secp256k1"===t.type)return new Xa({multihash:t.toCID().multihash,publicKey:t});if("RSA"===t.type)return new Ya({multihash:t.toCID().multihash,publicKey:t});throw new Q}function rh(t){if(function(t){return t.code===sn.code}(t))return new Ya({multihash:t});if(function(t){return t.code===Qt.code}(t))try{const e=function(t){const{Type:e,Data:r}=Tn.decode(t.digest),i=r??new Uint8Array;switch(e){case xn.Ed25519:return Jr(i);case xn.secp256k1:return qa(i);default:throw new Q}}(t);if("Ed25519"===e.type)return new Ja({multihash:t,publicKey:e});if("secp256k1"===e.type)return new Xa({multihash:t,publicKey:e})}catch(e){const r=sa(t.digest);return new Qa(new URL(r))}throw new z("Supplied PeerID Multihash is invalid")}function ih(t){if(null==t?.multihash||null==t.version||1===t.version&&114!==t.code&&2336!==t.code)throw new q("Supplied PeerID CID is invalid");if(2336===t.code){const e=sa(t.multihash.digest);return new Qa(new URL(e))}return rh(t.multihash)}function nh(t,e){null==e&&(e=t.reduce(((t,e)=>t+e.length),0));const r=ti(e);let i=0;for(const e of t)r.set(e,i),i+=e.length;return r}const sh=Symbol.for("@achingbrain/uint8arraylist");function oh(t,e){if(null==e||e<0)throw new RangeError("index is out of bounds");let r=0;for(const i of t){const t=r+i.byteLength;if(e<t)return{buf:i,index:e-r};r=t}throw new RangeError("index is out of bounds")}function ah(t){return Boolean(t?.[sh])}class hh{bufs;length;[sh]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(const r of t)if(r instanceof Uint8Array)e+=r.byteLength,this.bufs.push(r);else{if(!ah(r))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");e+=r.byteLength,this.bufs.push(...r.bufs)}this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(const r of t.reverse())if(r instanceof Uint8Array)e+=r.byteLength,this.bufs.unshift(r);else{if(!ah(r))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");e+=r.byteLength,this.bufs.unshift(...r.bufs)}this.length+=e}get(t){const e=oh(this.bufs,t);return e.buf[e.index]}set(t,e){const r=oh(this.bufs,t);r.buf[r.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let r=0;r<t.length;r++)this.set(e+r,t[r]);else{if(!ah(t))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let r=0;r<t.length;r++)this.set(e+r,t.get(r))}}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(t>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(t,e){const{bufs:r,length:i}=this._subList(t,e);return nh(r,i)}subarray(t,e){const{bufs:r,length:i}=this._subList(t,e);return 1===r.length?r[0]:nh(r,i)}sublist(t,e){const{bufs:r,length:i}=this._subList(t,e),n=new hh;return n.length=i,n.bufs=[...r],n}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(0===t&&e===this.length)return{bufs:this.bufs,length:this.length};const r=[];let i=0;for(let n=0;n<this.bufs.length;n++){const s=this.bufs[n],o=i,a=o+s.byteLength;if(i=a,t>=a)continue;const h=t>=o&&t<a,u=e>o&&e<=a;if(h&&u){if(t===o&&e===a){r.push(s);break}const i=t-o;r.push(s.subarray(i,i+(e-t)));break}if(h){if(0===t){r.push(s);continue}r.push(s.subarray(t-o))}else{if(u){if(e===a){r.push(s);break}r.push(s.subarray(0,e-o));break}r.push(s)}}return{bufs:r,length:e-t}}indexOf(t,e=0){if(!(ah(t)||t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),0===t.length)return e>this.length?this.length:e;const i=r.byteLength;if(0===i)throw new TypeError("search must be at least 1 byte long");const n=new Int32Array(256);for(let t=0;t<256;t++)n[t]=-1;for(let t=0;t<i;t++)n[r[t]]=t;const s=n,o=this.byteLength-r.byteLength,a=r.byteLength-1;let h;for(let t=e;t<=o;t+=h){h=0;for(let e=a;e>=0;e--){const i=this.get(t+e);if(r[e]!==i){h=Math.max(1,e-s[i]);break}}if(0===h)return t}return-1}getInt8(t){const e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getInt8(0)}setInt8(t,e){const r=ti(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,e),this.write(r,t)}getInt16(t,e){const r=this.subarray(t,t+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,e)}setInt16(t,e,r){const i=Qr(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,e,r),this.write(i,t)}getInt32(t,e){const r=this.subarray(t,t+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,e)}setInt32(t,e,r){const i=Qr(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,e,r),this.write(i,t)}getBigInt64(t,e){const r=this.subarray(t,t+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,e)}setBigInt64(t,e,r){const i=Qr(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,e,r),this.write(i,t)}getUint8(t){const e=this.subarray(t,t+1);return new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)}setUint8(t,e){const r=ti(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,e),this.write(r,t)}getUint16(t,e){const r=this.subarray(t,t+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,e)}setUint16(t,e,r){const i=Qr(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,e,r),this.write(i,t)}getUint32(t,e){const r=this.subarray(t,t+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,e)}setUint32(t,e,r){const i=Qr(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,e,r),this.write(i,t)}getBigUint64(t,e){const r=this.subarray(t,t+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,e)}setBigUint64(t,e,r){const i=Qr(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,e,r),this.write(i,t)}getFloat32(t,e){const r=this.subarray(t,t+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,e)}setFloat32(t,e,r){const i=Qr(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,e,r),this.write(i,t)}getFloat64(t,e){const r=this.subarray(t,t+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,e)}setFloat64(t,e,r){const i=Qr(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,e,r),this.write(i,t)}equals(t){if(null==t)return!1;if(!(t instanceof hh))return!1;if(t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!te(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){const r=new hh;return r.bufs=t,null==e&&(e=t.reduce(((t,e)=>t+e.byteLength),0)),r.length=e,r}}function uh(t){return null!=t[Symbol.asyncIterator]}const ch=t=>{const e=ci(t),r=ti(e);return fi(t,r),ch.bytes=e,r};function lh(t,e){const r=(e=e??{}).lengthEncoder??ch;function*i(t){const e=r(t.byteLength);e instanceof Uint8Array?yield e:yield*e,t instanceof Uint8Array?yield t:yield*t}return uh(t)?async function*(){for await(const e of t)yield*i(e)}():function*(){for(const e of t)yield*i(e)}()}ch.bytes=0,lh.single=(t,e)=>{const r=(e=e??{}).lengthEncoder??ch;return new hh(r(t.byteLength),t)};class dh extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class fh extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class ph extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}class mh extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}var gh;!function(t){t[t.LENGTH=0]="LENGTH",t[t.DATA=1]="DATA"}(gh||(gh={}));const bh=t=>{const e=pi(t);return bh.bytes=ci(e),e};function yh(t,e){const r=new hh;let i=gh.LENGTH,n=-1;const s=e?.lengthDecoder??bh,o=e?.maxLengthLength??8,a=e?.maxDataLength??4194304;function*h(){for(;r.byteLength>0;){if(i===gh.LENGTH)try{if(n=s(r),n<0)throw new dh("Invalid message length");if(n>a)throw new fh("Message length too long");const t=s.bytes;r.consume(t),null!=e?.onLength&&e.onLength(n),i=gh.DATA}catch(t){if(t instanceof RangeError){if(r.byteLength>o)throw new ph("Message length length too long");break}throw t}if(i===gh.DATA){if(r.byteLength<n)break;const t=r.sublist(0,n);r.consume(n),null!=e?.onData&&e.onData(t),yield t,i=gh.LENGTH}}}return uh(t)?async function*(){for await(const e of t)r.append(e),yield*h();if(r.byteLength>0)throw new mh("Unexpected end of input")}():function*(){for(const e of t)r.append(e),yield*h();if(r.byteLength>0)throw new mh("Unexpected end of input")}()}function vh(){const t={};return t.promise=new Promise(((e,r)=>{t.resolve=e,t.reject=r})),t}bh.bytes=0,yh.fromReader=(t,e)=>{let r=1;return yh(async function*(){for(;;)try{const{done:e,value:i}=await t.next(r);if(!0===e)return;null!=i&&(yield i)}catch(t){if("ERR_UNDER_READ"===t.code)return{done:!0,value:null};throw t}finally{r=1}}(),{...e??{},onLength:t=>{r=t}})};class wh{buffer;mask;top;btm;next;constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return void 0===this.buffer[this.btm]}}class Mh{size;hwm;head;tail;constructor(t={}){this.hwm=t.splitLimit??16,this.head=new wh(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return null!=t?.byteLength?t.byteLength:1}push(t){if(null!=t?.value&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){const e=this.head;this.head=e.next=new wh(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=t?.value&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class _h extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}}function Sh(t={}){return function(t,e){let r,i,n,s=(e=e??{}).onEnd,o=new Mh,a=vh();const h=t=>null!=i?i(t):(o.push(t),r),u=t=>{if(n)return r;if(!0!==e?.objectMode&&null==t?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return h({done:!1,value:t})},c=t=>n?r:(n=!0,null!=t?(t=>(o=new Mh,null!=i?i({error:t}):(o.push({error:t}),r)))(t):h({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return o.isEmpty()?n?{done:!0}:await new Promise(((e,n)=>{i=s=>{i=null,o.push(s);try{e(t(o))}catch(t){n(t)}return r}})):t(o)}finally{o.isEmpty()&&queueMicrotask((()=>{a.resolve(),a=vh()}))}},return:()=>(o=new Mh,c(),{done:!0}),throw:t=>(c(t),{done:!0}),push:u,end:c,get readableLength(){return o.size},onEmpty:async t=>{const e=t?.signal;if(e?.throwIfAborted(),o.isEmpty())return;let r,i;null!=e&&(r=new Promise(((t,r)=>{i=()=>{r(new _h)},e.addEventListener("abort",i)})));try{await Promise.race([a.promise,r])}finally{null!=i&&null!=e&&e?.removeEventListener("abort",i)}}},null==s)return r;const l=r;return r={[Symbol.asyncIterator](){return this},next:()=>l.next(),throw:t=>(l.throw(t),null!=s&&(s(t),s=void 0),{done:!0}),return:()=>(l.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:t=>(l.end(t),null!=s&&(s(t),s=void 0),r),get readableLength(){return l.readableLength},onEmpty:t=>l.onEmpty(t)},r}((t=>{const e=t.shift();if(null==e)return{done:!0};if(null!=e.error)throw e.error;return{done:!0===e.done,value:e.value}}),t)}const Eh=function(...t){const e=[];for(const r of t)null==r[Symbol.asyncIterator]&&e.push(r);return e.length===t.length?function*(){for(const t of e)yield*t}():async function*(){const e=Sh({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(t.map((async t=>{for await(const r of t)e.push(r)}))),e.end()}catch(t){e.end(t)}})),yield*e}()};function kh(t,...e){if(null==t)throw new Error("Empty pipeline");if(Ch(t)){const e=t;t=()=>e.source}else if(xh(t)||Ih(t)){const e=t;t=()=>e}const r=[t,...e];if(r.length>1&&Ch(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let t=1;t<r.length-1;t++)Ch(r[t])&&(r[t]=Th(r[t]));return Ah(...r)}const Ah=(...t)=>{let e;for(;t.length>0;)e=t.shift()(e);return e},Ih=t=>null!=t?.[Symbol.asyncIterator],xh=t=>null!=t?.[Symbol.iterator],Ch=t=>null!=t&&null!=t.sink&&null!=t.source,Th=t=>e=>{const r=t.sink(e);if(null!=r?.then){const e=Sh({objectMode:!0});let i;r.then((()=>{e.end()}),(t=>{e.end(t)}));const n=t.source;if(Ih(n))i=async function*(){yield*n,e.end()};else{if(!xh(n))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");i=function*(){yield*n,e.end()}}return Eh(e,i())}return t.source},Ph="/floodsub/1.0.0",Bh="/meshsub/1.0.0",Rh="/meshsub/1.2.0",Dh=5e3,Nh={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxIdontwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Lh,Oh,Uh,Fh,jh,Vh,qh,zh,Hh,$h,Wh,Kh;!function(t){let e,r,i,n,s,o,a,h,u,c;!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.subscribe&&(e.uint32(8),e.bool(t.subscribe)),null!=t.topic&&(e.uint32(18),e.string(t.topic)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.subscribe=t.bool();break;case 2:i.topic=t.string();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(e=t.SubOpts||(t.SubOpts={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.from&&(e.uint32(10),e.bytes(t.from)),null!=t.data&&(e.uint32(18),e.bytes(t.data)),null!=t.seqno&&(e.uint32(26),e.bytes(t.seqno)),null!=t.topic&&""!==t.topic&&(e.uint32(34),e.string(t.topic)),null!=t.signature&&(e.uint32(42),e.bytes(t.signature)),null!=t.key&&(e.uint32(50),e.bytes(t.key)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={topic:""},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.from=t.bytes();break;case 2:i.data=t.bytes();break;case 3:i.seqno=t.bytes();break;case 4:i.topic=t.string();break;case 5:i.signature=t.bytes();break;case 6:i.key=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(r=t.Message||(t.Message={})),function(e){let r;e.codec=()=>(null==r&&(r=Dn(((e,r,i={})=>{if(!1!==i.lengthDelimited&&r.fork(),null!=e.ihave)for(const i of e.ihave)r.uint32(10),t.ControlIHave.codec().encode(i,r);if(null!=e.iwant)for(const i of e.iwant)r.uint32(18),t.ControlIWant.codec().encode(i,r);if(null!=e.graft)for(const i of e.graft)r.uint32(26),t.ControlGraft.codec().encode(i,r);if(null!=e.prune)for(const i of e.prune)r.uint32(34),t.ControlPrune.codec().encode(i,r);if(null!=e.idontwant)for(const i of e.idontwant)r.uint32(42),t.ControlIDontWant.codec().encode(i,r);!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={ihave:[],iwant:[],graft:[],prune:[],idontwant:[]},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:if(null!=i.limits?.ihave&&n.ihave.length===i.limits.ihave)throw new Nn('Decode error - map field "ihave" had too many elements');n.ihave.push(t.ControlIHave.codec().decode(e,e.uint32(),{limits:i.limits?.ihave$}));break;case 2:if(null!=i.limits?.iwant&&n.iwant.length===i.limits.iwant)throw new Nn('Decode error - map field "iwant" had too many elements');n.iwant.push(t.ControlIWant.codec().decode(e,e.uint32(),{limits:i.limits?.iwant$}));break;case 3:if(null!=i.limits?.graft&&n.graft.length===i.limits.graft)throw new Nn('Decode error - map field "graft" had too many elements');n.graft.push(t.ControlGraft.codec().decode(e,e.uint32(),{limits:i.limits?.graft$}));break;case 4:if(null!=i.limits?.prune&&n.prune.length===i.limits.prune)throw new Nn('Decode error - map field "prune" had too many elements');n.prune.push(t.ControlPrune.codec().decode(e,e.uint32(),{limits:i.limits?.prune$}));break;case 5:if(null!=i.limits?.idontwant&&n.idontwant.length===i.limits.idontwant)throw new Nn('Decode error - map field "idontwant" had too many elements');n.idontwant.push(t.ControlIDontWant.codec().decode(e,e.uint32(),{limits:i.limits?.idontwant$}));break;default:e.skipType(7&r)}}return n}))),r),e.encode=t=>An(t,e.codec()),e.decode=(t,r)=>Ti(t,e.codec(),r)}(i=t.ControlMessage||(t.ControlMessage={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.topicID&&(e.uint32(10),e.string(t.topicID)),null!=t.messageIDs)for(const r of t.messageIDs)e.uint32(18),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={messageIDs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.topicID=t.string();break;case 2:if(null!=r.limits?.messageIDs&&i.messageIDs.length===r.limits.messageIDs)throw new Nn('Decode error - map field "messageIDs" had too many elements');i.messageIDs.push(t.bytes());break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(n=t.ControlIHave||(t.ControlIHave={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.messageIDs)for(const r of t.messageIDs)e.uint32(10),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={messageIDs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();if(e>>>3==1){if(null!=r.limits?.messageIDs&&i.messageIDs.length===r.limits.messageIDs)throw new Nn('Decode error - map field "messageIDs" had too many elements');i.messageIDs.push(t.bytes())}else t.skipType(7&e)}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(s=t.ControlIWant||(t.ControlIWant={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.topicID&&(e.uint32(10),e.string(t.topicID)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();e>>>3==1?i.topicID=t.string():t.skipType(7&e)}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(o=t.ControlGraft||(t.ControlGraft={})),function(e){let r;e.codec=()=>(null==r&&(r=Dn(((e,r,i={})=>{if(!1!==i.lengthDelimited&&r.fork(),null!=e.topicID&&(r.uint32(10),r.string(e.topicID)),null!=e.peers)for(const i of e.peers)r.uint32(18),t.PeerInfo.codec().encode(i,r);null!=e.backoff&&(r.uint32(24),r.uint64Number(e.backoff)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={peers:[]},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.topicID=e.string();break;case 2:if(null!=i.limits?.peers&&n.peers.length===i.limits.peers)throw new Nn('Decode error - map field "peers" had too many elements');n.peers.push(t.PeerInfo.codec().decode(e,e.uint32(),{limits:i.limits?.peers$}));break;case 3:n.backoff=e.uint64Number();break;default:e.skipType(7&r)}}return n}))),r),e.encode=t=>An(t,e.codec()),e.decode=(t,r)=>Ti(t,e.codec(),r)}(a=t.ControlPrune||(t.ControlPrune={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.peerID&&(e.uint32(10),e.bytes(t.peerID)),null!=t.signedPeerRecord&&(e.uint32(18),e.bytes(t.signedPeerRecord)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.peerID=t.bytes();break;case 2:i.signedPeerRecord=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(h=t.PeerInfo||(t.PeerInfo={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.messageIDs)for(const r of t.messageIDs)e.uint32(10),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={messageIDs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();if(e>>>3==1){if(null!=r.limits?.messageIDs&&i.messageIDs.length===r.limits.messageIDs)throw new Nn('Decode error - map field "messageIDs" had too many elements');i.messageIDs.push(t.bytes())}else t.skipType(7&e)}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(u=t.ControlIDontWant||(t.ControlIDontWant={})),t.codec=()=>(null==c&&(c=Dn(((e,r,i={})=>{if(!1!==i.lengthDelimited&&r.fork(),null!=e.subscriptions)for(const i of e.subscriptions)r.uint32(10),t.SubOpts.codec().encode(i,r);if(null!=e.messages)for(const i of e.messages)r.uint32(18),t.Message.codec().encode(i,r);null!=e.control&&(r.uint32(26),t.ControlMessage.codec().encode(e.control,r)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={subscriptions:[],messages:[]},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:if(null!=i.limits?.subscriptions&&n.subscriptions.length===i.limits.subscriptions)throw new Nn('Decode error - map field "subscriptions" had too many elements');n.subscriptions.push(t.SubOpts.codec().decode(e,e.uint32(),{limits:i.limits?.subscriptions$}));break;case 2:if(null!=i.limits?.messages&&n.messages.length===i.limits.messages)throw new Nn('Decode error - map field "messages" had too many elements');n.messages.push(t.Message.codec().decode(e,e.uint32(),{limits:i.limits?.messages$}));break;case 3:n.control=t.ControlMessage.codec().decode(e,e.uint32(),{limits:i.limits?.control});break;default:e.skipType(7&r)}}return n}))),c),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Lh||(Lh={}));class Gh{gossip;msgs=new Map;msgIdToStrFn;history=[];notValidatedCount=0;constructor(t,e,r){this.gossip=t,this.msgIdToStrFn=r;for(let t=0;t<e;t++)this.history[t]=[]}get size(){return this.msgs.size}put(t,e,r=!1){const{msgIdStr:i}=t;return!this.msgs.has(i)&&(this.msgs.set(i,{message:e,validated:r,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...t,topic:e.topic}),r||this.notValidatedCount++,!0)}observeDuplicate(t,e){const r=this.msgs.get(t);null==r||r.validated||r.originatingPeers.add(e)}get(t){return this.msgs.get(this.msgIdToStrFn(t))?.message}getWithIWantCount(t,e){const r=this.msgs.get(t);if(null==r)return null;const i=(r.iwantCounts.get(e)??0)+1;return r.iwantCounts.set(e,i),{msg:r.message,count:i}}getGossipIDs(t){const e=new Map;for(let r=0;r<this.gossip;r++)this.history[r].forEach((r=>{const i=this.msgs.get(r.msgIdStr);if(i?.validated&&t.has(r.topic)){let t=e.get(r.topic);null==t&&(t=[],e.set(r.topic,t)),t.push(r.msgId)}}));return e}validate(t){const e=this.msgs.get(t);if(null==e)return null;e.validated||this.notValidatedCount--;const{message:r,originatingPeers:i}=e;return e.validated=!0,e.originatingPeers=new Set,{message:r,originatingPeers:i}}shift(){this.history[this.history.length-1].forEach((t=>{const e=this.msgs.get(t.msgIdStr);null!=e&&(this.msgs.delete(t.msgIdStr),e.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(t){const e=this.msgs.get(t);return null==e?null:(this.msgs.delete(t),e)}}function Zh(t){switch(t){case _.Ignore:return Fh.Ignore;case _.Reject:return Fh.Reject;default:throw new Error("Unreachable")}}!function(t){t.StrictSign="StrictSign",t.StrictNoSign="StrictNoSign"}(Oh||(Oh={})),function(t){t[t.Signing=0]="Signing",t[t.Anonymous=1]="Anonymous"}(Uh||(Uh={})),function(t){t.Error="error",t.Ignore="ignore",t.Reject="reject",t.Blacklisted="blacklisted"}(Fh||(Fh={})),function(t){t.InvalidSignature="invalid_signature",t.InvalidSeqno="invalid_seqno",t.InvalidPeerId="invalid_peerid",t.SignaturePresent="signature_present",t.SeqnoPresent="seqno_present",t.FromPresent="from_present",t.TransformFailed="transform_failed"}(jh||(jh={})),function(t){t.duplicate="duplicate",t.invalid="invalid",t.valid="valid"}(Vh||(Vh={})),function(t){t.forward="forward",t.publish="publish"}(qh||(qh={})),function(t){t.Fanout="fanout",t.Random="random",t.Subscribed="subscribed",t.Outbound="outbound",t.NotEnough="not_enough",t.Opportunistic="opportunistic"}(zh||(zh={})),function(t){t.Dc="disconnected",t.BadScore="bad_score",t.Prune="prune",t.Excess="excess"}(Hh||(Hh={})),function(t){t.GraftBackoff="graft_backoff",t.BrokenPromise="broken_promise",t.MessageDeficit="message_deficit",t.IPColocation="IP_colocation"}($h||($h={})),function(t){t.LowScore="low_score",t.MaxIhave="max_ihave",t.MaxIasked="max_iasked"}(Wh||(Wh={})),function(t){t.graylist="graylist",t.publish="publish",t.gossip="gossip",t.mesh="mesh"}(Kh||(Kh={}));class Yh extends Error{static name="InvalidPeerScoreParamsError";constructor(t="Invalid peer score params"){super(t),this.name="InvalidPeerScoreParamsError"}}Error;const Jh={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},Xh={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function Qh(t={}){return{...Jh,...t,topics:null!=t.topics?Object.entries(t.topics).reduce(((t,[e,r])=>(t[e]=function(t={}){return{...Xh,...t}}(r),t)),{}):{}}}function tu(t){if(t.topicWeight<0)throw new Yh("invalid topic weight; must be >= 0");if(0===t.timeInMeshQuantum)throw new Yh("invalid TimeInMeshQuantum; must be non zero");if(t.timeInMeshWeight<0)throw new Yh("invalid TimeInMeshWeight; must be positive (or 0 to disable)");if(0!==t.timeInMeshWeight&&t.timeInMeshQuantum<=0)throw new Yh("invalid TimeInMeshQuantum; must be positive");if(0!==t.timeInMeshWeight&&t.timeInMeshCap<=0)throw new Yh("invalid TimeInMeshCap; must be positive");if(t.firstMessageDeliveriesWeight<0)throw new Yh("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)");if(0!==t.firstMessageDeliveriesWeight&&(t.firstMessageDeliveriesDecay<=0||t.firstMessageDeliveriesDecay>=1))throw new Yh("invalid FirstMessageDeliveriesDecay; must be between 0 and 1");if(0!==t.firstMessageDeliveriesWeight&&t.firstMessageDeliveriesCap<=0)throw new Yh("invalid FirstMessageDeliveriesCap; must be positive");if(t.meshMessageDeliveriesWeight>0)throw new Yh("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)");if(0!==t.meshMessageDeliveriesWeight&&(t.meshMessageDeliveriesDecay<=0||t.meshMessageDeliveriesDecay>=1))throw new Yh("invalid MeshMessageDeliveriesDecay; must be between 0 and 1");if(0!==t.meshMessageDeliveriesWeight&&t.meshMessageDeliveriesCap<=0)throw new Yh("invalid MeshMessageDeliveriesCap; must be positive");if(0!==t.meshMessageDeliveriesWeight&&t.meshMessageDeliveriesThreshold<=0)throw new Yh("invalid MeshMessageDeliveriesThreshold; must be positive");if(t.meshMessageDeliveriesWindow<0)throw new Yh("invalid MeshMessageDeliveriesWindow; must be non-negative");if(0!==t.meshMessageDeliveriesWeight&&t.meshMessageDeliveriesActivation<1e3)throw new Yh("invalid MeshMessageDeliveriesActivation; must be at least 1s");if(t.meshFailurePenaltyWeight>0)throw new Yh("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)");if(0!==t.meshFailurePenaltyWeight&&(t.meshFailurePenaltyDecay<=0||t.meshFailurePenaltyDecay>=1))throw new Yh("invalid MeshFailurePenaltyDecay; must be between 0 and 1");if(t.invalidMessageDeliveriesWeight>0)throw new Yh("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)");if(t.invalidMessageDeliveriesDecay<=0||t.invalidMessageDeliveriesDecay>=1)throw new Yh("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1")}const eu={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function ru(t={}){return{...eu,...t}}function iu(t,e,r=()=>!0){const i=new Set;if(e<=0)return i;for(const n of t){if(i.size>=e)break;r(n)&&(i.add(n),t.delete(n))}return i}class nu extends Map{getDefault;constructor(t){super(),this.getDefault=t}getOrDefault(t){let e=super.get(t);return void 0===e&&(e=this.getDefault(),this.set(t,e)),e}}function su(t,e,r,i){let n=0;Object.entries(e.topics).forEach((([t,e])=>{const i=r.topics[t];if(void 0===i)return;let s=0;if(e.inMesh){let t=e.meshTime/i.timeInMeshQuantum;t>i.timeInMeshCap&&(t=i.timeInMeshCap),s+=t*i.timeInMeshWeight}let o=e.firstMessageDeliveries;if(o>i.firstMessageDeliveriesCap&&(o=i.firstMessageDeliveriesCap),s+=o*i.firstMessageDeliveriesWeight,e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<i.meshMessageDeliveriesThreshold){const t=i.meshMessageDeliveriesThreshold-e.meshMessageDeliveries;s+=t*t*i.meshMessageDeliveriesWeight}s+=e.meshFailurePenalty*i.meshFailurePenaltyWeight,s+=e.invalidMessageDeliveries*e.invalidMessageDeliveries*i.invalidMessageDeliveriesWeight,n+=s*i.topicWeight})),r.topicScoreCap>0&&n>r.topicScoreCap&&(n=r.topicScoreCap);const s=r.appSpecificScore(t);if(n+=s*r.appSpecificWeight,e.knownIPs.forEach((t=>{if(r.IPColocationFactorWhitelist.has(t))return;const e=i.get(t),s=null!=e?e.size:0;if(s>r.IPColocationFactorThreshold){const t=s-r.IPColocationFactorThreshold;n+=t*t*r.IPColocationFactorWeight}})),e.behaviourPenalty>r.behaviourPenaltyThreshold){const t=e.behaviourPenalty-r.behaviourPenaltyThreshold;n+=t*t*r.behaviourPenaltyWeight}return n}var ou,au=r(6757);!function(t){t[t.unknown=0]="unknown",t[t.valid=1]="valid",t[t.invalid=2]="invalid",t[t.ignored=3]="ignored"}(ou||(ou={}));class hu{records;queue;constructor(){this.records=new Map,this.queue=new au}getRecord(t){return this.records.get(t)}ensureRecord(t){let e=this.records.get(t);if(null!=e)return e;e={status:ou.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(t,e);const r={msgId:t,expire:Date.now()+12e4};return this.queue.push(r),e}gc(){const t=Date.now();let e=this.queue.peekFront();for(;null!=e&&e.expire<t;)this.records.delete(e.msgId),this.queue.shift(),e=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class uu{params;metrics;peerStats=new Map;peerIPs=new nu((()=>new Set));scoreCache=new Map;deliveryRecords=new hu;_backgroundInterval;scoreCacheValidityMs;computeScore;log;constructor(t,e,r,i){this.params=t,this.metrics=e,function(t){for(const[e,r]of Object.entries(t.topics))try{tu(r)}catch(t){throw new Yh(`invalid score parameters for topic ${e}: ${t.message}`)}if(t.topicScoreCap<0)throw new Yh("invalid topic score cap; must be positive (or 0 for no cap)");if(null===t.appSpecificScore||void 0===t.appSpecificScore)throw new Yh("missing application specific score function");if(t.IPColocationFactorWeight>0)throw new Yh("invalid IPColocationFactorWeight; must be negative (or 0 to disable)");if(0!==t.IPColocationFactorWeight&&t.IPColocationFactorThreshold<1)throw new Yh("invalid IPColocationFactorThreshold; must be at least 1");if(t.behaviourPenaltyWeight>0)throw new Yh("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)");if(0!==t.behaviourPenaltyWeight&&(t.behaviourPenaltyDecay<=0||t.behaviourPenaltyDecay>=1))throw new Yh("invalid BehaviourPenaltyDecay; must be between 0 and 1");if(t.decayInterval<1e3)throw new Yh("invalid DecayInterval; must be at least 1s");if(t.decayToZero<=0||t.decayToZero>=1)throw new Yh("invalid DecayToZero; must be between 0 and 1")}(t),this.scoreCacheValidityMs=i.scoreCacheValidityMs,this.computeScore=i.computeScore??su,this.log=r.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){null==this._backgroundInterval?(this._backgroundInterval=setInterval((()=>{this.background()}),this.params.decayInterval),this.log("started")):this.log("Peer score already running")}stop(){null!=this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")):this.log("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([t,e])=>[t,e])))}messageFirstSeenTimestampMs(t){const e=this.deliveryRecords.getRecord(t);return null!=e?e.firstSeenTsMs:null}refreshScores(){const t=Date.now(),e=this.params.decayToZero;this.peerStats.forEach(((r,i)=>{r.connected?(Object.entries(r.topics).forEach((([r,i])=>{const n=this.params.topics[r];void 0!==n&&(i.firstMessageDeliveries*=n.firstMessageDeliveriesDecay,i.firstMessageDeliveries<e&&(i.firstMessageDeliveries=0),i.meshMessageDeliveries*=n.meshMessageDeliveriesDecay,i.meshMessageDeliveries<e&&(i.meshMessageDeliveries=0),i.meshFailurePenalty*=n.meshFailurePenaltyDecay,i.meshFailurePenalty<e&&(i.meshFailurePenalty=0),i.invalidMessageDeliveries*=n.invalidMessageDeliveriesDecay,i.invalidMessageDeliveries<e&&(i.invalidMessageDeliveries=0),i.inMesh&&(i.meshTime=t-i.graftTime,i.meshTime>n.meshMessageDeliveriesActivation&&(i.meshMessageDeliveriesActive=!0)))})),r.behaviourPenalty*=this.params.behaviourPenaltyDecay,r.behaviourPenalty<e&&(r.behaviourPenalty=0)):t>r.expire&&(this.removeIPsForPeer(i,r.knownIPs),this.peerStats.delete(i),this.scoreCache.delete(i))}))}score(t){this.metrics?.scoreFnCalls.inc();const e=this.peerStats.get(t);if(null==e)return 0;const r=Date.now(),i=this.scoreCache.get(t);if(null!=i&&i.cacheUntil>r)return i.score;this.metrics?.scoreFnRuns.inc();const n=this.computeScore(t,e,this.params,this.peerIPs),s=r+this.scoreCacheValidityMs;return null!=i?(this.metrics?.scoreCachedDelta.observe(Math.abs(n-i.score)),i.score=n,i.cacheUntil=s):this.scoreCache.set(t,{score:n,cacheUntil:s}),n}addPenalty(t,e,r){const i=this.peerStats.get(t);null!=i&&(i.behaviourPenalty+=e,this.metrics?.onScorePenalty(r))}addPeer(t){const e={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(t,e)}addIP(t,e){const r=this.peerStats.get(t);null!=r&&r.knownIPs.add(e),this.peerIPs.getOrDefault(e).add(t)}removeIP(t,e){const r=this.peerStats.get(t);null!=r&&r.knownIPs.delete(e);const i=this.peerIPs.get(e);null!=i&&(i.delete(t),0===i.size&&this.peerIPs.delete(e))}removePeer(t){const e=this.peerStats.get(t);if(null!=e){if(this.score(t)>0)return this.removeIPsForPeer(t,e.knownIPs),void this.peerStats.delete(t);Object.entries(e.topics).forEach((([t,e])=>{e.firstMessageDeliveries=0;const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.inMesh&&e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r){const t=r-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.inMesh=!1,e.meshMessageDeliveriesActive=!1})),e.connected=!1,e.expire=Date.now()+this.params.retainScore}}graft(t,e){const r=this.peerStats.get(t);if(null!=r){const t=this.getPtopicStats(r,e);null!=t&&(t.inMesh=!0,t.graftTime=Date.now(),t.meshTime=0,t.meshMessageDeliveriesActive=!1)}}prune(t,e){const r=this.peerStats.get(t);if(null!=r){const t=this.getPtopicStats(r,e);if(null!=t){const r=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r){const e=r-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.meshMessageDeliveriesActive=!1,t.inMesh=!1}}}validateMessage(t){this.deliveryRecords.ensureRecord(t)}deliverMessage(t,e,r){this.markFirstMessageDelivery(t,r);const i=this.deliveryRecords.ensureRecord(e),n=Date.now();i.status===ou.unknown?(i.status=ou.valid,i.validated=n,i.peers.forEach((e=>{e!==t.toString()&&this.markDuplicateMessageDelivery(e,r)}))):this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",t,n-i.firstSeenTsMs,ou[i.status])}rejectInvalidMessage(t,e){this.markInvalidMessageDelivery(t,e)}rejectMessage(t,e,r,i){switch(i){case Fh.Error:return void this.markInvalidMessageDelivery(t,r);case Fh.Blacklisted:return}const n=this.deliveryRecords.ensureRecord(e);if(n.status===ou.unknown){if(i===Fh.Ignore)return n.status=ou.ignored,void n.peers.clear();n.status=ou.invalid,this.markInvalidMessageDelivery(t,r),n.peers.forEach((t=>{this.markInvalidMessageDelivery(t,r)})),n.peers.clear()}else this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",t,Date.now()-n.firstSeenTsMs,ou[n.status])}duplicateMessage(t,e,r){const i=this.deliveryRecords.ensureRecord(e);if(!i.peers.has(t))switch(i.status){case ou.unknown:i.peers.add(t);break;case ou.valid:i.peers.add(t),this.markDuplicateMessageDelivery(t,r,i.validated);break;case ou.invalid:this.markInvalidMessageDelivery(t,r);case ou.ignored:}}markInvalidMessageDelivery(t,e){const r=this.peerStats.get(t);if(null!=r){const t=this.getPtopicStats(r,e);null!=t&&(t.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(t,e){const r=this.peerStats.get(t);if(null!=r){const t=this.getPtopicStats(r,e);if(null!=t){let r=this.params.topics[e].firstMessageDeliveriesCap;t.firstMessageDeliveries=Math.min(r,t.firstMessageDeliveries+1),t.inMesh&&(r=this.params.topics[e].meshMessageDeliveriesCap,t.meshMessageDeliveries=Math.min(r,t.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(t,e,r){const i=this.peerStats.get(t);if(null!=i){const t=void 0!==r?Date.now():0,n=this.getPtopicStats(i,e);if(null!=n&&n.inMesh){const i=this.params.topics[e];if(void 0!==r){const n=t-r,s=n>i.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(e,n,s),s)return}const s=i.meshMessageDeliveriesCap;n.meshMessageDeliveries=Math.min(s,n.meshMessageDeliveries+1)}}}removeIPsForPeer(t,e){for(const r of e){const e=this.peerIPs.get(r);null!=e&&(e.delete(t),0===e.size&&this.peerIPs.delete(r))}}getPtopicStats(t,e){let r=t.topics[e];return void 0!==r?r:void 0!==this.params.topics[e]?(r={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},t.topics[e]=r,r):null}}function cu(t,e,r,i,n){let s=0;const o=new Map;if(Object.entries(e.topics).forEach((([t,e])=>{const i=n.get(t)??"unknown",a=r.topics[t];if(void 0===a)return;let h=o.get(i);null==h&&(h={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(i,h));let u=0,c=0,l=0,d=0,f=0;e.inMesh&&(u+=Math.max(e.meshTime/a.timeInMeshQuantum,a.timeInMeshCap)*a.timeInMeshWeight);let p=e.firstMessageDeliveries;if(p>a.firstMessageDeliveriesCap&&(p=a.firstMessageDeliveriesCap),c+=p*a.firstMessageDeliveriesWeight,e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const t=a.meshMessageDeliveriesThreshold-e.meshMessageDeliveries;l+=t*t*a.meshMessageDeliveriesWeight}d+=e.meshFailurePenalty*a.meshFailurePenaltyWeight,f+=e.invalidMessageDeliveries*e.invalidMessageDeliveries*a.invalidMessageDeliveriesWeight,s+=(u+c+l+d+f)*a.topicWeight,h.p1w+=u,h.p2w+=c,h.p3w+=l,h.p3bw+=d,h.p4w+=f})),r.topicScoreCap>0&&s>r.topicScoreCap){s=r.topicScoreCap;const t=r.topicScoreCap/s;for(const e of o.values())e.p1w*=t,e.p2w*=t,e.p3w*=t,e.p3bw*=t,e.p4w*=t}let a=0,h=0,u=0;return a+=r.appSpecificScore(t)*r.appSpecificWeight,e.knownIPs.forEach((t=>{if(r.IPColocationFactorWhitelist.has(t))return;const e=i.get(t),n=null!=e?e.size:0;if(n>r.IPColocationFactorThreshold){const t=n-r.IPColocationFactorThreshold;h+=t*t*r.IPColocationFactorWeight}})),u+=e.behaviourPenalty*e.behaviourPenalty*r.behaviourPenaltyWeight,s+=a+h+u,{byTopic:o,p5w:a,p6w:h,p7w:u,score:s}}class lu{rawStream;pushable;closeController;maxBufferSize;constructor(t,e,r){this.rawStream=t,this.pushable=Sh(),this.closeController=new AbortController,this.maxBufferSize=r.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",(()=>{t.close().catch((e=>{t.abort(e)}))})),kh(this.pushable,this.rawStream).catch(e)}get protocol(){return this.rawStream.protocol}push(t){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(lh.single(t))}pushPrefixed(t){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(t)}async close(){this.closeController.abort(),await this.pushable.return()}}class du{source;rawStream;closeController;constructor(t,e={}){this.rawStream=t,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",(()=>{t.close().catch((e=>{t.abort(e)}))})),this.source=kh(this.rawStream,(t=>yh(t,e)))}async close(){this.closeController.abort()}}class fu{gossipsubIWantFollowupMs;msgIdToStrFn;metrics;promises=new Map;requestMsByMsg=new Map;requestMsByMsgExpire;constructor(t,e,r){this.gossipsubIWantFollowupMs=t,this.msgIdToStrFn=e,this.metrics=r,this.requestMsByMsgExpire=10*t}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(t,e){const r=e[Math.floor(Math.random()*e.length)],i=this.msgIdToStrFn(r);let n=this.promises.get(i);null==n&&(n=new Map,this.promises.set(i,n));const s=Date.now();n.has(t)||(n.set(t,s+this.gossipsubIWantFollowupMs),null!=this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,s)))}getBrokenPromises(){const t=Date.now(),e=new Map;let r=0;return this.promises.forEach(((i,n)=>{i.forEach(((n,s)=>{n<t&&(e.set(s,(e.get(s)??0)+1),i.delete(s),r++)})),0===i.size&&this.promises.delete(n)})),this.metrics?.iwantPromiseBroken.inc(r),e}deliverMessage(t,e=!1){this.trackMessage(t);const r=this.promises.get(t);null!=r&&(this.promises.delete(t),null!=this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),e&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(r.size)))}rejectMessage(t,e){this.trackMessage(t),e!==Fh.Error&&this.promises.delete(t)}clear(){this.promises.clear()}prune(){const t=Date.now()-this.requestMsByMsgExpire;let e=0;for(const[r,i]of this.requestMsByMsg.entries()){if(!(i<t))break;this.requestMsByMsg.delete(r),e++}this.metrics?.iwantMessagePruned.inc(e)}trackMessage(t){if(null!=this.metrics){const e=this.requestMsByMsg.get(t);void 0!==e&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-e)/1e3),this.requestMsByMsg.delete(t))}}}function pu(t){if(isNaN(t)||t<=0)throw new T("random bytes length must be a Number bigger than 0");return function(t=32){if(Vn&&"function"==typeof Vn.getRandomValues)return Vn.getRandomValues(new Uint8Array(t));if(Vn&&"function"==typeof Vn.randomBytes)return Vn.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}(t)}const mu=dn("libp2p-pubsub:");function gu(t=[],e){return{subscriptions:[],messages:t,control:void 0!==e?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[],idontwant:e.idontwant??[]}:void 0}}function bu(t){return void 0===t.control&&(t.control={graft:[],prune:[],ihave:[],iwant:[],idontwant:[]}),t}function yu(t){return sa(t,"base64")}function vu(t){if(t.length<=1)return t;for(let e=0;e<t.length;e++){const r=Math.floor(Math.random()*Math.floor(t.length)),i=t[e];t[e]=t[r],t[r]=i}return t}function wu(t){if("signed"!==t.type)throw new Error("expected signed message type");if(null==t.sequenceNumber)throw Error("missing seqno field");return((t,e)=>{const r=dn(e.toString(16).padStart(16,"0"),"base16"),i=$a(t),n=new Uint8Array(i.byteLength+r.length);return n.set(i,0),n.set(r,i.byteLength),n})(t.from.publicKey??t.key,t.sequenceNumber)}async function Mu(t){return sn.encode(t.data)}const _u=new class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){const e=this.index,r=t();return void 0===r&&(this.index=e),r}parseWith(t){const e=t();if(this.index===this.input.length)return e}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically((()=>{const e=this.readChar();if(e===t)return e}))}readSeparator(t,e,r){return this.readAtomically((()=>{if(!(e>0&&void 0===this.readGivenChar(t)))return r()}))}readNumber(t,e,r,i){return this.readAtomically((()=>{let n=0,s=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,h=2**(8*i)-1;for(;;){const r=this.readAtomically((()=>{const e=this.readChar();if(void 0===e)return;const r=Number.parseInt(e,t);return Number.isNaN(r)?void 0:r}));if(void 0===r)break;if(n*=t,n+=r,n>h)return;if(s+=1,void 0!==e&&s>e)return}return 0===s||!r&&a&&s>1?void 0:n}))}readIPv4Addr(){return this.readAtomically((()=>{const t=new Uint8Array(4);for(let e=0;e<t.length;e++){const r=this.readSeparator(".",e,(()=>this.readNumber(10,3,!1,1)));if(void 0===r)return;t[e]=r}return t}))}readIPv6Addr(){const t=t=>{for(let e=0;e<t.length/2;e++){const r=2*e;if(e<t.length-3){const i=this.readSeparator(":",e,(()=>this.readIPv4Addr()));if(void 0!==i)return t[r]=i[0],t[r+1]=i[1],t[r+2]=i[2],t[r+3]=i[3],[r+4,!0]}const i=this.readSeparator(":",e,(()=>this.readNumber(16,4,!0,2)));if(void 0===i)return[r,!1];t[r]=i>>8,t[r+1]=255&i}return[t.length,!1]};return this.readAtomically((()=>{const e=new Uint8Array(16),[r,i]=t(e);if(16===r)return e;if(i)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const n=new Uint8Array(14),s=16-(r+2),[o]=t(n.subarray(0,s));return e.set(n.subarray(0,o),16-o),e}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};function Su(t){if(!(t.length>15))return _u.new(t).parseWith((()=>_u.readIPv4Addr()))}function Eu(t){if(t.includes("%")&&(t=t.split("%")[0]),!(t.length>45))return _u.new(t).parseWith((()=>_u.readIPv6Addr()))}function ku(t){if(t.includes("%")&&(t=t.split("%")[0]),!(t.length>45))return _u.new(t).parseWith((()=>_u.readIPAddr()))}const Au=(parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]));function Iu(t,e){16===e.length&&4===t.length&&function(t){let e=0;for(const r of t)if(!(e<0)){if(e>11)break;if(255!==r)return!1;e++}return!0}(e)&&(e=e.slice(12)),4===e.length&&16===t.length&&function(t,e){let r=0;for(const i of t)if(!(r<0)){if(r>11)break;if(i!==e[r])return!1;r++}return!0}(t,Au)&&(t=t.slice(12));const r=t.length;if(r!=e.length)throw new Error("Failed to mask ip");const i=new Uint8Array(r);for(let n=0;n<r;n++)i[n]=t[n]&e[n];return i}function xu(t,e){if(32!==e&&128!==e)throw new Error("Invalid CIDR mask");if(t<0||t>e)throw new Error("Invalid CIDR mask");const r=e/8,i=new Uint8Array(r);for(let e=0;e<r;e++)t>=8?(i[e]=255,t-=8):(i[e]=255-(255>>t),t=0);return i}class Cu{constructor(t,e){if(null==e)({network:this.network,mask:this.mask}=function(t){const[e,r]=t.split("/");if(!e||!r)throw new Error("Failed to parse given CIDR: "+t);let i=4,n=Su(e);if(null==n&&(i=16,n=Eu(e),null==n))throw new Error("Failed to parse given CIDR: "+t);const s=parseInt(r,10);if(Number.isNaN(s)||String(s).length!==r.length||s<0||s>8*i)throw new Error("Failed to parse given CIDR: "+t);const o=xu(s,8*i);return{network:Iu(n,o),mask:o}}(t));else{const r=ku(t);if(null==r)throw new Error("Failed to parse network");e=String(e);const i=parseInt(e,10);if(Number.isNaN(i)||String(i).length!==e.length||i<0||i>8*r.length){const t=ku(e);if(null==t)throw new Error("Failed to parse mask");this.mask=t}else this.mask=xu(i,8*r.length);this.network=Iu(r,this.mask)}}contains(t){return function(t,e){if("string"==typeof e&&(e=ku(e)),null==e)throw new Error("Invalid ip");if(e.length!==t.network.length)return!1;for(let r=0;r<e.length;r++)if((t.network[r]&t.mask[r])!=(e[r]&t.mask[r]))return!1;return!0}({network:this.network,mask:this.mask},t)}toString(){const t=function(t){let e=0;for(let[r,i]of t.entries()){if(255!==i){for(;128&i;)e++,i<<=1;if(128&i)return-1;for(let e=r+1;e<t.length;e++)if(0!=t[e])return-1;break}e+=8}return e}(this.mask),e=-1!==t?String(t):function(t){let e="0x";for(const r of t)e+=(r>>4).toString(16)+(15&r).toString(16);return e}(this.mask);return function(t){switch(t.length){case 4:return t.join(".");case 16:{const e=[];for(let r=0;r<t.length;r++)r%2==0&&e.push(t[r].toString(16).padStart(2,"0")+t[r+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}(this.network)+"/"+e}}function Tu(t){return Boolean(Su(t))}function Pu(t){return Boolean(Eu(t))}function Bu(t){return Boolean(ku(t))}const Ru=Tu,Du=Pu,Nu=function(t){let e=0;if(t=t.toString().trim(),Ru(t)){const r=new Uint8Array(e+4);return t.split(/\./g).forEach((t=>{r[e++]=255&parseInt(t,10)})),r}if(Du(t)){const r=t.split(":",8);let i;for(i=0;i<r.length;i++){let t;Ru(r[i])&&(t=Nu(r[i]),r[i]=sa(t.slice(0,2),"base16")),null!=t&&++i<8&&r.splice(i,0,sa(t.slice(2,4),"base16"))}if(""===r[0])for(;r.length<8;)r.unshift("0");else if(""===r[r.length-1])for(;r.length<8;)r.push("0");else if(r.length<8){for(i=0;i<r.length&&""!==r[i];i++);const t=[i,1];for(i=9-r.length;i>0;i--)t.push("0");r.splice.apply(r,t)}const n=new Uint8Array(e+16);for(i=0;i<r.length;i++){const t=parseInt(r[i],16);n[e++]=t>>8&255,n[e++]=255&t}return n}throw new Error("invalid ip address")},Lu=-1,Ou={},Uu={};function Fu(t){if("number"==typeof t){if(null!=Uu[t])return Uu[t];throw new Error(`no protocol with code: ${t}`)}if("string"==typeof t){if(null!=Ou[t])return Ou[t];throw new Error(`no protocol with name: ${t}`)}throw new Error("invalid protocol id type: "+typeof t)}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Lu,"ip6zone"],[43,8,"ipcidr"],[53,Lu,"dns",!0],[54,Lu,"dns4",!0],[55,Lu,"dns6",!0],[56,Lu,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Lu,"unix",!1,!0],[421,Lu,"ipfs"],[421,Lu,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Lu,"garlic64"],[448,0,"tls"],[449,Lu,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Lu,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,Lu,"http-path"],[777,Lu,"memory"]].forEach((t=>{const e=function(t,e,r,i,n){return{code:t,size:e,name:r,resolvable:Boolean(i),path:Boolean(n)}}(...t);Uu[e.code]=e,Ou[e.name]=e}));const ju=Fu("ip4"),Vu=Fu("ip6"),qu=Fu("ipcidr");function zu(t,e){switch(Fu(t).code){case 4:case 41:return function(t){const e=function(t,e=0,r){e=~~e,r=r??t.length-e;const i=new DataView(t.buffer);if(4===r){const i=[];for(let n=0;n<r;n++)i.push(t[e+n]);return i.join(".")}if(16===r){const t=[];for(let n=0;n<r;n+=2)t.push(i.getUint16(e+n).toString(16));return t.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""}(t,0,t.length);if(null==e)throw new Error("ipBuff is required");if(!Bu(e))throw new Error("invalid ip address");return e}(e);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Yu(e);case 43:return sa(e,"base10");case 6:case 273:case 33:case 132:return Gu(e).toString();case 421:return function(t){const e=pi(t),r=t.slice(ci(e));if(r.length!==e)throw new Error("inconsistent lengths");return sa(r,"base58btc")}(e);case 444:case 445:return function(t){const e=t.slice(0,t.length-2),r=t.slice(t.length-2);return`${sa(e,"base32")}:${Gu(r)}`}(e);case 466:return function(t){const e=pi(t),r=t.slice(ci(e));if(r.length!==e)throw new Error("inconsistent lengths");return"u"+sa(r,"base64url")}(e);case 481:return globalThis.encodeURIComponent(Yu(e));default:return sa(e,"base16")}}function Hu(t,e){switch(Fu(t).code){case 4:case 41:return function(t){if(!Bu(t))throw new Error("invalid ip address");return Nu(t)}(e);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Zu(e);case 43:return dn(e,"base10");case 6:case 273:case 33:case 132:return Ku(parseInt(e,10));case 421:return function(t){let e;e="Q"===t[0]||"1"===t[0]?qt(ct.decode(`z${t}`)).bytes:Kt.parse(t).multihash.bytes;const r=Uint8Array.from(fi(e.length));return nh([r,e],r.length+e.length)}(e);case 444:return function(t){const e=t.split(":");if(2!==e.length)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(16!==e[0].length)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const r=dt.decode("b"+e[0]),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=Ku(i);return nh([r,n],r.length+n.length)}(e);case 445:return function(t){const e=t.split(":");if(2!==e.length)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(56!==e[0].length)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const r=dt.decode(`b${e[0]}`),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const n=Ku(i);return nh([r,n],r.length+n.length)}(e);case 466:return function(t){const e=Wu.decode(t),r=Uint8Array.from(fi(e.length));return nh([r,e],r.length+e.length)}(e);case 481:return Zu(globalThis.decodeURIComponent(e));default:return dn(e,"base16")}}const $u=Object.values(an).map((t=>t.decoder)),Wu=function(){let t=$u[0].or($u[1]);return $u.slice(2).forEach((e=>t=t.or(e))),t}();function Ku(t){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,t),new Uint8Array(e)}function Gu(t){return new DataView(t.buffer).getUint16(t.byteOffset)}function Zu(t){const e=dn(t),r=Uint8Array.from(fi(e.length));return nh([r,e],r.length+e.length)}function Yu(t){const e=pi(t);if((t=t.slice(ci(e))).length!==e)throw new Error("inconsistent lengths");return sa(t)}var Ju,Xu;!function(t){t[t.ip4=4]="ip4",t[t.ip6=41]="ip6"}(Ju||(Ju={}));class Qu{entries=new Map;validityMs;constructor(t){this.validityMs=t.validityMs}get size(){return this.entries.size}put(t,e){return!!this.entries.has(t)||(this.entries.set(t,{value:e,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const t=Date.now();for(const[e,r]of this.entries.entries()){if(!(r.validUntilMs<t))break;this.entries.delete(e)}}has(t){return this.entries.has(t)}get(t){const e=this.entries.get(t);return null!=e&&e.validUntilMs>=Date.now()?e.value:void 0}clear(){this.entries.clear()}}!function(t){t[t.started=0]="started",t[t.stopped=1]="stopped"}(Xu||(Xu={}));class tc extends v{globalSignaturePolicy;multicodecs=[Rh,"/meshsub/1.1.0",Bh];publishConfig;dataTransform;peers=new Set;streamsInbound=new Map;streamsOutbound=new Map;outboundInflightQueue=Sh({objectMode:!0});direct=new Set;floodsubPeers=new Set;seenCache;acceptFromWhitelist=new Map;topics=new Map;subscriptions=new Set;mesh=new Map;fanout=new Map;fanoutLastpub=new Map;gossip=new Map;control=new Map;peerhave=new Map;iasked=new Map;backoff=new Map;outbound=new Map;msgIdFn;fastMsgIdFn;msgIdToStrFn;fastMsgIdCache;publishedMessageIds;mcache;score;topicValidators=new Map;log;heartbeatTicks=0;gossipTracer;idontwantCounts=new Map;idontwants=new Map;components;directPeerInitial=null;static multicodec=Rh;opts;decodeRpcLimits;metrics;status={code:Xu.stopped};maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;allowedTopics;heartbeatTimer=null;constructor(t,e={}){super();const r={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,unsubcribeBackoff:1e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,gossipFactor:.25,idontwantMinDataSize:512,idontwantMaxMessages:512,...e,scoreParams:Qh(e.scoreParams),scoreThresholds:ru(e.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=r.decodeRpcLimits??Nh,this.globalSignaturePolicy=r.globalSignaturePolicy??w,r.fallbackToFloodsub&&this.multicodecs.push(Ph),this.log=t.logger.forComponent(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map((t=>t.id.toString()))),this.seenCache=new Qu({validityMs:r.seenTTL}),this.publishedMessageIds=new Qu({validityMs:r.seenTTL}),null!=e.msgIdFn)this.msgIdFn=e.msgIdFn;else switch(this.globalSignaturePolicy){case w:this.msgIdFn=wu;break;case M:this.msgIdFn=Mu;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(null!=e.fastMsgIdFn&&(this.fastMsgIdFn=e.fastMsgIdFn,this.fastMsgIdCache=new Qu({validityMs:r.seenTTL})),this.msgIdToStrFn=e.msgIdToStrFn??yu,this.mcache=e.messageCache??new Gh(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),null!=e.dataTransform&&(this.dataTransform=e.dataTransform),null!=e.metricsRegister){if(null==e.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const t=Math.max(...Object.values(r.scoreParams.topics).map((t=>t.meshMessageDeliveriesWindow)),1e3),i=function(t,e,r){return{protocolsEnabled:t.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:t.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:t.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:t.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:t.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:t.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:t.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:t.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:t.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:t.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:t.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:t.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:t.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:t.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:t.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:t.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:t.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:t.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:t.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:t.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:t.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:t.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:t.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:t.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:t.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:t.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:t.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:t.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:t.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:t.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:t.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:t.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:t.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:t.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:t.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:t.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:t.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:t.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:t.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:t.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:t.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),rpcSentIDontWant:t.gauge({name:"gossipsub_rpc_sent_idontwant_total",help:"RPC sent"}),msgPublishCount:t.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:t.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:t.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:t.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:t.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:t.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:t.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:t.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:t.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:t.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:t.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:t.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:t.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:t.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:t.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:t.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:t.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:t.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:t.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,Number(r.maxMeshMessageDeliveriesWindowSec),2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:t.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:t.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:t.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:t.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:t.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:t.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:t.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:t.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:t.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:t.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:t.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,Number(r.behaviourPenaltyThreshold),2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:t.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:t.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:t.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:t.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),idontwantRcvMsgids:t.gauge({name:"gossipsub_idontwant_rcv_msgids_total",help:"Total received IDONTWANT messages"}),idontwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_idontwant_rcv_dont_have_msgids_total",help:"Total received IDONTWANT messageIDs that we do not have in mcache"}),iwantPromiseStarted:t.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:t.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:t.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:t.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:t.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:t.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:t.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,Number(r.gossipPromiseExpireSec),2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),iwantPromiseUntracked:t.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:t.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:t.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:t.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:t.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:t.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:t.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(t){return this.topicStrToLabel.get(t)??t},onJoin(t){this.topicSubscriptionStatus.set({topicStr:t},1),this.meshPeerCounts.set({topicStr:t},0)},onLeave(t){this.topicSubscriptionStatus.set({topicStr:t},0),this.meshPeerCounts.set({topicStr:t},0)},onAddToMesh(t,e,r){const i=this.toTopic(t);switch(e){case zh.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:i},r);break;case zh.Random:this.meshPeerInclusionEventsRandom.inc({topic:i},r);break;case zh.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:i},r);break;case zh.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:i},r);break;case zh.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:i},r);break;case zh.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:i},r);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:i},r)}},onRemoveFromMesh(t,e,r){const i=this.toTopic(t);switch(e){case Hh.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:i},r);break;case Hh.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:i},r);break;case Hh.Prune:this.meshPeerChurnEventsPrune.inc({topic:i},r);break;case Hh.Excess:this.meshPeerChurnEventsExcess.inc({topic:i},r);break;default:this.meshPeerChurnEventsUnknown.inc({topic:i},r)}},onReportValidation(t,e,r){if(this.asyncValidationMcacheHit.inc({hit:null!=t?"hit":"miss"}),null!=t){const r=this.toTopic(t.message.topic);switch(e){case _.Accept:this.acceptedMessagesTotal.inc({topic:r});break;case _.Ignore:this.ignoredMessagesTotal.inc({topic:r});break;case _.Reject:this.rejectedMessagesTotal.inc({topic:r});break;default:this.unknownValidationResultsTotal.inc({topic:r})}}null!=r?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-r)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(t){this.scoringPenalties.inc({penalty:t},1)},onIhaveRcv(t,e,r){const i=this.toTopic(t);this.ihaveRcvMsgids.inc({topic:i},e),this.ihaveRcvNotSeenMsgids.inc({topic:i},r)},onIwantRcv(t,e){for(const[e,r]of t){const t=this.toTopic(e);this.iwantRcvMsgids.inc({topic:t},r)}this.iwantRcvDonthaveMsgids.inc(e)},onIdontwantRcv(t,e){this.idontwantRcvMsgids.inc(t),this.idontwantRcvDonthaveMsgids.inc(e)},onForwardMsg(t,e){const r=this.toTopic(t);this.msgForwardCount.inc({topic:r},1),this.msgForwardPeers.inc({topic:r},e)},onPublishMsg(t,e,r,i,n){const s=this.toTopic(t);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},r*i),this.msgPublishPeersByTopic.inc({topic:s},r),this.directPeersPublishedTotal.inc({topic:s},e.direct),this.floodsubPeersPublishedTotal.inc({topic:s},e.floodsub),this.meshPeersPublishedTotal.inc({topic:s},e.mesh),this.fanoutPeersPublishedTotal.inc({topic:s},e.fanout),this.msgPublishTime.observe({topic:s},n/1e3)},onMsgRecvPreValidation(t){const e=this.toTopic(t);this.msgReceivedPreValidation.inc({topic:e},1)},onMsgRecvError(t){const e=this.toTopic(t);this.msgReceivedError.inc({topic:e},1)},onPrevalidationResult(t,e){const r=this.toTopic(t);switch(e){case Vh.duplicate:this.prevalidationDuplicateTotal.inc({topic:r});break;case Vh.invalid:this.prevalidationInvalidTotal.inc({topic:r});break;case Vh.valid:this.prevalidationValidTotal.inc({topic:r});break;default:this.prevalidationUnknownTotal.inc({topic:r})}},onMsgRecvInvalid(t,e){const r=this.toTopic(t),i=e.reason===Fh.Error?e.error:e.reason;this.msgReceivedInvalid.inc({error:i},1),this.msgReceivedInvalidByTopic.inc({topic:r},1)},onDuplicateMsgDelivery(t,e,r){const i=this.toTopic(t);this.duplicateMsgDeliveryDelay.observe({topic:i},e/1e3),r&&this.duplicateMsgLateDelivery.inc({topic:i},1)},onPublishDuplicateMsg(t){const e=this.toTopic(t);this.duplicateMsgIgnored.inc({topic:e},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(t,e){this.rpcRecvBytes.inc(e),this.rpcRecvCount.inc(1),null!=t.subscriptions&&this.rpcRecvSubscription.inc(t.subscriptions.length),null!=t.messages&&this.rpcRecvMessage.inc(t.messages.length),null!=t.control&&(this.rpcRecvControl.inc(1),null!=t.control.ihave&&this.rpcRecvIHave.inc(t.control.ihave.length),null!=t.control.iwant&&this.rpcRecvIWant.inc(t.control.iwant.length),null!=t.control.graft&&this.rpcRecvGraft.inc(t.control.graft.length),null!=t.control.prune&&this.rpcRecvPrune.inc(t.control.prune.length))},onRpcSent(t,e){if(this.rpcSentBytes.inc(e),this.rpcSentCount.inc(1),null!=t.subscriptions&&this.rpcSentSubscription.inc(t.subscriptions.length),null!=t.messages&&this.rpcSentMessage.inc(t.messages.length),null!=t.control){const e=t.control.ihave?.length??0,r=t.control.iwant?.length??0,i=t.control.graft?.length??0,n=t.control.prune?.length??0,s=t.control.idontwant?.length??0;e>0&&this.rpcSentIHave.inc(e),r>0&&this.rpcSentIWant.inc(r),i>0&&this.rpcSentGraft.inc(i),n>0&&this.rpcSentPrune.inc(n),s>0&&this.rpcSentIDontWant.inc(s),(e>0||r>0||i>0||n>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(t,e){let r=0,i=0,n=0,s=0;for(const o of t)o>=e.graylistThreshold&&r++,o>=e.publishThreshold&&i++,o>=e.gossipThreshold&&n++,o>=0&&s++;this.peersByScoreThreshold.set({threshold:Kh.graylist},r),this.peersByScoreThreshold.set({threshold:Kh.publish},i),this.peersByScoreThreshold.set({threshold:Kh.gossip},n),this.peersByScoreThreshold.set({threshold:Kh.mesh},s),this.score.set(t)},registerScoreWeights(t){for(const[e,r]of t.byTopic)this.scoreWeights.set({topic:e,p:"p1"},r.p1w),this.scoreWeights.set({topic:e,p:"p2"},r.p2w),this.scoreWeights.set({topic:e,p:"p3"},r.p3w),this.scoreWeights.set({topic:e,p:"p3b"},r.p3bw),this.scoreWeights.set({topic:e,p:"p4"},r.p4w);this.scoreWeights.set({p:"p5"},t.p5w),this.scoreWeights.set({p:"p6"},t.p6w),this.scoreWeights.set({p:"p7"},t.p7w)},registerScorePerMesh(t,e){const r=new Map;t.forEach(((t,e)=>{const i=this.topicStrToLabel.get(e)??"unknown";let n=r.get(i);null==n&&(n=new Set,r.set(i,n)),t.forEach((t=>n?.add(t)))}));for(const[t,i]of r){const r=[];i.forEach((t=>{r.push(e.get(t)??0)})),this.scorePerMesh.set({topic:t},r)}}}}(e.metricsRegister,e.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:t/1e3});i.mcacheSize.addCollect((()=>{this.onScrapeMetrics(i)}));for(const t of this.multicodecs)i.protocolsEnabled.set({protocol:t},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new fu(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new uu(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=e.maxInboundStreams,this.maxOutboundStreams=e.maxOutboundStreams,this.runOnLimitedConnection=e.runOnLimitedConnection,this.allowedTopics=null!=r.allowedTopics?new Set(r.allowedTopics):null}[Symbol.toStringTag]="@chainsafe/libp2p-gossipsub";[k]=["@libp2p/pubsub"];[A]=["@libp2p/identify"];getPeers(){return[...this.peers.keys()].map((t=>th(t)))}isStarted(){return this.status.code===Xu.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=function(t,e,r){switch(t){case w:return{type:Uh.Signing,author:e,key:$a(r.publicKey),privateKey:r};case M:return{type:Uh.Anonymous};default:throw new Error(`Unknown signature policy "${t}"`)}}(this.globalSignaturePolicy,this.components.peerId,this.components.privateKey),this.outboundInflightQueue=Sh({objectMode:!0}),kh(this.outboundInflightQueue,(async t=>{for await(const{peerId:e,connection:r}of t)await this.createOutboundStream(e,r)})).catch((t=>{this.log.error("outbound inflight queue error",t)})),await Promise.all(this.opts.directPeers.map((async t=>{await this.components.peerStore.merge(t.id,{multiaddrs:t.addrs})})));const t=this.components.registrar;await Promise.all(this.multicodecs.map((async e=>t.handle(e,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}))));const e={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnLimitedConnection:this.runOnLimitedConnection},r=await Promise.all(this.multicodecs.map((async r=>t.register(r,e)))),i=setTimeout(this.runHeartbeat,100);this.status={code:Xu.started,registrarTopologyIds:r,heartbeatTimeout:i,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async t=>this.connect(t))))})).catch((t=>{this.log(t)}))}),1e3),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Xu.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:Xu.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const e=this.components.registrar;await Promise.all(this.multicodecs.map((async t=>e.unhandle(t)))),t.forEach((t=>{e.unregister(t)})),this.outboundInflightQueue.end();const r=[];for(const t of this.streamsOutbound.values())r.push(t.close());this.streamsOutbound.clear();for(const t of this.streamsInbound.values())r.push(t.close());this.streamsInbound.clear(),await Promise.all(r),this.peers.clear(),this.subscriptions.clear(),null!=this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),null!=this.fastMsgIdCache&&this.fastMsgIdCache.clear(),null!=this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.idontwantCounts.clear(),this.idontwants.clear(),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:e}){if(!this.isStarted())return;const r=e.remotePeer;this.addPeer(r,e.direction,e.remoteAddr),this.createInboundStream(r,t),this.outboundInflightQueue.push({peerId:r,connection:e})}onPeerConnected(t,e){this.metrics?.newConnectionCount.inc({status:e.status}),this.isStarted()&&"open"===e.status&&(this.addPeer(t,e.direction,e.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:e}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,e){if(!this.isStarted())return;const r=t.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const i=new lu(await e.newStream(this.multicodecs,{runOnLimitedConnection:this.runOnLimitedConnection}),(t=>{this.log.error("outbound pipe error",t)}),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(r,i);const n=i.protocol;n===Ph&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:n},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(t){this.log.error("createOutboundStream error",t)}}createInboundStream(t,e){if(!this.isStarted())return;const r=t.toString();if(!this.peers.has(r))return;const i=this.streamsInbound.get(r);void 0!==i&&(this.log("replacing existing inbound steam %s",r),i.close().catch((t=>{this.log.error(t)}))),this.log("create inbound stream %s",r);const n=new du(e,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,n),this.pipePeerReadStream(t,n.source).catch((t=>{this.log(t)}))}addPeer(t,e,r){const i=t.toString();if(!this.peers.has(i)){this.log("new peer %p",t),this.peers.add(i),this.score.addPeer(i);const n=function(t){for(const e of t.tuples())switch(e[0]){case Ju.ip4:case Ju.ip6:return zu(e[0],e[1])}return null}(r);null!==n?this.score.addIP(i,n):this.log("Added peer has no IP in current address %s %s",i,r.toString()),this.outbound.has(i)||this.outbound.set(i,"outbound"===e)}}removePeer(t){const e=t.toString();if(!this.peers.has(e))return;this.log("delete peer %p",t),this.peers.delete(e);const r=this.streamsOutbound.get(e),i=this.streamsInbound.get(e);null!=r&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close().catch((t=>{this.log.error(t)})),i?.close().catch((t=>{this.log.error(t)})),this.streamsOutbound.delete(e),this.streamsInbound.delete(e);for(const t of this.topics.values())t.delete(e);for(const[t,r]of this.mesh)r.delete(e)&&this.metrics?.onRemoveFromMesh(t,Hh.Dc,1);for(const t of this.fanout.values())t.delete(e);this.floodsubPeers.delete(e),this.gossip.delete(e),this.control.delete(e),this.outbound.delete(e),this.idontwantCounts.delete(e),this.idontwants.delete(e),this.score.removePeer(e),this.acceptFromWhitelist.delete(e)}get started(){return this.status.code===Xu.started}getMeshPeers(t){const e=this.mesh.get(t);return null!=e?Array.from(e):[]}getSubscribers(t){const e=this.topics.get(t);return(null!=e?Array.from(e):[]).map((t=>th(t)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,e){try{await kh(e,(async e=>{for await(const r of e)try{const e=r.subarray(),i=Lh.decode(e,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos},idontwant:this.decodeRpcLimits.maxControlMessages,idontwant$:{messageIDs:this.decodeRpcLimits.maxIdontwantMessageIDs}}}});if(this.metrics?.onRpcRecv(i,e.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,i)}catch(t){this.metrics?.onRpcRecvError(),this.log(t)}else this.handleReceivedRpc(t,i).catch((t=>{this.metrics?.onRpcRecvError(),this.log(t)}))}catch(t){this.metrics?.onRpcDataError(),this.log(t)}}))}catch(e){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(e,t)}}handlePeerReadStreamError(t,e){this.log.error(t),this.onPeerDisconnected(e)}async handleReceivedRpc(t,e){if(!this.acceptFrom(t.toString()))return this.log("received message from unacceptable peer %p",t),void this.metrics?.rpcRecvNotAccepted.inc();const r=null!=e.subscriptions?e.subscriptions.length:0,i=null!=e.messages?e.messages.length:0;let n=0,s=0,o=0,a=0;if(null!=e.control&&(null!=e.control.ihave&&(n=e.control.ihave.length),null!=e.control.iwant&&(s=e.control.iwant.length),null!=e.control.graft&&(o=e.control.graft.length),null!=e.control.prune&&(a=e.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${r} messages ${i} ihave ${n} iwant ${s} graft ${o} prune ${a}`),null!=e.subscriptions&&e.subscriptions.length>0){const r=[];e.subscriptions.forEach((e=>{const i=e.topic,n=!0===e.subscribe;if(null!=i){if(null!=this.allowedTopics&&!this.allowedTopics.has(i))return;this.handleReceivedSubscription(t,i,n),r.push({topic:i,subscribe:n})}})),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:r}})}for(const r of e.messages){if(null!=this.allowedTopics&&!this.allowedTopics.has(r.topic))continue;const e=this.handleReceivedMessage(t,r).catch((t=>{this.metrics?.onMsgRecvError(r.topic),this.log(t)}));this.opts.awaitRpcMessageHandler&&await e}null!=e.control&&await this.handleControlMessage(t.toString(),e.control)}handleReceivedSubscription(t,e,r){this.log("subscription update from %p topic %s",t,e);let i=this.topics.get(e);null==i&&(i=new Set,this.topics.set(e,i)),r?i.add(t.toString()):i.delete(t.toString())}async handleReceivedMessage(t,e){this.metrics?.onMsgRecvPreValidation(e.topic);const r=await this.validateReceivedMessage(t,e);this.metrics?.onPrevalidationResult(e.topic,r.code);const i=r.code;switch(i){case Vh.duplicate:return this.score.duplicateMessage(t.toString(),r.msgIdStr,e.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),void this.mcache.observeDuplicate(r.msgIdStr,t.toString());case Vh.invalid:if(null!=r.msgIdStr){const i=r.msgIdStr;this.score.rejectMessage(t.toString(),i,e.topic,r.reason),this.gossipTracer.rejectMessage(i,r.reason)}else this.score.rejectInvalidMessage(t.toString(),e.topic);return void this.metrics?.onMsgRecvInvalid(e.topic,r);case Vh.valid:this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,e,!this.opts.asyncValidation),this.subscriptions.has(e.topic)&&(this.components.peerId.equals(t)&&!this.opts.emitSelf||(super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:t,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new CustomEvent("message",{detail:r.msg})))),this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,e,t.toString());break;default:throw new Error(`Invalid validation result: ${i}`)}}async validateReceivedMessage(t,e){const r=this.fastMsgIdFn?.(e),i=void 0!==r?this.fastMsgIdCache?.get(r):void 0;if(null!=i)return{code:Vh.duplicate,msgIdStr:i};const n=await async function(t,e){switch(t){case M:return null!=e.signature?{valid:!1,error:jh.SignaturePresent}:null!=e.seqno?{valid:!1,error:jh.SeqnoPresent}:null!=e.key?{valid:!1,error:jh.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case w:{if(null==e.seqno)return{valid:!1,error:jh.InvalidSeqno};if(8!==e.seqno.length)return{valid:!1,error:jh.InvalidSeqno};if(null==e.signature)return{valid:!1,error:jh.InvalidSignature};if(null==e.from)return{valid:!1,error:jh.InvalidPeerId};let t,r;try{t=rh(qt(e.from))}catch(t){return{valid:!1,error:jh.InvalidPeerId}}if(null!=e.key){if(r=Ha(e.key),void 0!==t.publicKey&&!r.equals(t.publicKey))return{valid:!1,error:jh.InvalidPeerId}}else{if(null==t.publicKey)return{valid:!1,error:jh.InvalidPeerId};r=t.publicKey}const i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},n=nh([mu,Lh.Message.encode(i)]);return await r.verify(n,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${sa(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:null!=e.key?Ha(e.key):r}}:{valid:!1,error:jh.InvalidSignature}}default:throw new Error("Unreachable")}}(this.globalSignaturePolicy,e);if(!n.valid)return{code:Vh.invalid,reason:Fh.Error,error:n.error};const s=n.message;try{null!=this.dataTransform&&(s.data=this.dataTransform.inboundTransform(e.topic,s.data))}catch(t){return this.log("Invalid message, transform failed",t),{code:Vh.invalid,reason:Fh.Error,error:jh.TransformFailed}}const o=await this.msgIdFn(s),a=this.msgIdToStrFn(o),h={msgId:o,msgIdStr:a};if(void 0!==r&&null!=this.fastMsgIdCache&&this.fastMsgIdCache.put(r,a)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(a))return{code:Vh.duplicate,msgIdStr:a};this.seenCache.put(a),(e.data?.length??0)>=this.opts.idontwantMinDataSize&&this.sendIDontWants(o,e.topic,t.toString());const u=this.topicValidators.get(e.topic);if(null!=u){let e;try{e=await u(t,s)}catch(t){const r=t.code;"ERR_TOPIC_VALIDATOR_IGNORE"===r&&(e=_.Ignore),e="ERR_TOPIC_VALIDATOR_REJECT"===r?_.Reject:_.Ignore}if(e!==_.Accept)return{code:Vh.invalid,reason:Zh(e),msgIdStr:a}}return{code:Vh.valid,messageId:h,msg:s}}getScore(t){return this.score.score(t)}sendSubscriptions(t,e,r){this.sendRpc(t,{subscriptions:e.map((t=>({topic:t,subscribe:r}))),messages:[]})}async handleControlMessage(t,e){if(void 0===e)return;const r=e.ihave?.length>0?this.handleIHave(t,e.ihave):[],i=e.iwant?.length>0?this.handleIWant(t,e.iwant):[],n=e.graft?.length>0?await this.handleGraft(t,e.graft):[];if(e.prune?.length>0&&await this.handlePrune(t,e.prune),e.idontwant?.length>0&&this.handleIdontwant(t,e.idontwant),0===r.length&&0===i.length&&0===n.length)return;const s=this.sendRpc(t,gu(i,{iwant:r,prune:n})),o=r[0]?.messageIDs;null!=o&&(s?this.gossipTracer.addPromise(t,o):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const e=Date.now(),r=this.acceptFromWhitelist.get(t);if(null!=r&&r.messagesAccepted<128&&r.acceptUntil>=e)return r.messagesAccepted+=1,!0;const i=this.score.score(t);return i>=0?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:e+1e3}):this.acceptFromWhitelist.delete(t),i>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,e){if(0===e.length)return[];const r=this.score.score(t);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,r),this.metrics?.ihaveRcvIgnored.inc({reason:Wh.LowScore}),[];const i=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,i),i>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,i),this.metrics?.ihaveRcvIgnored.inc({reason:Wh.MaxIhave}),[];const n=this.iasked.get(t)??0;if(n>=Dh)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,n),this.metrics?.ihaveRcvIgnored.inc({reason:Wh.MaxIasked}),[];const s=new Map;if(e.forEach((({topicID:t,messageIDs:e})=>{if(null==t||null==e||!this.mesh.has(t))return;let r=0;e.forEach((t=>{const e=this.msgIdToStrFn(t);this.seenCache.has(e)||(s.set(e,t),r++)})),this.metrics?.onIhaveRcv(t,e.length,r)})),0===s.size)return[];let o=s.size;o+n>Dh&&(o=Dh-n),this.log("IHAVE: Asking for %d out of %d messages from %s",o,s.size,t);let a=Array.from(s.values());return vu(a),a=a.slice(0,o),this.iasked.set(t,n+o),[{messageIDs:a}]}handleIWant(t,e){if(0===e.length)return[];const r=this.score.score(t);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,r),[];const i=new Map,n=new Map;let s=0;return e.forEach((({messageIDs:e})=>{e?.forEach((e=>{const r=this.msgIdToStrFn(e),o=this.mcache.getWithIWantCount(r,t);null!=o?(n.set(o.msg.topic,1+(n.get(o.msg.topic)??0)),o.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,e):i.set(r,o.msg)):s++}))})),this.metrics?.onIwantRcv(n,s),0===i.size?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",i.size,t),Array.from(i.values()))}async handleGraft(t,e){const r=[],i=this.score.score(t),n=Date.now();let s=this.opts.doPX;return e.forEach((({topicID:e})=>{if(null==e)return;const o=this.mesh.get(e);if(null==o)return void(s=!1);if(o.has(t))return;const a=this.backoff.get(e)?.get(t);if(this.direct.has(t))this.log("GRAFT: ignoring request from direct peer %s",t),r.push(e),s=!1;else if("number"==typeof a&&n<a){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,$h.GraftBackoff),s=!1;const i=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;n<i&&this.score.addPenalty(t,1,$h.GraftBackoff),this.addBackoff(t,e),r.push(e)}else i<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,i,e),r.push(e),s=!1,this.addBackoff(t,e)):o.size>=this.opts.Dhi&&!this.outbound.get(t)?(r.push(e),this.addBackoff(t,e)):(this.log("GRAFT: Add mesh link from %s in %s",t,e),this.score.graft(t,e),o.add(t),this.metrics?.onAddToMesh(e,zh.Subscribed,1));this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:e,direction:"inbound"}})})),0===r.length?[]:Promise.all(r.map((async e=>this.makePrune(t,e,s,!1))))}async handlePrune(t,e){const r=this.score.score(t);for(const{topicID:i,backoff:n,peers:s}of e){if(null==i)continue;const e=this.mesh.get(i);if(null==e)return;this.log("PRUNE: Remove mesh link to %s in %s",t,i),this.score.prune(t,i),e.has(t)&&(e.delete(t),this.metrics?.onRemoveFromMesh(i,Hh.Prune,1)),"number"==typeof n&&n>0?this.doAddBackoff(t,i,1e3*n):this.addBackoff(t,i),null!=s&&s.length>0&&(r<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,r,i):await this.pxConnect(s)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:i,direction:"inbound"}})}}handleIdontwant(t,e){let r=this.idontwantCounts.get(t)??0;if(r>=this.opts.idontwantMaxMessages)return;const i=r;let n=this.idontwants.get(t);null==n&&(n=new Map,this.idontwants.set(t,n));let s=0;t:for(const{messageIDs:t}of e)for(const e of t){if(r>=this.opts.idontwantMaxMessages)break t;r++;const t=this.msgIdToStrFn(e);n.set(t,this.heartbeatTicks),this.mcache.msgs.has(t)||s++}this.idontwantCounts.set(t,r);const o=r-i;this.metrics?.onIdontwantRcv(o,s)}addBackoff(t,e){this.doAddBackoff(t,e,this.opts.pruneBackoff)}doAddBackoff(t,e,r){let i=this.backoff.get(e);null==i&&(i=new Map,this.backoff.set(e,i));const n=Date.now()+r;(i.get(t)??0)<n&&i.set(t,n)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((t,e)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",e,t),this.score.addPenalty(e,t,$h.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!=0)return;const t=Date.now();this.backoff.forEach(((e,r)=>{e.forEach(((r,i)=>{r+1*this.opts.heartbeatInterval<t&&e.delete(i)})),0===e.size&&this.backoff.delete(r)}))}async directConnect(){const t=[];this.direct.forEach((e=>{this.streamsOutbound.has(e)||t.push(e)})),await Promise.all(t.map((async t=>this.connect(t))))}async pxConnect(t){t.length>this.opts.prunePeers&&(vu(t),t=t.slice(0,this.opts.prunePeers));const e=[];await Promise.all(t.map((async t=>{if(null==t.peerID)return;const r=rh(qt(t.peerID)),i=r.toString();if(!this.peers.has(i))if(null!=t.signedPeerRecord)try{if(!await this.components.peerStore.consumePeerRecord(t.signedPeerRecord,r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");e.push(i)}catch(t){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else e.push(i)}))),0!==e.length&&await Promise.all(e.map((async t=>this.connect(t))))}async connect(t){this.log("Initiating connection with %s",t);const e=th(t),r=await this.components.connectionManager.openConnection(e);for(const t of this.multicodecs)for(const i of this.components.registrar.getTopologies(t))i.onConnect?.(e,r)}subscribe(t){if(this.status.code!==Xu.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const e of this.peers.keys())this.sendSubscriptions(e,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==Xu.started)throw new Error("Pubsub is not started");const e=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,e),e)for(const e of this.peers.keys())this.sendSubscriptions(e,[t],!1);this.leave(t)}join(t){if(this.status.code!==Xu.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),this.metrics?.onJoin(t);const e=new Set,r=this.backoff.get(t),i=this.fanout.get(t);if(null!=i&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),i.forEach((t=>{!this.direct.has(t)&&this.score.score(t)>=0&&!0!==r?.has(t)&&e.add(t)})),this.metrics?.onAddToMesh(t,zh.Fanout,e.size)),e.size<this.opts.D){const i=e.size;this.getRandomGossipPeers(t,this.opts.D,(t=>!e.has(t)&&!this.direct.has(t)&&this.score.score(t)>=0&&!0!==r?.has(t))).forEach((t=>{e.add(t)})),this.metrics?.onAddToMesh(t,zh.Random,e.size-i)}this.mesh.set(t,e),e.forEach((e=>{this.log("JOIN: Add mesh link to %s in %s",e,t),this.sendGraft(e,t)}))}leave(t){if(this.status.code!==Xu.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),this.metrics?.onLeave(t);const e=this.mesh.get(t);null!=e&&(Promise.all(Array.from(e).map((async e=>{this.log("LEAVE: Remove mesh link to %s in %s",e,t),await this.sendPrune(e,t)}))).catch((t=>{this.log("Error sending prunes to mesh peers",t)})),this.mesh.delete(t))}selectPeersToForward(t,e,r){const i=new Set,n=this.topics.get(t);null!=n&&(this.direct.forEach((t=>{n.has(t)&&e!==t&&!r?.has(t)&&i.add(t)})),this.floodsubPeers.forEach((t=>{n.has(t)&&e!==t&&!r?.has(t)&&this.score.score(t)>=this.opts.scoreThresholds.publishThreshold&&i.add(t)})));const s=this.mesh.get(t);return null!=s&&s.size>0&&s.forEach((t=>{e===t||r?.has(t)||i.add(t)})),i}selectPeersToPublish(t){const e=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},i=this.topics.get(t);if(null!=i)if(this.opts.floodPublish)i.forEach((t=>{this.direct.has(t)?(e.add(t),r.direct++):this.score.score(t)>=this.opts.scoreThresholds.publishThreshold&&(e.add(t),r.floodsub++)}));else{this.direct.forEach((t=>{i.has(t)&&(e.add(t),r.direct++)})),this.floodsubPeers.forEach((t=>{i.has(t)&&this.score.score(t)>=this.opts.scoreThresholds.publishThreshold&&(e.add(t),r.floodsub++)}));const n=this.mesh.get(t);if(null!=n&&n.size>0)n.forEach((t=>{e.add(t),r.mesh++})),n.size<this.opts.D&&this.getRandomGossipPeers(t,this.opts.D-n.size,(t=>!n.has(t)&&!this.direct.has(t)&&!this.floodsubPeers.has(t)&&this.score.score(t)>=this.opts.scoreThresholds.publishThreshold)).forEach((t=>{e.add(t),r.mesh++}));else{const i=this.fanout.get(t);if(null!=i&&i.size>0)i.forEach((t=>{e.add(t),r.fanout++}));else{const i=this.getRandomGossipPeers(t,this.opts.D,(t=>this.score.score(t)>=this.opts.scoreThresholds.publishThreshold));i.size>0&&(this.fanout.set(t,i),i.forEach((t=>{e.add(t),r.fanout++})))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:e,tosendCount:r}}forwardMessage(t,e,r,i){null!=r&&this.score.deliverMessage(r,t,e.topic);const n=this.selectPeersToForward(e.topic,r,i);n.forEach((t=>{this.sendRpc(t,gu([e]))})),this.metrics?.onForwardMsg(e.topic,n.size)}async publish(t,e,r){const i=Date.now(),n=null!=this.dataTransform?this.dataTransform.outboundTransform(t,e):e;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:s,msg:o}=await async function(t,e,r,i){switch(t.type){case Uh.Signing:{const n={from:t.author.toMultihash().bytes,data:i,seqno:pu(8),topic:e,signature:void 0,key:void 0},s=nh([mu,Lh.Message.encode(n)]);return n.signature=await t.privateKey.sign(s),n.key=t.key,{raw:n,msg:{type:"signed",from:t.author,data:r,sequenceNumber:BigInt(`0x${sa(n.seqno??new Uint8Array(0),"base16")}`),topic:e,signature:n.signature,key:Ha(n.key)}}}case Uh.Anonymous:return{raw:{from:void 0,data:i,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:e}};default:throw new Error("Unreachable")}}(this.publishConfig,t,e,n),a=await this.msgIdFn(o),h=this.msgIdToStrFn(a),u=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(h)){if(u)return this.metrics?.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:c,tosendCount:l}=this.selectPeersToPublish(t),d=this.opts.emitSelf&&this.subscriptions.has(t),f=r?.allowPublishToZeroTopicPeers??this.opts.allowPublishToZeroTopicPeers;if(0===c.size&&!f&&!d)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(h),this.mcache.put({msgId:a,msgIdStr:h},s,!0),this.publishedMessageIds.put(h);const p=r?.batchPublish??this.opts.batchPublish,m=gu([s]);if(p)this.sendRpcInBatch(c,m);else for(const t of c)this.sendRpc(t,m)||c.delete(t);const g=Date.now()-i;return this.metrics?.onPublishMsg(t,l,c.size,null!=s.data?s.data.length:0,g),d&&(c.add(this.components.peerId.toString()),super.dispatchEvent(new CustomEvent("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:h,msg:o}})),super.dispatchEvent(new CustomEvent("message",{detail:o}))),{recipients:Array.from(c.values()).map((t=>th(t)))}}sendRpcInBatch(t,e){const r=Lh.encode(e),i=lh.single(r);for(const n of t){const s=this.streamsOutbound.get(n);if(null!=s){try{s.pushPrefixed(i)}catch(e){t.delete(n),this.log.error(`Cannot send rpc to ${n}`,e)}this.metrics?.onRpcSent(e,r.length)}else this.log(`Cannot send RPC to ${n} as there is no open stream to it available`),t.delete(n)}}reportMessageValidationResult(t,e,r){let i;if(r===_.Accept){if(i=this.mcache.validate(t),null!=i){const{message:r,originatingPeers:n}=i;this.score.deliverMessage(e,t,r.topic),this.forwardMessage(t,i.message,e,n)}}else if(i=this.mcache.remove(t),null!=i){const n=Zh(r),{message:s,originatingPeers:o}=i;this.score.rejectMessage(e,t,s.topic,n);for(const e of o)this.score.rejectMessage(e,t,s.topic,n)}const n=this.score.messageFirstSeenTimestampMs(t);this.metrics?.onReportValidation(i,r,n)}sendGraft(t,e){const r=gu([],{graft:[{topicID:e}]});this.sendRpc(t,r)}async sendPrune(t,e){const r=gu([],{prune:[await this.makePrune(t,e,this.opts.doPX,!0)]});this.sendRpc(t,r)}sendIDontWants(t,e,r){const i=this.mesh.get(e);if(null==i)return;const n=new Set(i);n.delete(r);for(const t of n)this.streamsOutbound.get(t)?.protocol!==Rh&&n.delete(t);const s=gu([],{idontwant:[{messageIDs:[t]}]});this.sendRpcInBatch(n,s)}sendRpc(t,e){const r=this.streamsOutbound.get(t);if(null==r)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const i=this.control.get(t);null!=i&&(this.piggybackControl(t,e,i),this.control.delete(t));const n=this.gossip.get(t);null!=n&&(this.piggybackGossip(t,e,n),this.gossip.delete(t));const s=Lh.encode(e);try{r.push(s)}catch(e){return this.log.error(`Cannot send rpc to ${t}`,e),null!=i&&this.control.set(t,i),null!=n&&this.gossip.set(t,n),!1}if(this.metrics?.onRpcSent(e,s.length),null!=e.control?.graft)for(const r of e.control?.graft)null!=r.topicID&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:t,topic:r.topicID,direction:"outbound"}});if(null!=e.control?.prune)for(const r of e.control?.prune)null!=r.topicID&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:t,topic:r.topicID,direction:"outbound"}});return!0}piggybackControl(t,e,r){const i=bu(e);for(const e of r.graft)null!=e.topicID&&this.mesh.get(e.topicID)?.has(t)&&i.control.graft.push(e);for(const e of r.prune)null==e.topicID||this.mesh.get(e.topicID)?.has(t)||i.control.prune.push(e)}piggybackGossip(t,e,r){bu(e).control.ihave=r}async sendGraftPrune(t,e,r){const i=this.opts.doPX,n=!1;for(const[s,o]of t){const t=o.map((t=>({topicID:t})));let a=[];const h=e.get(s);null!=h&&(a=await Promise.all(h.map((async t=>this.makePrune(s,t,i&&!r.get(s),n)))),e.delete(s)),this.sendRpc(s,gu([],{graft:t,prune:a}))}for(const[t,s]of e){const e=await Promise.all(s.map((async e=>this.makePrune(t,e,i&&!r.get(t),n))));this.sendRpc(t,gu([],{prune:e}))}}emitGossip(t){const e=this.mcache.getGossipIDs(new Set(t.keys()));for(const[r,i]of t)this.doEmitGossip(r,i,e.get(r)??[])}doEmitGossip(t,e,r){if(0===r.length)return;if(vu(r),r.length>Dh&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),0===e.size)return;let i=this.opts.Dlazy;const n=this.opts.gossipFactor*e.size;let s=e;n>i&&(i=n),i>s.size?i=s.size:s=vu(Array.from(s)).slice(0,i),s.forEach((e=>{let i=r;r.length>Dh&&(i=vu(i.slice()).slice(0,Dh)),this.pushGossip(e,{topicID:t,messageIDs:i})}))}flush(){for(const[t,e]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,gu([],{ihave:e}));for(const[t,e]of this.control.entries()){this.control.delete(t);const r=gu([],{graft:e.graft,prune:e.prune});this.sendRpc(t,r)}}pushGossip(t,e){this.log("Add gossip to %s",t);const r=this.gossip.get(t)??[];this.gossip.set(t,r.concat(e))}async makePrune(t,e,r,i){if(this.score.prune(t,e),this.streamsOutbound.get(t)?.protocol===Bh)return{topicID:e,peers:[]};const n=i?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,s=n/1e3;if(this.doAddBackoff(t,e,n),!r)return{topicID:e,peers:[],backoff:s};const o=this.getRandomGossipPeers(e,this.opts.prunePeers,(e=>e!==t&&this.score.score(e)>=0)),a=await Promise.all(Array.from(o).map((async t=>{const e=th(t);let r;try{r=await this.components.peerStore.get(e)}catch(t){if("NotFoundError"!==t.name)throw t}return{peerID:e.toMultihash().bytes,signedPeerRecord:r?.peerRecordEnvelope}})));return{topicID:e,peers:a,backoff:s}}runHeartbeat=()=>{const t=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((t=>{this.log("Error running heartbeat",t)})).finally((()=>{if(null!=t&&t(),this.status.code===Xu.started){clearTimeout(this.status.heartbeatTimeout);let t=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;t<.25*this.opts.heartbeatInterval&&(t+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,t)}}))};async heartbeat(){const{D:t,Dlo:e,Dhi:r,Dscore:i,Dout:n,fanoutTTL:s}=this.opts;this.heartbeatTicks++;const o=new Map,a=t=>{let e=o.get(t);return void 0===e&&(e=this.score.score(t),o.set(t,e)),e},h=new Map,u=new Map,c=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.idontwantCounts.clear();for(const t of this.idontwants.values())for(const[e,r]of t)this.heartbeatTicks-r>=this.opts.mcacheLength&&t.delete(e);this.heartbeatTicks%this.opts.directConnectTicks==0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const l=new Map;this.mesh.forEach(((s,o)=>{const d=this.topics.get(o),f=new Set,p=new Set;if(l.set(o,p),null!=d){const t=vu(Array.from(d)),e=this.backoff.get(o);for(const r of t){const t=this.streamsOutbound.get(r);if(null!=t&&this.multicodecs.includes(t.protocol)&&!s.has(r)&&!this.direct.has(r)){const t=a(r);!0!==e?.has(r)&&t>=0&&f.add(r),t>=this.opts.scoreThresholds.gossipThreshold&&p.add(r)}}}const m=(t,e)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",t,o),this.addBackoff(t,o),s.delete(t),a(t)>=this.opts.scoreThresholds.gossipThreshold&&p.add(t),this.metrics?.onRemoveFromMesh(o,e,1);const r=u.get(t);null==r?u.set(t,[o]):r.push(o)},g=(t,e)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",t,o),this.score.graft(t,o),s.add(t),p.delete(t),this.metrics?.onAddToMesh(o,e,1);const r=h.get(t);null==r?h.set(t,[o]):r.push(o)};if(s.forEach((t=>{const e=a(t);e<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",t,e,o),m(t,Hh.BadScore),c.set(t,!0))})),s.size<e){(b=f,y=t-s.size,iu(b,y,(()=>!0))).forEach((t=>{g(t,zh.NotEnough)}))}var b,y;if(s.size>r){let e=Array.from(s);e.sort(((t,e)=>a(e)-a(t))),e=e.slice(0,i).concat(vu(e.slice(i)));let r=0;if(e.slice(0,t).forEach((t=>{this.outbound.get(t)&&r++})),r<n){const i=t=>{const r=e[t];for(let r=t;r>0;r--)e[r]=e[r-1];e[0]=r};if(r>0){let n=r;for(let r=1;r<t&&n>0;r++)this.outbound.get(e[r])&&(i(r),n--)}let n=t-r;for(let r=t;r<e.length&&n>0;r++)this.outbound.get(e[r])&&(i(r),n--)}e.slice(t).forEach((t=>{m(t,Hh.Excess)}))}if(s.size>=e){let t=0;s.forEach((e=>{this.outbound.get(e)&&t++})),t<n&&iu(f,n-t,(t=>!0===this.outbound.get(t))).forEach((t=>{g(t,zh.Outbound)}))}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks==0&&s.size>1){const t=Array.from(s).sort(((t,e)=>a(t)-a(e))),e=Math.floor(s.size/2),r=a(t[e]);if(r<this.opts.scoreThresholds.opportunisticGraftThreshold){const t=iu(f,this.opts.opportunisticGraftPeers,(t=>a(t)>r));for(const e of t)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",e,o),g(e,zh.Opportunistic)}}}));const d=Date.now();this.fanoutLastpub.forEach(((t,e)=>{t+s<d&&(this.fanout.delete(e),this.fanoutLastpub.delete(e))})),this.fanout.forEach(((e,r)=>{const i=this.topics.get(r);e.forEach((t=>{(!i?.has(t)||a(t)<this.opts.scoreThresholds.publishThreshold)&&e.delete(t)}));const n=this.topics.get(r),s=[],o=new Set;if(l.set(r,o),null!=n){const t=vu(Array.from(n));for(const r of t){const t=this.streamsOutbound.get(r);if(null!=t&&this.multicodecs.includes(t.protocol)&&!e.has(r)&&!this.direct.has(r)){const t=a(r);t>=this.opts.scoreThresholds.publishThreshold&&s.push(r),t>=this.opts.scoreThresholds.gossipThreshold&&o.add(r)}}}if(e.size<t){const r=t-e.size;s.slice(0,r).forEach((t=>{e.add(t),o?.delete(t)}))}})),this.emitGossip(l),await this.sendGraftPrune(h,u,c),this.flush(),this.mcache.shift(),this.dispatchEvent(new CustomEvent("gossipsub:heartbeat"))}getRandomGossipPeers(t,e,r=()=>!0){const i=this.topics.get(t);if(null==i)return new Set;let n=[];return i.forEach((t=>{const e=this.streamsOutbound.get(t);null!=e&&this.multicodecs.includes(e.protocol)&&r(t)&&n.push(t)})),n=vu(n),e>0&&n.length>e&&(n=n.slice(0,e)),new Set(n)}onScrapeMetrics(t){t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let e=0;const r=Date.now();t.connectedPeersBackoffSec.reset();for(const i of this.backoff.values()){e+=i.size;for(const[e,n]of i.entries())this.peers.has(e)&&t.connectedPeersBackoffSec.observe(Math.max(0,n-r)/1e3)}t.cacheSize.set({cache:"backoff"},e);let i=0;for(const t of this.idontwants.values())i+=t.size;t.cacheSize.set({cache:"idontwants"},i);for(const[e,r]of this.topics)t.topicPeersCount.set({topicStr:e},r.size);for(const[e,r]of this.mesh)t.meshPeerCounts.set({topicStr:e},r.size);const n=[],s=new Map;t.behaviourPenalty.reset();for(const e of this.peers.keys()){const r=this.score.score(e);n.push(r),s.set(e,r),t.behaviourPenalty.observe(this.score.peerStats.get(e)?.behaviourPenalty??0)}t.registerScores(n,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,s);const o=function(t,e,r,i,n){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of t){const t=e.get(o);if(null!=t){const e=cu(o,t,r,i,n);for(const[t,r]of e.byTopic){let e=s.byTopic.get(t);null==e&&(e={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(t,e)),e.p1w.push(r.p1w),e.p2w.push(r.p2w),e.p3w.push(r.p3w),e.p3bw.push(r.p3bw),e.p4w.push(r.p4w)}s.p5w.push(e.p5w),s.p6w.push(e.p6w),s.p7w.push(e.p7w),s.score.push(e.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(o)}tagMeshPeer=t=>{const{peerId:e,topic:r}=t.detail;this.components.peerStore.merge(th(e),{tags:{[r]:{value:100}}}).catch((t=>{this.log.error("Error tagging peer %s with topic %s",e,r,t)}))};untagMeshPeer=t=>{const{peerId:e,topic:r}=t.detail;this.components.peerStore.merge(th(e),{tags:{[r]:void 0}}).catch((t=>{this.log.error("Error untagging peer %s with topic %s",e,r,t)}))}}function ec(t={}){return e=>new tc(e,t)}class rc extends Error{type;code;constructor(t,e,r){super(t??"The operation was aborted"),this.type="aborted",this.name=r??"AbortError",this.code=e??"ABORT_ERR"}}async function ic(t,e,r){if(null==e)return t;if(e.aborted)return Promise.reject(new rc(r?.errorMessage,r?.errorCode,r?.errorName));let i;const n=new rc(r?.errorMessage,r?.errorCode,r?.errorName);try{return await Promise.race([t,new Promise(((t,r)=>{i=()=>{r(n)},e.addEventListener("abort",i)}))])}finally{null!=i&&e.removeEventListener("abort",i)}}class nc{readNext;haveNext;ended;nextResult;constructor(){this.ended=!1,this.readNext=vh(),this.haveNext=vh()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw new Error("HaveNext promise resolved but nextResult was undefined");const t=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=vh(),t}async throw(t){return this.ended=!0,null!=t&&(this.haveNext.promise.catch((()=>{})),this.haveNext.reject(t)),{done:!0,value:void 0}}async return(){return await this._push(void 0),{done:!0,value:void 0}}async push(t,e){await this._push(t,e)}async end(t,e){null!=t?await this.throw(t):await this._push(void 0,e)}async _push(t,e){if(null!=t&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;null!=this.nextResult;)await this.readNext.promise;null!=t?this.nextResult={done:!1,value:t}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=vh(),await ic(this.readNext.promise,e?.signal,e)}}class sc extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}class oc extends Error{code;constructor(t,e){super(t),this.code=e}}class ac extends oc{type;constructor(t){super(t,"ABORT_ERR"),this.type="aborted",this.name="AbortError"}}function hc(t,e){const r=new nc;t.sink(r).catch((async t=>{await r.end(t)})),t.sink=async t=>{for await(const e of t)await r.push(e);await r.end()};let i=t.source;null!=t.source[Symbol.iterator]?i=t.source[Symbol.iterator]():null!=t.source[Symbol.asyncIterator]&&(i=t.source[Symbol.asyncIterator]());const n=new hh,s={read:async(t,e)=>{let r;e?.signal?.throwIfAborted();const s=new Promise(((t,i)=>{r=()=>{i(new ac("Read aborted"))},e?.signal?.addEventListener("abort",r)}));try{if(null==t){const{done:t,value:e}=await Promise.race([i.next(),s]);return!0===t?new hh:e}for(;n.byteLength<t;){const{value:t,done:e}=await Promise.race([i.next(),s]);if(!0===e)throw new sc("unexpected end of input");n.append(t)}const e=n.sublist(0,t);return n.consume(t),e}finally{null!=r&&e?.signal?.removeEventListener("abort",r)}},write:async(t,e)=>{e?.signal?.throwIfAborted(),t instanceof Uint8Array?await r.push(t,e):await r.push(t.subarray(),e)},unwrap:()=>{if(n.byteLength>0){const r=t.source;t.source=async function*(){!1===e?.yieldBytes?yield n:yield*n,yield*r}()}return t}};return s}class uc extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"}class cc extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class lc extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}function dc(t,e={}){const r=hc(t,e);null!=e.maxDataLength&&null==e.maxLengthLength&&(e.maxLengthLength=ci(e.maxDataLength));const i=e?.lengthDecoder??pi,n=e?.lengthEncoder??fi,s={read:async t=>{let n=-1;const s=new hh;for(;;){s.append(await r.read(1,t));try{n=i(s)}catch(t){if(t instanceof RangeError)continue;throw t}if(n<0)throw new uc("Invalid message length");if(null!=e?.maxLengthLength&&s.byteLength>e.maxLengthLength)throw new lc("message length length too long");if(n>-1)break}if(null!=e?.maxDataLength&&n>e.maxDataLength)throw new cc("message length too long");return r.read(n,t)},write:async(t,e)=>{await r.write(new hh(n(t.byteLength),t),e)},writeV:async(t,e)=>{const i=new hh(...t.flatMap((t=>[n(t.byteLength),t])));await r.write(i,e)},unwrap:()=>r.unwrap()};return s}function fc(){const t=vh();let e=!1;return{sink:async r=>{if(e)throw new Error("already piped");e=!0,t.resolve(r)},source:async function*(){const e=await t.promise;yield*e}()}}const pc=65535,mc=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);function gc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function bc(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function yc(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function vc(t,...e){if(!yc(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function wc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}const Mc=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4));if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function _c(t){if("string"==typeof t)t=function(t){if("string"!=typeof t)throw new Error("string expected, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!yc(t))throw new Error("Uint8Array expected, got "+typeof t);t=kc(t)}return t}const Sc=(t,e)=>(Object.assign(e,t),e);function Ec(t,e,r,i){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,i);const n=BigInt(32),s=BigInt(4294967295),o=Number(r>>n&s),a=Number(r&s),h=i?4:0,u=i?0:4;t.setUint32(e+h,o,i),t.setUint32(e+u,a,i)}function kc(t){return Uint8Array.from(t)}function Ac(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}const Ic=t=>Uint8Array.from(t.split("").map((t=>t.charCodeAt(0)))),xc=Ic("expand 16-byte k"),Cc=Ic("expand 32-byte k"),Tc=Mc(xc),Pc=Mc(Cc);function Bc(t,e){return t<<e|t>>>32-e}function Rc(t){return t.byteOffset%4==0}Pc.slice();const Dc=2**32-1,Nc=new Uint32Array;function Lc(t,e){const{allowShortKeys:r,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=function(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e)}(0,e);if("function"!=typeof t)throw new Error("core must be a function");return gc(n),gc(o),bc(s),bc(r),(e,a,h,u,c=0)=>{vc(e),vc(a),vc(h);const l=h.length;if(void 0===u&&(u=new Uint8Array(l)),vc(u),gc(c),c<0||c>=Dc)throw new Error("arx: counter overflow");if(u.length<l)throw new Error(`arx: output (${u.length}) is shorter than data (${l})`);const d=[];let f,p,m=e.length;if(32===m)d.push(f=kc(e)),p=Pc;else{if(16!==m||!r)throw new Error(`arx: invalid 32-byte key, got length=${m}`);f=new Uint8Array(32),f.set(e),f.set(e,16),p=Tc,d.push(f)}Rc(a)||d.push(a=kc(a));const g=Mc(f);if(i){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");i(p,g,Mc(a.subarray(0,16)),g),a=a.subarray(16)}const b=16-n;if(b!==a.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(12!==b){const t=new Uint8Array(12);t.set(a,s?0:12-a.length),a=t,d.push(a)}const y=Mc(a);return function(t,e,r,i,n,s,o,a){const h=n.length,u=new Uint8Array(64),c=Mc(u),l=Rc(n)&&Rc(s),d=l?Mc(n):Nc,f=l?Mc(s):Nc;for(let p=0;p<h;o++){if(t(e,r,i,c,o,a),o>=Dc)throw new Error("arx: counter overflow");const m=Math.min(64,h-p);if(l&&64===m){const t=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let e,r=0;r<16;r++)e=t+r,f[e]=d[e]^c[r];p+=64}else{for(let t,e=0;e<m;e++)t=p+e,s[t]=n[t]^u[e];p+=m}}}(t,p,g,y,h,u,c,o),Ac(...d),u}}const Oc=(t,e)=>255&t[e++]|(255&t[e++])<<8;class Uc{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,vc(t=_c(t),32);const e=Oc(t,0),r=Oc(t,2),i=Oc(t,4),n=Oc(t,6),s=Oc(t,8),o=Oc(t,10),a=Oc(t,12),h=Oc(t,14);this.r[0]=8191&e,this.r[1]=8191&(e>>>13|r<<3),this.r[2]=7939&(r>>>10|i<<6),this.r[3]=8191&(i>>>7|n<<9),this.r[4]=255&(n>>>4|s<<12),this.r[5]=s>>>1&8190,this.r[6]=8191&(s>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|h<<8),this.r[9]=h>>>5&127;for(let e=0;e<8;e++)this.pad[e]=Oc(t,16+2*e)}process(t,e,r=!1){const i=r?0:2048,{h:n,r:s}=this,o=s[0],a=s[1],h=s[2],u=s[3],c=s[4],l=s[5],d=s[6],f=s[7],p=s[8],m=s[9],g=Oc(t,e+0),b=Oc(t,e+2),y=Oc(t,e+4),v=Oc(t,e+6),w=Oc(t,e+8),M=Oc(t,e+10),_=Oc(t,e+12),S=Oc(t,e+14);let E=n[0]+(8191&g),k=n[1]+(8191&(g>>>13|b<<3)),A=n[2]+(8191&(b>>>10|y<<6)),I=n[3]+(8191&(y>>>7|v<<9)),x=n[4]+(8191&(v>>>4|w<<12)),C=n[5]+(w>>>1&8191),T=n[6]+(8191&(w>>>14|M<<2)),P=n[7]+(8191&(M>>>11|_<<5)),B=n[8]+(8191&(_>>>8|S<<8)),R=n[9]+(S>>>5|i),D=0,N=D+E*o+k*(5*m)+A*(5*p)+I*(5*f)+x*(5*d);D=N>>>13,N&=8191,N+=C*(5*l)+T*(5*c)+P*(5*u)+B*(5*h)+R*(5*a),D+=N>>>13,N&=8191;let L=D+E*a+k*o+A*(5*m)+I*(5*p)+x*(5*f);D=L>>>13,L&=8191,L+=C*(5*d)+T*(5*l)+P*(5*c)+B*(5*u)+R*(5*h),D+=L>>>13,L&=8191;let O=D+E*h+k*a+A*o+I*(5*m)+x*(5*p);D=O>>>13,O&=8191,O+=C*(5*f)+T*(5*d)+P*(5*l)+B*(5*c)+R*(5*u),D+=O>>>13,O&=8191;let U=D+E*u+k*h+A*a+I*o+x*(5*m);D=U>>>13,U&=8191,U+=C*(5*p)+T*(5*f)+P*(5*d)+B*(5*l)+R*(5*c),D+=U>>>13,U&=8191;let F=D+E*c+k*u+A*h+I*a+x*o;D=F>>>13,F&=8191,F+=C*(5*m)+T*(5*p)+P*(5*f)+B*(5*d)+R*(5*l),D+=F>>>13,F&=8191;let j=D+E*l+k*c+A*u+I*h+x*a;D=j>>>13,j&=8191,j+=C*o+T*(5*m)+P*(5*p)+B*(5*f)+R*(5*d),D+=j>>>13,j&=8191;let V=D+E*d+k*l+A*c+I*u+x*h;D=V>>>13,V&=8191,V+=C*a+T*o+P*(5*m)+B*(5*p)+R*(5*f),D+=V>>>13,V&=8191;let q=D+E*f+k*d+A*l+I*c+x*u;D=q>>>13,q&=8191,q+=C*h+T*a+P*o+B*(5*m)+R*(5*p),D+=q>>>13,q&=8191;let z=D+E*p+k*f+A*d+I*l+x*c;D=z>>>13,z&=8191,z+=C*u+T*h+P*a+B*o+R*(5*m),D+=z>>>13,z&=8191;let H=D+E*m+k*p+A*f+I*d+x*l;D=H>>>13,H&=8191,H+=C*c+T*u+P*h+B*a+R*o,D+=H>>>13,H&=8191,D=(D<<2)+D|0,D=D+N|0,N=8191&D,D>>>=13,L+=D,n[0]=N,n[1]=L,n[2]=O,n[3]=U,n[4]=F,n[5]=j,n[6]=V,n[7]=q,n[8]=z,n[9]=H}finalize(){const{h:t,pad:e}=this,r=new Uint16Array(10);let i=t[1]>>>13;t[1]&=8191;for(let e=2;e<10;e++)t[e]+=i,i=t[e]>>>13,t[e]&=8191;t[0]+=5*i,i=t[0]>>>13,t[0]&=8191,t[1]+=i,i=t[1]>>>13,t[1]&=8191,t[2]+=i,r[0]=t[0]+5,i=r[0]>>>13,r[0]&=8191;for(let e=1;e<10;e++)r[e]=t[e]+i,i=r[e]>>>13,r[e]&=8191;r[9]-=8192;let n=(1^i)-1;for(let t=0;t<10;t++)r[t]&=n;n=~n;for(let e=0;e<10;e++)t[e]=t[e]&n|r[e];t[0]=65535&(t[0]|t[1]<<13),t[1]=65535&(t[1]>>>3|t[2]<<10),t[2]=65535&(t[2]>>>6|t[3]<<7),t[3]=65535&(t[3]>>>9|t[4]<<4),t[4]=65535&(t[4]>>>12|t[5]<<1|t[6]<<14),t[5]=65535&(t[6]>>>2|t[7]<<11),t[6]=65535&(t[7]>>>5|t[8]<<8),t[7]=65535&(t[8]>>>8|t[9]<<5);let s=t[0]+e[0];t[0]=65535&s;for(let r=1;r<8;r++)s=(t[r]+e[r]|0)+(s>>>16)|0,t[r]=65535&s;Ac(r)}update(t){wc(this);const{buffer:e,blockLen:r}=this,i=(t=_c(t)).length;for(let n=0;n<i;){const s=Math.min(r-this.pos,i-n);if(s!==r)e.set(t.subarray(n,n+s),this.pos),this.pos+=s,n+=s,this.pos===r&&(this.process(e,0,!1),this.pos=0);else for(;r<=i-n;n+=r)this.process(t,n)}return this}destroy(){Ac(this.h,this.r,this.buffer,this.pad)}digestInto(t){wc(this),function(t,e){vc(t);const r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}(t,this),this.finished=!0;const{buffer:e,h:r}=this;let{pos:i}=this;if(i){for(e[i++]=1;i<16;i++)e[i]=0;this.process(e,0,!0)}this.finalize();let n=0;for(let e=0;e<8;e++)t[n++]=r[e]>>>0,t[n++]=r[e]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}}const Fc=function(t){const e=(e,r)=>t(r).update(_c(e)).digest(),r=t(new Uint8Array(32));return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=e=>t(e),e}((t=>new Uc(t)));function jc(t,e,r,i,n,s=20){let o=t[0],a=t[1],h=t[2],u=t[3],c=e[0],l=e[1],d=e[2],f=e[3],p=e[4],m=e[5],g=e[6],b=e[7],y=n,v=r[0],w=r[1],M=r[2],_=o,S=a,E=h,k=u,A=c,I=l,x=d,C=f,T=p,P=m,B=g,R=b,D=y,N=v,L=w,O=M;for(let t=0;t<s;t+=2)_=_+A|0,D=Bc(D^_,16),T=T+D|0,A=Bc(A^T,12),_=_+A|0,D=Bc(D^_,8),T=T+D|0,A=Bc(A^T,7),S=S+I|0,N=Bc(N^S,16),P=P+N|0,I=Bc(I^P,12),S=S+I|0,N=Bc(N^S,8),P=P+N|0,I=Bc(I^P,7),E=E+x|0,L=Bc(L^E,16),B=B+L|0,x=Bc(x^B,12),E=E+x|0,L=Bc(L^E,8),B=B+L|0,x=Bc(x^B,7),k=k+C|0,O=Bc(O^k,16),R=R+O|0,C=Bc(C^R,12),k=k+C|0,O=Bc(O^k,8),R=R+O|0,C=Bc(C^R,7),_=_+I|0,O=Bc(O^_,16),B=B+O|0,I=Bc(I^B,12),_=_+I|0,O=Bc(O^_,8),B=B+O|0,I=Bc(I^B,7),S=S+x|0,D=Bc(D^S,16),R=R+D|0,x=Bc(x^R,12),S=S+x|0,D=Bc(D^S,8),R=R+D|0,x=Bc(x^R,7),E=E+C|0,N=Bc(N^E,16),T=T+N|0,C=Bc(C^T,12),E=E+C|0,N=Bc(N^E,8),T=T+N|0,C=Bc(C^T,7),k=k+A|0,L=Bc(L^k,16),P=P+L|0,A=Bc(A^P,12),k=k+A|0,L=Bc(L^k,8),P=P+L|0,A=Bc(A^P,7);let U=0;i[U++]=o+_|0,i[U++]=a+S|0,i[U++]=h+E|0,i[U++]=u+k|0,i[U++]=c+A|0,i[U++]=l+I|0,i[U++]=d+x|0,i[U++]=f+C|0,i[U++]=p+T|0,i[U++]=m+P|0,i[U++]=g+B|0,i[U++]=b+R|0,i[U++]=y+D|0,i[U++]=v+N|0,i[U++]=w+L|0,i[U++]=M+O|0}const Vc=Lc(jc,{counterRight:!1,counterLength:4,allowShortKeys:!1}),qc=Lc(jc,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,r,i){let n=t[0],s=t[1],o=t[2],a=t[3],h=e[0],u=e[1],c=e[2],l=e[3],d=e[4],f=e[5],p=e[6],m=e[7],g=r[0],b=r[1],y=r[2],v=r[3];for(let t=0;t<20;t+=2)n=n+h|0,g=Bc(g^n,16),d=d+g|0,h=Bc(h^d,12),n=n+h|0,g=Bc(g^n,8),d=d+g|0,h=Bc(h^d,7),s=s+u|0,b=Bc(b^s,16),f=f+b|0,u=Bc(u^f,12),s=s+u|0,b=Bc(b^s,8),f=f+b|0,u=Bc(u^f,7),o=o+c|0,y=Bc(y^o,16),p=p+y|0,c=Bc(c^p,12),o=o+c|0,y=Bc(y^o,8),p=p+y|0,c=Bc(c^p,7),a=a+l|0,v=Bc(v^a,16),m=m+v|0,l=Bc(l^m,12),a=a+l|0,v=Bc(v^a,8),m=m+v|0,l=Bc(l^m,7),n=n+u|0,v=Bc(v^n,16),p=p+v|0,u=Bc(u^p,12),n=n+u|0,v=Bc(v^n,8),p=p+v|0,u=Bc(u^p,7),s=s+c|0,g=Bc(g^s,16),m=m+g|0,c=Bc(c^m,12),s=s+c|0,g=Bc(g^s,8),m=m+g|0,c=Bc(c^m,7),o=o+l|0,b=Bc(b^o,16),d=d+b|0,l=Bc(l^d,12),o=o+l|0,b=Bc(b^o,8),d=d+b|0,l=Bc(l^d,7),a=a+h|0,y=Bc(y^a,16),f=f+y|0,h=Bc(h^f,12),a=a+h|0,y=Bc(y^a,8),f=f+y|0,h=Bc(h^f,7);let w=0;i[w++]=n,i[w++]=s,i[w++]=o,i[w++]=a,i[w++]=g,i[w++]=b,i[w++]=y,i[w++]=v},allowShortKeys:!1}),zc=new Uint8Array(16),Hc=(t,e)=>{t.update(e);const r=e.length%16;r&&t.update(zc.subarray(r))},$c=new Uint8Array(32);function Wc(t,e,r,i,n){const s=t(e,r,$c),o=Fc.create(s);n&&Hc(o,n),Hc(o,i);const a=new Uint8Array(16),h=(u=a,new DataView(u.buffer,u.byteOffset,u.byteLength));var u;Ec(h,0,BigInt(n?n.length:0),!0),Ec(h,8,BigInt(i.length),!0),o.update(a);const c=o.digest();return Ac(s,a),c}const Kc=t=>(e,r,i)=>(vc(e,32),vc(r),{encrypt(n,s){const o=n.length,a=o+16;s?vc(s,a):s=new Uint8Array(a),t(e,r,n,s,1);const h=Wc(t,e,r,s.subarray(0,-16),i);return s.set(h,o),Ac(h),s},decrypt(n,s){const o=n.length,a=o-16;if(o<16)throw new Error("encrypted data must be at least 16 bytes");s?vc(s,a):s=new Uint8Array(a);const h=n.subarray(0,-16),u=n.subarray(-16),c=Wc(t,e,r,h,i);if(!function(t,e){if(t.length!==e.length)return!1;let r=0;for(let i=0;i<t.length;i++)r|=t[i]^e[i];return 0===r}(u,c))throw new Error("invalid tag");return t(e,r,h,s,1),Ac(c),s}}),Gc=Sc({blockSize:64,nonceLength:12,tagLength:16},Kc(Vc));Kc(qc);class Zc extends $n{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Fn(t);const r=Hn(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,n=new Uint8Array(i);n.set(r.length>i?t.create().update(r).digest():r);for(let t=0;t<n.length;t++)n[t]^=54;this.iHash.update(n),this.oHash=t.create();for(let t=0;t<n.length;t++)n[t]^=106;this.oHash.update(n),n.fill(0)}update(t){return jn(this),this.iHash.update(t),this}digestInto(t){jn(this),Un(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:i,destroyed:n,blockLen:s,outputLen:o}=this;return t.finished=i,t.destroyed=n,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Yc=(t,e,r)=>new Zc(t,e).update(r).digest();Yc.create=(t,e)=>new Zc(t,e);const Jc=new Uint8Array([0]),Xc=new Uint8Array;const Qc={hashSHA256:t=>Qn(t.subarray()),getHKDF(t,e){const r=function(t,e,r){return Fn(t),void 0===r&&(r=new Uint8Array(t.outputLen)),Yc(t,Hn(r),Hn(e))}(Qn,e,t),i=function(t,e,r,i=32){if(Fn(t),On(i),i>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(i/t.outputLen);void 0===r&&(r=Xc);const s=new Uint8Array(n*t.outputLen),o=Yc.create(t,e),a=o._cloneInto(),h=new Uint8Array(o.outputLen);for(let e=0;e<n;e++)Jc[0]=e+1,a.update(0===e?Xc:h).update(r).update(Jc).digestInto(h),s.set(h,t.outputLen*e),o._cloneInto(a);return o.destroy(),a.destroy(),h.fill(0),Jc.fill(0),s.slice(0,i)}(Qn,r,void 0,96);return[i.subarray(0,32),i.subarray(32,64),i.subarray(64,96)]},generateX25519KeyPair(){const t=Kr.utils.randomPrivateKey();return{publicKey:Kr.getPublicKey(t),privateKey:t}},generateX25519KeyPairFromSeed:t=>({publicKey:Kr.getPublicKey(t),privateKey:t}),generateX25519SharedKey:(t,e)=>Kr.getSharedSecret(t.subarray(),e.subarray()),chaCha20Poly1305Encrypt:(t,e,r,i)=>Gc(i,e,r).encrypt(t.subarray()),chaCha20Poly1305Decrypt:(t,e,r,i,n)=>Gc(i,e,r).decrypt(t.subarray(),n)},tl=t=>{const e=ti(2);return e[0]=t>>8,e[1]=t,e};tl.bytes=2;const el=t=>{if(t.length<2)throw RangeError("Could not decode int16BE");if(t instanceof Uint8Array){let e=0;return e+=t[0]<<8,e+=t[1],e}return t.getUint16(0)};function rl(t,e){e.enabled&&mc&&(t?(e(`LOCAL_STATIC_PUBLIC_KEY ${sa(t.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${sa(t.privateKey,"hex")}`)):e("Missing local static keys."))}function il(t,e){e.enabled&&mc&&(t?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${sa(t.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${sa(t.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function nl(t,e){e.enabled&&mc&&e(t?`REMOTE_EPHEMERAL_PUBLIC_KEY ${sa(t.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function sl(t,e,r){r.enabled&&mc&&(r(`CIPHER_STATE_1 ${t.n.getUint64()} ${t.k&&sa(t.k,"hex")}`),r(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&sa(e.k,"hex")}`))}el.bytes=2;class ol extends Error{code;constructor(t="Invalid crypto exchange"){super(t),this.code=ol.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}class al{n;bytes;view;constructor(t=0){this.n=t,this.bytes=Qr(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,t,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}const hl=Qr(0);class ul{k;n;crypto;constructor(t,e=void 0,r=0){this.crypto=t,this.k=e,this.n=new al(r)}hasKey(){return Boolean(this.k)}encryptWithAd(t,e){if(!this.hasKey())return e;this.n.assertValue();const r=this.crypto.encrypt(e,this.n.getBytes(),t,this.k);return this.n.increment(),r}decryptWithAd(t,e,r){if(!this.hasKey())return e;this.n.assertValue();const i=this.crypto.decrypt(e,this.n.getBytes(),t,this.k,r);return this.n.increment(),i}}class cl{cs;ck;h;crypto;constructor(t,e){this.crypto=t;const r=dn(e,"utf-8");this.h=function(t,e){if(e.length<=32){const t=Qr(32);return t.set(e),t}return t.hash(e)}(t,r),this.ck=this.h,this.cs=new ul(t)}mixKey(t){const[e,r]=this.crypto.hkdf(this.ck,t);this.ck=e,this.cs=new ul(this.crypto,r)}mixHash(t){this.h=this.crypto.hash(new hh(this.h,t))}encryptAndHash(t){const e=this.cs.encryptWithAd(this.h,t);return this.mixHash(e),e}decryptAndHash(t){const e=this.cs.decryptWithAd(this.h,t);return this.mixHash(t),e}split(){const[t,e]=this.crypto.hkdf(this.ck,hl);return[new ul(this.crypto,t),new ul(this.crypto,e)]}}class ll{ss;s;e;rs;re;initiator;crypto;constructor(t){const{crypto:e,protocolName:r,prologue:i,initiator:n,s,e:o,rs:a,re:h}=t;this.crypto=e,this.ss=new cl(e,r),this.ss.mixHash(i),this.initiator=n,this.s=s,this.e=o,this.rs=a,this.re=h}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const t=this.crypto.generateKeypair();return this.ss.mixHash(t.publicKey),this.e=t,t.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(t,e=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(t.byteLength<e+32)throw new Error("message is not long enough");this.re=t.sublist(e,e+32),this.ss.mixHash(this.re)}readS(t,e=0){if(this.rs)throw new Error("remote static public key is already set");const r=32+(this.ss.cs.hasKey()?16:0);if(t.byteLength<e+r)throw new Error("message is not long enough");const i=t.sublist(e,e+r);return this.rs=this.ss.decryptAndHash(i),r}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class dl extends ll{writeMessageA(t){return new hh(this.writeE(),this.ss.encryptAndHash(t))}writeMessageB(t){const e=this.writeE();this.writeEE();const r=this.writeS();return this.writeES(),new hh(e,r,this.ss.encryptAndHash(t))}writeMessageC(t){const e=this.writeS();return this.writeSE(),new hh(e,this.ss.encryptAndHash(t))}readMessageA(t){try{return this.readE(t),this.ss.decryptAndHash(t.sublist(32))}catch(t){throw new ol(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(t){try{this.readE(t),this.readEE();const e=this.readS(t,32);return this.readES(),this.ss.decryptAndHash(t.sublist(32+e))}catch(t){throw new ol(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(t){try{const e=this.readS(t);return this.readSE(),this.ss.decryptAndHash(t.sublist(e))}catch(t){throw new ol(`handshake stage 2 validation fail: ${t.message}`)}}}var fl,pl;async function ml(t,e,r){const i=await t.sign(bl(e));return pl.encode({identityKey:$a(t.publicKey),identitySig:i,extensions:r})}async function gl(t,e,r){try{const i=pl.decode(t),n=Ha(i.identityKey);if(!1===r?.equals(n))throw new Error(`Payload identity key ${n} does not match expected remote identity key ${r}`);if(!e)throw new Error("Remote static does not exist");const s=bl(e);if(!await n.verify(s,i.identitySig))throw new Error("Invalid payload signature");return i}catch(t){throw new x(t.message)}}function bl(t){const e=dn("noise-libp2p-static-key:");return t instanceof Uint8Array?nh([e,t],e.length+t.length):(t.prepend(e),t)}!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.webtransportCerthashes)for(const r of t.webtransportCerthashes)e.uint32(10),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e)=>{const r={webtransportCerthashes:[]},i=null==e?t.len:t.pos+e;for(;t.pos<i;){const e=t.uint32();e>>>3==1?r.webtransportCerthashes.push(t.bytes()):t.skipType(7&e)}return r}))),e),t.encode=e=>An(e,t.codec()),t.decode=e=>Ti(e,t.codec())}(fl||(fl={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.identityKey&&t.identityKey.byteLength>0&&(e.uint32(10),e.bytes(t.identityKey)),null!=t.identitySig&&t.identitySig.byteLength>0&&(e.uint32(18),e.bytes(t.identitySig)),null!=t.extensions&&(e.uint32(34),fl.codec().encode(t.extensions,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e)=>{const r={identityKey:Qr(0),identitySig:Qr(0)},i=null==e?t.len:t.pos+e;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:r.identityKey=t.bytes();break;case 2:r.identitySig=t.bytes();break;case 4:r.extensions=fl.codec().decode(t,t.uint32());break;default:t.skipType(7&e)}}return r}))),e),t.encode=e=>An(e,t.codec()),t.decode=e=>Ti(e,t.codec())}(pl||(pl={}));class yl{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;constructor(t,e={}){const{staticNoiseKey:r,extensions:i,crypto:n,prologueBytes:s}=e,{metrics:o}=t;this.components=t;const a=n??Qc;this.crypto=function(t){return{generateKeypair:t.generateX25519KeyPair,dh:(e,r)=>t.generateX25519SharedKey(e.privateKey,r).subarray(0,32),encrypt:t.chaCha20Poly1305Encrypt,decrypt:t.chaCha20Poly1305Decrypt,hash:t.hashSHA256,hkdf:t.getHKDF}}(a),this.extensions=i,this.metrics=o?function(t){return{xxHandshakeSuccesses:t.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:t.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:t.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:t.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:t.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(o):void 0,this.staticKey=r?a.generateX25519KeyPairFromSeed(r):a.generateX25519KeyPair(),this.prologue=s??Qr(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[k]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(t,e){const r=dc(t,{lengthEncoder:tl,lengthDecoder:el,maxDataLength:pc}),i=await this.performHandshakeInitiator(r,this.components.privateKey,e?.remotePeer?.publicKey,e),n=await this.createSecureConnection(r,i);t.source=n.source,t.sink=n.sink;const s=Ha(i.payload.identityKey);return{conn:t,remoteExtensions:i.payload.extensions,remotePeer:eh(s)}}async secureInbound(t,e){const r=dc(t,{lengthEncoder:tl,lengthDecoder:el,maxDataLength:pc}),i=await this.performHandshakeResponder(r,this.components.privateKey,e?.remotePeer?.publicKey,e),n=await this.createSecureConnection(r,i);t.source=n.source,t.sink=n.sink;const s=Ha(i.payload.identityKey);return{conn:t,remoteExtensions:i.payload.extensions,remotePeer:eh(s)}}async performHandshakeInitiator(t,e,r,i){let n;try{n=await async function(t,e){const{log:r,connection:i,crypto:n,privateKey:s,prologue:o,s:a,remoteIdentityKey:h,extensions:u}=t,c=await ml(s,a.publicKey,u),l=new dl({crypto:n,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});rl(l.s,r),r.trace("Stage 0 - Initiator starting to send first message."),await i.write(l.writeMessageA(hl),e),r.trace("Stage 0 - Initiator finished sending first message."),il(l.e,r),r.trace("Stage 1 - Initiator waiting to receive first message from responder...");const d=l.readMessageB(await i.read(e));var f,p;r.trace("Stage 1 - Initiator received the message."),nl(l.re,r),f=l.rs,(p=r).enabled&&mc&&p(f?`REMOTE_STATIC_PUBLIC_KEY ${sa(f.subarray(),"hex")}`:"Missing remote static public key."),r.trace("Initiator going to check remote's signature...");const m=await gl(d,l.rs,h);r.trace("All good with the signature!"),r.trace("Stage 2 - Initiator sending third handshake message."),await i.write(l.writeMessageC(c),e),r.trace("Stage 2 - Initiator sent message with signed payload.");const[g,b]=l.ss.split();return sl(g,b,r),{payload:m,encrypt:t=>g.encryptWithAd(hl,t),decrypt:(t,e)=>b.decryptWithAd(hl,t,e)}}({connection:t,privateKey:e,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions},i),this.metrics?.xxHandshakeSuccesses.increment()}catch(t){throw this.metrics?.xxHandshakeErrors.increment(),t}return n}async performHandshakeResponder(t,e,r,i){let n;try{n=await async function(t,e){const{log:r,connection:i,crypto:n,privateKey:s,prologue:o,s:a,remoteIdentityKey:h,extensions:u}=t,c=await ml(s,a.publicKey,u),l=new dl({crypto:n,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});rl(l.s,r),r.trace("Stage 0 - Responder waiting to receive first message."),l.readMessageA(await i.read(e)),r.trace("Stage 0 - Responder received first message."),nl(l.re,r),r.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await i.write(l.writeMessageB(c),e),r.trace("Stage 1 - Responder sent the second handshake message with signed payload."),il(l.e,r),r.trace("Stage 2 - Responder waiting for third handshake message...");const d=l.readMessageC(await i.read(e));r.trace("Stage 2 - Responder received the message, finished handshake.");const f=await gl(d,l.rs,h),[p,m]=l.ss.split();return sl(p,m,r),{payload:f,encrypt:t=>m.encryptWithAd(hl,t),decrypt:(t,e)=>p.decryptWithAd(hl,t,e)}}({connection:t,privateKey:e,remoteIdentityKey:r,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions},i),this.metrics?.xxHandshakeSuccesses.increment()}catch(t){throw this.metrics?.xxHandshakeErrors.increment(),t}return n}async createSecureConnection(t,e){const[r,i]=function(){const t=fc(),e=fc();return[{source:t.source,sink:e.sink},{source:e.source,sink:t.sink}]}(),n=t.unwrap();return await kh(r,function(t,e){return async function*(r){for await(const i of r)for(let r=0;r<i.length;r+=65519){let n,s=r+65519;s>i.length&&(s=i.length),n=i instanceof Uint8Array?t.encrypt(i.subarray(r,s)):t.encrypt(i.sublist(r,s)),e?.encryptedPackets.increment(),yield new hh(tl(n.byteLength),n)}}}(e,this.metrics),n,(t=>yh(t,{lengthDecoder:el})),function(t,e){return async function*(r){for await(const i of r)for(let r=0;r<i.length;r+=pc){let n=r+pc;if(n>i.length&&(n=i.length),n-16<r)throw new Error("Invalid chunk");const s=i.sublist(r,n),o=i.subarray(r,n-16);try{const r=t.decrypt(s,o);e?.decryptedPackets.increment(),yield r}catch(t){throw e?.decryptErrors.increment(),t}}}}(e,this.metrics),r),i}}function vl(t={}){return e=>new yl(e,t)}function wl(t){if(null!=t){if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"==typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}class Ml extends Error{static name="InvalidFrameError";constructor(t="The frame was invalid"){super(t),this.name="InvalidFrameError"}}class _l extends Error{static name="UnrequestedPingError";constructor(t="Unrequested ping error"){super(t),this.name="UnrequestedPingError"}}class Sl extends Error{static name="NotMatchingPingError";constructor(t="Unrequested ping error"){super(t),this.name="NotMatchingPingError"}}class El extends Error{static name="InvalidStateError";constructor(t="Invalid state"){super(t),this.name="InvalidStateError"}}class kl extends Error{static name="StreamAlreadyExistsError";constructor(t="Strean already exists"){super(t),this.name="StreamAlreadyExistsError"}}class Al extends Error{static name="DecodeInvalidVersionError";constructor(t="Decode invalid version"){super(t),this.name="DecodeInvalidVersionError"}}class Il extends Error{static name="BothClientsError";constructor(t="Both clients"){super(t),this.name="BothClientsError"}}class xl extends Error{static name="ReceiveWindowExceededError";constructor(t="Receive window exceeded"){super(t),this.name="ReceiveWindowExceededError"}}const Cl=new Set([Ml.name,_l.name,Sl.name,kl.name,Al.name,Il.name,xl.name]),Tl=262144,Pl={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:Tl,maxStreamWindowSize:16777216,maxMessageSize:65536};var Bl,Rl,Dl;!function(t){t[t.Data=0]="Data",t[t.WindowUpdate=1]="WindowUpdate",t[t.Ping=2]="Ping",t[t.GoAway=3]="GoAway"}(Bl||(Bl={})),function(t){t[t.SYN=1]="SYN",t[t.ACK=2]="ACK",t[t.FIN=4]="FIN",t[t.RST=8]="RST"}(Rl||(Rl={})),Object.values(Rl).filter((t=>"string"!=typeof t)),function(t){t[t.NormalTermination=0]="NormalTermination",t[t.ProtocolError=1]="ProtocolError",t[t.InternalError=2]="InternalError"}(Dl||(Dl={}));const Nl=2**24;class Ll{source;buffer;frameInProgress;constructor(t){this.source=function(t){if(void 0!==t[Symbol.iterator]){const e=t[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator]:()=>e}}if(void 0!==t[Symbol.asyncIterator]){const e=t[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator]:()=>e}}throw new Error("a source must be either an iterable or an async iterable")}(t),this.buffer=new hh,this.frameInProgress=!1}async*emitFrames(){for await(const t of this.source)for(this.buffer.append(t);;){const t=this.readHeader();if(void 0===t)break;const{type:e,length:r}=t;e===Bl.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,r)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new El("decoding frame already in progress");if(this.buffer.length<12)return;const t=function(t){if(0!==t[0])throw new Ml("Invalid frame version");return{type:t[1],flag:(t[2]<<8)+t[3],streamID:t[4]*Nl+(t[5]<<16)+(t[6]<<8)+t[7],length:t[8]*Nl+(t[9]<<16)+(t[10]<<8)+t[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),t}async readBytes(t){if(this.buffer.length<t)for await(const e of this.source)if(this.buffer.append(e),this.buffer.length>=t)break;const e=this.buffer.sublist(0,t);return this.buffer.consume(t),this.frameInProgress=!1,e}}function Ol(t){const e=new Uint8Array(12);return e[1]=t.type,e[2]=t.flag>>>8,e[3]=t.flag,e[4]=t.streamID>>>24,e[5]=t.streamID>>>16,e[6]=t.streamID>>>8,e[7]=t.streamID,e[8]=t.length>>>24,e[9]=t.length>>>16,e[10]=t.length>>>8,e[11]=t.length,e}function Ul(t){return null!=t&&"function"==typeof t.then&&"function"==typeof t.catch&&"function"==typeof t.finally}class Fl{id;direction;timeline;protocol;metadata;source;status;readStatus;writeStatus;log;sinkController;sinkEnd;closed;endErr;streamSource;onEnd;onCloseRead;onCloseWrite;onReset;onAbort;sendCloseWriteTimeout;sendingData;constructor(t){this.sinkController=new AbortController,this.sinkEnd=vh(),this.closed=vh(),this.log=t.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=t.id,this.metadata=t.metadata??{},this.direction=t.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=t.sendCloseWriteTimeout??5e3,this.onEnd=t.onEnd,this.onCloseRead=t?.onCloseRead,this.onCloseWrite=t?.onCloseWrite,this.onReset=t?.onReset,this.onAbort=t?.onAbort,this.source=this.streamSource=Sh({onEnd:t=>{null!=t?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(t){if("ready"!==this.writeStatus)throw new U(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const e={signal:this.sinkController.signal};if("outbound"===this.direction){const t=this.sendNewStream(e);Ul(t)&&await t}const r=()=>{!function(t,e){const r=wl(t).return?.();var i;null!=(i=r)&&"function"==typeof i.then&&"function"==typeof i.catch&&"function"==typeof i.finally&&r.catch((t=>{e.error("could not cause iterator to return",t)}))}(t,this.log)};try{this.sinkController.signal.addEventListener("abort",r),this.log.trace("sink reading from source");for await(let r of t){r=r instanceof Uint8Array?new hh(r):r;const t=this.sendData(r,e);Ul(t)&&(this.sendingData=vh(),await t,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",r)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(t){null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=t&&null==this.endErr&&(this.endErr=t),this.onCloseRead?.(),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(t){null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=t&&null==this.endErr&&(this.endErr=t),this.onCloseWrite?.(),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(t){"open"===this.status&&(this.log.trace("closing gracefully"),this.status="closing",await ic(Promise.all([this.closeWrite(t),this.closeRead(t),this.closed.promise]),t?.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(t={}){if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const e=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(t)),"ready"===e&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(t={}){"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await ic(this.sink([]),t.signal)),"writing"===this.writeStatus&&(null!=this.sendingData&&await ic(this.sendingData.promise,t.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await ic(this.sinkEnd.promise,t.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(t){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",t),this.log("try to send reset to remote");const e=this.sendReset();Ul(e)&&e.catch((t=>{this.log.error("error sending reset message",t)})),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(t),this.onAbort?.(t)}reset(){if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;const t=new O("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(t),this.onReset?.()}_closeSinkAndSource(t){this._closeSink(t),this._closeSource(t)}_closeSink(t){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(t)}_closeSource(t){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(t))}remoteCloseWrite(){"closing"!==this.readStatus&&"closed"!==this.readStatus?(this.log.trace("remote close write"),this._closeSource()):this.log("received remote close write but local source is already closed")}remoteCloseRead(){"closing"!==this.writeStatus&&"closed"!==this.writeStatus?(this.log.trace("remote close read"),this._closeSink()):this.log("received remote close read but local sink is already closed")}destroy(){"closed"!==this.status&&"aborted"!==this.status&&"reset"!==this.status?(this.log.trace("stream destroyed"),this._closeSinkAndSource()):this.log("received destroy but we are already closed")}sourcePush(t){this.streamSource.push(t)}sourceReadableLength(){return this.streamSource.readableLength}}const jl=function(t){const[e,r]=null!=t[Symbol.asyncIterator]?[t[Symbol.asyncIterator](),Symbol.asyncIterator]:[t[Symbol.iterator](),Symbol.iterator],i=[];return{peek:()=>e.next(),push:t=>{i.push(t)},next:()=>i.length>0?{done:!1,value:i.shift()}:e.next(),[r](){return this}}};function Vl(t){return null!=t?.then}const ql=function(t,e){let r=0;if(null!=t[Symbol.asyncIterator])return async function*(){for await(const i of t){const t=e(i,r++);Vl(t)&&await t,yield i}}();const i=jl(t),{value:n,done:s}=i.next();if(!0===s)return function*(){}();const o=e(n,r++);if("function"==typeof o?.then)return async function*(){yield n;for await(const t of i){const i=e(t,r++);Vl(i)&&await i,yield t}}();const a=e;return function*(){yield n;for(const t of i)a(t,r++),yield t}()};var zl;!function(t){t[t.Init=0]="Init",t[t.SYNSent=1]="SYNSent",t[t.SYNReceived=2]="SYNReceived",t[t.Established=3]="Established",t[t.Finished=4]="Finished"}(zl||(zl={}));class Hl extends Fl{name;state;config;_id;sendWindowCapacity;sendWindowCapacityUpdate;recvWindow;recvWindowCapacity;epochStart;getRTT;sendFrame;constructor(t){super({...t,onEnd:e=>{this.state=zl.Finished,t.onEnd?.(e)}}),this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=Tl,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=ql(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(t,e={}){for(t=t.sublist();0!==t.byteLength;){if(0===this.sendWindowCapacity&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(e),"closed"===this.status||"aborted"===this.status||"reset"===this.status))return void this.log?.trace("%s while waiting for send window capacity",this.status);const r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,t.length),i=this.getSendFlags();this.sendFrame({type:Bl.Data,flag:i,streamID:this._id,length:r},t.sublist(0,r)),this.sendWindowCapacity-=r,t.consume(r)}}async sendReset(){this.sendFrame({type:Bl.WindowUpdate,flag:Rl.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|Rl.FIN;this.sendFrame({type:Bl.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){if(this.sendWindowCapacity>0)return;let e,r;const i=()=>{"open"===this.status||"closing"===this.status?r(new I("Stream aborted")):e()};t.signal?.addEventListener("abort",i);try{await new Promise(((t,i)=>{this.sendWindowCapacityUpdate=()=>{t()},r=i,e=t}))}finally{t.signal?.removeEventListener("abort",i)}}handleWindowUpdate(t){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const e=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,0===e&&t.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(t,e){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new xl("Receive window exceeded");const r=await e();this.recvWindowCapacity-=t.length,this.sourcePush(r)}processFlags(t){(t&Rl.ACK)===Rl.ACK&&this.state===zl.SYNSent&&(this.state=zl.Established),(t&Rl.FIN)===Rl.FIN&&this.remoteCloseWrite(),(t&Rl.RST)===Rl.RST&&this.reset()}getSendFlags(){switch(this.state){case zl.Init:return this.state=zl.SYNSent,Rl.SYN;case zl.SYNReceived:return this.state=zl.Established,Rl.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),e=Date.now(),r=this.getRTT();if(0===t&&r>-1&&e-this.epochStart<4*r&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===t)return;const i=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=e,this.sendFrame({type:Bl.WindowUpdate,flag:t,streamID:this._id,length:i})}}const $l="/yamux/1.0.0";class Wl{protocol=$l;_components;_init;constructor(t,e={}){this._components=t,this._init=e}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[k]=["@libp2p/stream-multiplexing"];createStreamMuxer(t){return new Kl(this._components,{...this._init,...t})}}class Kl{protocol=$l;source;sink;config;log;logger;closeController;nextStreamID;_streams;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;onIncomingStream;onStreamEnd;constructor(t,e){this.client="outbound"===e.direction,this.config={...Pl,...e},this.logger=t.logger,this.log=this.logger.forComponent("libp2p:yamux"),function(t){if(t.keepAliveInterval<=0)throw new T("keep-alive interval must be positive");if(t.maxInboundStreams<0)throw new T("max inbound streams must be larger or equal 0");if(t.maxOutboundStreams<0)throw new T("max outbound streams must be larger or equal 0");if(t.initialStreamWindowSize<Tl)throw new T("InitialStreamWindowSize must be larger or equal 256 kB");if(t.maxStreamWindowSize<t.initialStreamWindowSize)throw new T("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(t.maxStreamWindowSize>2**32-1)throw new T("MaxStreamWindowSize must be less than equal MAX_UINT32");if(t.maxMessageSize<1024)throw new T("MaxMessageSize must be greater than a kilobyte")}(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=e.onIncomingStream,this.onStreamEnd=e.onStreamEnd,this._streams=new Map,this.source=Sh({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach((t=>{t.destroy()}))}}),this.sink=async t=>{const e=()=>{const e=wl(t);if(null!=e.return){const t=e.return();null!=(r=t)&&"function"==typeof r.then&&t.catch((t=>{this.log?.("could not cause sink source to return",t)}))}var r};let r,i;try{const i=new Ll(t);try{this.closeController.signal.addEventListener("abort",e);for await(const t of i.emitFrames())await this.handleFrame(t.header,t.readData)}finally{this.closeController.signal.removeEventListener("abort",e)}r=Dl.NormalTermination}catch(t){Cl.has(t.name)?(this.log?.error("protocol error in sink",t),r=Dl.ProtocolError):(this.log?.error("internal error in sink",t),r=Dl.InternalError),i=t}this.log?.trace("muxer sink ended"),null!=i?this.abort(i,r):await this.close({reason:r})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((t=>this.log?.error("keepalive error: %s",t))),this.ping().catch((t=>this.log?.error("ping error: %s",t)))}get streams(){return Array.from(this._streams.values())}newStream(t){if(void 0!==this.remoteGoAway)throw new L("Muxer closed remotely");if(void 0!==this.localGoAway)throw new L("Muxer closed locally");const e=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new X("max outbound streams exceeded");this.log?.trace("new outgoing stream id=%s",e);const r=this._newStream(e,t,zl.Init,"outbound");return this._streams.set(e,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new L("Muxer closed remotely");if(void 0!==this.localGoAway)throw new L("Muxer closed locally");if(void 0===this.activePing){let t=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((e,r)=>{const i=()=>{r(new L("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",i,{once:!0}),t=()=>{this.closeController.signal.removeEventListener("abort",i),e()}})),resolve:t};const e=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const r=Date.now();this.rtt=r-e}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(t={}){if(this.closeController.signal.aborted)return;const e=t?.reason??Dl.NormalTermination;if(this.log?.trace("muxer close reason=%s",e),null==t.signal){const e=AbortSignal.timeout(500);t={...t,signal:e}}try{await Promise.all([...this._streams.values()].map((async e=>e.close(t)))),this.sendGoAway(e),this._closeMuxer()}catch(t){this.abort(t)}}abort(t,e){if(!this.closeController.signal.aborted){e=e??Dl.InternalError,this.log?.error("muxer abort reason=%s error=%s",e,t);for(const e of this._streams.values())e.abort(t);this.sendGoAway(e),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(t,e,r,i){if(null!=this._streams.get(t))throw new T("Stream already exists with that id");const n=new Hl({id:t.toString(),name:e,state:r,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(t),this.onStreamEnd?.(n)},log:this.logger.forComponent(`libp2p:yamux:${i}:${t}`),config:this.config,getRTT:this.getRTT.bind(this)});return n}closeStream(t){this.client===(t%2==0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(t)}async keepAliveLoop(){const t=new Promise(((t,e)=>{this.closeController.signal.addEventListener("abort",e,{once:!0})}));for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let e;try{await Promise.race([t,new Promise((t=>{e=setTimeout(t,this.config.keepAliveInterval)}))]),this.ping().catch((t=>this.log?.error("ping error: %s",t)))}catch(t){return void clearInterval(e)}}}async handleFrame(t,e){const{streamID:r,type:i,length:n}=t;if(this.log?.trace("received frame %o",t),0===r)switch(i){case Bl.Ping:return void this.handlePing(t);case Bl.GoAway:return void this.handleGoAway(n);default:throw new Ml("Invalid frame type")}else switch(t.type){case Bl.Data:case Bl.WindowUpdate:return void await this.handleStreamMessage(t,e);default:throw new Ml("Invalid frame type")}}handlePing(t){if(t.flag===Rl.SYN)this.log?.trace("received ping request pingId=%s",t.length),this.sendPing(t.length,Rl.ACK);else{if(t.flag!==Rl.ACK)throw new Ml("Invalid frame flag");this.log?.trace("received ping response pingId=%s",t.length),this.handlePingResponse(t.length)}}handlePingResponse(t){if(void 0===this.activePing)throw new _l("ping not requested");if(this.activePing.id!==t)throw new Sl("ping doesn't match our id");this.activePing.resolve()}handleGoAway(t){this.log?.trace("received GoAway reason=%s",Dl[t]??"unknown"),this.remoteGoAway=t;for(const t of this._streams.values())t.reset();this._closeMuxer()}async handleStreamMessage(t,e){const{streamID:r,flag:i,type:n}=t;(i&Rl.SYN)===Rl.SYN&&this.incomingStream(r);const s=this._streams.get(r);if(void 0!==s)switch(n){case Bl.WindowUpdate:return void s.handleWindowUpdate(t);case Bl.Data:if(void 0===e)throw new Error("unreachable");return void await s.handleData(t,e);default:throw new Error("unreachable")}else if(n===Bl.Data){if(this.log?.("discarding data for stream id=%s",r),void 0===e)throw new Error("unreachable");await e()}else this.log?.trace("frame for missing stream id=%s",r)}incomingStream(t){if(this.client!==(t%2==0))throw new T("Both endpoints are clients");if(this._streams.has(t))return;if(this.log?.trace("new incoming stream id=%s",t),void 0!==this.localGoAway)return void this.sendFrame({type:Bl.WindowUpdate,flag:Rl.RST,streamID:t,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return this.log?.("maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:Bl.WindowUpdate,flag:Rl.RST,streamID:t,length:0});const e=this._newStream(t,void 0,zl.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(t,e),this.onIncomingStream?.(e)}sendFrame(t,e){if(this.log?.trace("sending frame %o",t),t.type===Bl.Data){if(void 0===e)throw new Ml("Invalid frame");this.source.push(new hh(Ol(t),e))}else this.source.push(Ol(t))}sendPing(t,e=Rl.SYN){e===Rl.SYN?this.log?.trace("sending ping request pingId=%s",t):this.log?.trace("sending ping response pingId=%s",t),this.sendFrame({type:Bl.Ping,flag:e,streamID:0,length:t})}sendGoAway(t=Dl.NormalTermination){this.log?.("sending GoAway reason=%s",Dl[t]),this.localGoAway=t,this.sendFrame({type:Bl.GoAway,flag:0,streamID:0,length:t})}}function Gl(t={}){return e=>new Wl(e,t)}function Zl(t,e){const r={[Symbol.iterator]:()=>r,next:()=>{const r=t.next(),i=r.value;return!0===r.done||null==i?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return r}function Yl(t){return rh(qt(ct.decode(`z${t}`)))}class Jl{set;constructor(t){if(this.set=new Set,null!=t)for(const e of t)this.set.add(e.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(t){this.set.add(t.toString())}clear(){this.set.clear()}delete(t){this.set.delete(t.toString())}entries(){return Zl(this.set.entries(),(t=>{const e=Yl(t[0]);return[e,e]}))}forEach(t){this.set.forEach((e=>{const r=Yl(e);t(r,r,this)}))}has(t){return this.set.has(t.toString())}values(){return Zl(this.set.values(),(t=>Yl(t)))}intersection(t){const e=new Jl;for(const r of t)this.has(r)&&e.add(r);return e}difference(t){const e=new Jl;for(const r of this)t.has(r)||e.add(r);return e}union(t){const e=new Jl;for(const r of t)e.add(r);for(const t of this)e.add(t);return e}}class Xl{fp;h;seed;constructor(t,e,r,i=2){if(i>64)throw new TypeError("Invalid Fingerprint Size");const n=e.hashV(t,r),s=Qr(i);for(let t=0;t<s.length;t++)s[t]=n[t];0===s.length&&(s[0]=7),this.fp=s,this.h=e,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(t){return t?.fp instanceof Uint8Array&&te(this.fp,t.fp)}}function Ql(t,e){return Math.floor(Math.random()*(e-t))+t}class td{contents;constructor(t){this.contents=new Array(t).fill(null)}has(t){if(!(t instanceof Xl))throw new TypeError("Invalid Fingerprint");return this.contents.some((e=>t.equals(e)))}add(t){if(!(t instanceof Xl))throw new TypeError("Invalid Fingerprint");for(let e=0;e<this.contents.length;e++)if(null==this.contents[e])return this.contents[e]=t,!0;return!0}swap(t){if(!(t instanceof Xl))throw new TypeError("Invalid Fingerprint");const e=Ql(0,this.contents.length-1),r=this.contents[e];return this.contents[e]=t,r}remove(t){if(!(t instanceof Xl))throw new TypeError("Invalid Fingerprint");const e=this.contents.findIndex((e=>t.equals(e)));return e>-1&&(this.contents[e]=null,!0)}}const ed={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},rd={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},id=new globalThis.TextEncoder;r(2511);const nd={hash:t=>Number(function(t,{size:e=32,utf8Buffer:r}={}){if(!ed[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if("string"==typeof t){if(r)return function(t,e,r){if(0===r.length)throw new Error("The `utf8Buffer` option must have a length greater than zero");const i=ed[e];let n=rd[e],s=t;for(;s.length>0;){const t=id.encodeInto(s,r);s=s.slice(t.read);for(let s=0;s<t.written;s++)n^=BigInt(r[s]),n=BigInt.asUintN(e,n*i)}return n}(t,e,r);t=id.encode(t)}return function(t,e){const r=ed[e];let i=rd[e];for(let n=0;n<t.length;n++)i^=BigInt(t[n]),i=BigInt.asUintN(e,i*r);return i}(t,e)}(t,{size:32})),hashV:(t,e)=>function(t){let e=t.toString(16);return e.length%2==1&&(e=`0${e}`),dn(e,"base16")}(nd.hash(t,e))};class sd{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(t){this.filterSize=t.filterSize,this.bucketSize=t.bucketSize??4,this.fingerprintSize=t.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=t.hash??nd,this.seed=t.seed??Ql(0,Math.pow(2,10))}add(t){"string"==typeof t&&(t=dn(t));const e=new Xl(t,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(t,this.seed)%this.filterSize,i=(r^e.hash())%this.filterSize;if(null==this.buckets[r]&&(this.buckets[r]=new td(this.bucketSize)),null==this.buckets[i]&&(this.buckets[i]=new td(this.bucketSize)),this.buckets[r].add(e)||this.buckets[i].add(e))return this.count++,!0;const n=[r,i];let s=n[Ql(0,n.length-1)];null==this.buckets[s]&&(this.buckets[s]=new td(this.bucketSize));for(let t=0;t<500;t++){const t=this.buckets[s].swap(e);if(null!=t&&(s=(s^t.hash())%this.filterSize,null==this.buckets[s]&&(this.buckets[s]=new td(this.bucketSize)),this.buckets[s].add(t)))return this.count++,!0}return!1}has(t){"string"==typeof t&&(t=dn(t));const e=new Xl(t,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(t,this.seed)%this.filterSize,i=this.buckets[r]?.has(e)??!1;if(i)return i;const n=(r^e.hash())%this.filterSize;return this.buckets[n]?.has(e)??!1}remove(t){"string"==typeof t&&(t=dn(t));const e=new Xl(t,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(t,this.seed)%this.filterSize,i=this.buckets[r]?.remove(e)??!1;if(i)return this.count--,i;const n=(r^e.hash())%this.filterSize,s=this.buckets[n]?.remove(e)??!1;return s&&this.count--,s}get reliable(){return Math.floor(this.count/this.filterSize*100)<=90}}const od={1:.5,2:.84,4:.95,8:.98};function ad(t,e=.001){const r=function(t=.001){return t>.002?2:t>1e-5?4:8}(e),i=od[r];return{filterSize:Math.round(t/i),bucketSize:r,fingerprintSize:Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*r)),64)}}class hd{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(t){this.bucketSize=t.bucketSize??4,this.filterSize=t.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=t.fingerprintSize??2,this.scale=t.scale??2,this.hash=t.hash??nd,this.seed=t.seed??Ql(0,Math.pow(2,10)),this.filterSeries=[new sd({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(t){if("string"==typeof t&&(t=dn(t)),this.has(t))return!0;let e=this.filterSeries.find((t=>t.reliable));if(null==e){const t=this.filterSize*Math.pow(this.scale,this.filterSeries.length);e=new sd({filterSize:t,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(e)}return e.add(t)}has(t){"string"==typeof t&&(t=dn(t));for(let e=0;e<this.filterSeries.length;e++)if(this.filterSeries[e].has(t))return!0;return!1}remove(t){"string"==typeof t&&(t=dn(t));for(let e=0;e<this.filterSeries.length;e++)if(this.filterSeries[e].remove(t))return!0;return!1}get count(){return this.filterSeries.reduce(((t,e)=>t+e.count),0)}}function ud(t,e=.001,r){return new hd({...ad(t,e),...r??{}})}function cd(t){try{const[[r,i]]=t.stringTuples();if(null==i)return!1;if(41===r)return e=i,new Cu("2000::/3").contains(e)}catch{}var e;return!1}var ld=r(5905);const dd=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map((t=>new ld.Netmask(t)));function fd(t){for(const e of dd)if(e.contains(t))return!0;return!1}function pd(t){return Tu(t)?fd(t):/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(t)?function(t){const e=t.split(":");if(e.length<2)return!1;const r=e[e.length-1].padStart(4,"0"),i=e[e.length-2].padStart(4,"0");return fd(`${parseInt(i.substring(0,2),16)}.${parseInt(i.substring(2),16)}.${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}`)}(t):/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)?function(t){const e=t.split(":");return fd(e[e.length-1])}(t):Pu(t)?function(t){return/^::$/.test(t)||/^::1$/.test(t)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(t)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(t)||/^ff([0-9a-fA-F]{2,2}):/i.test(t)}(t):void 0}function md(t){try{const[[e,r]]=t.stringTuples();if(null==r)return!0;if(53===e||54===e||55===e||56===e)return!1;if(4===e||41===e)return pd(r)??!1}catch{}return!0}class gd extends Error{type;code;constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.name="AbortError",this.code=e??"ABORT_ERR"}}async function bd(t,e,r,i){const n=new gd(i?.errorMessage,i?.errorCode);return!0===r?.aborted?Promise.reject(n):new Promise(((s,o)=>{function a(){r?.removeEventListener("abort",c),t.removeEventListener(e,h),null!=i?.errorEvent&&t.removeEventListener(i.errorEvent,u)}const h=t=>{try{if(!1===i?.filter?.(t))return}catch(t){return a(),void o(t)}a(),s(t)},u=t=>{a(),o(t.detail)},c=()=>{a(),o(n)};r?.addEventListener("abort",c),t.addEventListener(e,h),null!=i?.errorEvent&&t.addEventListener(i.errorEvent,u)}))}class yd extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(t="Rate limit exceeded",e){super(t),this.name="RateLimitError",this.remainingPoints=e.remainingPoints,this.msBeforeNext=e.msBeforeNext,this.consumedPoints=e.consumedPoints,this.isFirstInDuration=e.isFirstInDuration}}class vd extends Error{static name="QueueFullError";constructor(t="The queue was full"){super(t),this.name="QueueFullError"}}class wd{deferred;signal;constructor(t){this.signal=t,this.deferred=vh(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new I)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}class Md{id;fn;options;recipients;status;timeline;controller;constructor(t,e){this.id=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,this.status="queued",this.fn=t,this.options=e,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(t){this.controller.abort(t)}onAbort(){this.recipients.reduce(((t,e)=>t&&!0===e.signal?.aborted),!0)&&(this.controller.abort(new I),this.cleanup())}async join(t={}){const e=new wd(t.signal);return this.recipients.push(e),t.signal?.addEventListener("abort",this.onAbort),e.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const t=await ic(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach((e=>{e.deferred.resolve(t)})),this.status="complete"}catch(t){this.recipients.forEach((e=>{e.deferred.reject(t)})),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach((t=>{t.cleanup(),t.signal?.removeEventListener("abort",this.onAbort)}))}}class _d extends v{concurrency;maxSize;queue;pending;sort;constructor(t={}){super(),this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,null!=t.metricName&&t.metrics?.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(0===this.size)return queueMicrotask((()=>{this.safeDispatchEvent("empty")})),0===this.running&&queueMicrotask((()=>{this.safeDispatchEvent("idle")})),!1;if(this.pending<this.concurrency){let t;for(const e of this.queue)if("queued"===e.status){t=e;break}return null!=t&&(this.safeDispatchEvent("active"),this.pending++,t.run().finally((()=>{for(let e=0;e<this.queue.length;e++)if(this.queue[e]===t){this.queue.splice(e,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")})),!0)}return!1}enqueue(t){this.queue.push(t),null!=this.sort&&this.queue.sort(this.sort)}async add(t,e){if(e?.signal?.throwIfAborted(),this.size===this.maxSize)throw new vd;const r=new Md(t,e);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(e).then((t=>(this.safeDispatchEvent("completed",{detail:t}),this.safeDispatchEvent("success",{detail:{job:r,result:t}}),t))).catch((t=>{if("queued"===r.status)for(let t=0;t<this.queue.length;t++)if(this.queue[t]===r){this.queue.splice(t,1);break}throw this.safeDispatchEvent("error",{detail:t}),this.safeDispatchEvent("failure",{detail:{job:r,error:t}}),t}))}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach((t=>{t.abort(new I)})),this.clear()}async onEmpty(t){0!==this.size&&await bd(this,"empty",t?.signal)}async onSizeLessThan(t,e){this.size<t||await bd(this,"next",e?.signal,{filter:()=>this.size<t})}async onIdle(t){0===this.pending&&0===this.size||await bd(this,"idle",t?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){t?.signal?.throwIfAborted();const e=Sh({objectMode:!0}),r=t=>{null!=t?this.abort():this.clear(),e.end(t)},i=t=>{null!=t.detail&&e.push(t.detail)},n=t=>{r(t.detail)},s=()=>{r()},o=()=>{r(new I("Queue aborted"))};this.addEventListener("completed",i),this.addEventListener("error",n),this.addEventListener("idle",s),t?.signal?.addEventListener("abort",o);try{yield*e}finally{this.removeEventListener("completed",i),this.removeEventListener("error",n),this.removeEventListener("idle",s),t?.signal?.removeEventListener("abort",o),r()}}}class Sd extends _d{has(t){return null!=this.find(t)}find(t){return this.queue.find((e=>t.equals(e.options.peerId)))}}function Ed(t){const e=new globalThis.AbortController;function r(){e.abort();for(const e of t)null!=e?.removeEventListener&&e.removeEventListener("abort",r)}for(const e of t){if(!0===e?.aborted){r();break}null!=e?.addEventListener&&e.addEventListener("abort",r)}const i=e.signal;return i.clear=function(){for(const e of t)null!=e?.removeEventListener&&e.removeEventListener("abort",r)},i}function kd(t){const e=[],r=[];let i=null,n=0;for(;n<t.length;){const s=pi(t,n),o=ci(s),a=Fu(s),h=xd(a,t.slice(n+o));if(0===h){e.push([s]),r.push([s]),n+=o;continue}const u=t.slice(n+o,n+o+h);if(n+=h+o,n>t.length)throw Td("Invalid address Uint8Array: "+sa(t,"base16"));e.push([s,u]);const c=zu(s,u);if(r.push([s,c]),!0===a.path){i=c;break}}return{bytes:Uint8Array.from(t),string:Ad(r),tuples:e,stringTuples:r,path:i}}function Ad(t){const e=[];return t.map((t=>{const r=Fu(t[0]);return e.push(r.name),t.length>1&&null!=t[1]&&e.push(t[1]),null})),Cd(e.join("/"))}function Id(t){return nh(t.map((t=>{const e=Fu(t[0]);let r=Uint8Array.from(fi(e.code));return t.length>1&&null!=t[1]&&(r=nh([r,t[1]])),r})))}function xd(t,e){if(t.size>0)return t.size/8;if(0===t.size)return 0;{const t=pi(e instanceof Uint8Array?e:Uint8Array.from(e));return t+ci(t)}}function Cd(t){return"/"+t.trim().split("/").filter((t=>t)).join("/")}function Td(t){return new Error("Error parsing address: "+t)}const Pd=Symbol.for("nodejs.util.inspect.custom"),Bd=Symbol.for("@multiformats/js-multiaddr/multiaddr"),Rd=[Fu("dns").code,Fu("dns4").code,Fu("dns6").code,Fu("dnsaddr").code];class Dd extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}}class Nd{bytes;#e;#r;#i;#n;[Bd]=!0;constructor(t){let e;if(null==t&&(t=""),t instanceof Uint8Array)e=kd(t);else if("string"==typeof t){if(t.length>0&&"/"!==t.charAt(0))throw new Error(`multiaddr "${t}" must start with a "/"`);e=function(t){const e=[],r=[];let i=null;const n=(t=Cd(t)).split("/").slice(1);if(1===n.length&&""===n[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let s=0;s<n.length;s++){const o=Fu(n[s]);if(0===o.size){e.push([o.code]),r.push([o.code]);continue}if(s++,s>=n.length)throw Td("invalid address: "+t);if(!0===o.path){i=Cd(n.slice(s).join("/")),e.push([o.code,Hu(o.code,i)]),r.push([o.code,i]);break}const a=Hu(o.code,n[s]);e.push([o.code,a]),r.push([o.code,zu(o.code,a)])}return{string:Ad(r),bytes:Id(e),tuples:e,stringTuples:r,path:i}}(t)}else{if(!Od(t))throw new Error("addr must be a string, Buffer, or another Multiaddr");e=kd(t.bytes)}this.bytes=e.bytes,this.#e=e.string,this.#r=e.tuples,this.#i=e.stringTuples,this.#n=e.path}toString(){return this.#e}toJSON(){return this.toString()}toOptions(){let t,e,r,i,n="";const s=Fu("tcp"),o=Fu("udp"),a=Fu("ip4"),h=Fu("ip6"),u=Fu("dns6"),c=Fu("ip6zone");for(const[l,d]of this.stringTuples())l===c.code&&(n=`%${d??""}`),Rd.includes(l)&&(e=s.name,i=443,r=`${d??""}${n}`,t=l===u.code?6:4),l!==s.code&&l!==o.code||(e=Fu(l).name,i=parseInt(d??"")),l!==a.code&&l!==h.code||(e=Fu(l).name,r=`${d??""}${n}`,t=l===h.code?6:4);if(null==t||null==e||null==r||null==i)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:r,transport:e,port:i}}protos(){return this.#r.map((([t])=>Object.assign({},Fu(t))))}protoCodes(){return this.#r.map((([t])=>t))}protoNames(){return this.#r.map((([t])=>Fu(t).name))}tuples(){return this.#r.map((([t,e])=>null==e?[t]:[t,e]))}stringTuples(){return this.#i.map((([t,e])=>null==e?[t]:[t,e]))}encapsulate(t){return t=new Nd(t),new Nd(this.toString()+t.toString())}decapsulate(t){const e=t.toString(),r=this.toString(),i=r.lastIndexOf(e);if(i<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new Nd(r.slice(0,i))}decapsulateCode(t){const e=this.tuples();for(let r=e.length-1;r>=0;r--)if(e[r][0]===t)return new Nd(Id(e.slice(0,r)));return this}getPeerId(){try{let t=[];this.stringTuples().forEach((([e,r])=>{e===Ou.p2p.code&&t.push([e,r]),e===Ou["p2p-circuit"].code&&(t=[])}));const e=t.pop();if(null!=e?.[1]){const t=e[1];return"Q"===t[0]||"1"===t[0]?sa(ct.decode(`z${t}`),"base58btc"):sa(Kt.parse(t).multihash.bytes,"base58btc")}return null}catch(t){return null}}getPath(){return this.#n}equals(t){return te(this.bytes,t.bytes)}async resolve(t){const e=this.protos().find((t=>t.resolvable));if(null==e)return[this];const r=Ld.get(e.name);if(null==r)throw new Dd(`no available resolver for ${e.name}`);return(await r(this,t)).map((t=>Ud(t)))}nodeAddress(){const t=this.toOptions();if("tcp"!==t.transport&&"udp"!==t.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(t){const e=(t??this).protos();return!(2!==e.length||4!==e[0].code&&41!==e[0].code||6!==e[1].code&&273!==e[1].code)}[Pd](){return`Multiaddr(${this.#e})`}}const Ld=new Map;function Od(t){return Boolean(t?.[Bd])}function Ud(t){return new Nd(t)}function Fd(t,e){const r=dc(t,e),i={read:async(t,e)=>{const i=await r.read(e);return t.decode(i)},write:async(t,e,i)=>{await r.write(e.encode(t),i)},writeV:async(t,e,i)=>{await r.writeV(t.map((t=>e.encode(t))),i)},pb:t=>({read:async e=>i.read(t,e),write:async(e,r)=>i.write(e,t,r),writeV:async(e,r)=>i.writeV(e,t,r),unwrap:()=>i}),unwrap:()=>r.unwrap()};return i}var jd;!function(t){let e,r,i,n,s,o,a,h;!function(t){t.DIAL="DIAL",t.DIAL_RESPONSE="DIAL_RESPONSE"}(e=t.MessageType||(t.MessageType={})),function(t){t[t.DIAL=0]="DIAL",t[t.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(r||(r={})),function(t){t.codec=()=>Rn(r)}(e=t.MessageType||(t.MessageType={})),function(t){t.OK="OK",t.E_DIAL_ERROR="E_DIAL_ERROR",t.E_DIAL_REFUSED="E_DIAL_REFUSED",t.E_BAD_REQUEST="E_BAD_REQUEST",t.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(i=t.ResponseStatus||(t.ResponseStatus={})),function(t){t[t.OK=0]="OK",t[t.E_DIAL_ERROR=100]="E_DIAL_ERROR",t[t.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",t[t.E_BAD_REQUEST=200]="E_BAD_REQUEST",t[t.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(n||(n={})),function(t){t.codec=()=>Rn(n)}(i=t.ResponseStatus||(t.ResponseStatus={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.id&&(e.uint32(10),e.bytes(t.id)),null!=t.addrs)for(const r of t.addrs)e.uint32(18),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={addrs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.id=t.bytes();break;case 2:if(null!=r.limits?.addrs&&i.addrs.length===r.limits.addrs)throw new Nn('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(s=t.PeerInfo||(t.PeerInfo={})),function(e){let r;e.codec=()=>(null==r&&(r=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.peer&&(r.uint32(10),t.PeerInfo.codec().encode(e.peer,r)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();r>>>3==1?n.peer=t.PeerInfo.codec().decode(e,e.uint32(),{limits:i.limits?.peer}):e.skipType(7&r)}return n}))),r),e.encode=t=>An(t,e.codec()),e.decode=(t,r)=>Ti(t,e.codec(),r)}(o=t.Dial||(t.Dial={})),function(e){let r;e.codec=()=>(null==r&&(r=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.status&&(r.uint32(8),t.ResponseStatus.codec().encode(e.status,r)),null!=e.statusText&&(r.uint32(18),r.string(e.statusText)),null!=e.addr&&(r.uint32(26),r.bytes(e.addr)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.status=t.ResponseStatus.codec().decode(e);break;case 2:n.statusText=e.string();break;case 3:n.addr=e.bytes();break;default:e.skipType(7&r)}}return n}))),r),e.encode=t=>An(t,e.codec()),e.decode=(t,r)=>Ti(t,e.codec(),r)}(a=t.DialResponse||(t.DialResponse={})),t.codec=()=>(null==h&&(h=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.type&&(r.uint32(8),t.MessageType.codec().encode(e.type,r)),null!=e.dial&&(r.uint32(18),t.Dial.codec().encode(e.dial,r)),null!=e.dialResponse&&(r.uint32(26),t.DialResponse.codec().encode(e.dialResponse,r)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.type=t.MessageType.codec().decode(e);break;case 2:n.dial=t.Dial.codec().decode(e,e.uint32(),{limits:i.limits?.dial});break;case 3:n.dialResponse=t.DialResponse.codec().decode(e,e.uint32(),{limits:i.limits?.dialResponse});break;default:e.skipType(7&r)}}return n}))),h),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(jd||(jd={}));class Vd{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(t,e){this.components=t,this.log=t.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${e.protocolPrefix??"libp2p"}/autonat/1.0.0`,this.timeout=e.timeout??3e4,this.maxInboundStreams=e.maxInboundStreams??2,this.maxOutboundStreams=e.maxOutboundStreams??20,this.connectionThreshold=e.connectionThreshold??80,this.maxMessageSize=e.maxMessageSize??8192,this.dialResults=new Map,this.findPeers=function(t){let e,r;function i(){const n={signal:r.signal};Promise.resolve().then((async()=>{await t(n)})).catch((()=>{})).finally((()=>{r.signal.aborted||(e=setTimeout(i,6e4))}))}let n=!1;return{start:()=>{n||(n=!0,r=new AbortController,r.signal,e=setTimeout(i,6e4))},stop:()=>{clearTimeout(e),r?.abort(),n=!1}}}(this.findRandomPeers.bind(this)),this.addressFilter=ud(1024)}[Symbol.toStringTag]="@libp2p/autonat";[k]=["@libp2p/autonat"];get[A](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(t=>{this.handleIncomingAutonatStream(t).catch((t=>{this.log.error("error handling incoming autonat stream - %e",t)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(t,e)=>{this.verifyExternalAddresses(e).catch((t=>{this.log.error("could not verify addresses - %e",t)}))}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),null!=this.topologyId&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every((t=>t.expires>Date.now()||t.verified))}async findRandomPeers(t){if(this.allAddressesAreVerified())return;const e=Ed([AbortSignal.timeout(1e4),t?.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const t of this.components.randomWalk.walk({signal:e}))if(await this.components.connectionManager.isDialable(t.multiaddrs)){try{this.log.trace("dial random peer %p",t.id),await this.components.connectionManager.openConnection(t.multiaddrs,{signal:e})}catch{}if(this.allAddressesAreVerified())return void this.log("stopping random walk, all addresses are verified");if(!this.hasConnectionCapacity())return void this.log("stopping random walk, too close to max connections")}else this.log.trace("random peer %p was not dialable %s",t.id,t.multiaddrs.map((t=>t.toString())).join(", "))}catch{}}async handleIncomingAutonatStream(t){const e=AbortSignal.timeout(this.timeout),r=Fd(t.stream,{maxDataLength:this.maxMessageSize}).pb(jd);try{const i=await r.read({signal:e}),n=await this.handleAutonatMessage(i,t.connection,{signal:e});await r.write(n,{signal:e}),await r.unwrap().unwrap().close({signal:e})}catch(e){this.log.error("error handling incoming autonat stream - %e",e),t.stream.abort(e)}}async handleAutonatMessage(t,e,r){const i=this.components.addressManager.getAddresses().map((t=>t.toOptions().host)),n=t.dial;if(null==n)return this.log.error("dial was missing from message"),{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let s;const o=n.peer;if(null==o?.id)return this.log.error("PeerId missing from message"),{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const t=qt(o.id);s=rh(t)}catch(t){return this.log.error("invalid PeerId - %e",t),{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",s),!e.remotePeer.equals(s))return this.log("target peer %p did not equal sending peer %p",s,e.remotePeer),{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const a=o.addrs.map((t=>Ud(t))).filter((t=>{const r=t.toOptions();return!(md(t)||(r.host!==e.remoteAddr.toOptions().host?(this.log.trace("not dialing %a - target host did not match remote host %a",t,e.remoteAddr),1):i.includes(r.host)||null==this.components.transportManager.dialTransportForMultiaddr(t)&&(this.log.trace("not dialing %a - transport unsupported",t),1)))})).map((t=>(null==t.getPeerId()&&(t=t.encapsulate(`/p2p/${s.toString()}`)),t)));if(0===a.length)return this.log("refused to dial all multiaddrs for %p from message",s),{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",a.map((t=>t.toString())).join(", "),s);let h="",u=a[0];for await(const t of a){let e;u=t;try{if(e=await this.components.connectionManager.openConnection(t,r),!e.remoteAddr.equals(t))throw this.log.error("tried to dial %a but dialed %a",t,e.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",s,t),{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.OK,addr:e.remoteAddr.decapsulateCode(Fu("p2p").code).bytes}}}catch(t){this.log.error("could not dial %p - %e",s,t),h=t.message}finally{null!=e&&await e.close()}}return{type:jd.MessageType.DIAL_RESPONSE,dialResponse:{status:jd.ResponseStatus.E_DIAL_ERROR,statusText:h,addr:u.bytes}}}getFirstUnverifiedMultiaddr(t,e){const r=this.components.addressManager.getAddressesWithMetadata().sort(((t,e)=>"observed"===t.type&&"observed"!==e.type?1:"observed"===e.type&&"observed"!==t.type?-1:0)).filter((t=>{if(!(t.expires<Date.now()))return!1;if(6===t.multiaddr.toOptions().family){if(!e)return!1;if(!cd(t.multiaddr))return!1}return!md(t.multiaddr)}));for(const e of r){const r=e.multiaddr.toString();let i=this.dialResults.get(r);if(null!=i){if(i.networkSegments.includes(t)){this.log.trace("%a already has a network segment result from %s",i.multiaddr,t);continue}if(i.queue.size>10){this.log.trace("%a already has enough peers queued",i.multiaddr);continue}}if(null==i){const t=e.expires<Date.now();if(t&&this.addressFilter.remove?.(r),this.addressFilter.has(r))continue;this.addressFilter.add(r),this.log.trace("creating dial result %s %s",t?"to revalidate":"for",r),i={multiaddr:e.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:new Jl,queue:new Sd({concurrency:3,maxSize:50}),type:e.type,lastVerified:e.lastVerified},this.dialResults.set(r,i)}return i}}removeOutdatedMultiaddrResults(){const t=new Set(this.components.addressManager.getAddressesWithMetadata().filter((({expires:t})=>t<Date.now())).map((({multiaddr:t})=>t.toString())));for(const e of this.dialResults.keys())t.has(e)||(this.log.trace("remove results for %a",e),this.dialResults.delete(e))}async verifyExternalAddresses(t){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const e=(await this.components.peerStore.get(t.remotePeer)).addresses.some((({multiaddr:t})=>6===t.toOptions().family)),r=this.getNetworkSegment(t.remoteAddr),i=this.getFirstUnverifiedMultiaddr(r,e);null!=i?this.hasConnectionCapacity()?i.queue.add((async e=>{await this.askPeerToVerify(t,r,e)}),{peerId:t.remotePeer,multiaddr:i.multiaddr}).catch((e=>{null==i?.result&&this.log.error("error from %p verifying address %a - %e",t.remotePeer,i?.multiaddr,e)})):null!=i.lastVerified?(this.log("automatically re-verifying %a because we are too close to the connection limit",i.multiaddr),this.confirmAddress(i)):this.log("skipping verifying %a because we are too close to the connection limit",i.multiaddr):this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",t.remotePeer)}async askPeerToVerify(t,e,r){let i=this.dialResults.get(r.multiaddr.toString());if(null==i)return void this.log("%a was verified while %p was queued",r.multiaddr,t.remotePeer);const n=AbortSignal.timeout(this.timeout);this.log.trace("asking %p to verify multiaddr %s",t.remotePeer,r.multiaddr);const s=await t.newStream(this.protocol,{signal:n});try{const o=Fd(s).pb(jd),[,a]=await Promise.all([o.write({type:jd.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[r.multiaddr.bytes]}}},{signal:n}),o.read({signal:n})]);if(a.type!==jd.MessageType.DIAL_RESPONSE||null==a.dialResponse)return void this.log("invalid autonat response from %p - %j",t.remotePeer,a);const h=a.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",t.remotePeer,r.multiaddr,h),h!==jd.ResponseStatus.OK&&h!==jd.ResponseStatus.E_DIAL_ERROR)return;if(i=this.dialResults.get(r.multiaddr.toString()),null==i)return void this.log.trace("peer reported %a as %s but there is no result object",r.multiaddr,a.dialResponse.status);if(i.networkSegments.includes(e))return void this.log.trace("%a results included network segment %s",r.multiaddr,e);if(null!=i.result)return void this.log.trace("already resolved result for %a, ignoring response from",r.multiaddr,t.remotePeer);if(i.verifyingPeers.has(t.remotePeer))return void this.log.trace("peer %p has already verified %a, ignoring response",t.remotePeer,r.multiaddr);if(i.verifyingPeers.add(t.remotePeer),i.networkSegments.push(e),h===jd.ResponseStatus.OK){if(i.success++,"observed"!==i.type)return void this.confirmAddress(i)}else h===jd.ResponseStatus.E_DIAL_ERROR&&i.failure++;this.log("%a success %d failure %d",i.multiaddr,i.success,i.failure),4===i.success&&this.confirmAddress(i),8===i.failure&&this.unconfirmAddress(i)}finally{try{await s.close({signal:n})}catch(t){s.abort(t)}}}hasConnectionCapacity(){return this.components.connectionManager.getConnections().length/this.components.connectionManager.getMaxConnections()*100<this.connectionThreshold}confirmAddress(t){this.log("%s address %a is externally dialable",t.type,t.multiaddr),this.components.addressManager.confirmObservedAddr(t.multiaddr),this.dialResults.delete(t.multiaddr.toString()),t.result=!0,t.queue.abort()}unconfirmAddress(t){this.log("%s address %a is not externally dialable",t.type,t.multiaddr),this.components.addressManager.removeObservedAddr(t.multiaddr),this.dialResults.delete(t.multiaddr.toString()),t.result=!1,t.queue.abort()}getNetworkSegment(t){const e=t.toOptions();return 4===e.family?e.host.split(".")[0].padStart(3,"0"):e.host.split(":")[0].padStart(4,"0")}}function qd(t={}){return e=>new Vd(e,t)}const zd=Symbol.for("@libp2p/peer-discovery"),Hd=_f("dns4"),$d=_f("dns6"),Wd=_f("dnsaddr"),Kd=Mf(_f("dns"),Wd,Hd,$d),Gd=Mf(_f("ip4"),_f("ip6")),Zd=Mf(wf(Gd,_f("tcp")),wf(Kd,_f("tcp"))),Yd=wf(Gd,_f("udp")),Jd=wf(Yd,_f("utp")),Xd=wf(Yd,_f("quic")),Qd=wf(Yd,_f("quic-v1")),tf=Mf(wf(Zd,_f("ws")),wf(Kd,_f("ws"))),ef=Mf(wf(tf,_f("p2p")),tf),rf=Mf(wf(Zd,_f("wss")),wf(Kd,_f("wss")),wf(Zd,_f("tls"),_f("ws")),wf(Kd,_f("tls"),_f("ws"))),nf=Mf(wf(rf,_f("p2p")),rf),sf=Mf(wf(Zd,_f("http")),wf(Gd,_f("http")),wf(Kd,_f("http"))),of=Mf(wf(Zd,_f("https")),wf(Gd,_f("https")),wf(Kd,_f("https"))),af=wf(Yd,_f("webrtc-direct"),_f("certhash")),hf=Mf(wf(af,_f("p2p")),af),uf=wf(Qd,_f("webtransport"),_f("certhash"),_f("certhash")),cf=Mf(wf(uf,_f("p2p")),uf),lf=Mf(wf(ef,_f("p2p-webrtc-star"),_f("p2p")),wf(nf,_f("p2p-webrtc-star"),_f("p2p")),wf(ef,_f("p2p-webrtc-star")),wf(nf,_f("p2p-webrtc-star"))),df=(Mf(wf(ef,_f("p2p-websocket-star"),_f("p2p")),wf(nf,_f("p2p-websocket-star"),_f("p2p")),wf(ef,_f("p2p-websocket-star")),wf(nf,_f("p2p-websocket-star"))),Mf(wf(sf,_f("p2p-webrtc-direct"),_f("p2p")),wf(of,_f("p2p-webrtc-direct"),_f("p2p")),wf(sf,_f("p2p-webrtc-direct")),wf(of,_f("p2p-webrtc-direct")))),ff=Mf(tf,rf,sf,of,lf,df,Zd,Jd,Xd,Kd,hf,cf),pf=(Mf(wf(ff,_f("p2p-stardust"),_f("p2p")),wf(ff,_f("p2p-stardust"))),Mf(wf(ff,_f("p2p")),lf,df,hf,cf,_f("p2p"))),mf=Mf(wf(pf,_f("p2p-circuit"),pf),wf(pf,_f("p2p-circuit")),wf(_f("p2p-circuit"),pf),wf(ff,_f("p2p-circuit")),wf(_f("p2p-circuit"),ff),_f("p2p-circuit")),gf=()=>Mf(wf(mf,gf),mf),bf=gf(),yf=Mf(wf(bf,pf,bf),wf(pf,bf),wf(bf,pf),bf,pf);function vf(t){return function(e){let r;try{r=Ud(e)}catch(t){return!1}const i=t(r.protoNames());return null!==i&&(!0===i||!1===i?i:0===i.length)}}function wf(...t){function e(e){if(e.length<t.length)return null;let r=e;return t.some((t=>(r="function"==typeof t?t().partialMatch(e):t.partialMatch(e),Array.isArray(r)&&(e=r),null===r))),r}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:vf(e),partialMatch:e}}function Mf(...t){function e(e){let r=null;return t.some((t=>{const i="function"==typeof t?t().partialMatch(e):t.partialMatch(e);return null!=i&&(r=i,!0)})),r}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:vf(e),partialMatch:e}}function _f(t){const e=t;return{toString:function(){return e},matches:function(t){let r;try{r=Ud(t)}catch(t){return!1}const i=r.protoNames();return 1===i.length&&i[0]===e},partialMatch:function(t){return 0===t.length?null:t[0]===e?t.slice(1):null}}}Mf(wf(bf,_f("webrtc"),_f("p2p")),wf(bf,_f("webrtc")),wf(ff,_f("webrtc"),_f("p2p")),wf(ff,_f("webrtc")),_f("webrtc"));class Sf extends v{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(t,e={list:[]}){if(null==e.list||0===e.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=e.timeout??1e3,this.list=[];for(const t of e.list){if(!yf.matches(t)){this.log.error("Invalid multiaddr");continue}const e=Ud(t),r=e.getPeerId();if(null==r){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const i={id:th(r),multiaddrs:[e]};this.list.push(i)}this._init=e}[zd]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[k]=["@libp2p/peer-discovery"];isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((t=>{this.log.error(t)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??"bootstrap"]:{value:this._init.tagValue??50,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),null==this.timer)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch((e=>{this.log.error("could not dial bootstrap peer %p",t.id,e)}))}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}var Ef;!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.publicKey&&t.publicKey.byteLength>0&&(e.uint32(10),e.bytes(t.publicKey)),null!=t.payloadType&&t.payloadType.byteLength>0&&(e.uint32(18),e.bytes(t.payloadType)),null!=t.payload&&t.payload.byteLength>0&&(e.uint32(26),e.bytes(t.payload)),null!=t.signature&&t.signature.byteLength>0&&(e.uint32(42),e.bytes(t.signature)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={publicKey:Qr(0),payloadType:Qr(0),payload:Qr(0),signature:Qr(0)},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=t.bytes();break;case 5:i.signature=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Ef||(Ef={}));class kf extends Error{constructor(t="Invalid signature"){super(t),this.name="InvalidSignatureError"}}class Af{static createFromProtobuf=async t=>{const e=Ef.decode(t),r=Ha(e.publicKey);return new Af({publicKey:r,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};static seal=async(t,e)=>{if(null==e)throw new Error("Missing private key");const r=t.domain,i=t.codec,n=t.marshal(),s=If(r,i,n),o=await e.sign(s.subarray());return new Af({publicKey:e.publicKey,payloadType:i,payload:n,signature:o})};static openAndCertify=async(t,e)=>{const r=await Af.createFromProtobuf(t);if(!await r.validate(e))throw new kf("Envelope signature is not valid for the given domain");return r};publicKey;payloadType;payload;signature;marshaled;constructor(t){const{publicKey:e,payloadType:r,payload:i,signature:n}=t;this.publicKey=e,this.payloadType=r,this.payload=i,this.signature=n}marshal(){return null==this.marshaled&&(this.marshaled=Ef.encode({publicKey:$a(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return te(this.marshal(),t.marshal())}async validate(t){const e=If(t,this.payloadType,this.payload);return this.publicKey.verify(e.subarray(),this.signature)}}const If=(t,e,r)=>{const i=dn(t),n=fi(i.byteLength),s=fi(e.length),o=fi(r.length);return new hh(n,i,s,e,o,r)},xf="keep-alive",Cf="circuit-relay-source",Tf=`${xf}-circuit-relay`,Pf=`${xf}-circuit-relay-source`,Bf=BigInt(1<<17),Rf="/libp2p/circuit/relay/0.2.0/hop",Df="/libp2p/circuit/relay/0.2.0/stop";var Nf,Lf,Of,Uf,Ff,jf,Vf,qf,zf;!function(t){let e,r,i;!function(t){t.RESERVE="RESERVE",t.CONNECT="CONNECT",t.STATUS="STATUS"}(e=t.Type||(t.Type={})),function(t){t[t.RESERVE=0]="RESERVE",t[t.CONNECT=1]="CONNECT",t[t.STATUS=2]="STATUS"}(r||(r={})),function(t){t.codec=()=>Rn(r)}(e=t.Type||(t.Type={})),t.codec=()=>(null==i&&(i=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.type&&(r.uint32(8),t.Type.codec().encode(e.type,r)),null!=e.peer&&(r.uint32(18),Of.codec().encode(e.peer,r)),null!=e.reservation&&(r.uint32(26),Uf.codec().encode(e.reservation,r)),null!=e.limit&&(r.uint32(34),Ff.codec().encode(e.limit,r)),null!=e.status&&(r.uint32(40),jf.codec().encode(e.status,r)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.type=t.Type.codec().decode(e);break;case 2:n.peer=Of.codec().decode(e,e.uint32(),{limits:i.limits?.peer});break;case 3:n.reservation=Uf.codec().decode(e,e.uint32(),{limits:i.limits?.reservation});break;case 4:n.limit=Ff.codec().decode(e,e.uint32(),{limits:i.limits?.limit});break;case 5:n.status=jf.codec().decode(e);break;default:e.skipType(7&r)}}return n}))),i),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Nf||(Nf={})),function(t){let e,r,i;!function(t){t.CONNECT="CONNECT",t.STATUS="STATUS"}(e=t.Type||(t.Type={})),function(t){t[t.CONNECT=0]="CONNECT",t[t.STATUS=1]="STATUS"}(r||(r={})),function(t){t.codec=()=>Rn(r)}(e=t.Type||(t.Type={})),t.codec=()=>(null==i&&(i=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.type&&(r.uint32(8),t.Type.codec().encode(e.type,r)),null!=e.peer&&(r.uint32(18),Of.codec().encode(e.peer,r)),null!=e.limit&&(r.uint32(26),Ff.codec().encode(e.limit,r)),null!=e.status&&(r.uint32(32),jf.codec().encode(e.status,r)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.type=t.Type.codec().decode(e);break;case 2:n.peer=Of.codec().decode(e,e.uint32(),{limits:i.limits?.peer});break;case 3:n.limit=Ff.codec().decode(e,e.uint32(),{limits:i.limits?.limit});break;case 4:n.status=jf.codec().decode(e);break;default:e.skipType(7&r)}}return n}))),i),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Lf||(Lf={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.id&&t.id.byteLength>0&&(e.uint32(10),e.bytes(t.id)),null!=t.addrs)for(const r of t.addrs)e.uint32(18),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={id:Qr(0),addrs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.id=t.bytes();break;case 2:if(null!=r.limits?.addrs&&i.addrs.length===r.limits.addrs)throw new Nn('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Of||(Of={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.expire&&0n!==t.expire&&(e.uint32(8),e.uint64(t.expire)),null!=t.addrs)for(const r of t.addrs)e.uint32(18),e.bytes(r);null!=t.voucher&&(e.uint32(26),zf.codec().encode(t.voucher,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={expire:0n,addrs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.expire=t.uint64();break;case 2:if(null!=r.limits?.addrs&&i.addrs.length===r.limits.addrs)throw new Nn('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break;case 3:i.voucher=zf.codec().decode(t,t.uint32(),{limits:r.limits?.voucher});break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Uf||(Uf={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.duration&&(e.uint32(8),e.uint32(t.duration)),null!=t.data&&(e.uint32(16),e.uint64(t.data)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.duration=t.uint32();break;case 2:i.data=t.uint64();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Ff||(Ff={})),function(t){t.UNUSED="UNUSED",t.OK="OK",t.RESERVATION_REFUSED="RESERVATION_REFUSED",t.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONNECTION_FAILED="CONNECTION_FAILED",t.NO_RESERVATION="NO_RESERVATION",t.MALFORMED_MESSAGE="MALFORMED_MESSAGE",t.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(jf||(jf={})),function(t){t[t.UNUSED=0]="UNUSED",t[t.OK=100]="OK",t[t.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",t[t.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",t[t.PERMISSION_DENIED=202]="PERMISSION_DENIED",t[t.CONNECTION_FAILED=203]="CONNECTION_FAILED",t[t.NO_RESERVATION=204]="NO_RESERVATION",t[t.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",t[t.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(Vf||(Vf={})),function(t){t.codec=()=>Rn(Vf)}(jf||(jf={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.relay&&t.relay.byteLength>0&&(e.uint32(10),e.bytes(t.relay)),null!=t.peer&&t.peer.byteLength>0&&(e.uint32(18),e.bytes(t.peer)),null!=t.expiration&&0n!==t.expiration&&(e.uint32(24),e.uint64(t.expiration)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={relay:Qr(0),peer:Qr(0),expiration:0n},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.relay=t.bytes();break;case 2:i.peer=t.bytes();break;case 3:i.expiration=t.uint64();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(qf||(qf={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.publicKey&&t.publicKey.byteLength>0&&(e.uint32(10),e.bytes(t.publicKey)),null!=t.payloadType&&t.payloadType.byteLength>0&&(e.uint32(18),e.bytes(t.payloadType)),null!=t.payload&&(e.uint32(26),qf.codec().encode(t.payload,e)),null!=t.signature&&t.signature.byteLength>0&&(e.uint32(42),e.bytes(t.signature)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={publicKey:Qr(0),payloadType:Qr(0),signature:Qr(0)},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.publicKey=t.bytes();break;case 2:i.payloadType=t.bytes();break;case 3:i.payload=qf.codec().decode(t,t.uint32(),{limits:r.limits?.payload});break;case 5:i.signature=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(zf||(zf={}));const Hf=t=>({match:e=>!(e.length<1)&&!!t(e[0])&&e.slice(1),pattern:"fn"}),$f=t=>({match:e=>Hf((e=>e===t)).match(e),pattern:t}),Wf=()=>({match:t=>Hf((t=>"string"==typeof t)).match(t),pattern:"{string}"}),Kf=()=>({match:t=>Hf((t=>!isNaN(parseInt(t)))).match(t),pattern:"{number}"}),Gf=()=>({match:t=>{if(t.length<2)return!1;if("p2p"!==t[0]&&"ipfs"!==t[0])return!1;if(!t[1].startsWith("Q")&&!t[1].startsWith("1"))return!1;try{ct.decode(`z${t[1]}`)}catch(t){return!1}return t.slice(2)},pattern:"/p2p/{peerid}"}),Zf=()=>({match:t=>{if(t.length<2)return!1;if("certhash"!==t[0])return!1;try{Vi.decode(t[1])}catch{return!1}return t.slice(2)},pattern:"/certhash/{certhash}"}),Yf=t=>({match:e=>{const r=t.match(e);return!1===r?e:r},pattern:`optional(${t.pattern})`}),Jf=(...t)=>({match:e=>{let r;for(const i of t){const t=i.match(e);!1!==t&&(null==r||t.length<r.length)&&(r=t)}return null!=r&&r},pattern:`or(${t.map((t=>t.pattern)).join(", ")})`}),Xf=(...t)=>({match:e=>{for(const r of t){const t=r.match(e);if(!1===t)return!1;e=t}return e},pattern:`and(${t.map((t=>t.pattern)).join(", ")})`});function Qf(...t){function e(e){let r=(t=>t.toString().split("/").slice(1))(e);for(const e of t){const t=e.match(r);if(!1===t)return!1;r=t}return r}return{matchers:t,matches:function(t){return!1!==e(t)},exactMatch:function(t){const r=e(t);return!1!==r&&0===r.length}}}const tp=Xf($f("dns4"),Wf()),ep=Xf($f("dns6"),Wf()),rp=Xf($f("dnsaddr"),Wf()),ip=Xf($f("dns"),Wf()),np=(Qf(tp,Yf(Gf())),Qf(ep,Yf(Gf())),Qf(rp,Yf(Gf())),Qf(Jf(ip,rp,tp,ep),Yf(Gf()))),sp=Xf($f("ip4"),Hf(Tu)),op=Xf($f("ip6"),Hf(Pu)),ap=Jf(sp,op),hp=Jf(ap,ip,tp,ep,rp),up=Qf(Jf(ap,Xf(Jf(ip,rp,tp,ep),Yf(Gf())))),cp=(Qf(sp),Qf(op),Qf(ap)),lp=Xf(hp,$f("tcp"),Kf()),dp=Xf(hp,$f("udp"),Kf()),fp=Qf(Xf(lp,Yf(Gf()))),pp=(Qf(dp),Xf(dp,$f("quic"),Yf(Gf()))),mp=Xf(dp,$f("quic-v1"),Yf(Gf())),gp=Jf(pp,mp),bp=(Qf(pp),Qf(mp),Jf(hp,lp,dp,pp,mp)),yp=Jf(Xf(bp,$f("ws"),Yf(Gf()))),vp=Qf(yp),wp=Jf(Xf(bp,$f("wss"),Yf(Gf())),Xf(bp,$f("tls"),Yf(Xf($f("sni"),Wf())),$f("ws"),Yf(Gf()))),Mp=Qf(wp),_p=Xf(dp,$f("webrtc-direct"),Yf(Zf()),Yf(Zf()),Yf(Gf())),Sp=Qf(_p),Ep=Xf(mp,$f("webtransport"),Yf(Zf()),Yf(Zf()),Yf(Gf())),kp=Qf(Ep),Ap=Jf(yp,wp,Xf(lp,Yf(Gf())),Xf(gp,Yf(Gf())),Xf(hp,Yf(Gf())),_p,Ep,Gf()),Ip=Qf(Ap),xp=Qf(Xf(Ap,$f("p2p-circuit"),Gf())),Cp=Qf(Jf(Xf(Ap,$f("p2p-circuit"),$f("webrtc"),Yf(Gf())),Xf(Ap,$f("webrtc"),Yf(Gf())),Xf($f("webrtc"),Yf(Gf()))));Qf(Jf(Xf(hp,$f("tcp"),Kf(),$f("http"),Yf(Gf())),Xf(hp,$f("http"),Yf(Gf())))),Qf(Jf(Xf(hp,$f("tcp"),Jf(Xf($f("443"),$f("http")),Xf(Kf(),$f("https"))),Yf(Gf())),Xf(hp,$f("tls"),$f("http"),Yf(Gf())),Xf(hp,$f("https"),Yf(Gf())))),Qf(Jf(Xf($f("memory"),Wf(),Yf(Gf()))));class Tp extends Error{constructor(t="Transfer limit error"){super(t),this.name="TransferLimitError"}}class Pp extends Error{constructor(t="Duration limit error"){super(t),this.name="DurationLimitError"}}class Bp extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class Rp extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class Dp extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}async function*Np(t,e,r){const i=e.remaining;for await(const n of t){const t=BigInt(n.byteLength);if(e.remaining-t<0){const t=Number(e.remaining);e.remaining=0n;try{0!==t&&(yield n.subarray(0,t))}catch(t){r.log.error(t)}throw new Tp(`data limit of ${i} bytes exceeded`)}e.remaining-=t,yield n}}function Lp(t){const e=t*BigInt(1e3),r=(new Date).getTime();return Number(e-BigInt(r))}class Op{expires;bytes;constructor(t){null!=t?.duration&&0!==t?.duration&&(this.expires=Date.now()+1e3*t.duration),this.bytes=t?.data,0n===this.bytes&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(t){null!=this.bytes&&(this.bytes-=BigInt(t.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(null==this.expires&&null==this.bytes)return;const t={};if(null!=this.bytes){const e=this;Object.defineProperty(t,"bytes",{get:()=>e.bytes})}if(null!=this.expires){const e=this;Object.defineProperty(t,"seconds",{get:()=>Math.round(((e.expires??0)-Date.now())/1e3)})}return t}}const Up=Qf(Xf(Ip.matchers[0],$f("p2p-circuit"))),Fp=Qf($f("p2p-circuit"));class jp{map;constructor(t){if(this.map=new Map,null!=t)for(const[e,r]of t.entries())this.map.set(e.toString(),{key:e,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(t){return this.map.delete(t.toString())}entries(){return Zl(this.map.entries(),(t=>[t[1].key,t[1].value]))}forEach(t){this.map.forEach(((e,r)=>{t(e.value,e.key,this)}))}get(t){return this.map.get(t.toString())?.value}has(t){return this.map.has(t.toString())}set(t,e){this.map.set(t.toString(),{key:t,value:e})}keys(){return Zl(this.map.values(),(t=>t.key))}values(){return Zl(this.map.values(),(t=>t.value))}get size(){return this.map.size}}class Vp extends jp{metric;constructor(t){super();const{name:e,metrics:r}=t;this.metric=r.registerMetric(e),this.updateComponentMetric()}set(t,e){return super.set(t,e),this.updateComponentMetric(),this}delete(t){const e=super.delete(t);return this.updateComponentMetric(),e}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}class qp extends Error{type;code;constructor(t,e,r){super(t??"The operation was aborted"),this.type="aborted",this.name=r??"AbortError",this.code=e??"ABORT_ERR"}}function zp(t,e){const r=new qp(e?.errorMessage,e?.errorCode,e?.errorName),i=new AbortController,n=()=>{i.abort(r)};let s=AbortSignal.timeout(t);s.addEventListener("abort",n);const o=i.signal;return o.reset=e=>{s?.removeEventListener("abort",n),s=AbortSignal.timeout(e??t),s.addEventListener("abort",(()=>{i.abort(r)}))},o.clear=()=>{s?.removeEventListener("abort",n),s=void 0},o}class Hp{reservations;maxReservations;applyDefaultLimit;reservationTtl;defaultDurationLimit;defaultDataLimit;log;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:circuit-relay:server:reservation-store"),this.maxReservations=e.maxReservations??15,this.applyDefaultLimit=!1!==e.applyDefaultLimit,this.reservationTtl=e.reservationTtl??72e5,this.defaultDurationLimit=e.defaultDurationLimit??12e4,this.defaultDataLimit=e.defaultDataLimit??Bf,this.reservations=function(t){const{name:e,metrics:r}=t;let i;return i=null!=r?new Vp({name:e,metrics:r}):new jp,i}({metrics:t.metrics,name:"libp2p_circuit_relay_server_reservations_total"})}reserve(t,e,r){let i=this.reservations.get(t);if(this.reservations.size>=this.maxReservations&&null==i)return{status:jf.RESERVATION_REFUSED};const n=new Date(Date.now()+this.reservationTtl);let s;return this.applyDefaultLimit&&(s=r??{data:this.defaultDataLimit,duration:this.defaultDurationLimit}),null!=i?(this.log("refreshing reservation for client %p",t),i.signal.reset(this.reservationTtl)):(this.log("creating new reservation for client %p",t),i={addr:e,expiry:n,limit:s,signal:zp(this.reservationTtl)}),this.reservations.set(t,i),i.signal.addEventListener("abort",(()=>{this.reservations.delete(t)})),{status:jf.OK,expire:Math.round(n.getTime()/1e3)}}removeReservation(t){this.reservations.delete(t)}get(t){return this.reservations.get(t)}clear(){this.reservations.clear()}}class $p{domain="libp2p-relay-rsvp";codec=new Uint8Array([3,2]);relay;peer;expiration;constructor({relay:t,peer:e,expiration:r}){this.relay=t,this.peer=e,this.expiration=r}marshal(){return qf.encode({relay:this.relay.toMultihash().bytes,peer:this.peer.toMultihash().bytes,expiration:BigInt(this.expiration)})}equals(t){return t instanceof $p&&!!this.peer.equals(t.peer)&&!!this.relay.equals(t.relay)&&this.expiration===t.expiration}}const Wp=t=>t.protoCodes().includes(290);class Kp extends v{registrar;peerStore;addressManager;peerId;privateKey;connectionManager;connectionGater;reservationStore;started;hopTimeout;shutdownController;maxInboundHopStreams;maxOutboundHopStreams;maxOutboundStopStreams;log;constructor(t,e={}){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:server"),this.registrar=t.registrar,this.peerStore=t.peerStore,this.addressManager=t.addressManager,this.peerId=t.peerId,this.privateKey=t.privateKey,this.connectionManager=t.connectionManager,this.connectionGater=t.connectionGater,this.started=!1,this.hopTimeout=e?.hopTimeout??3e4,this.maxInboundHopStreams=e.maxInboundHopStreams,this.maxOutboundHopStreams=e.maxOutboundHopStreams,this.maxOutboundStopStreams=e.maxOutboundStopStreams??300,this.reservationStore=new Hp(t,e.reservations),this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-server";isStarted(){return this.started}async start(){this.started||(await this.registrar.handle(Rf,(t=>{this.onHop(t).catch((t=>{this.log.error(t)}))}),{maxInboundStreams:this.maxInboundHopStreams,maxOutboundStreams:this.maxOutboundHopStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){this.reservationStore.clear(),this.shutdownController.abort(),await this.registrar.unhandle(Rf),this.started=!1}async onHop({connection:t,stream:e}){this.log("received circuit v2 hop protocol stream from %p",t.remotePeer);const r={signal:AbortSignal.timeout(this.hopTimeout)},i=Fd(e);try{const e=await i.pb(Nf).read(r);if(null==e?.type)throw new Error("request was invalid, could not read from stream");this.log("received",e.type),await this.handleHopProtocol({connection:t,stream:i,request:e},r)}catch(t){this.log.error("error while handling hop",t),await i.pb(Nf).write({type:Nf.Type.STATUS,status:jf.MALFORMED_MESSAGE},r),e.abort(t)}}async handleHopProtocol({stream:t,request:e,connection:r},i){switch(this.log("received hop message"),e.type){case Nf.Type.RESERVE:await this.handleReserve({stream:t,request:e,connection:r},i);break;case Nf.Type.CONNECT:await this.handleConnect({stream:t,request:e,connection:r},i);break;default:this.log.error("invalid hop request type %s via peer %p",e.type,r.remotePeer),await t.pb(Nf).write({type:Nf.Type.STATUS,status:jf.UNEXPECTED_MESSAGE})}}async handleReserve({stream:t,connection:e},r){const i=t.pb(Nf);if(this.log("hop reserve request from %p",e.remotePeer),Wp(e.remoteAddr))return this.log.error("relay reservation over circuit connection denied for peer: %p",e.remotePeer),void await i.write({type:Nf.Type.STATUS,status:jf.PERMISSION_DENIED},r);if(!0===await(this.connectionGater.denyInboundRelayReservation?.(e.remotePeer)))return this.log.error("reservation for %p denied by connection gater",e.remotePeer),void await i.write({type:Nf.Type.STATUS,status:jf.PERMISSION_DENIED},r);const n=this.reservationStore.reserve(e.remotePeer,e.remoteAddr);try{if(n.status!==jf.OK)return void await i.write({type:Nf.Type.STATUS,status:n.status},r);if(null!=n.expire){const t=1e3*n.expire-Date.now();await this.peerStore.merge(e.remotePeer,{tags:{[Cf]:{value:1,ttl:t},[Pf]:{value:1,ttl:t}}})}await i.write({type:Nf.Type.STATUS,status:jf.OK,reservation:await this.makeReservation(e.remotePeer,BigInt(n.expire??0)),limit:this.reservationStore.get(e.remotePeer)?.limit},r),this.log("sent confirmation response to %s",e.remotePeer)}catch(t){this.log.error("failed to send confirmation response to %p - %e",e.remotePeer,t),this.reservationStore.removeReservation(e.remotePeer);try{await this.peerStore.merge(e.remotePeer,{tags:{[Cf]:void 0,[Pf]:void 0}})}catch(t){this.log.error("failed to untag relay source peer %p - %e",e.remotePeer,t)}}}async makeReservation(t,e){const r=[];for(const t of this.addressManager.getAddresses())t.toString().includes("/p2p-circuit")||r.push(t.bytes);const i=await Af.seal(new $p({peer:t,relay:this.peerId,expiration:e}),this.privateKey);return{addrs:r,expire:e,voucher:{publicKey:$a(i.publicKey),payloadType:i.payloadType,payload:{peer:t.toMultihash().bytes,relay:this.peerId.toMultihash().bytes,expiration:e},signature:i.signature}}}async handleConnect({stream:t,request:e,connection:r},i){const n=t.pb(Nf);if(Wp(r.remoteAddr))return this.log.error("relay reservation over circuit connection denied for peer: %p",r.remotePeer),void await n.write({type:Nf.Type.STATUS,status:jf.PERMISSION_DENIED},i);let s;this.log("hop connect request from %p",r.remotePeer);try{if(null==e.peer)throw this.log.error("no peer info in hop connect request"),new Error("no peer info in request");e.peer.addrs.forEach(Ud),s=rh(qt(e.peer.id))}catch(t){return this.log.error("invalid hop connect request via peer %p %s",r.remotePeer,t),void await n.write({type:Nf.Type.STATUS,status:jf.MALFORMED_MESSAGE},i)}const o=this.reservationStore.get(s);if(null==o)return this.log.error("hop connect denied for destination peer %p not having a reservation for %p with status %s",s,r.remotePeer,jf.NO_RESERVATION),void await n.write({type:Nf.Type.STATUS,status:jf.NO_RESERVATION},i);if(!0===await(this.connectionGater.denyOutboundRelayedConnection?.(r.remotePeer,s)))return this.log.error("hop connect for %p to %p denied by connection gater",r.remotePeer,s),void await n.write({type:Nf.Type.STATUS,status:jf.PERMISSION_DENIED},i);const a=this.connectionManager.getConnections(s);if(0===a.length)return this.log("hop connect denied for destination peer %p not having a connection for %p as there is no destination connection",s,r.remotePeer),void await n.write({type:Nf.Type.STATUS,status:jf.NO_RESERVATION},i);const h=a[0],u=await this.stopHop({connection:h,request:{type:Lf.Type.CONNECT,peer:{id:r.remotePeer.toMultihash().bytes,addrs:[]},limit:o?.limit}},i);if(null==u)return this.log.error("failed to open stream to destination peer %p",h?.remotePeer),void await n.write({type:Nf.Type.STATUS,status:jf.CONNECTION_FAILED},i);await n.write({type:Nf.Type.STATUS,status:jf.OK,limit:o?.limit},i);const c=t.unwrap();this.log("connection from %p to %p established - merging streams",r.remotePeer,s),function(t,e,r,i,n){function s(r){t.abort(r),e.abort(r)}const o=[r,i.signal];null!=i.limit?.duration&&(n.log("limiting relayed connection duration to %dms",i.limit.duration),o.push(AbortSignal.timeout(i.limit.duration)));const a=Ed(o);let h,u=!1,c=!1;null!=i.limit?.data&&(h={remaining:i.limit.data}),queueMicrotask((()=>{const r=()=>{n.log("relayed connection reached time limit"),e.abort(new Pp(`duration limit of ${i.limit?.duration} ms exceeded`))};a.addEventListener("abort",r,{once:!0}),e.sink(null==h?t.source:Np(t.source,h,n)).catch((t=>{n.log.error("error while relaying streams src -> dst",t),s(t)})).finally((()=>{u=!0,c&&(a.removeEventListener("abort",r),a.clear())}))})),queueMicrotask((()=>{const r=()=>{n.log("relayed connection reached time limit"),t.abort(new Pp(`duration limit of ${i.limit?.duration} ms exceeded`))};a.addEventListener("abort",r,{once:!0}),t.sink(null==h?e.source:Np(e.source,h,n)).catch((t=>{n.log.error("error while relaying streams dst -> src",t),s(t)})).finally((()=>{c=!0,u&&(a.removeEventListener("abort",r),a.clear())}))}))}(c,u,this.shutdownController.signal,o,{log:this.log})}async stopHop({connection:t,request:e},r){this.log("starting circuit relay v2 stop request to %s",t.remotePeer);const i=await t.newStream([Df],{maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0,...r}),n=Fd(i),s=n.pb(Lf);let o;await s.write(e,r);try{o=await s.read(r)}catch(e){this.log.error("error parsing stop message response from %p",t.remotePeer)}return null==o?(this.log.error("could not read response from %p",t.remotePeer),void await i.close(r)):o.status===jf.OK?(this.log("stop request to %p was successful",t.remotePeer),n.unwrap()):(this.log("stop request failed with code %d",o.status),void await i.close(r))}get reservations(){return this.reservationStore.reservations}}function Gp(t={}){return e=>new Kp(e,t)}const Zp=Symbol.for("@libp2p/transport");var Yp;function Jp(t){return null!=t&&"function"==typeof t.start&&"function"==typeof t.stop}async function Xp(...t){const e=[];for(const r of t)Jp(r)&&e.push(r);await Promise.all(e.map((async t=>{null!=t.beforeStart&&await t.beforeStart()}))),await Promise.all(e.map((async t=>{await t.start()}))),await Promise.all(e.map((async t=>{null!=t.afterStart&&await t.afterStart()})))}async function Qp(...t){const e=[];for(const r of t)Jp(r)&&e.push(r);await Promise.all(e.map((async t=>{null!=t.beforeStop&&await t.beforeStop()}))),await Promise.all(e.map((async t=>{await t.stop()}))),await Promise.all(e.map((async t=>{null!=t.afterStop&&await t.afterStop()})))}!function(t){t[t.FATAL_ALL=0]="FATAL_ALL",t[t.NO_FATAL=1]="NO_FATAL"}(Yp||(Yp={}));class tm{filter;constructor(t,e){this.filter=ud(t,e)}has(t){return this.filter.has(t.toMultihash().bytes)}add(t){this.filter.add(t.toMultihash().bytes)}remove(t){this.filter.remove?.(t.toMultihash().bytes)}}function em(t,e=.001){return new tm(t,e)}function rm(t){const{stream:e,remoteAddr:r,logger:i,onDataRead:n,onDataWrite:s}=t,o=i.forComponent("libp2p:stream:converter");let a=!1,h=!1;const u=e.close.bind(e);e.close=async t=>{await u(t),f(!0)};const c=e.abort.bind(e);e.abort=t=>{c(t),f(!0)};const l=e.sink.bind(e);e.sink=async t=>{try{await l(kh(t,(t=>ql(t,(t=>s?.(t))))))}catch(t){"aborted"!==t.type&&o.error("%s error in sink",r,t)}finally{h=!0,f()}};const d={log:o,sink:e.sink,source:async function*(){try{for await(const t of e.source)n?.(t),yield t}finally{a=!0,f()}}(),remoteAddr:r,timeline:{open:Date.now(),close:void 0},close:e.close,abort:e.abort};function f(t){!0===t&&(a=!0,h=!0),a&&h&&null==d.timeline.close&&(d.timeline.close=Date.now())}return d}class im extends Event{type;detail;constructor(t,e){super(t),this.type=t,this.detail=e}}class nm extends v{peerStore;registrar;connectionManager;randomWalk;started;running;topologyId;log;discoveryController;filter;queue;constructor(t,e={}){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.running=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.connectionManager=t.connectionManager,this.randomWalk=t.randomWalk,this.filter=e.filter,this.discoveryController=new AbortController,this.discoveryController.signal}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(Rf,{filter:this.filter,onConnect:t=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",t,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.discoveryController?.abort(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,Promise.resolve().then((async()=>{this.log("searching peer store for relays");const t=await this.peerStore.all({filters:[t=>t.protocols.includes(Rf)],orders:[()=>Math.random()<.5?1:-1,(t,e)=>{const r=sm(t),i=sm(e);return r>i?-1:i>r?1:0}]});for(const e of t)this.log.trace("found relay peer %p in peer store",e.id),this.safeDispatchEvent("relay:discover",{detail:e.id});this.log("found %d relay peers in peer store",t.length);const e=this.queue=new Sd({concurrency:5});this.log("start random walk");for await(const t of this.randomWalk.walk({signal:this.discoveryController.signal}))this.log.trace("found random peer %p",t.id),e.has(t.id)?this.log.trace("random peer %p was already in queue",t.id):this.connectionManager.getConnections(t.id)?.length>0?this.log.trace("random peer %p was already connected",t.id):await this.connectionManager.isDialable(t.multiaddrs)?(e.queued>10&&(this.log.trace("wait for space in queue for %p",t.id),await e.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",t.id,e.size,e.running),e.add((async()=>{const e=Ed([this.discoveryController.signal,AbortSignal.timeout(5e3)]);try{await this.connectionManager.openConnection(t.id,{signal:e})}finally{e.clear()}}),{peerId:t.id,signal:this.discoveryController.signal}).catch((e=>{this.log.error("error opening connection to random peer %p",t.id,e)}))):this.log.trace("random peer %p was not dialable",t.id,t.multiaddrs.map((t=>t.toString())));this.log("stop random walk"),await e.onIdle()})).catch((t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network",t)})))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort()}}function sm(t){const e=t.metadata.get("last-dial-success");return null==e?0:new Date(sa(e)).getTime()}class om extends v{peerId;connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(t,e={}){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=e.listenTimeout??2e3,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=t=>{this.log("relay removed %p our relay %p",t.detail.relay,this.relay,this.relay?.equals(t.detail.relay)),!0===this.relay?.equals(t.detail.relay)&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach((t=>{this.addressManager.removeObservedAddr(t)})),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=t=>{const{details:e}=t.detail;"configured"!==e.type&&e.id===this.reservationId&&this.addedRelay(t.detail)};async listen(t){if(this.log("listen on %a",t),Fp.exactMatch(t))this.reservationId=this.reservationStore.reserveRelay();else{if(!Up.exactMatch(t))throw new Z(`Could not listen on p2p-circuit address "${t}"`);{const e=AbortSignal.timeout(this.listenTimeout),r=t.decapsulate("/p2p-circuit"),i=await this.connectionManager.openConnection(r,{signal:e});if(!this.reservationStore.hasReservation(i.remotePeer)){this.log("making reservation on peer %p",i.remotePeer);const t=await this.reservationStore.addRelay(i.remotePeer,"configured");this.addedRelay(t)}}}}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask((()=>{this.safeDispatchEvent("close")}))}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map((t=>Ud(t).encapsulate("/p2p-circuit"))),this.listeningAddrs.forEach((t=>{this.addressManager.confirmObservedAddr(t,{type:"transport"})})),queueMicrotask((()=>{this.safeDispatchEvent("listening")}))}}let am=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t|=0));for(;t--;)e+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[t]];return e};class hm extends v{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(t,e){super(),this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new jp,this.pendingReservations=[],this.maxReservationQueueLength=e?.maxReservationQueueLength??100,this.reservationCompletionTimeout=e?.reservationCompletionTimeout??2e3,this.started=!1,this.relayFilter=ud(100),this.reserveQueue=new Sd({concurrency:e?.reservationConcurrency??1,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",(t=>{null!=[...this.reservations.values()].find((e=>e.connection===t.detail.id))&&this.#s(t.detail.remotePeer).catch((e=>{this.log("could not remove relay %p - %e",t.detail,e)}))}))}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then((async()=>{const t=await this.peerStore.all({filters:[t=>t.tags.has(Tf)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map((async t=>{await this.peerStore.merge(t.id,{tags:{[Tf]:void 0}})}))),this.log("redialing %d old relays",t.length),await Promise.all(t.map((async t=>this.addRelay(t.id,"discovered")))),this.#o()})).catch((t=>{this.log.error(t)}))}stop(){this.reserveQueue.clear(),this.reservations.forEach((({timeout:t})=>{clearTimeout(t)})),this.reservations.clear(),this.started=!1}reserveRelay(){const t=am();return this.pendingReservations.push(t),this.#o(),t}async addRelay(t,e){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new Z("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new Dp("The reservation queue is full");const r=this.reserveQueue.find(t);if(null!=r)return this.log.trace("potential relay peer %p is already in the reservation queue",t),r.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new Z("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add((async()=>{const r=Date.now();try{const r=this.reservations.get(t);if(null!=r){const e=this.connectionManager.getConnections(t);let i=!1;if(0===e.length&&this.log("already have relay reservation with %p but we are no longer connected",t),e.map((t=>t.id)).includes(r.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),i=!0),i&&Lp(r.reservation.expire)>6e5)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:r};await this.#s(t)}if("discovered"===e&&0===this.pendingReservations.length)throw new Bp("Not making reservation on discovered relay because we do not need any more relays");const i=AbortSignal.timeout(this.reservationCompletionTimeout),n=await this.connectionManager.openConnection(t,{signal:i});if(xp.matches(n.remoteAddr))throw new Rp("not creating reservation over relayed connection");const s=await this.#a(n,{signal:i}),o=Lp(s.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+o).toString());const a=Math.min(Math.max(o-3e5,3e4),Math.pow(2,31)-1),h=setTimeout((()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,e).catch((async e=>{this.log.error("could not refresh reservation to relay %p - %e",t,e),await this.#s(t)})).catch((e=>{this.log.error("could not remove expired reservation to relay %p - %e",t,e)}))}),a);let u;if("discovered"===e){const t=this.pendingReservations.pop();if(null==t)throw new Bp("Made reservation on relay but did not need any more discovered relays");u={timeout:h,reservation:s,type:e,connection:n.id,id:t}}else u={timeout:h,reservation:s,type:e,connection:n.id};this.reservations.set(t,u),await this.peerStore.merge(t,{tags:{[Tf]:{value:1,ttl:o}}}),this.#o();const c={relay:t,details:u};return this.safeDispatchEvent("relay:created-reservation",{detail:c}),c}catch(i){throw"discovered"===e&&"HadEnoughRelaysError"===i.name||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-r,i),"DialError"!==i.name&&"UnsupportedProtocolError"!==i.name||this.relayFilter.add(t.toMultihash().bytes),this.#s(t).catch((e=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,e)})),i}}),{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){return this.reservations.get(t)?.reservation}reservationCount(t){return null==t?this.reservations.size:[...this.reservations.values()].reduce(((e,r)=>(r.type===t&&e++,e)),0)}cancelReservations(){[...this.reservations.values()].forEach((t=>{clearTimeout(t.timeout)})),this.reservations.clear()}async#a(t,e){e.signal?.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const r=await t.newStream(Rf,e),i=Fd(r).pb(Nf);let n;this.log.trace("send RESERVE to %p",t.remotePeer),await i.write({type:Nf.Type.RESERVE},e);try{this.log.trace("reading response from %p",t.remotePeer),n=await i.read(e)}catch(t){throw r.abort(t),t}finally{"closed"!==r.status&&await r.close(e)}if(this.log.trace("read response %o",n),n.status===jf.OK&&null!=n.reservation){const e=new Set;e.add(t.remoteAddr.toString());for(const r of n.reservation.addrs){let i=Ud(r);null==i.getPeerId()&&(i=i.encapsulate(`/p2p/${t.remotePeer}`)),i=Ud(i.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),e.add(i.toString())}return n.reservation.addrs=[...e].map((t=>Ud(t).bytes)),n.reservation}const s=`reservation failed with status ${n.status??"undefined"}`;throw this.log.error(s),new Error(s)}async#s(t){const e=this.reservations.get(t);null!=e&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(e.timeout),this.reservations.delete(t),"discovered"===e.type&&this.pendingReservations.push(e.id),await this.peerStore.merge(t,{tags:{[Tf]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:e}}),this.#o())}#o(){if(0===this.pendingReservations.length)return this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),void this.safeDispatchEvent("relay:found-enough-relays");this.relayFilter=ud(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}class um{discovery;registrar;peerStore;connectionManager;transportManager;peerId;upgrader;addressManager;connectionGater;reservationStore;logger;maxInboundStopStreams;maxOutboundStopStreams;stopTimeout;started;log;constructor(t,e){this.log=t.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=t.registrar,this.peerStore=t.peerStore,this.connectionManager=t.connectionManager,this.transportManager=t.transportManager,this.logger=t.logger,this.peerId=t.peerId,this.upgrader=t.upgrader,this.addressManager=t.addressManager,this.connectionGater=t.connectionGater,this.maxInboundStopStreams=e.maxInboundStopStreams??300,this.maxOutboundStopStreams=e.maxOutboundStopStreams??300,this.stopTimeout=e.stopTimeout??3e4,this.discovery=new nm(t,{filter:e.discoveryFilter??em(4096,.001)}),this.discovery.addEventListener("relay:discover",(t=>{this.reservationStore.addRelay(t.detail,"discovered").catch((e=>{"HadEnoughRelaysError"!==e.name&&"RelayQueueFullError"!==e.name&&this.log.error("could not add discovered relay %p",t.detail,e)}))})),this.reservationStore=new hm(t,e),this.reservationStore.addEventListener("relay:not-enough-relays",(()=>{this.discovery?.startDiscovery()})),this.reservationStore.addEventListener("relay:found-enough-relays",(()=>{this.discovery?.stopDiscovery()})),this.started=!1}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[k]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[A](){return null!=this.discovery?["@libp2p/identify"]:[]}[Zp]=!0;isStarted(){return this.started}async start(){await this.registrar.handle(Df,(t=>{this.onStop(t).catch((e=>{this.log.error("error while handling STOP protocol",e),t.stream.abort(e)}))}),{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await Xp(this.discovery,this.reservationStore),this.started=!0}async stop(){await Qp(this.discovery,this.reservationStore),await this.registrar.unhandle(Df),this.started=!1}async dial(t,e){if(1!==t.protoCodes().filter((t=>290===t)).length){const e="Invalid circuit relay address";throw this.log.error(e,t),new G(e)}const r=t.toString().split("/p2p-circuit"),i=Ud(r[0]),n=Ud(r[r.length-1]),s=i.getPeerId(),o=n.getPeerId();if(null==s||null==o){const e=`ircuit relay dial to ${t.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${e}`),new G(`C${e}`)}const a=th(s),h=th(o);let u,c=this.connectionManager.getConnections(a)[0];null==c?(await this.peerStore.merge(a,{multiaddrs:[i]}),e.onProgress?.(new im("circuit-relay:open-connection")),c=await this.connectionManager.openConnection(a,e)):e.onProgress?.(new im("circuit-relay:reuse-connection"));try{e.onProgress?.(new im("circuit-relay:open-hop-stream")),u=await c.newStream(Rf,e);const r=Fd(u),s=r.pb(Nf);e.onProgress?.(new im("circuit-relay:write-connect-message")),await s.write({type:Nf.Type.CONNECT,peer:{id:h.toMultihash().bytes,addrs:[Ud(n).bytes]}},e),e.onProgress?.(new im("circuit-relay:read-connect-response"));const o=await s.read(e);if(o.status!==jf.OK)throw new $(`failed to connect via relay with status ${o?.status?.toString()??"undefined"}`);const a=new Op(o.limit),l=rm({stream:r.unwrap(),remoteAddr:t,localAddr:i.encapsulate(`/p2p-circuit/p2p/${this.peerId.toString()}`),logger:this.logger,onDataRead:a.onData,onDataWrite:a.onData});return this.log("new outbound relayed connection %a",l.remoteAddr),await this.upgrader.upgradeOutbound(l,{...e,limits:a.getLimits()})}catch(t){throw this.log.error("circuit relay dial to destination %p via relay %p failed",h,a,t),u?.abort(t),t}}createListener(t){return function(t){return new om(t)}({peerId:this.peerId,connectionManager:this.connectionManager,addressManager:this.addressManager,reservationStore:this.reservationStore,logger:this.logger})}listenFilter(t){return(t=Array.isArray(t)?t:[t]).filter((t=>Up.exactMatch(t)||Fp.exactMatch(t)))}dialFilter(t){return(t=Array.isArray(t)?t:[t]).filter((t=>xp.exactMatch(t)))}async onStop({connection:t,stream:e}){if(!this.reservationStore.hasReservation(t.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([t.remoteAddr.encapsulate("/p2p-circuit")])}catch(t){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",t)}const r=AbortSignal.timeout(this.stopTimeout),i=Fd(e).pb(Lf),n=await i.read({signal:r});if(this.log("new circuit relay v2 stop stream from %p with type %s",t.remotePeer,n.type),void 0===n?.type)return this.log.error("type was missing from circuit v2 stop protocol request from %s",t.remotePeer),await i.write({type:Lf.Type.STATUS,status:jf.MALFORMED_MESSAGE},{signal:r}),void await e.close();if(n.type!==Lf.Type.CONNECT)return this.log.error("invalid stop connect request via peer %p",t.remotePeer),await i.write({type:Lf.Type.STATUS,status:jf.UNEXPECTED_MESSAGE},{signal:r}),void await e.close();if(!(t=>{if(null==t.peer)return!1;try{t.peer.addrs.forEach(Ud)}catch{return!1}return!0})(n))return this.log.error("invalid stop connect request via peer %p",t.remotePeer),await i.write({type:Lf.Type.STATUS,status:jf.MALFORMED_MESSAGE},{signal:r}),void await e.close();const s=rh(qt(n.peer.id));if(!0===await(this.connectionGater.denyInboundRelayedConnection?.(t.remotePeer,s)))return this.log.error("connection gater denied inbound relayed connection from %p",t.remotePeer),await i.write({type:Lf.Type.STATUS,status:jf.PERMISSION_DENIED},{signal:r}),void await e.close();this.log.trace("sending success response to %p",t.remotePeer),await i.write({type:Lf.Type.STATUS,status:jf.OK},{signal:r});const o=new Op(n.limit),a=t.remoteAddr.encapsulate(`/p2p-circuit/p2p/${s.toString()}`),h=this.addressManager.getAddresses()[0],u=rm({stream:i.unwrap().unwrap(),remoteAddr:a,localAddr:h,logger:this.logger,onDataRead:o.onData,onDataWrite:o.onData});this.log("new inbound relayed connection %a",u.remoteAddr),await this.upgrader.upgradeInbound(u,{limits:o.getLimits()}),this.log("%s connection %a upgraded","inbound",u.remoteAddr)}}function cm(t={}){return e=>new um(e,t)}const lm=()=>{const t=new Error("Delay aborted");return t.name="AbortError",t},dm=new WeakMap,fm=function({clearTimeout:t,setTimeout:e}={}){return(r,{value:i,signal:n}={})=>{if(n?.aborted)return Promise.reject(lm());let s,o,a;const h=t??clearTimeout,u=()=>{h(s),a(lm())},c=new Promise(((t,h)=>{o=()=>{n&&n.removeEventListener("abort",u),t(i)},a=h,s=(e??setTimeout)(o,r)}));return n&&n.addEventListener("abort",u,{once:!0}),dm.set(c,(()=>{h(s),s=null,o()})),c}}();var pm;function mm(t,e){return!xp.matches(t)&&(null!=e.dialTransportForMultiaddr(t)&&(!!np.matches(t)||!!cp.matches(t)&&!1===pd(t.toOptions().host)))}!function(t){let e,r,i;!function(t){t.UNUSED="UNUSED",t.CONNECT="CONNECT",t.SYNC="SYNC"}(e=t.Type||(t.Type={})),function(t){t[t.UNUSED=0]="UNUSED",t[t.CONNECT=100]="CONNECT",t[t.SYNC=300]="SYNC"}(r||(r={})),function(t){t.codec=()=>Rn(r)}(e=t.Type||(t.Type={})),t.codec=()=>(null==i&&(i=Dn(((e,r,i={})=>{if(!1!==i.lengthDelimited&&r.fork(),null!=e.type&&(r.uint32(8),t.Type.codec().encode(e.type,r)),null!=e.observedAddresses)for(const t of e.observedAddresses)r.uint32(18),r.bytes(t);!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={observedAddresses:[]},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.type=t.Type.codec().decode(e);break;case 2:if(null!=i.limits?.observedAddresses&&n.observedAddresses.length===i.limits.observedAddresses)throw new Nn('Decode error - map field "observedAddresses" had too many elements');n.observedAddresses.push(e.bytes());break;default:e.skipType(7&r)}}return n}))),i),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(pm||(pm={}));class gm{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(t,e){this.log=t.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=t.peerStore,this.registrar=t.registrar,this.addressManager=t.addressManager,this.connectionManager=t.connectionManager,this.transportManager=t.transportManager,this.timeout=e.timeout??5e3,this.retries=e.retries??3,this.maxInboundStreams=e.maxInboundStreams??1,this.maxOutboundStreams=e.maxOutboundStreams??1}[Symbol.toStringTag]="@libp2p/dcutr";[A]=["@libp2p/identify"];isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(bm,{notifyOnLimitedConnection:!0,onConnect:(t,e)=>{xp.exactMatch(e.remoteAddr)&&"inbound"===e.direction&&this.upgradeInbound(e).catch((t=>{this.log.error("error during outgoing DCUtR attempt",t)}))}}),await this.registrar.handle(bm,(t=>{this.handleIncomingUpgrade(t.stream,t.connection).catch((e=>{this.log.error("error during incoming DCUtR attempt",e),t.stream.abort(e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(bm),null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(t){if(await this.attemptUnilateralConnectionUpgrade(t))return;let e;for(let r=0;r<this.retries;r++){const i={signal:AbortSignal.timeout(this.timeout)};try{e=await t.newStream([bm],{signal:i.signal,runOnLimitedConnection:!0});const r=Fd(e,{maxDataLength:4096}).pb(pm);this.log("B sending connect to %p",t.remotePeer);const n=Date.now();await r.write({type:pm.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map((t=>t.bytes))},i),this.log("B receiving connect from %p",t.remotePeer);const s=await r.read(i);if(s.type!==pm.Type.CONNECT)throw this.log("A sent wrong message type"),new $("DCUtR message type was incorrect");const o=this.getDialableMultiaddrs(s.observedAddresses);if(0===o.length)throw this.log("A did not have any dialable multiaddrs"),new $("DCUtR connect message had no multiaddrs");const a=Date.now()-n;this.log("A sending sync, rtt %dms",a),await r.write({type:pm.Type.SYNC,observedAddresses:[]},i),this.log("A waiting for half RTT"),await fm(a/2),this.log("B dialing",o);const h=await this.connectionManager.openConnection(o,{signal:i.signal,priority:100});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",t.remotePeer,h.remoteAddr),await t.close(i);break}catch(t){if(this.log.error("error while attempting DCUtR on attempt %d of %d",r+1,this.retries,t),e?.abort(t),r===this.retries)throw t}finally{null!=e&&await e.close(i)}}}async attemptUnilateralConnectionUpgrade(t){const e=(await this.peerStore.get(t.remotePeer)).addresses.map((e=>{const r=e.multiaddr;return null==r.getPeerId()?r.encapsulate(`/p2p/${t.remotePeer}`):r})).filter((t=>mm(t,this.transportManager)));if(e.length>0){const r=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",e);const i=await this.connectionManager.openConnection(e,{signal:r,force:!0});if(xp.exactMatch(i.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",t.remotePeer,i.remoteAddr),await t.close({signal:r}),!0}catch(r){this.log.error("unilateral connection upgrade to %p on addresses %a failed",t.remotePeer,e,r)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",t.remotePeer);return!1}async handleIncomingUpgrade(t,e){const r={signal:AbortSignal.timeout(this.timeout)};try{const i=Fd(t,{maxDataLength:4096}).pb(pm);this.log("A receiving connect");const n=await i.read(r);if(n.type!==pm.Type.CONNECT)throw this.log("B sent wrong message type"),new $("DCUtR message type was incorrect");if(0===n.observedAddresses.length)throw this.log("B sent no multiaddrs"),new $("DCUtR connect message had no multiaddrs");const s=this.getDialableMultiaddrs(n.observedAddresses);if(0===s.length)throw this.log("B had no dialable multiaddrs"),new $("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await i.write({type:pm.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map((t=>t.bytes))}),this.log("A receiving sync"),(await i.read(r)).type!==pm.Type.SYNC)throw new $("DCUtR message type was incorrect");this.log("A dialing",s);const o=await this.connectionManager.openConnection(s,{signal:r.signal,priority:100,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",e.remotePeer,o.remoteAddr),await e.close(r)}catch(r){this.log.error("incoming DCUtR from %p failed",e.remotePeer,r),t.abort(r)}finally{await t.close(r)}}getDialableMultiaddrs(t){const e=[];for(const r of t)if(null!=r&&0!==r.length)try{const t=Ud(r);if(!mm(t,this.transportManager))continue;e.push(t)}catch{}return e}}const bm="/libp2p/dcutr";function ym(t={}){return e=>new gm(e,t)}const vm=1e3,wm=60*vm,Mm=60*wm,_m=24*Mm,Sm=7*_m,Em=function(t,e){try{if("string"==typeof t&&t.length>0)return function(t){if((t=String(t)).length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return NaN;const r=parseFloat(e[1]),i=(e[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return r*Sm;case"days":case"day":case"d":return r*_m;case"hours":case"hour":case"hrs":case"hr":case"h":return r*Mm;case"minutes":case"minute":case"mins":case"min":case"m":return r*wm;case"seconds":case"second":case"secs":case"sec":case"s":return r*vm;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw new Error(`The unit ${i} was matched, but no matching case exists.`)}}(t);if("number"==typeof t&&isFinite(t))return e?.long?function(t){const e=Math.abs(t);return e>=_m?km(t,e,_m,"day"):e>=Mm?km(t,e,Mm,"hour"):e>=wm?km(t,e,wm,"minute"):e>=vm?km(t,e,vm,"second"):`${t} ms`}(t):function(t){const e=Math.abs(t);return e>=_m?`${Math.round(t/_m)}d`:e>=Mm?`${Math.round(t/Mm)}h`:e>=wm?`${Math.round(t/wm)}m`:e>=vm?`${Math.round(t/vm)}s`:`${t}ms`}(t);throw new Error("Value is not a string or number.")}catch(e){const r=function(t){return"object"==typeof t&&null!==t&&"message"in t}(e)?`${e.message}. value=${JSON.stringify(t)}`:"An unknown error has occured.";throw new Error(r)}};function km(t,e,r,i){const n=e>=1.5*r;return`${Math.round(t/r)} ${i}${n?"s":""}`}const Am=function(){try{return localStorage}catch(t){}}(),Im=console.debug??console.log??(()=>{}),xm=function(t){function e(t){let i,n,s,o=null;function a(...t){if(!a.enabled)return;const r=a,n=Number(new Date),s=n-(i||n);r.diff=s,r.prev=i,r.curr=n,i=n,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((i,n)=>{if("%%"===i)return"%";o++;const s=e.formatters[n];if("function"==typeof s){const e=t[o];i=s.call(r,e),t.splice(o,1),o--}return i})),e.formatArgs.call(r,t),(r.log||e.log).apply(r,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=r,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==e.namespaces&&(n=e.namespaces,s=e.enabled(t)),s),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function r(t,r){const i=e(this.namespace+(void 0===r?":":r)+t);return i.log=this.log,i}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack??t.message:t},e.disable=function(){const t=[...e.names.map(i),...e.skips.map(i).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let r;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const i=("string"==typeof t?t:"").split(/[\s,]+/),n=i.length;for(r=0;r<n;r++)i[r]&&("-"===(t=i[r].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let r,i;for(r=0,i=e.skips.length;r<i;r++)if(e.skips[r].test(t))return!1;for(r=0,i=e.names.length;r<i;r++)if(e.names[r].test(t))return!0;return!1},e.humanize=Em,e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((r=>{e[r]=t[r]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return e.colors[Math.abs(r)%e.colors.length]},e.setupFormatters(e.formatters),e.enable(e.load()),e}({formatArgs:function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Em(this.diff),!this.useColors)return;const e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),t.splice(i,0,e)},save:function(t){try{t?Am?.setItem("debug",t):Am?.removeItem("debug")}catch(t){}},load:function(){let t;try{t=Am?.getItem("debug")}catch(t){}return!t&&void 0!==globalThis.process&&"env"in globalThis.process&&(t=globalThis.process.env.DEBUG),t},useColors:function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||null==navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement?.style?.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&null!=navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/))},setupFormatters:function(t){t.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},colors:["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],storage:Am,log:Im}),Cm=xm;function Tm(){return{forComponent:t=>Pm(t)}}function Pm(t){let e=function(t){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=t,e.destroy=()=>!0,e.extend=()=>e,e}(`${t}:trace`);return Cm.enabled(`${t}:trace`)&&null!=Cm.names.map((t=>t.toString())).find((t=>t.includes(":trace")))&&(e=Cm(`${t}:trace`)),Object.assign(Cm(t),{error:Cm(`${t}:error`),trace:e})}function Bm(t){if(null!=t&&0!==(t=t.trim()).length)return t}Cm.formatters.b=t=>null==t?"undefined":ct.baseEncode(t),Cm.formatters.t=t=>null==t?"undefined":dt.baseEncode(t),Cm.formatters.m=t=>null==t?"undefined":Fi.baseEncode(t),Cm.formatters.p=t=>null==t?"undefined":t.toString(),Cm.formatters.c=t=>null==t?"undefined":t.toString(),Cm.formatters.k=t=>null==t?"undefined":t.toString(),Cm.formatters.a=t=>null==t?"undefined":t.toString(),Cm.formatters.e=t=>null==t?"undefined":Bm(t.stack)??Bm(t.message)??t.toString();var Rm=r(5295);const Dm=Pm("libp2p:simple-metrics");class Nm{value=0;update(t){this.value=t}increment(t=1){this.value+=t}decrement(t=1){this.value-=t}reset(){this.value=0}timer(){const t=Date.now();return()=>{this.value=Date.now()-t}}}class Lm{values={};update(t){Object.entries(t).forEach((([t,e])=>{this.values[t]=e}))}increment(t){Object.entries(t).forEach((([t,e])=>{this.values[t]=this.values[t]??0;const r="number"==typeof e?e:1;this.values[t]+=Number(r)}))}decrement(t){Object.entries(t).forEach((([t,e])=>{this.values[t]=this.values[t]??0;const r="number"==typeof e?e:1;this.values[t]-=Number(r)}))}reset(){this.values={}}timer(t){const e=Date.now();return()=>{this.values[t]=Date.now()-e}}}class Om{bucketValues=new Map;countValue=0;sumValue=0;constructor(t){const e=[...t.buckets??[.005,.01,.025,.05,.1,.25,.5,1,2.5,5,10],1/0];for(const t of e)this.bucketValues.set(t,0)}observe(t){this.countValue++,this.sumValue+=t;for(const[e,r]of this.bucketValues.entries())t<=e&&this.bucketValues.set(e,r+1)}reset(){this.countValue=0,this.sumValue=0;for(const t of this.bucketValues.keys())this.bucketValues.set(t,0)}timer(){const t=Date.now();return()=>{this.observe(Date.now()-t)}}}class Um{histograms={};constructor(t){this.histograms={}}observe(t){for(const[e,r]of Object.entries(t))void 0===this.histograms[e]&&(this.histograms[e]=new Om({})),this.histograms[e].observe(r)}reset(){for(const t of Object.values(this.histograms))t.reset()}timer(t){const e=Date.now();return()=>{this.observe({[t]:Date.now()-e})}}}class Fm{sumValue=0;countValue=0;percentiles;tdigest=new Rm.TDigest(.01);compressCount;constructor(t){this.percentiles=t.percentiles??[.01,.05,.5,.9,.95,.99,.999],this.compressCount=t.compressCount??1e3}observe(t){this.sumValue+=t,this.countValue++,this.tdigest.push(t),this.tdigest.size()>this.compressCount&&this.tdigest.compress()}reset(){this.sumValue=0,this.countValue=0,this.tdigest.reset()}timer(){const t=Date.now();return()=>{this.observe(Date.now()-t)}}}class jm{summaries={};opts;constructor(t){this.summaries={},this.opts=t}observe(t){for(const[e,r]of Object.entries(t))void 0===this.summaries[e]&&(this.summaries[e]=new Fm(this.opts)),this.summaries[e].observe(r)}reset(){for(const t of Object.values(this.summaries))t.reset()}timer(t){const e=Date.now();return()=>{this.observe({[t]:Date.now()-e})}}}class Vm{metrics=new Map;transferStats;started;interval;intervalMs;onMetrics;constructor(t,e){this.started=!1,this._emitMetrics=this._emitMetrics.bind(this),this.intervalMs=e.intervalMs??1e3,this.onMetrics=e.onMetrics,this.transferStats=new Map}[Symbol.toStringTag]="@libp2p/metrics-simple";[k]=["@libp2p/metrics"];isStarted(){return this.started}start(){this.started=!0,this.interval=setInterval(this._emitMetrics,this.intervalMs)}stop(){this.started=!1,clearInterval(this.interval)}_emitMetrics(){Promise.resolve().then((async()=>{const t={};for(const[e,r]of this.metrics.entries())t[e]=r instanceof Nm?r.value:r instanceof Lm?r.values:r instanceof Om?{count:r.countValue,sum:r.sumValue,buckets:{...r.bucketValues}}:r instanceof Um?{...Object.fromEntries(Object.entries(r.histograms).map((([t,e])=>[t,{count:e.countValue,sum:e.sumValue,buckets:{...e.bucketValues}}])))}:r instanceof Fm?{count:r.countValue,sum:r.sumValue,percentiles:Object.fromEntries(r.percentiles.map((t=>[t,r.tdigest.percentile(t)])))}:r instanceof jm?{...Object.fromEntries(Object.entries(r.summaries).map((([t,e])=>[t,{count:e.countValue,sum:e.sumValue,percentiles:Object.fromEntries(e.percentiles.map((t=>[t,e.tdigest.percentile(t)])))}])))}:await r();this.onMetrics(structuredClone(t))})).catch((t=>{Dm.error("could not invoke onMetrics callback",t)}))}_incrementValue(t,e){const r=this.transferStats.get(t)??0;this.transferStats.set(t,r+e)}_track(t,e){const r=this,i=t.sink;t.sink=async function(t){await i(ql(t,(t=>{r._incrementValue(`${e} sent`,t.byteLength)})))};const n=t.source;t.source=ql(n,(t=>{r._incrementValue(`${e} received`,t.byteLength)}))}trackMultiaddrConnection(t){this._track(t,"global")}trackProtocolStream(t,e){null!=t.protocol&&this._track(t,t.protocol)}registerMetric(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Nm;return this.metrics.set(t,r),r}registerMetricGroup(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Lm;return this.metrics.set(t,r),r}registerCounter(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Nm;return this.metrics.set(t,r),r}registerCounterGroup(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Lm;return this.metrics.set(t,r),r}registerHistogram(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Om(e);return this.metrics.set(t,r),r}registerHistogramGroup(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Um(e);return this.metrics.set(t,r),r}registerSummary(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new Fm(e);return this.metrics.set(t,r),r}registerSummaryGroup(t,e={}){if(null==t||""===t.trim())throw new Error("Metric name is required");if(null!=e?.calculate)return void this.metrics.set(t,e.calculate);const r=new jm(e);return this.metrics.set(t,r),r}}class qm extends Error{constructor(t="Method not found"){super(t),this.name="MethodNotFoundError"}}class zm extends Error{constructor(t="Invocation target was not a function"){super(t),this.name="InvalidMethodError"}}class Hm extends Error{constructor(t="Unsupported value type"){super(t),this.name="UnsupportedValueTypeError"}}class $m extends Error{constructor(t="Cannot reuse RPC target name"){super(t),this.name="DuplicateTargetNameError"}}class Wm extends Error{constructor(t="Duplicate scope"){super(t),this.name="DuplicateScopeError"}}class Km extends Error{constructor(t="Invalid return type"){super(t),this.name="InvalidReturnTypeError"}}class Gm extends Error{constructor(t="Invocation target was not a function"){super(t),this.name="InvalidInvocationTypeError"}}class Zm extends Error{constructor(t="Parent invocation scope not found"){super(t),this.name="MissingParentScopeError"}}class Ym extends Error{constructor(t="Invocation not found"){super(t),this.name="MissingInvocationError"}}class Jm extends Error{constructor(t="Callback not found"){super(t),this.name="MissingCallbackError"}}var Xm,Qm,tg,eg,rg,ig,ng,sg,og,ag,hg,ug;function cg(t,e){if(function(t){return null!=t.parents}(t))return function(t,e){let r;for(const i of t)if(null!=r){if(r=r.children.get(i),null==r)throw new Zm}else if(r=e.get(i),null==r)throw new Zm;if(null==r)throw new Zm;return r}(t.parents,e);const r=e.get(t.scope);if(null==r)throw new Ym;return r}!function(t){t.invokeMethod="invokeMethod",t.methodResolved="methodResolved",t.methodRejected="methodRejected",t.invokeGeneratorMethod="invokeGeneratorMethod",t.abortMethodInvocation="abortMethodInvocation",t.invokeCallback="invokeCallback",t.callbackResolved="callbackResolved",t.callbackRejected="callbackRejected",t.abortCallbackInvocation="abortCallbackInvocation"}(Xm||(Xm={})),function(t){t[t.invokeMethod=0]="invokeMethod",t[t.methodResolved=1]="methodResolved",t[t.methodRejected=2]="methodRejected",t[t.invokeGeneratorMethod=3]="invokeGeneratorMethod",t[t.abortMethodInvocation=4]="abortMethodInvocation",t[t.invokeCallback=5]="invokeCallback",t[t.callbackResolved=6]="callbackResolved",t[t.callbackRejected=7]="callbackRejected",t[t.abortCallbackInvocation=8]="abortCallbackInvocation"}(Qm||(Qm={})),function(t){t.codec=()=>Rn(Qm)}(Xm||(Xm={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.type&&0!==t.type&&(e.uint32(8),e.uint32(t.type)),null!=t.value&&(e.uint32(18),e.bytes(t.value)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={type:0},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.type=t.uint32();break;case 2:i.value=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(tg||(tg={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.type&&0!==Qm[t.type]&&(e.uint32(8),Xm.codec().encode(t.type,e)),null!=t.message&&t.message.byteLength>0&&(e.uint32(18),e.bytes(t.message)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={type:Xm.invokeMethod,message:Qr(0)},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.type=Xm.codec().decode(t);break;case 2:i.message=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(eg||(eg={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.path&&""!==t.path&&(e.uint32(18),e.string(t.path)),null!=t.args)for(const r of t.args)e.uint32(26),tg.codec().encode(r,e);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:"",path:"",args:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:i.path=t.string();break;case 3:if(null!=r.limits?.args&&i.args.length===r.limits.args)throw new Nn('Decode error - map field "args" had too many elements');i.args.push(tg.codec().decode(t,t.uint32(),{limits:r.limits?.args$}));break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(rg||(rg={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:""},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();e>>>3==1?i.scope=t.string():t.skipType(7&e)}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(ig||(ig={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.value&&(e.uint32(18),tg.codec().encode(t.value,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:""},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:i.value=tg.codec().decode(t,t.uint32(),{limits:r.limits?.value});break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(ng||(ng={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.error&&(e.uint32(18),tg.codec().encode(t.error,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:""},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:i.error=tg.codec().decode(t,t.uint32(),{limits:r.limits?.error});break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(sg||(sg={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.parents)for(const r of t.parents)e.uint32(18),e.string(r);if(null!=t.callback&&""!==t.callback&&(e.uint32(26),e.string(t.callback)),null!=t.args)for(const r of t.args)e.uint32(34),tg.codec().encode(r,e);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:"",parents:[],callback:"",args:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:if(null!=r.limits?.parents&&i.parents.length===r.limits.parents)throw new Nn('Decode error - map field "parents" had too many elements');i.parents.push(t.string());break;case 3:i.callback=t.string();break;case 4:if(null!=r.limits?.args&&i.args.length===r.limits.args)throw new Nn('Decode error - map field "args" had too many elements');i.args.push(tg.codec().decode(t,t.uint32(),{limits:r.limits?.args$}));break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(og||(og={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.parents)for(const r of t.parents)e.uint32(18),e.string(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:"",parents:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:if(null!=r.limits?.parents&&i.parents.length===r.limits.parents)throw new Nn('Decode error - map field "parents" had too many elements');i.parents.push(t.string());break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(ag||(ag={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.parents)for(const r of t.parents)e.uint32(18),e.string(r);null!=t.value&&(e.uint32(26),tg.codec().encode(t.value,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:"",parents:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:if(null!=r.limits?.parents&&i.parents.length===r.limits.parents)throw new Nn('Decode error - map field "parents" had too many elements');i.parents.push(t.string());break;case 3:i.value=tg.codec().decode(t,t.uint32(),{limits:r.limits?.value});break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(hg||(hg={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.scope&&""!==t.scope&&(e.uint32(10),e.string(t.scope)),null!=t.parents)for(const r of t.parents)e.uint32(18),e.string(r);null!=t.error&&(e.uint32(26),tg.codec().encode(t.error,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={scope:"",parents:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.scope=t.string();break;case 2:if(null!=r.limits?.parents&&i.parents.length===r.limits.parents)throw new Nn('Decode error - map field "parents" had too many elements');i.parents.push(t.string());break;case 3:i.error=tg.codec().decode(t,t.uint32(),{limits:r.limits?.error});break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(ug||(ug={}));const lg=["string","number","bigint","symbol"],dg=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class fg{constructor(t,e,r){this.major=t,this.majorEncoded=t<<5,this.name=e,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}}fg.uint=new fg(0,"uint",!0),fg.negint=new fg(1,"negint",!0),fg.bytes=new fg(2,"bytes",!0),fg.string=new fg(3,"string",!0),fg.array=new fg(4,"array",!1),fg.map=new fg(5,"map",!1),fg.tag=new fg(6,"tag",!1),fg.float=new fg(7,"float",!0),fg.false=new fg(7,"false",!0),fg.true=new fg(7,"true",!0),fg.null=new fg(7,"null",!0),fg.undefined=new fg(7,"undefined",!0),fg.break=new fg(7,"break",!0);class pg{constructor(t,e,r){this.type=t,this.value=e,this.encodedLength=r,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const mg=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,gg=new TextDecoder,bg=new TextEncoder;function yg(t){return mg&&globalThis.Buffer.isBuffer(t)}function vg(t){return t instanceof Uint8Array?yg(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t:Uint8Array.from(t)}const wg=mg?(t,e,r)=>r-e>64?globalThis.Buffer.from(t.subarray(e,r)).toString("utf8"):Ig(t,e,r):(t,e,r)=>r-e>64?gg.decode(t.subarray(e,r)):Ig(t,e,r),Mg=mg?t=>t.length>64?globalThis.Buffer.from(t):Ag(t):t=>t.length>64?bg.encode(t):Ag(t),_g=t=>Uint8Array.from(t),Sg=mg?(t,e,r)=>yg(t)?new Uint8Array(t.subarray(e,r)):t.slice(e,r):(t,e,r)=>t.slice(e,r),Eg=mg?(t,e)=>(t=t.map((t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t))),vg(globalThis.Buffer.concat(t,e))):(t,e)=>{const r=new Uint8Array(e);let i=0;for(let e of t)i+e.length>r.length&&(e=e.subarray(0,r.length-i)),r.set(e,i),i+=e.length;return r},kg=mg?t=>globalThis.Buffer.allocUnsafe(t):t=>new Uint8Array(t);function Ag(t){const e=[];let r=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);n<128?e[r++]=n:n<2048?(e[r++]=n>>6|192,e[r++]=63&n|128):55296==(64512&n)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++i)),e[r++]=n>>18|240,e[r++]=n>>12&63|128,e[r++]=n>>6&63|128,e[r++]=63&n|128):(e[r++]=n>>12|224,e[r++]=n>>6&63|128,e[r++]=63&n|128)}return e}function Ig(t,e,r){const i=[];for(;e<r;){const n=t[e];let s=null,o=n>239?4:n>223?3:n>191?2:1;if(e+o<=r){let r,i,a,h;switch(o){case 1:n<128&&(s=n);break;case 2:r=t[e+1],128==(192&r)&&(h=(31&n)<<6|63&r,h>127&&(s=h));break;case 3:r=t[e+1],i=t[e+2],128==(192&r)&&128==(192&i)&&(h=(15&n)<<12|(63&r)<<6|63&i,h>2047&&(h<55296||h>57343)&&(s=h));break;case 4:r=t[e+1],i=t[e+2],a=t[e+3],128==(192&r)&&128==(192&i)&&128==(192&a)&&(h=(15&n)<<18|(63&r)<<12|(63&i)<<6|63&a,h>65535&&h<1114112&&(s=h))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),e+=o}return function(t){const e=t.length;if(e<=xg)return String.fromCharCode.apply(String,t);let r="",i=0;for(;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=xg));return r}(i)}const xg=4096;class Cg{constructor(t=256){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let e=this.chunks[this.chunks.length-1];if(this.cursor+t.length<=this.maxCursor+1){const r=e.length-(this.maxCursor-this.cursor)-1;e.set(t,r)}else{if(e){const t=e.length-(this.maxCursor-this.cursor)-1;t<e.length&&(this.chunks[this.chunks.length-1]=e.subarray(0,t),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(e=kg(this.chunkSize),this.chunks.push(e),this.maxCursor+=e.length,null===this._initReuseChunk&&(this._initReuseChunk=e),e.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let e;if(1===this.chunks.length){const r=this.chunks[0];t&&this.cursor>r.length/2?(e=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=Sg(r,0,this.cursor)}else e=Eg(this.chunks,this.cursor);return t&&this.reset(),e}}const Tg="CBOR decode error:",Pg="CBOR encode error:",Bg=[];function Rg(t,e,r){if(t.length-e<r)throw new Error(`${Tg} not enough data for type`)}Bg[23]=1,Bg[24]=2,Bg[25]=3,Bg[26]=5,Bg[27]=9;const Dg=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Ng(t,e,r){Rg(t,e,1);const i=t[e];if(!0===r.strict&&i<Dg[0])throw new Error(`${Tg} integer encoded in more bytes than necessary (strict decode)`);return i}function Lg(t,e,r){Rg(t,e,2);const i=t[e]<<8|t[e+1];if(!0===r.strict&&i<Dg[1])throw new Error(`${Tg} integer encoded in more bytes than necessary (strict decode)`);return i}function Og(t,e,r){Rg(t,e,4);const i=16777216*t[e]+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];if(!0===r.strict&&i<Dg[2])throw new Error(`${Tg} integer encoded in more bytes than necessary (strict decode)`);return i}function Ug(t,e,r){Rg(t,e,8);const i=16777216*t[e]+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3],n=16777216*t[e+4]+(t[e+5]<<16)+(t[e+6]<<8)+t[e+7],s=(BigInt(i)<<BigInt(32))+BigInt(n);if(!0===r.strict&&s<Dg[3])throw new Error(`${Tg} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===r.allowBigInt)return s;throw new Error(`${Tg} integers outside of the safe integer range are not supported`)}function Fg(t,e){return jg(t,0,e.value)}function jg(t,e,r){if(r<Dg[0]){const i=Number(r);t.push([e|i])}else if(r<Dg[1]){const i=Number(r);t.push([24|e,i])}else if(r<Dg[2]){const i=Number(r);t.push([25|e,i>>>8,255&i])}else if(r<Dg[3]){const i=Number(r);t.push([26|e,i>>>24&255,i>>>16&255,i>>>8&255,255&i])}else{const i=BigInt(r);if(!(i<Dg[4]))throw new Error(`${Tg} encountered BigInt larger than allowable range`);{const r=[27|e,0,0,0,0,0,0,0];let n=Number(i&BigInt(4294967295)),s=Number(i>>BigInt(32)&BigInt(4294967295));r[8]=255&n,n>>=8,r[7]=255&n,n>>=8,r[6]=255&n,n>>=8,r[5]=255&n,r[4]=255&s,s>>=8,r[3]=255&s,s>>=8,r[2]=255&s,s>>=8,r[1]=255&s,t.push(r)}}}Fg.encodedSize=function(t){return jg.encodedSize(t.value)},jg.encodedSize=function(t){return t<Dg[0]?1:t<Dg[1]?2:t<Dg[2]?3:t<Dg[3]?5:9},Fg.compareTokens=function(t,e){return t.value<e.value?-1:t.value>e.value?1:0};const Vg=BigInt(-1),qg=BigInt(1);function zg(t,e){const r=e.value,i="bigint"==typeof r?r*Vg-qg:-1*r-1;jg(t,e.type.majorEncoded,i)}function Hg(t,e,r,i){Rg(t,e,r+i);const n=Sg(t,e+r,e+r+i);return new pg(fg.bytes,n,r+i)}function $g(t,e,r,i){return Hg(t,e,1,r)}function Wg(t){return void 0===t.encodedBytes&&(t.encodedBytes=t.type===fg.string?Mg(t.value):t.value),t.encodedBytes}function Kg(t,e){const r=Wg(e);jg(t,e.type.majorEncoded,r.length),t.push(r)}function Gg(t,e,r,i,n){const s=r+i;Rg(t,e,s);const o=new pg(fg.string,wg(t,e+r,e+s),s);return!0===n.retainStringBytes&&(o.byteValue=Sg(t,e+r,e+s)),o}function Zg(t,e,r,i){return Gg(t,e,1,r,i)}zg.encodedSize=function(t){const e=t.value,r="bigint"==typeof e?e*Vg-qg:-1*e-1;return r<Dg[0]?1:r<Dg[1]?2:r<Dg[2]?3:r<Dg[3]?5:9},zg.compareTokens=function(t,e){return t.value<e.value?1:t.value>e.value?-1:0},Kg.encodedSize=function(t){const e=Wg(t);return jg.encodedSize(e.length)+e.length},Kg.compareTokens=function(t,e){return r=Wg(t),i=Wg(e),r.length<i.length?-1:r.length>i.length?1:function(t,e){if(yg(t)&&yg(e))return t.compare(e);for(let r=0;r<t.length;r++)if(t[r]!==e[r])return t[r]<e[r]?-1:1;return 0}(r,i);var r,i};const Yg=Kg;function Jg(t,e,r,i){return new pg(fg.array,i,r)}function Xg(t,e,r,i){return Jg(0,0,1,r)}function Qg(t,e){jg(t,fg.array.majorEncoded,e.value)}function tb(t,e,r,i){return new pg(fg.map,i,r)}function eb(t,e,r,i){return tb(0,0,1,r)}function rb(t,e){jg(t,fg.map.majorEncoded,e.value)}function ib(t,e,r,i){return new pg(fg.tag,r,1)}function nb(t,e){jg(t,fg.tag.majorEncoded,e.value)}function sb(t,e,r){if(r){if(!1===r.allowNaN&&Number.isNaN(t))throw new Error(`${Tg} NaN values are not supported`);if(!1===r.allowInfinity&&(t===1/0||t===-1/0))throw new Error(`${Tg} Infinity values are not supported`)}return new pg(fg.float,t,e)}function ob(t,e,r){const i=e.value;if(!1===i)t.push([20|fg.float.majorEncoded]);else if(!0===i)t.push([21|fg.float.majorEncoded]);else if(null===i)t.push([22|fg.float.majorEncoded]);else if(void 0===i)t.push([23|fg.float.majorEncoded]);else{let e,s=!1;r&&!0===r.float64||(cb(i),e=lb(ub,1),i===e||Number.isNaN(i)?(ub[0]=249,t.push(ub.slice(0,3)),s=!0):(db(i),e=fb(ub,1),i===e&&(ub[0]=250,t.push(ub.slice(0,5)),s=!0))),s||(n=i,hb.setFloat64(0,n,!1),e=pb(ub,1),ub[0]=251,t.push(ub.slice(0,9)))}var n}Qg.compareTokens=Fg.compareTokens,Qg.encodedSize=function(t){return jg.encodedSize(t.value)},rb.compareTokens=Fg.compareTokens,rb.encodedSize=function(t){return jg.encodedSize(t.value)},nb.compareTokens=Fg.compareTokens,nb.encodedSize=function(t){return jg.encodedSize(t.value)},ob.encodedSize=function(t,e){const r=t.value;if(!1===r||!0===r||null==r)return 1;if(!e||!0!==e.float64){cb(r);let t=lb(ub,1);if(r===t||Number.isNaN(r))return 3;if(db(r),t=fb(ub,1),r===t)return 5}return 9};const ab=new ArrayBuffer(9),hb=new DataView(ab,1),ub=new Uint8Array(ab,0);function cb(t){if(t===1/0)hb.setUint16(0,31744,!1);else if(t===-1/0)hb.setUint16(0,64512,!1);else if(Number.isNaN(t))hb.setUint16(0,32256,!1);else{hb.setFloat32(0,t);const e=hb.getUint32(0),r=(2139095040&e)>>23,i=8388607&e;if(255===r)hb.setUint16(0,31744,!1);else if(0===r)hb.setUint16(0,(2147483648&t)>>16|i>>13,!1);else{const t=r-127;t<-24?hb.setUint16(0,0):t<-14?hb.setUint16(0,(2147483648&e)>>16|1<<24+t,!1):hb.setUint16(0,(2147483648&e)>>16|t+15<<10|i>>13,!1)}}}function lb(t,e){if(t.length-e<2)throw new Error(`${Tg} not enough data for float16`);const r=(t[e]<<8)+t[e+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const i=r>>10&31,n=1023&r;let s;return s=0===i?n*2**-24:31!==i?(n+1024)*2**(i-25):0===n?1/0:NaN,32768&r?-s:s}function db(t){hb.setFloat32(0,t,!1)}function fb(t,e){if(t.length-e<4)throw new Error(`${Tg} not enough data for float32`);const r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,4).getFloat32(0,!1)}function pb(t,e){if(t.length-e<8)throw new Error(`${Tg} not enough data for float64`);const r=(t.byteOffset||0)+e;return new DataView(t.buffer,r,8).getFloat64(0,!1)}function mb(t,e,r){throw new Error(`${Tg} encountered invalid minor (${r}) for major ${t[e]>>>5}`)}function gb(t){return()=>{throw new Error(`${Tg} ${t}`)}}ob.compareTokens=Fg.compareTokens;const bb=[];for(let t=0;t<=23;t++)bb[t]=mb;bb[24]=function(t,e,r,i){return new pg(fg.uint,Ng(t,e+1,i),2)},bb[25]=function(t,e,r,i){return new pg(fg.uint,Lg(t,e+1,i),3)},bb[26]=function(t,e,r,i){return new pg(fg.uint,Og(t,e+1,i),5)},bb[27]=function(t,e,r,i){return new pg(fg.uint,Ug(t,e+1,i),9)},bb[28]=mb,bb[29]=mb,bb[30]=mb,bb[31]=mb;for(let t=32;t<=55;t++)bb[t]=mb;bb[56]=function(t,e,r,i){return new pg(fg.negint,-1-Ng(t,e+1,i),2)},bb[57]=function(t,e,r,i){return new pg(fg.negint,-1-Lg(t,e+1,i),3)},bb[58]=function(t,e,r,i){return new pg(fg.negint,-1-Og(t,e+1,i),5)},bb[59]=function(t,e,r,i){const n=Ug(t,e+1,i);if("bigint"!=typeof n){const t=-1-n;if(t>=Number.MIN_SAFE_INTEGER)return new pg(fg.negint,t,9)}if(!0!==i.allowBigInt)throw new Error(`${Tg} integers outside of the safe integer range are not supported`);return new pg(fg.negint,Vg-BigInt(n),9)},bb[60]=mb,bb[61]=mb,bb[62]=mb,bb[63]=mb;for(let t=64;t<=87;t++)bb[t]=$g;bb[88]=function(t,e,r,i){return Hg(t,e,2,Ng(t,e+1,i))},bb[89]=function(t,e,r,i){return Hg(t,e,3,Lg(t,e+1,i))},bb[90]=function(t,e,r,i){return Hg(t,e,5,Og(t,e+1,i))},bb[91]=function(t,e,r,i){const n=Ug(t,e+1,i);if("bigint"==typeof n)throw new Error(`${Tg} 64-bit integer bytes lengths not supported`);return Hg(t,e,9,n)},bb[92]=mb,bb[93]=mb,bb[94]=mb,bb[95]=gb("indefinite length bytes/strings are not supported");for(let t=96;t<=119;t++)bb[t]=Zg;bb[120]=function(t,e,r,i){return Gg(t,e,2,Ng(t,e+1,i),i)},bb[121]=function(t,e,r,i){return Gg(t,e,3,Lg(t,e+1,i),i)},bb[122]=function(t,e,r,i){return Gg(t,e,5,Og(t,e+1,i),i)},bb[123]=function(t,e,r,i){const n=Ug(t,e+1,i);if("bigint"==typeof n)throw new Error(`${Tg} 64-bit integer string lengths not supported`);return Gg(t,e,9,n,i)},bb[124]=mb,bb[125]=mb,bb[126]=mb,bb[127]=gb("indefinite length bytes/strings are not supported");for(let t=128;t<=151;t++)bb[t]=Xg;bb[152]=function(t,e,r,i){return Jg(0,0,2,Ng(t,e+1,i))},bb[153]=function(t,e,r,i){return Jg(0,0,3,Lg(t,e+1,i))},bb[154]=function(t,e,r,i){return Jg(0,0,5,Og(t,e+1,i))},bb[155]=function(t,e,r,i){const n=Ug(t,e+1,i);if("bigint"==typeof n)throw new Error(`${Tg} 64-bit integer array lengths not supported`);return Jg(0,0,9,n)},bb[156]=mb,bb[157]=mb,bb[158]=mb,bb[159]=function(t,e,r,i){if(!1===i.allowIndefinite)throw new Error(`${Tg} indefinite length items not allowed`);return Jg(0,0,1,1/0)};for(let t=160;t<=183;t++)bb[t]=eb;bb[184]=function(t,e,r,i){return tb(0,0,2,Ng(t,e+1,i))},bb[185]=function(t,e,r,i){return tb(0,0,3,Lg(t,e+1,i))},bb[186]=function(t,e,r,i){return tb(0,0,5,Og(t,e+1,i))},bb[187]=function(t,e,r,i){const n=Ug(t,e+1,i);if("bigint"==typeof n)throw new Error(`${Tg} 64-bit integer map lengths not supported`);return tb(0,0,9,n)},bb[188]=mb,bb[189]=mb,bb[190]=mb,bb[191]=function(t,e,r,i){if(!1===i.allowIndefinite)throw new Error(`${Tg} indefinite length items not allowed`);return tb(0,0,1,1/0)};for(let t=192;t<=215;t++)bb[t]=ib;bb[216]=function(t,e,r,i){return new pg(fg.tag,Ng(t,e+1,i),2)},bb[217]=function(t,e,r,i){return new pg(fg.tag,Lg(t,e+1,i),3)},bb[218]=function(t,e,r,i){return new pg(fg.tag,Og(t,e+1,i),5)},bb[219]=function(t,e,r,i){return new pg(fg.tag,Ug(t,e+1,i),9)},bb[220]=mb,bb[221]=mb,bb[222]=mb,bb[223]=mb;for(let t=224;t<=243;t++)bb[t]=gb("simple values are not supported");bb[244]=mb,bb[245]=mb,bb[246]=mb,bb[247]=function(t,e,r,i){if(!1===i.allowUndefined)throw new Error(`${Tg} undefined values are not supported`);return!0===i.coerceUndefinedToNull?new pg(fg.null,null,1):new pg(fg.undefined,void 0,1)},bb[248]=gb("simple values are not supported"),bb[249]=function(t,e,r,i){return sb(lb(t,e+1),3,i)},bb[250]=function(t,e,r,i){return sb(fb(t,e+1),5,i)},bb[251]=function(t,e,r,i){return sb(pb(t,e+1),9,i)},bb[252]=mb,bb[253]=mb,bb[254]=mb,bb[255]=function(t,e,r,i){if(!1===i.allowIndefinite)throw new Error(`${Tg} indefinite length items not allowed`);return new pg(fg.break,void 0,1)};const yb=[];for(let t=0;t<24;t++)yb[t]=new pg(fg.uint,t,1);for(let t=-1;t>=-24;t--)yb[31-t]=new pg(fg.negint,t,1);yb[64]=new pg(fg.bytes,new Uint8Array(0),1),yb[96]=new pg(fg.string,"",1),yb[128]=new pg(fg.array,0,1),yb[160]=new pg(fg.map,0,1),yb[244]=new pg(fg.false,!1,1),yb[245]=new pg(fg.true,!0,1),yb[246]=new pg(fg.null,null,1);const vb={float64:!1,mapSorter:function(t,e){const r=Array.isArray(t[0])?t[0][0]:t[0],i=Array.isArray(e[0])?e[0][0]:e[0];if(r.type!==i.type)return r.type.compare(i.type);const n=r.type.major,s=wb[n].compareTokens(r,i);return 0===s&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s},quickEncodeToken:function(t){switch(t.type){case fg.false:return _g([244]);case fg.true:return _g([245]);case fg.null:return _g([246]);case fg.bytes:return t.value.length?void 0:_g([64]);case fg.string:return""===t.value?_g([96]):void 0;case fg.array:return 0===t.value?_g([128]):void 0;case fg.map:return 0===t.value?_g([160]):void 0;case fg.uint:return t.value<24?_g([Number(t.value)]):void 0;case fg.negint:if(t.value>=-24)return _g([31-Number(t.value)])}}},wb=function(){const t=[];return t[fg.uint.major]=Fg,t[fg.negint.major]=zg,t[fg.bytes.major]=Kg,t[fg.string.major]=Yg,t[fg.array.major]=Qg,t[fg.map.major]=rb,t[fg.tag.major]=nb,t[fg.float.major]=ob,t}(),Mb=new Cg;class _b{constructor(t,e){this.obj=t,this.parent=e}includes(t){let e=this;do{if(e.obj===t)return!0}while(e=e.parent);return!1}static createCheck(t,e){if(t&&t.includes(e))throw new Error(`${Pg} object contains circular references`);return new _b(e,t)}}const Sb={null:new pg(fg.null,null),undefined:new pg(fg.undefined,void 0),true:new pg(fg.true,!0),false:new pg(fg.false,!1),emptyArray:new pg(fg.array,0),emptyMap:new pg(fg.map,0)},Eb={number:(t,e,r,i)=>Number.isInteger(t)&&Number.isSafeInteger(t)?new pg(t>=0?fg.uint:fg.negint,t):new pg(fg.float,t),bigint:(t,e,r,i)=>t>=BigInt(0)?new pg(fg.uint,t):new pg(fg.negint,t),Uint8Array:(t,e,r,i)=>new pg(fg.bytes,t),string:(t,e,r,i)=>new pg(fg.string,t),boolean:(t,e,r,i)=>t?Sb.true:Sb.false,null:(t,e,r,i)=>Sb.null,undefined:(t,e,r,i)=>Sb.undefined,ArrayBuffer:(t,e,r,i)=>new pg(fg.bytes,new Uint8Array(t)),DataView:(t,e,r,i)=>new pg(fg.bytes,new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),Array(t,e,r,i){if(!t.length)return!0===r.addBreakTokens?[Sb.emptyArray,new pg(fg.break)]:Sb.emptyArray;i=_b.createCheck(i,t);const n=[];let s=0;for(const e of t)n[s++]=kb(e,r,i);return r.addBreakTokens?[new pg(fg.array,t.length),n,new pg(fg.break)]:[new pg(fg.array,t.length),n]},Object(t,e,r,i){const n="Object"!==e,s=n?t.keys():Object.keys(t),o=n?t.size:s.length;if(!o)return!0===r.addBreakTokens?[Sb.emptyMap,new pg(fg.break)]:Sb.emptyMap;i=_b.createCheck(i,t);const a=[];let h=0;for(const e of s)a[h++]=[kb(e,r,i),kb(n?t.get(e):t[e],r,i)];return function(t,e){e.mapSorter&&t.sort(e.mapSorter)}(a,r),r.addBreakTokens?[new pg(fg.map,o),a,new pg(fg.break)]:[new pg(fg.map,o),a]}};Eb.Map=Eb.Object,Eb.Buffer=Eb.Uint8Array;for(const t of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Eb[`${t}Array`]=Eb.DataView;function kb(t,e={},r){const i=function(t){if(null===t)return"null";if(void 0===t)return"undefined";if(!0===t||!1===t)return"boolean";const e=typeof t;if(lg.includes(e))return e;if("function"===e)return"Function";if(Array.isArray(t))return"Array";if(function(t){return t&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t)}(t))return"Buffer";return function(t){const e=Object.prototype.toString.call(t).slice(8,-1);if(dg.includes(e))return e}(t)||"Object"}(t),n=e&&e.typeEncoders&&e.typeEncoders[i]||Eb[i];if("function"==typeof n){const s=n(t,i,e,r);if(null!=s)return s}const s=Eb[i];if(!s)throw new Error(`${Pg} unsupported type: ${i}`);return s(t,i,e,r)}function Ab(t,e,r,i){if(Array.isArray(e))for(const n of e)Ab(t,n,r,i);else r[e.type.major](t,e,i)}function Ib(t,e,r){const i=kb(t,r);if(!Array.isArray(i)&&r.quickEncodeToken){const t=r.quickEncodeToken(i);if(t)return t;const n=e[i.type.major];if(n.encodedSize){const t=n.encodedSize(i,r),e=new Cg(t);if(n(e,i,r),1!==e.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${i} was wrong`);return vg(e.chunks[0])}}return Mb.reset(),Ab(Mb,i,e,r),Mb.toBytes(!0)}function xb(t,e){return e=Object.assign({},vb,e),Ib(t,wb,e)}const Cb={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Tb{constructor(t,e={}){this._pos=0,this.data=t,this.options=e}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const t=this.data[this._pos];let e=yb[t];if(void 0===e){const r=bb[t];if(!r)throw new Error(`${Tg} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);const i=31&t;e=r(this.data,this._pos,i,this.options)}return this._pos+=e.encodedLength,e}}const Pb=Symbol.for("DONE"),Bb=Symbol.for("BREAK");function Rb(t,e){if(t.done())return Pb;const r=t.next();if(r.type===fg.break)return Bb;if(r.type.terminal)return r.value;if(r.type===fg.array)return function(t,e,r){const i=[];for(let n=0;n<t.value;n++){const s=Rb(e,r);if(s===Bb){if(t.value===1/0)break;throw new Error(`${Tg} got unexpected break to lengthed array`)}if(s===Pb)throw new Error(`${Tg} found array but not enough entries (got ${n}, expected ${t.value})`);i[n]=s}return i}(r,t,e);if(r.type===fg.map)return function(t,e,r){const i=!0===r.useMaps,n=i?void 0:{},s=i?new Map:void 0;for(let o=0;o<t.value;o++){const a=Rb(e,r);if(a===Bb){if(t.value===1/0)break;throw new Error(`${Tg} got unexpected break to lengthed map`)}if(a===Pb)throw new Error(`${Tg} found map but not enough entries (got ${o} [no key], expected ${t.value})`);if(!0!==i&&"string"!=typeof a)throw new Error(`${Tg} non-string keys not supported (got ${typeof a})`);if(!0===r.rejectDuplicateMapKeys&&(i&&s.has(a)||!i&&a in n))throw new Error(`${Tg} found repeat map key "${a}"`);const h=Rb(e,r);if(h===Pb)throw new Error(`${Tg} found map but not enough entries (got ${o} [no value], expected ${t.value})`);i?s.set(a,h):n[a]=h}return i?s:n}(r,t,e);if(r.type===fg.tag){if(e.tags&&"function"==typeof e.tags[r.value]){const i=Rb(t,e);return e.tags[r.value](i)}throw new Error(`${Tg} tag not supported (${r.value})`)}throw new Error("unsupported")}function Db(t,e){const[r,i]=function(t,e){if(!(t instanceof Uint8Array))throw new Error(`${Tg} data to decode must be a Uint8Array`);const r=(e=Object.assign({},Cb,e)).tokenizer||new Tb(t,e),i=Rb(r,e);if(i===Pb)throw new Error(`${Tg} did not find any content to decode`);if(i===Bb)throw new Error(`${Tg} got unexpected break`);return[i,t.subarray(r.pos())]}(t,e);if(i.length>0)throw new Error(`${Tg} too many terminals, data makes no sense`);return r}const Nb={type:1029,canEncode:t=>Array.isArray(t),encode:(t,e,r,i)=>xb(t.map((t=>e.toValue(t,r,i)))),decode:(t,e,r,i)=>Db(t).map((t=>e.fromValue(t,r,i)))},Lb={type:1030,canEncode:t=>"function"==typeof t,encode:(t,e,r,i)=>{const n=am();return i?.callbacks.set(n,{context:r,fn:t}),xb(n)},decode:(t,e,r,i)=>async(...n)=>new Promise(((s,o)=>{const a=Db(t),h=am(),u={scope:h,result:vh(),callbacks:new Map,children:new Map,parents:[...i.parents,i.scope],abortControllers:[],abortSignals:[]};i.children.set(h,u),n=n.map((t=>e.toValue(t,null,u)));const c=Ed(u.abortSignals);c.addEventListener("abort",(()=>{r.push(eg.encode({type:Xm.abortCallbackInvocation,message:ag.encode({scope:h,parents:u.parents})}))})),r.push(eg.encode({type:Xm.invokeCallback,message:og.encode({scope:h,parents:u.parents,callback:a,args:n})})),u.result.promise.then((t=>{s(t)}),(t=>{o(t)})).finally((()=>{i.children.delete(h),c.clear()}))}))},Ob=["__defineGetter__","__defineSetter__","hasOwnProperty","__lookupGetter__","__lookupSetter__","isPrototypeOf","propertyIsEnumerable","toString","valueOf","__proto__","toLocaleString","constructor"],Ub={type:2147483647,canEncode:t=>"object"==typeof t,encode:(t,e,r,i)=>{const n={};for(const e in t)Ob.includes(e)||Object.hasOwn(t,e)&&(n[e]=t[e]);for(const e of Object.getOwnPropertyNames(Object.getPrototypeOf(t)))Ob.includes(e)||(n[e]=t[e]);return xb([...Object.entries(n)].map((([r,n])=>[e.toValue(r,t,i),e.toValue(n,t,i)])))},decode:(t,e,r,i)=>{const n={};return Db(t).forEach((([t,s])=>{n[e.fromValue(t,r,i)]=e.fromValue(s,r,i)})),n}},Fb=Ub,jb={type:1034,canEncode:t=>"function"==typeof t.next&&"function"==typeof t.throw&&"function"==typeof t.return,encode:(t,e,r,i)=>Fb.encode({next:t.next.bind(t),throw:t.throw.bind(t),return:t.return.bind(t)},e,r,i),decode:(t,e,r,i)=>{const n=Fb.decode(t,e,r,i);return n[Symbol.asyncIterator]=()=>n,n}},Vb={type:1036,canEncode:t=>t instanceof Map,encode:(t,e,r,i)=>xb([...t.entries()].map((([t,n])=>[e.toValue(t,r,i),e.toValue(n,r,i)]))),decode:(t,e,r,i)=>{const n=new Map;return Db(t).forEach((([t,s])=>{const o=e.fromValue(t,r,i),a=e.fromValue(s,r,i);n.set(o,a)})),n}},qb={type:1037,canEncode:t=>t instanceof Set,encode:(t,e,r,i)=>xb([...t.values()].map((t=>e.toValue(t,r,i)))),decode:(t,e,r,i)=>{const n=new Set;return Db(t).forEach((t=>{n.add(e.fromValue(t,r,i))})),n}},zb=[{type:1024,canEncode:t=>void 0===t,decode:()=>{}},{type:1025,canEncode:t=>null===t,decode:()=>null},{type:1026,canEncode:t=>!0===t||!1===t,encode:t=>xb(t),decode:t=>Db(t)},{type:1027,canEncode:t=>"number"==typeof t&&!isNaN(t),encode:t=>xb(t),decode:t=>Db(t)},{type:1028,canEncode:t=>"string"==typeof t,encode:t=>xb(t),decode:t=>Db(t)},Nb,Lb,{type:1031,canEncode:t=>"NaN"===t.toString()&&isNaN(t),decode:()=>NaN},{type:1032,canEncode:t=>t instanceof Error,encode:t=>xb({message:t.message,name:t.name,code:t.code,type:t.type,stack:t.stack}),decode:t=>{const e=Db(t),r=new Error(e.message);return r.name=e.name,r.stack=e.stack,r.code=e.code,r.type=e.type,r}},{type:1033,canEncode:t=>Array.isArray(t),encode:(t,e,r,i)=>{throw new Error("Promises are not supported")},decode:(t,e,r,i)=>{throw new Error("Promises are not supported")}},jb,{type:1035,canEncode:t=>"bigint"==typeof t,encode:t=>xb(t),decode:t=>BigInt(Db(t))},Vb,qb,{type:1038,canEncode:t=>t instanceof Uint8Array,encode:t=>t,decode:t=>t},{type:1039,canEncode:t=>t instanceof AbortSignal,encode:(t,e,r,i)=>(i?.abortSignals.push(t),new Uint8Array(0)),decode:(t,e,r,i)=>{const n=new AbortController;return i.abortControllers.push(n),n.signal}},{type:1040,canEncode:t=>t instanceof Date,encode:t=>xb(t.toString()),decode:t=>new Date(Db(t))},{type:1041,canEncode:t=>t instanceof RegExp,encode:t=>xb({source:t.source,flags:t.flags}),decode:t=>{const{source:e,flags:r}=Db(t);return new RegExp(e,r)}},Fb];class Hb{transformersMap;transformersList;constructor(t){this.transformersList=[...zb,...t?.valueCodecs??[]].sort(((t,e)=>t.type<e.type?-1:t.type>e.type?1:0)),this.transformersMap={},this.transformersList.forEach((t=>{if(null!=this.transformersMap[t.type])throw new Error(`Duplicate transformer type ${t.type}`);this.transformersMap[t.type]=t}))}toValue(t,e,r){for(let i=0;i<this.transformersList.length;i++){const n=this.transformersList[i];if(n.canEncode(t))return{type:n.type,value:n.encode?.(t,this,e,r)}}throw new Hm(`Unsupported value type "${t}"`)}fromValue(t,e,r){const i=this.transformersMap[t.type];if(null==i)throw new Hm(`Unsupported value type "${t.type}"`);return i.decode(t.value??new Uint8Array(0),this,e,r)}}function $b(t){return t.type===Xm.invokeMethod||t.type===Xm.invokeGeneratorMethod||t.type===Xm.invokeCallback}class Wb{source;output;targets;invocations;values;messageHandlers;constructor(t){this.output=Sh(),this.source=lh(this.output),this.targets=new Map,this.invocations=new Map,this.values=new Hb(t),this.sink=this.sink.bind(this),this.messageHandlers={[Xm.invokeMethod]:{decoder:rg,handler:this.handleInvokeMethod.bind(this)},[Xm.invokeGeneratorMethod]:{decoder:rg,handler:this.handleInvokeGeneratorMethod.bind(this)},[Xm.abortMethodInvocation]:{decoder:ig,handler:this.handleAbortMethod.bind(this),isScope:!0},[Xm.methodResolved]:{decoder:ng,handler:this.handleMethodResolved.bind(this),isScope:!0},[Xm.methodRejected]:{decoder:sg,handler:this.handleMethodRejected.bind(this),isScope:!0,isError:!0},[Xm.invokeCallback]:{decoder:og,handler:this.handleInvokeCallback.bind(this),isScope:!0},[Xm.abortCallbackInvocation]:{decoder:ag,handler:this.handleAbortCallback.bind(this),isScope:!0},[Xm.callbackResolved]:{decoder:hg,handler:this.handleCallbackResolved.bind(this),isScope:!0},[Xm.callbackRejected]:{decoder:ug,handler:this.handleCallbackRejected.bind(this),isScope:!0,isError:!0}}}async sink(t){for await(const e of yh(t))try{const t=eg.decode(e),r=this.messageHandlers[t.type];if(null==r)continue;const i=r.decoder.decode(t.message);let n;if(!0===r.isScope)try{n=cg(i,this.invocations)}catch(t){continue}r.handler(i,n).catch((e=>{$b(t)&&this.sendError(i,e),this.invocations.delete(i.scope)})).finally((()=>{t.type===Xm.invokeMethod&&this.invocations.delete(i.scope)}))}catch{continue}}sendError(t,e){null!=t.parents?this.output.push(eg.encode({type:Xm.callbackRejected,message:ug.encode({scope:t.scope,parents:t.parents,error:this.values.toValue(e)})})):this.output.push(eg.encode({type:Xm.methodRejected,message:sg.encode({scope:t.scope,error:this.values.toValue(e)})}))}createClient(t){return this.proxy(t)}createTarget(t,e){if(this.targets.has(t))throw new $m(`Cannot reuse RPC target name "${t}"`);this.targets.set(t,e)}async handleInvokeMethod(t){if(this.invocations.has(t.scope))throw new Wm;const e=new Map,r=new Map,i={scope:t.scope,result:vh(),callbacks:e,children:r,parents:[],abortControllers:[],abortSignals:[]};this.invocations.set(t.scope,i);const n=this.lookupInvocationTarget(t.path),s=await n.fn.apply(n.context,t.args.map((t=>this.values.fromValue(t,this.output,i))));this.output.push(eg.encode({type:Xm.methodResolved,message:ng.encode({scope:t.scope,value:this.values.toValue(s)})}))}async handleAbortMethod(t,e){e.abortControllers.forEach((t=>{t.abort()}))}async handleInvokeGeneratorMethod(t){if(this.invocations.has(t.scope))throw new Wm;const e=new Map,r=new Map,i={scope:t.scope,result:vh(),callbacks:e,children:r,parents:[],abortControllers:[],abortSignals:[]};this.invocations.set(t.scope,i);const n=this.lookupInvocationTarget(t.path),s=n.fn.apply(n.context,t.args.map((t=>this.values.fromValue(t,this.output,i))));if("function"!=typeof s.next)throw new Km(`${t.path} did not return an async generator`);const o={next:async()=>{const e=await s.next();return!0===e.done&&this.invocations.delete(t.scope),e},throw:async e=>{try{const r=await s.throw(e);return!0===r.done&&this.invocations.delete(t.scope),r}catch(e){throw this.invocations.delete(t.scope),e}},return:async e=>{const r=await s.return(e);return!0===r.done&&this.invocations.delete(t.scope),r},[Symbol.asyncIterator]:()=>o};this.output.push(eg.encode({type:Xm.methodResolved,message:ng.encode({scope:t.scope,value:this.values.toValue(o,null,i)})}))}lookupInvocationTarget(t){const e=t.split(".");let r=this.targets.get(e[0]),i=r;for(let t=1;t<e.length;t++)i=r,r=r?.[e[t]];if(null==r){if(null!=i&&t.endsWith(".then"))throw new zm(`"${t.substring(0,t.length-5)}" was not a function`);throw new qm(`Could not find "${t}" on target`)}if("function"!=typeof r)throw new Gm("Invocation target was not a function");return{context:i,fn:r}}async handleMethodResolved(t,e){let r;null!=t.value&&(r=this.values.fromValue(t.value,this.output,e)),e.result.resolve(r)}async handleMethodRejected(t,e){let r;null!=t.error&&(r=this.values.fromValue(t.error,this.output,e)),e.result.reject(r)}async handleInvokeCallback(t,e){const r=e.callbacks.get(t.callback);if(null==r)throw new Jm;const i=await r.fn.apply(r.context,t.args.map((t=>this.values.fromValue(t,this.output,e))));this.output.push(eg.encode({type:Xm.callbackResolved,message:hg.encode({scope:t.scope,parents:t.parents,value:this.values.toValue(i)})}))}async handleAbortCallback(t,e){e.abortControllers.forEach((t=>{t.abort()}))}async handleCallbackResolved(t,e){let r;null!=t.value&&(r=this.values.fromValue(t.value,this.output,e)),e.children.get(t.scope)?.result.resolve(r),e.children.delete(t.scope)}async handleCallbackRejected(t,e){let r;null!=t.error&&(r=this.values.fromValue(t.error,this.output,e)),e.children.get(t.scope)?.result.reject(r),e.children.delete(t.scope)}proxy(t){const e=()=>{},r=this;return new Proxy(e,{get:(e,i,n)=>r.proxy(`${null==t?"":`${t}.`}${i.toString()}`),apply(i,n,s){let o,a;function h(){return null==a&&(a=new Promise(((e,i)=>{const n=am(),o={scope:n,result:vh(),callbacks:new Map,children:new Map,parents:[],abortControllers:[],abortSignals:[]};r.invocations.set(n,o),r.output.push(eg.encode({type:Xm.invokeMethod,message:rg.encode({scope:n,path:t,args:s.map((t=>r.values.toValue(t,null,o)))})}));const a=Ed(o.abortSignals);a.addEventListener("abort",(()=>{r.output.push(eg.encode({type:Xm.abortMethodInvocation,message:ig.encode({scope:n})}))})),o.result.promise.then((t=>{e(t)}),(t=>{i(t)})).finally((()=>{r.invocations.delete(n),a.clear()}))}))),a}function u(){if(null==o){const e=am(),i={scope:e,result:vh(),callbacks:new Map,children:new Map,parents:[],abortControllers:[],abortSignals:[]};let n;r.invocations.set(e,i),r.output.push(eg.encode({type:Xm.invokeGeneratorMethod,message:rg.encode({scope:e,path:t,args:s.map((t=>r.values.toValue(t,null,i)))})})),o={async next(){if(null!=n)throw n;const t=await i.result.promise,s=await t.next();return!0===s.done&&r.invocations.delete(e),s},async throw(t){if(null!=n)throw n;try{const n=await i.result.promise,s=await n.throw(t);return!0===s.done&&r.invocations.delete(e),s}catch(i){throw r.invocations.delete(e),n=t,i}},async return(t){if(null!=n)throw n;const s=await i.result.promise,o=await s.return(t);return!0===o.done&&r.invocations.delete(e),o},[Symbol.asyncIterator]:()=>o}}return o}return new Proxy(e,{get(t,e,r){if("then"===e)return h().then.bind(a);if("catch"===e)return h().catch.bind(a);if("finally"===e)return h().finally.bind(a);if(e===Symbol.asyncIterator)return()=>u();if("next"===e)return u().next.bind(o);if("return"===e)return u().return.bind(o);if("throw"===e)return u().throw.bind(o);if(e===Symbol.toStringTag)return"[object Object]";if("constructor"===e)return()=>{};throw new Gm(`Property ${e.toString()} was not used as a promise or async generator`)}})}})}}const Kb={type:4096,canEncode:t=>null!=t.code&&null!=t.version&&null!=t.multihash&&null!=t["/"],encode:t=>t.bytes,decode:t=>Kt.decode(t)},Gb={type:4099,canEncode:t=>t instanceof im,encode:(t,e,r,i)=>xb({type:t.type,detail:e.toValue(t.detail,r,i)}),decode:(t,e,r,i)=>{const{type:n,detail:s}=Db(t);return new im(n,e.fromValue(s,r,i))}},Zb={type:4097,canEncode:t=>Od(t),encode:t=>t.bytes,decode:t=>Ud(t)},Yb={type:4098,canEncode:t=>Ka(t),encode:t=>t.toMultihash().bytes,decode:t=>rh(qt(t))},Jb=[Kb,Zb,Yb,Gb];function Xb(t){const e={},r=t.components??t;return Object.entries(r).forEach((([t,r])=>{null!=r?.[k]&&Array.isArray(r[k])&&(e[t]=r[k])})),e}function Qb(t,e){const r={};for(const[i,n]of t.entries())r[i]=e(n);return r}async function ty(t,e){const r=[],i=t.connectionManager.getConnectionsMap(),n=[...i.values()].flatMap((t=>t)).map((t=>t.remoteAddr.toString()));for(const[s,o]of i.entries())try{const e=await t.peerStore.get(s);r.push({id:s,addresses:e.addresses.map((({isCertified:t,multiaddr:e})=>({multiaddr:e,isCertified:t,isConnected:n.includes(e.toString())}))),protocols:[...e.protocols],tags:Qb(e.tags,(t=>t.value)),metadata:Qb(e.metadata,(t=>Fi.encode(t)))})}catch(t){e.error("could not load peer data from peer store",t),r.push({id:s,addresses:o.map((t=>({multiaddr:t.remoteAddr,isConnected:n.includes(t.remoteAddr.toString())}))),protocols:[],tags:{},metadata:{}})}return r}function ey(t,e){const r=e[t];if(!E(r))throw new T(`Component ${t} did not implement the PubSub interface`);return r}async function ry(t){const e=await t.peerStore.get(t.peerId);return{id:e.id,addresses:e.addresses,protocols:[...e.protocols],tags:Qb(e.tags,(t=>t.value)),metadata:Qb(e.metadata,(t=>Fi.encode(t)))}}function iy(t,e=100){let r,i;return()=>{if(null==i&&(i=Date.now()),null!=r&&Date.now()-i>e)return clearTimeout(r),i=void 0,void t();clearTimeout(r),r=setTimeout((()=>{i=void 0,t()}),e)}}Object.defineProperty(globalThis,"________libp2p_devtools_metrics",{value:!0,enumerable:!1,writable:!1});class ny{log;components;simpleMetrics;intervalMs;rpcQueue;rpc;devTools;constructor(t,e){this.log=t.logger.forComponent("libp2p:devtools-metrics"),this.intervalMs=e?.intervalMs,this.components=t,this.rpcQueue=Sh(),this.rpc=function(t){return new Wb(t)}({valueCodecs:Jb}),this.devTools=this.rpc.createClient("devTools"),this.onPeersUpdate=iy(this.onPeersUpdate.bind(this),1e3),this.onSelfUpdate=iy(this.onSelfUpdate.bind(this),1e3),this.onIncomingMessage=this.onIncomingMessage.bind(this),this.onPubSubMessage=this.onPubSubMessage.bind(this),this.onPubSubSubscriptionChange=this.onPubSubSubscriptionChange.bind(this),this.simpleMetrics=function(t){return e=>new Vm(e,t)}({intervalMs:this.intervalMs,onMetrics:t=>{this.devTools.safeDispatchEvent("metrics",{detail:t}).catch((t=>{this.log.error("error sending metrics",t)}))}})({})}[Symbol.toStringTag]="@libp2p/devtools-metrics";[k]=["@libp2p/metrics"];trackMultiaddrConnection(t){this.simpleMetrics.trackMultiaddrConnection(t)}trackProtocolStream(t,e){this.simpleMetrics.trackProtocolStream(t,e)}registerMetric(t,e){return this.simpleMetrics.registerMetric(t,e)}registerMetricGroup(t,e){return this.simpleMetrics.registerMetricGroup(t,e)}registerCounter(t,e){return this.simpleMetrics.registerCounter(t,e)}registerCounterGroup(t,e){return this.simpleMetrics.registerCounterGroup(t,e)}registerHistogram(t,e){return this.simpleMetrics.registerHistogram(t,e)}registerHistogramGroup(t,e){return this.simpleMetrics.registerHistogramGroup(t,e)}registerSummary(t,e){return this.simpleMetrics.registerSummary(t,e)}registerSummaryGroup(t,e){return this.simpleMetrics.registerSummaryGroup(t,e)}async start(){this.components.events.addEventListener("peer:connect",this.onPeersUpdate),this.components.events.addEventListener("peer:disconnect",this.onPeersUpdate),this.components.events.addEventListener("peer:identify",this.onPeersUpdate),this.components.events.addEventListener("peer:update",this.onPeersUpdate),this.components.events.addEventListener("self:peer:update",this.onSelfUpdate),window.addEventListener("message",this.onIncomingMessage),this.rpc.createTarget("metrics",function(t){const e=t.logger.forComponent("libp2p:devtools-metrics:metrics-rpc");return{init:async()=>({self:await ry(t),peers:await ty(t,e),debug:localStorage.getItem("debug")??"",capabilities:Xb(t)}),setDebug:async t=>{var e;null!=t?.length&&t?.length>0?(e=t,Cm.enable(e),localStorage.setItem("debug",t)):(Cm.disable(),localStorage.removeItem("debug"))},openConnection:async(e,r)=>{let i;try{i=th(e)}catch{i=Ud(e)}await t.connectionManager.openConnection(i,r)},closeConnection:async(e,r)=>{await Promise.all(t.connectionManager.getConnections(e).map((async t=>{try{await t.close(r)}catch(e){t.abort(e)}})))},contentRouting:t.contentRouting,peerRouting:t.peerRouting,pubsub:{getTopics:async e=>ey(e,t).getTopics(),async subscribe(e,r){ey(e,t).subscribe(r)},async unsubscribe(e,r){ey(e,t).unsubscribe(r)},async publish(e,r,i){await ey(e,t).publish(r,i)},getSubscribers:async(e,r)=>ey(e,t).getSubscribers(r)}}}(this.components)),await Xp(this.simpleMetrics),Promise.resolve().then((async()=>{await kh(this.rpcQueue,this.rpc,(async t=>{for await(const e of t)window.postMessage({source:"@libp2p/devtools-metrics:metrics",type:"libp2p-rpc",message:Fi.encode(e)})}))})).catch((t=>{this.log.error("error while reading RPC messages",t)}));const t=function(t,e){for(const[t,r]of Object.entries(Xb(e)))if(r.includes("@libp2p/pubsub"))return e[t]}(0,this.components);E(t)&&(t.addEventListener("message",this.onPubSubMessage),t.addEventListener("subscription-change",this.onPubSubSubscriptionChange))}async stop(){window.removeEventListener("message",this.onIncomingMessage),this.components.events.removeEventListener("self:peer:update",this.onSelfUpdate),this.components.events.removeEventListener("peer:connect",this.onPeersUpdate),this.components.events.removeEventListener("peer:disconnect",this.onPeersUpdate),this.components.events.removeEventListener("peer:identify",this.onPeersUpdate),this.components.events.removeEventListener("peer:update",this.onPeersUpdate),await Qp(this.simpleMetrics)}onIncomingMessage(t){if(t.source!==window)return;const e=t.data;"@libp2p/devtools-metrics:devtools"===e?.source&&"libp2p-rpc"===e.type&&this.rpcQueue.push(Fi.decode(e.message))}onPubSubMessage(t){this.devTools.safeDispatchEvent("pubsub:message",{detail:t.detail}).catch((t=>{this.log.error("error relaying pubsub message",t)}))}onPubSubSubscriptionChange(t){this.devTools.safeDispatchEvent("pubsub:subscription-change",{detail:t.detail}).catch((t=>{this.log.error("error relaying pubsub subscription change",t)}))}onSelfUpdate(){Promise.resolve().then((async()=>{await this.devTools.safeDispatchEvent("self",{detail:await ry(this.components)})})).catch((t=>{this.log.error("error sending peers message",t)}))}onPeersUpdate(){Promise.resolve().then((async()=>{await this.devTools.safeDispatchEvent("peers",{detail:await ty(this.components,this.log)})})).catch((t=>{this.log.error("error sending peers message",t)}))}}function sy(t){return e=>new ny(e,t)}const oy=Uint8Array.from([3,1]);var ay,hy;!function(t){let e,r;!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.multiaddr&&t.multiaddr.byteLength>0&&(e.uint32(10),e.bytes(t.multiaddr)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={multiaddr:Qr(0)},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();e>>>3==1?i.multiaddr=t.bytes():t.skipType(7&e)}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(e=t.AddressInfo||(t.AddressInfo={})),t.codec=()=>(null==r&&(r=Dn(((e,r,i={})=>{if(!1!==i.lengthDelimited&&r.fork(),null!=e.peerId&&e.peerId.byteLength>0&&(r.uint32(10),r.bytes(e.peerId)),null!=e.seq&&0n!==e.seq&&(r.uint32(16),r.uint64(e.seq)),null!=e.addresses)for(const i of e.addresses)r.uint32(26),t.AddressInfo.codec().encode(i,r);!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={peerId:Qr(0),seq:0n,addresses:[]},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.peerId=e.bytes();break;case 2:n.seq=e.uint64();break;case 3:if(null!=i.limits?.addresses&&n.addresses.length===i.limits.addresses)throw new Nn('Decode error - map field "addresses" had too many elements');n.addresses.push(t.AddressInfo.codec().decode(e,e.uint32(),{limits:i.limits?.addresses$}));break;default:e.skipType(7&r)}}return n}))),r),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(ay||(ay={}));class uy{static createFromProtobuf=t=>{const e=ay.decode(t),r=rh(qt(e.peerId)),i=(e.addresses??[]).map((t=>Ud(t.multiaddr))),n=e.seq;return new uy({peerId:r,multiaddrs:i,seqNumber:n})};static DOMAIN="libp2p-peer-record";static CODEC=oy;peerId;multiaddrs;seqNumber;domain=uy.DOMAIN;codec=uy.CODEC;marshaled;constructor(t){const{peerId:e,multiaddrs:r,seqNumber:i}=t;this.peerId=e,this.multiaddrs=r??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=ay.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((t=>({multiaddr:t.bytes})))})),this.marshaled}equals(t){return t instanceof uy&&!!this.peerId.equals(t.peerId)&&this.seqNumber===t.seqNumber&&!!function(t,e){const r=(t,e)=>t.toString().localeCompare(e.toString());return t.length===e.length&&(e.sort(r),t.sort(r).every(((t,r)=>e[r].equals(t))))}(this.multiaddrs,t.multiaddrs)}}!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.protocolVersion&&(e.uint32(42),e.string(t.protocolVersion)),null!=t.agentVersion&&(e.uint32(50),e.string(t.agentVersion)),null!=t.publicKey&&(e.uint32(10),e.bytes(t.publicKey)),null!=t.listenAddrs)for(const r of t.listenAddrs)e.uint32(18),e.bytes(r);if(null!=t.observedAddr&&(e.uint32(34),e.bytes(t.observedAddr)),null!=t.protocols)for(const r of t.protocols)e.uint32(26),e.string(r);null!=t.signedPeerRecord&&(e.uint32(66),e.bytes(t.signedPeerRecord)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={listenAddrs:[],protocols:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 5:i.protocolVersion=t.string();break;case 6:i.agentVersion=t.string();break;case 1:i.publicKey=t.bytes();break;case 2:if(null!=r.limits?.listenAddrs&&i.listenAddrs.length===r.limits.listenAddrs)throw new Nn('Decode error - map field "listenAddrs" had too many elements');i.listenAddrs.push(t.bytes());break;case 4:i.observedAddr=t.bytes();break;case 3:if(null!=r.limits?.protocols&&i.protocols.length===r.limits.protocols)throw new Nn('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break;case 8:i.signedPeerRecord=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(hy||(hy={}));var cy=r(7144);const ly="object"==typeof window&&"object"==typeof document&&9===document.nodeType,dy=cy(),fy=ly&&!dy,py=dy&&!ly,my=dy&&ly,gy=void 0!==globalThis.process&&void 0!==globalThis.process.release&&"node"===globalThis.process.release.name&&!dy,by="function"==typeof importScripts&&"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,yy=(void 0!==globalThis.process&&void 0!==globalThis.process.env&&globalThis.process.env.NODE_ENV,"undefined"!=typeof navigator&&"ReactNative"===navigator.product),vy="ipfs",wy=5e3,My=1,_y=1,Sy=10,Ey=8192,ky=!0,Ay=!0;class Iy{host;protocol;started;timeout;peerId;privateKey;peerStore;registrar;addressManager;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;events;runOnLimitedConnection;log;constructor(t,e){var r,i;this.protocol=e.protocol,this.started=!1,this.peerId=t.peerId,this.privateKey=t.privateKey,this.peerStore=t.peerStore,this.registrar=t.registrar,this.addressManager=t.addressManager,this.events=t.events,this.log=e.log,this.timeout=e.timeout??wy,this.maxInboundStreams=e.maxInboundStreams??My,this.maxOutboundStreams=e.maxOutboundStreams??_y,this.maxMessageSize=e.maxMessageSize??Ey,this.maxObservedAddresses=e.maxObservedAddresses??Sy,this.runOnLimitedConnection=e.runOnLimitedConnection??Ay,this.host={protocolVersion:`${e.protocolPrefix??vy}/0.1.0`,agentVersion:(r=t.nodeInfo,i=e.agentVersion,null!=i||(i=`${r.name}/${r.version}`,gy||py?i+=` UserAgent=${globalThis.process.version}`:(fy||by||my||yy)&&(i+=` UserAgent=${globalThis.navigator.userAgent}`)),i)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:dn(this.host.agentVersion),ProtocolVersion:dn(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,(t=>{this.handleProtocol(t).catch((t=>{this.log.error(t)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}class xy extends Iy{constructor(t,e={}){super(t,{...e,protocol:`/${e.protocolPrefix??vy}/id/1.0.0`,log:t.logger.forComponent("libp2p:identify")}),(e.runOnConnectionOpen??ky)&&t.events.addEventListener("connection:open",(t=>{const e=t.detail;this.identify(e).catch((t=>{t.name!==H.name&&this.log.error("error during identify trigged by connection:open",t)}))}))}[k]=["@libp2p/identify"];async _identify(t,e={}){let r;if(null==e.signal){const t=AbortSignal.timeout(this.timeout);e={...e,signal:t}}try{r=await t.newStream(this.protocol,{...e,runOnLimitedConnection:this.runOnLimitedConnection});const i=Fd(r,{maxDataLength:this.maxMessageSize}).pb(hy),n=await i.read(e);return await r.close(e),n}catch(t){throw r?.abort(t),t}}async identify(t,e={}){const r=await this._identify(t,e),{publicKey:i,protocols:n,observedAddr:s}=r;if(null==i)throw new $("public key was missing from identify message");const o=ih(Ha(i).toCID());if(!t.remotePeer.equals(o))throw new $("identified peer does not match the expected peer");if(this.peerId.equals(o))throw new $("identified peer is our own peer id?");return this.maybeAddObservedAddress(s),this.log("identify completed for peer %p and protocols %o",o,n),async function(t,e,r,i,n){if(r("received identify from %p",i.remotePeer),null==n)throw new $("message was null or undefined");const s={};if(n.listenAddrs.length>0&&(s.addresses=n.listenAddrs.map((t=>({isCertified:!1,multiaddr:Ud(t)})))),n.protocols.length>0&&(s.protocols=n.protocols),null!=n.publicKey){const t=Ha(n.publicKey);if(!eh(t).equals(i.remotePeer))throw new $("public key did not match remote PeerId");s.publicKey=t}let o;if(null!=n.signedPeerRecord){r.trace("received signedPeerRecord from %p",i.remotePeer);let e=n.signedPeerRecord;const a=await Af.openAndCertify(e,uy.DOMAIN);let h=uy.createFromProtobuf(a.payload);const u=ih(a.publicKey.toCID());if(!h.peerId.equals(u))throw new $("signing key does not match PeerId in the PeerRecord");if(!i.remotePeer.equals(h.peerId))throw new $("signing key does not match remote PeerId");let c;try{c=await t.get(h.peerId)}catch(t){if("NotFoundError"!==t.name)throw t}if(null!=c&&(s.metadata=c.metadata,null!=c.peerRecordEnvelope)){const t=await Af.createFromProtobuf(c.peerRecordEnvelope),i=uy.createFromProtobuf(t.payload);i.seqNumber>=h.seqNumber&&(r("sequence number was lower or equal to existing sequence number - stored: %d received: %d",i.seqNumber,h.seqNumber),h=i,e=c.peerRecordEnvelope)}s.peerRecordEnvelope=e,s.addresses=h.multiaddrs.map((t=>({isCertified:!0,multiaddr:t}))),o={seq:h.seqNumber,addresses:h.multiaddrs}}else r("%p did not send a signed peer record",i.remotePeer);if(r.trace("patching %p with",i.remotePeer,s),await t.patch(i.remotePeer,s),null!=n.agentVersion||null!=n.protocolVersion){const e={};null!=n.agentVersion&&(e.AgentVersion=dn(n.agentVersion)),null!=n.protocolVersion&&(e.ProtocolVersion=dn(n.protocolVersion)),r.trace("merging %p metadata",i.remotePeer,e),await t.merge(i.remotePeer,{metadata:e})}const a={peerId:i.remotePeer,protocolVersion:n.protocolVersion,agentVersion:n.agentVersion,publicKey:n.publicKey,listenAddrs:n.listenAddrs.map((t=>Ud(t))),observedAddr:null==n.observedAddr?void 0:Ud(n.observedAddr),protocols:n.protocols,signedPeerRecord:o,connection:i};return e.safeDispatchEvent("peer:identify",{detail:a}),a}(this.peerStore,this.events,this.log,t,r)}maybeAddObservedAddress(t){const e=function(t){if(null!=t&&t.length>0)try{return Ud(t)}catch{}}(t);null!=e&&(this.log.trace("our observed address was %a",e),md(e)?this.log.trace("our observed address was private"):41!==e.stringTuples()[0][0]||cd(e)?fp.exactMatch(e)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(e)):this.log.trace("our observed address was IPv6 but not a global unicast address"))}async handleProtocol(t){const{connection:e,stream:r}=t,i=AbortSignal.timeout(this.timeout);try{const t=await this.peerStore.get(this.peerId),n=this.addressManager.getAddresses().map((t=>t.decapsulateCode(Fu("p2p").code)));let s=t.peerRecordEnvelope;if(n.length>0&&null==s){const t=new uy({peerId:this.peerId,multiaddrs:n});s=(await Af.seal(t,this.privateKey)).marshal().subarray()}let o=e.remoteAddr.bytes;up.matches(e.remoteAddr)||(o=void 0);const a=Fd(r).pb(hy);await a.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:$a(this.privateKey.publicKey),listenAddrs:n.map((t=>t.bytes)),signedPeerRecord:s,observedAddr:o,protocols:t.protocols},{signal:i}),await r.close({signal:i})}catch(t){this.log.error("could not respond to identify request",t),r.abort(t)}}}function Cy(t={}){return e=>new xy(e,t)}var Ty;!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{if(!1!==r.lengthDelimited&&e.fork(),null!=t.publicKey&&t.publicKey.byteLength>0&&(e.uint32(10),e.bytes(t.publicKey)),null!=t.addrs)for(const r of t.addrs)e.uint32(18),e.bytes(r);!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={publicKey:Qr(0),addrs:[]},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.publicKey=t.bytes();break;case 2:if(null!=r.limits?.addrs&&i.addrs.length===r.limits.addrs)throw new Nn('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Ty||(Ty={}));class Py extends v{[zd]=!0;[Symbol.toStringTag]="@libp2p/pubsub-peer-discovery";interval;listenOnly;topics;intervalId;components;log;constructor(t,e={}){super();const{interval:r,topics:i,listenOnly:n}=e;this.components=t,this.interval=r??1e4,this.listenOnly=n??!1,this.log=t.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(i)&&i.length>0?this.topics=i:this.topics=["_peer-discovery._p2p._pubsub"],this._onMessage=this._onMessage.bind(this)}isStarted(){return null!=this.intervalId}start(){}afterStart(){if(null!=this.intervalId)return;const t=this.components.pubsub;if(null==t)throw new Error("PubSub not configured");for(const e of this.topics)t.subscribe(e),t.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval((()=>{this._broadcast()}),this.interval))}beforeStop(){const t=this.components.pubsub;if(null==t)throw new Error("PubSub not configured");for(const e of this.topics)t.unsubscribe(e),t.removeEventListener("message",this._onMessage)}stop(){null!=this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){const t=this.components.peerId;if(null==t.publicKey)throw new Error("PeerId was missing public key");const e={publicKey:$a(t.publicKey),addrs:this.components.addressManager.getAddresses().map((t=>t.bytes))},r=Ty.encode(e),i=this.components.pubsub;if(null==i)throw new Error("PubSub not configured");for(const t of this.topics)0!==i.getSubscribers(t).length?(this.log("broadcasting our peer data on topic %s",t),i.publish(t,r)):this.log("skipping broadcasting our peer data on topic %s because there are no peers present",t)}_onMessage(t){if(!this.isStarted())return;const e=t.detail;if(this.topics.includes(e.topic))try{const t=Ty.decode(e.data),r=eh(Ha(t.publicKey));if(r.equals(this.components.peerId))return;this.log("discovered peer %p on %s",r,e.topic),this.safeDispatchEvent("peer",{detail:{id:r,multiaddrs:t.addrs.map((t=>Ud(t)))}})}catch(t){this.log.error("error handling incoming message",t)}}}var By=r(5606),Ry=function(t,e,r){if(r||2===arguments.length)for(var i,n=0,s=e.length;n<s;n++)!i&&n in e||(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return t.concat(i||Array.prototype.slice.call(e))},Dy=function(t,e,r){this.name=t,this.version=e,this.os=r,this.type="browser"},Ny=function(t){this.version=t,this.type="node",this.name="node",this.os=By.platform},Ly=function(t,e,r,i){this.name=t,this.version=e,this.os=r,this.bot=i,this.type="bot-device"},Oy=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},Uy=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Fy=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],jy=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Vy(t){var e=function(t){return""!==t&&Fy.reduce((function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]}),!1)}(t);if(!e)return null;var r=e[0],i=e[1];if("searchbot"===r)return new Oy;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<3&&(n=Ry(Ry([],n,!0),function(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}(3-n.length),!0)):n=[];var s=n.join("."),o=function(t){for(var e=0,r=jy.length;e<r;e++){var i=jy[e],n=i[0];if(i[1].exec(t))return n}return null}(t),a=Uy.exec(t);return a&&a[1]?new Ly(r,s,o,a[1]):new Dy(r,s,o)}class qy extends Error{constructor(t){super(t),this.name="TimeoutError"}}class zy extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const Hy=t=>void 0===globalThis.DOMException?new zy(t):new DOMException(t),$y=t=>{const e=void 0===t.reason?Hy("This operation was aborted."):t.reason;return e instanceof Error?e:Hy(e)};function Wy(t,e){const{milliseconds:r,fallback:i,message:n,customTimers:s={setTimeout,clearTimeout}}=e;let o;const a=new Promise(((a,h)=>{if("number"!=typeof r||1!==Math.sign(r))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${r}\``);if(e.signal){const{signal:r}=e;r.aborted&&h($y(r));const i=()=>{h($y(r))};r.addEventListener("abort",i,{once:!0}),t.finally((()=>{r.removeEventListener("abort",i)}))}if(r===Number.POSITIVE_INFINITY)return void t.then(a,h);const u=new qy;o=s.setTimeout.call(void 0,(()=>{if(i)try{a(i())}catch(t){h(t)}else"function"==typeof t.cancel&&t.cancel(),!1===n?a():n instanceof Error?h(n):(u.message=n??`Promise timed out after ${r} milliseconds`,h(u))}),r),(async()=>{try{a(await t)}catch(t){h(t)}})()})).finally((()=>{a.clear()}));return a.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},a}const Ky=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],Gy="undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product?new function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}:"undefined"!=typeof navigator?Vy(navigator.userAgent):void 0!==By&&By.version?new Ny(By.version.slice(1)):null;const Zy=null!=Gy&&"firefox"===Gy.name,Yy=async function*(){},Jy=async t=>{};async function Xy(t){return"function"==typeof(t=t??{})&&(t=await t()),t.iceServers=t.iceServers??Ky.map((t=>({urls:[t]}))),t}class Qy{log;peerConnection;remoteAddr;timeline;metrics;source=Yy();sink=Jy;constructor(t,e){this.log=t.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=e.remoteAddr,this.timeline=e.timeline,this.peerConnection=e.peerConnection;const r=this.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",this.peerConnection.connectionState,"initial state",r),"disconnected"!==this.peerConnection.connectionState&&"failed"!==this.peerConnection.connectionState&&"closed"!==this.peerConnection.connectionState||(this.timeline.close=Date.now())}}async close(t){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(t){this.log.error("closing connection due to error",t),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}function tv(t,e,r){"function"==typeof r&&(r={filter:r});const i=function(t,e,r){let i;const n=new Promise(((n,s)=>{if(!((r={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...r}).count>=0)||r.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(r.count))throw new TypeError("The `count` option should be at least 0 or more");r.signal?.throwIfAborted();const o=[e].flat(),a=[],{addListener:h,removeListener:u}=(t=>{const e=t.addEventListener||t.on||t.addListener,r=t.removeEventListener||t.off||t.removeListener;if(!e||!r)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(t),removeListener:r.bind(t)}})(t),c=(...t)=>{const e=r.multiArgs?t:t[0];r.filter&&!r.filter(e)||(a.push(e),r.count===a.length&&(i(),n(a)))},l=t=>{i(),s(t)};i=()=>{for(const t of o)u(t,c);for(const t of r.rejectionEvents)u(t,l)};for(const t of o)h(t,c);for(const t of r.rejectionEvents)h(t,l);r.signal&&r.signal.addEventListener("abort",(()=>{l(r.signal.reason)}),{once:!0}),r.resolveImmediately&&n(a)}));if(n.cancel=i,"number"==typeof r.timeout){const t=Wy(n,{milliseconds:r.timeout});return t.cancel=i,t}return n}(t,e,r={...r,count:1,resolveImmediately:!1}),n=i.then((t=>t[0]));return n.cancel=i.cancel,n}var ev;!function(t){let e,r,i;!function(t){t.FIN="FIN",t.STOP_SENDING="STOP_SENDING",t.RESET="RESET",t.FIN_ACK="FIN_ACK"}(e=t.Flag||(t.Flag={})),function(t){t[t.FIN=0]="FIN",t[t.STOP_SENDING=1]="STOP_SENDING",t[t.RESET=2]="RESET",t[t.FIN_ACK=3]="FIN_ACK"}(r||(r={})),function(t){t.codec=()=>Rn(r)}(e=t.Flag||(t.Flag={})),t.codec=()=>(null==i&&(i=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.flag&&(r.uint32(8),t.Flag.codec().encode(e.flag,r)),null!=e.message&&(r.uint32(18),r.bytes(e.message)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.flag=t.Flag.codec().decode(e);break;case 2:n.message=e.bytes();break;default:e.skipType(7&r)}}return n}))),i),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(ev||(ev={}));const rv=function(t=16384){const e=ci(t-ci(t)),r=1+ci(Object.keys(ev.Flag).length-1);return e+r+1+ci(t-e-r-1)}();class iv extends Fl{channel;incomingData;maxBufferedAmount;bufferedAmountLowEventTimeout;maxMessageSize;receiveFinAck;finAckTimeout;openTimeout;constructor(t){const e=t.onEnd;switch(t.onEnd=t=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve((async()=>{if(null==this.timeline.abort&&null===this.timeline.reset)try{await Wy(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(t){this.log.error("error receiving FIN_ACK",t)}})).then((()=>{this.incomingData.end(),e?.(t)})).catch((t=>{this.log.error("error ending stream",t)}))},super(t),this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=Sh(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??3e4,this.maxBufferedAmount=t.maxBufferedAmount??2097152,this.maxMessageSize=(t.maxMessageSize??16384)-rv,this.receiveFinAck=vh(),this.finAckTimeout=t.closeTimeout??5e3,this.openTimeout=t.openTimeout??5e3,this.channel.readyState){case"open":this.timeline.open=(new Date).getTime();break;case"closed":case"closing":void 0!==this.timeline.close&&0!==this.timeline.close||(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new U("Unknown datachannel state")}this.channel.onopen=t=>{this.timeline.open=(new Date).getTime()},this.channel.onclose=t=>{this.receiveFinAck.resolve(),this.close().catch((t=>{this.log.error("error closing stream after channel closed",t)}))},this.channel.onerror=t=>{const e=t.error;this.abort(e)},this.channel.onmessage=async t=>{const{data:e}=t;null!==e&&0!==e.byteLength&&this.incomingData.push(new Uint8Array(e,0,e.byteLength))};const r=this;Promise.resolve().then((async()=>{for await(const t of yh(this.incomingData)){const e=r.processIncomingProtobuf(t);null!=e&&r.sourcePush(new hh(e))}})).catch((t=>{this.log.error("error processing incoming data channel messages",t)}))}sendNewStream(){}async _sendMessage(t,e=!0){if(e&&this.channel.bufferedAmount>this.maxBufferedAmount)try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await tv(this.channel,"bufferedamountlow",{timeout:this.bufferedAmountLowEventTimeout})}catch(t){if(t instanceof W)throw new W(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`);throw t}if("closed"===this.channel.readyState||"closing"===this.channel.readyState)throw new U(`Invalid datachannel state - ${this.channel.readyState}`);"open"!==this.channel.readyState&&(this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await tv(this.channel,"open",{timeout:this.openTimeout}),this.log('channel state is now "%s", sending data',this.channel.readyState)),this.channel.send(t.subarray())}async sendData(t){for(t=t.sublist();t.byteLength>0;){const e=Math.min(t.byteLength,this.maxMessageSize),r=t.subarray(0,e),i=ev.encode({message:r}),n=lh.single(i);await this._sendMessage(n),t.consume(e)}}async sendReset(){try{await this._sendFlag(ev.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}}async sendCloseWrite(t){if(await this._sendFlag(ev.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await ic(this.receiveFinAck.promise,t?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(t){this.log.error("failed to await FIN_ACK",t)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){await this._sendFlag(ev.Flag.STOP_SENDING)}processIncomingProtobuf(t){const e=ev.decode(t);if(void 0!==e.flag&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',e.flag,this.writeStatus,this.readStatus),e.flag===ev.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(ev.Flag.FIN_ACK).catch((t=>{this.log.error("error sending FIN_ACK immediately",t)}))),e.flag===ev.Flag.RESET&&this.reset(),e.flag===ev.Flag.STOP_SENDING&&this.remoteCloseRead(),e.flag===ev.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),"ready"===this.readStatus)return e.message}async _sendFlag(t){if("open"!==this.channel.readyState)return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,t.toString()),!1;this.log.trace("sending flag %s",t.toString());const e=ev.encode({flag:t}),r=lh.single(e);try{return await this._sendMessage(r,!1),!0}catch(e){this.log.error("could not send flag %s - %e",t.toString(),e)}return!1}}function nv(t){const{channel:e,direction:r}=t;return new iv({id:"inbound"===r?`i${e.id}`:`r${e.id}`,log:t.logger.forComponent(`libp2p:webrtc:stream:${r}:${e.id}`),...t})}const sv="/webrtc";class ov{protocol;peerConnection;bufferedStreams=[];metrics;dataChannelOptions;components;log;constructor(t,e){this.components=t,this.peerConnection=e.peerConnection,this.metrics=e.metrics,this.protocol=e.protocol??sv,this.dataChannelOptions=e.dataChannelOptions??{},this.log=t.logger.forComponent("libp2p:webrtc:datachannelmuxerfactory"),this.peerConnection.ondatachannel=({channel:e})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',e.id),"init"===e.label)return this.log.trace("closing early init channel"),void e.close();const r={},i=nv({channel:e,direction:"inbound",onEnd:t=>{r.onEnd(t)},logger:t.logger,...this.dataChannelOptions});r.stream=i,r.channel=e,r.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter((t=>t.stream.id!==i.id))},this.bufferedStreams.push(r)}}createStreamMuxer(t){return new av(this.components,{...t,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}class av{init;streams;protocol;log;peerConnection;dataChannelOptions;metrics;logger;constructor(t,e){this.init=e,this.log=t.logger.forComponent("libp2p:webrtc:muxer"),this.logger=t.logger,this.streams=e.streams.map((t=>t.stream)),this.peerConnection=e.peerConnection,this.protocol=e.protocol??sv,this.metrics=e.metrics,this.dataChannelOptions=e.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:t})=>{if(this.log.trace("incoming datachannel with channel id %d",t.id),"init"===t.label)return this.log.trace("closing init channel"),void t.close();const r=t.id,i=nv({channel:t,direction:"inbound",onEnd:()=>{this.#h(i,t),this.log("incoming channel %s ended",r)},logger:this.logger,...this.dataChannelOptions});this.streams.push(i),this.metrics?.increment({incoming_stream:!0}),e?.onIncomingStream?.(i)},this.init.streams.length>0&&queueMicrotask((()=>{this.init.streams.forEach((t=>{t.onEnd=()=>{this.log("incoming early channel %s ended with state %s",t.channel.id,t.channel.readyState),this.#h(t.stream,t.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(t.stream)}))}))}#h(t,e){this.log.trace("stream %s %s %s onEnd",t.direction,t.id,t.protocol),function(t,e,r=3e4,i){"open"===t.readyState&&Promise.resolve().then((async()=>{if(t.bufferedAmount>0){i.log("%s drain channel with %d buffered bytes",e,t.bufferedAmount);const n=vh();let s=!1;t.bufferedAmountLowThreshold=0;const o=()=>{s||(i.log("%s drain channel closed before drain",e),n.resolve())};t.addEventListener("close",o,{once:!0}),t.addEventListener("bufferedamountlow",(()=>{s=!0,t.removeEventListener("close",o),n.resolve()})),await Wy(n.promise,{milliseconds:r})}})).then((async()=>{"open"===t.readyState&&t.close()})).catch((t=>{i.log.error("error closing outbound stream",t)}))}(e,`${t.direction} ${t.id} ${t.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter((e=>e.id!==t.id)),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(t)}async close(t){try{await Promise.all(this.streams.map((async e=>e.close(t))))}catch(t){this.abort(t)}}abort(t){for(const e of this.streams)e.abort(t)}source=Yy();sink=Jy;newStream(){const t=this.peerConnection.createDataChannel(""),e=t.id;this.log.trace("opened outgoing datachannel with channel id %s",e);const r=nv({channel:t,direction:"outbound",onEnd:()=>{this.#h(r,t),this.log("outgoing channel %s ended",e)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(r),this.metrics?.increment({outgoing_stream:!0}),r}}const hv=globalThis.RTCPeerConnection,uv=globalThis.RTCSessionDescription,cv=globalThis.RTCIceCandidate;class lv extends Error{constructor(t){super(`WebRTC transport error: ${t}`),this.name="WebRTCTransportError"}}class dv extends lv{constructor(t="SDP handshake failed"){super(t),this.name="SDPHandshakeFailedError"}}class fv extends lv{constructor(t,e){super(`[stream: ${t}] data channel error: ${e}`),this.name="WebRTC/DataChannelError"}}class pv extends lv{constructor(t,e){super(`Invalid fingerprint "${t}" within ${e}`),this.name="WebRTC/InvalidFingerprintError"}}class mv extends lv{constructor(t){super(`A method (${t}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class gv extends lv{constructor(t){super(`unsupported hash algorithm code: ${t} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var bv;!function(t){let e,r,i;!function(t){t.SDP_OFFER="SDP_OFFER",t.SDP_ANSWER="SDP_ANSWER",t.ICE_CANDIDATE="ICE_CANDIDATE"}(e=t.Type||(t.Type={})),function(t){t[t.SDP_OFFER=0]="SDP_OFFER",t[t.SDP_ANSWER=1]="SDP_ANSWER",t[t.ICE_CANDIDATE=2]="ICE_CANDIDATE"}(r||(r={})),function(t){t.codec=()=>Rn(r)}(e=t.Type||(t.Type={})),t.codec=()=>(null==i&&(i=Dn(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),null!=e.type&&(r.uint32(8),t.Type.codec().encode(e.type,r)),null!=e.data&&(r.uint32(18),r.string(e.data)),!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:n.type=t.Type.codec().decode(e);break;case 2:n.data=e.string();break;default:e.skipType(7&r)}}return n}))),i),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(bv||(bv={}));const yv=async(t,e,r)=>{try{const i=vh();for(function(t,e){t[Zy?"oniceconnectionstatechange":"onconnectionstatechange"]=r=>{switch(vv(t)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new N("RTCPeerConnection was closed"))}}}(t,i);;){const n=await Promise.race([i.promise,e.read({signal:r.signal}).catch((()=>{}))]);if(null==n){r.signal?.throwIfAborted();break}if(n.type!==bv.Type.ICE_CANDIDATE)throw new $("ICE candidate message expected");const s=JSON.parse(n.data??"null");if(""===s||null===s){r.onProgress?.(new im("webrtc:end-of-ice-candidates")),r.log.trace("end-of-candidates received");continue}const o=new cv(s);r.log.trace("%s received new ICE candidate %o",r.direction,s);try{r.onProgress?.(new im("webrtc:add-ice-candidate",o.candidate)),await t.addIceCandidate(o)}catch(t){r.log.error("%s bad candidate received",r.direction,s,t)}}}catch(e){if(r.log.error("%s error parsing ICE candidate",r.direction,e),!0===r.signal?.aborted&&"connected"!==vv(t))throw e}};function vv(t){return Zy?t.iceConnectionState:t.connectionState}const wv=Qf(Ip.matchers[0],$f("p2p-circuit"));class Mv extends v{transportManager;shutdownController;constructor(t,e){super(),this.transportManager=t.transportManager,this.shutdownController=e.shutdownController}async listen(){queueMicrotask((()=>{this.safeDispatchEvent("listening")}))}getAddrs(){return this.transportManager.getListeners().filter((t=>t!==this)).map((t=>t.getAddrs().filter((t=>wv.exactMatch(t))).map((t=>t.encapsulate("/webrtc"))))).flat()}async close(){this.shutdownController.abort(),queueMicrotask((()=>{this.safeDispatchEvent("close")}))}}const _v="/webrtc",Sv="/p2p-circuit",Ev="/webrtc-signaling/0.0.1";class kv{components;init;log;_started=!1;metrics;shutdownController;constructor(t,e={}){this.components=t,this.init=e,this.log=t.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,null!=t.metrics&&(this.metrics={dialerEvents:t.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:t.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[Zp]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[k]=["@libp2p/transport"];[A]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(Ev,(t=>{this._onProtocol(t).catch((e=>{this.log.error("failed to handle incoming connect from %p",t.connection.remotePeer,e)}))}),{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(Ev),this._started=!1}createListener(t){return new Mv(this.components,{shutdownController:this.shutdownController})}listenFilter(t){return t.filter(Cp.exactMatch)}dialFilter(t){return this.listenFilter(t)}async dial(t,e){this.log.trace("dialing address: %a",t);const{remoteAddress:r,peerConnection:i,muxerFactory:n}=await async function({rtcConfiguration:t,dataChannel:e,signal:r,metrics:i,multiaddr:n,connectionManager:s,transportManager:o,log:a,logger:h,onProgress:u}){const{baseAddr:c}=function(t){const e=t.toString().split(_v+"/");if(2!==e.length)throw new T("webrtc protocol was not present in multiaddr");if(!e[0].includes(Sv))throw new T("p2p-circuit protocol was not present in multiaddr");let r=Ud(e[0]);const i=Ud("/"+e[1]).getPeerId();if(null==i)throw new T("destination peer id was missing");const n=r.protos().pop();if(void 0===n)throw new T("invalid multiaddr");return"p2p"!==n.name&&(r=r.encapsulate(`/p2p/${i}`)),{baseAddr:r,peerId:th(i)}}(n);i?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",c);const l=c.getPeerId();if(null==l)throw new T("Relay peer was missing");const d=s.getConnections(th(l));let f,p=!1;0===d.length?(u?.(new im("webrtc:dial-relay")),f=await o.dial(c,{signal:r,onProgress:u}),p=!0):(u?.(new im("webrtc:reuse-relay-connection")),f=d[0]);try{u?.(new im("webrtc:open-signaling-stream"));const i=await f.newStream(Ev,{signal:r,runOnLimitedConnection:!0}),s=Fd(i).pb(bv),o=new hv(t),c=new ov({logger:h},{peerConnection:o,dataChannelOptions:e});try{const t=o.createDataChannel("init");o.onicecandidate=({candidate:t})=>{const e=JSON.stringify(t?.toJSON()??null);a.trace("initiator sending ICE candidate %o",t),s.write({type:bv.Type.ICE_CANDIDATE,data:e},{signal:r}).catch((t=>{a.error("error sending ICE candidate",t)}))},o.onicecandidateerror=t=>{a.error("initiator ICE candidate error",t)};const e=await o.createOffer().catch((t=>{throw a.error("could not execute createOffer",t),new dv("Failed to set createOffer")}));a.trace("initiator send SDP offer %s",e.sdp),u?.(new im("webrtc:send-sdp-offer")),await s.write({type:bv.Type.SDP_OFFER,data:e.sdp},{signal:r}),await o.setLocalDescription(e).catch((t=>{throw a.error("could not execute setLocalDescription",t),new dv("Failed to set localDescription")})),u?.(new im("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const h=await s.read({signal:r});if(h.type!==bv.Type.SDP_ANSWER)throw new dv("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",h.data);const l=new uv({type:"answer",sdp:h.data});return await o.setRemoteDescription(l).catch((t=>{throw a.error("could not execute setRemoteDescription",t),new dv("Failed to set remoteDescription")})),a.trace("initiator read candidates until connected"),u?.(new im("webrtc:read-ice-candidates")),await yv(o,s,{direction:"initiator",signal:r,log:a,onProgress:u}),a.trace("initiator connected, closing init channel"),t.close(),u?.(new im("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await i.close({signal:r}),a.trace("initiator connected to remote address %s",n),{remoteAddress:n,peerConnection:o,muxerFactory:c}}catch(t){throw a.error("outgoing signaling error",t),o.close(),i.abort(t),t}finally{o.onicecandidate=null,o.onicecandidateerror=null}}finally{if(p)try{await f.close({signal:r})}catch(t){f.abort(t)}}}({rtcConfiguration:await Xy(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:t,dataChannelOptions:this.init.dataChannel,signal:e.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:e.onProgress}),s=new Qy(this.components,{peerConnection:i,timeline:{open:Date.now()},remoteAddr:r,metrics:this.metrics?.dialerEvents}),o=await e.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:n,onProgress:e.onProgress});return this._closeOnShutdown(i,s),o}async _onProtocol({connection:t,stream:e}){const r=AbortSignal.timeout(this.init.inboundConnectionTimeout??3e4),i=new hv(await Xy(this.init.rtcConfiguration)),n=new ov(this.components,{peerConnection:i,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:s}=await async function({peerConnection:t,stream:e,signal:r,connection:i,log:n}){n.trace("new inbound signaling stream");const s=Fd(e).pb(bv);try{t.onicecandidate=({candidate:t})=>{const e=JSON.stringify(t?.toJSON()??null);n.trace("recipient sending ICE candidate %s",e),s.write({type:bv.Type.ICE_CANDIDATE,data:e},{signal:r}).catch((t=>{n.error("error sending ICE candidate",t)}))},n.trace("recipient read SDP offer");const e=await s.read({signal:r});if(e.type!==bv.Type.SDP_OFFER)throw new dv(`expected message type SDP_OFFER, received: ${e.type??"undefined"} `);n.trace("recipient received SDP offer %s",e.data);const i=new uv({type:"offer",sdp:e.data});await t.setRemoteDescription(i).catch((t=>{throw n.error("could not execute setRemoteDescription",t),new dv("Failed to set remoteDescription")}));const o=await t.createAnswer().catch((t=>{throw n.error("could not execute createAnswer",t),new dv("Failed to create answer")}));n.trace("recipient send SDP answer %s",o.sdp),await s.write({type:bv.Type.SDP_ANSWER,data:o.sdp},{signal:r}),await t.setLocalDescription(o).catch((t=>{throw n.error("could not execute setLocalDescription",t),new dv("Failed to set localDescription")})),n.trace("recipient read candidates until connected"),await yv(t,s,{direction:"recipient",signal:r,log:n})}catch(e){if("connected"!==vv(t))throw n.error("error while handling signaling stream from peer %a",i.remoteAddr,e),t.close(),e;n("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",i.remoteAddr,e)}const o=Ud(`/webrtc/p2p/${i.remoteAddr.getPeerId()}`);return n.trace("recipient connected to remote address %s",o),{remoteAddress:o}}({peerConnection:i,connection:t,stream:e,signal:r,log:this.log});await e.close({signal:r});const o=new Qy(this.components,{peerConnection:i,timeline:{open:(new Date).getTime()},remoteAddr:s,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(o,{skipEncryption:!0,skipProtection:!0,muxerFactory:n}),this._closeOnShutdown(i,o)}catch(t){throw this.log.error("incoming signaling error",t),i.close(),e.abort(t),t}}_closeOnShutdown(t,e){const r=()=>{e.close().catch((t=>{this.log.error("could not close WebRTCMultiaddrConnection",t)}))};this.shutdownController.signal.addEventListener("abort",r),t.addEventListener("close",(()=>{this.shutdownController.signal.removeEventListener("abort",r)}))}}const Av=Object.values(an).map((t=>t.decoder)).reduce(((t,e)=>t.or(e)));const Iv=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function xv(t){const e=t.stringTuples().filter((t=>t[0]===Rv)).map((t=>t[1]))[0];if(void 0===e||""===e)throw new T(`Couldn't find a certhash component of multiaddr: ${t.toString()}`);return e}function Cv(t){return qt(Av.decode(t))}function Tv(t){switch(t){case 17:return"SHA-1";case 18:return"SHA-256";case 19:return"SHA-512";default:throw new gv(t)}}function Pv(t,e){const{host:r,port:i}=t.toOptions(),n=function(t){for(const e of t.protoNames())if(e.startsWith("ip"))return e.toUpperCase();return"IP6"}(t),[s]=function(t){const e=Cv(xv(t)),r=Tv(e.code),i=e.digest.reduce(((t,e)=>t+e.toString(16).padStart(2,"0")),""),n=i.match(/.{1,2}/g);if(null==n)throw new pv(i,t.toString());return[`${r} ${n.join(":").toUpperCase()}`,i]}(t);return`v=0\no=- 0 0 IN ${n} ${r}\ns=-\nc=IN ${n} ${r}\nt=0 0\na=ice-lite\nm=application ${i} UDP/DTLS/SCTP webrtc-datachannel\na=mid:0\na=setup:passive\na=ice-ufrag:${e}\na=ice-pwd:${e}\na=fingerprint:${s}\na=sctp-port:5000\na=max-message-size:16384\na=candidate:1467250027 1 UDP 1467250027 ${r} ${i} typ host\r\n`}const Bv=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Rv=(Fu("webrtc-direct").code,Fu("certhash").code);class Dv{log;metrics;components;init;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:webrtc-direct"),this.components=t,this.init=e,null!=t.metrics&&(this.metrics={dialerEvents:t.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[Zp]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[k]=["@libp2p/transport"];async dial(t,e){const r=await this._connect(t,e);return this.log("dialing address: %a",t),r}createListener(t){throw new mv("WebRTCTransport.createListener")}listenFilter(t){return t.filter(Sp.exactMatch)}dialFilter(t){return this.listenFilter(t)}async _connect(t,e){const r=new AbortController,i=r.signal;let n;const s=t.getPeerId();null!=s&&(n=th(s));const o=Cv(xv(t)),a=await hv.generateCertificate({name:"ECDSA",namedCurve:"P-256",hash:Tv(o.code)}),h=new hv({...await Xy(this.init.rtcConfiguration),certificates:[a]});try{const s=new Promise(((t,e)=>{const r=h.createDataChannel("",{negotiated:!0,id:0}),i=setTimeout((()=>{const t=`Data channel was never opened: state: ${r.readyState}`;this.log.error(t),this.metrics?.dialerEvents.increment({open_error:!0}),e(new fv("data",t))}),1e4);r.onopen=e=>{clearTimeout(i),t(r)},r.onerror=t=>{clearTimeout(i);const r=`Error opening a data channel for handshaking: ${t.target?.toString()??"not specified"}`;this.log.error(r),this.metrics?.dialerEvents.increment({unknown_error:!0}),e(new fv("data",r))}})),a="libp2p+webrtc+v1/"+[...Array(32)].map((()=>Bv.at(Math.floor(Math.random()*Bv.length)))).join(""),u=function(t,e){if(void 0===t.sdp)throw new T("Can't munge a missing SDP");return t.sdp=t.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,"\na=ice-ufrag:"+e+"\n").replace(/\na=ice-pwd:[^\n]*\n/,"\na=ice-pwd:"+e+"\n"),t}(await h.createOffer(),a);await h.setLocalDescription(u);const c=function(t,e){return{type:"answer",sdp:Pv(t,e)}}(t,a);await h.setRemoteDescription(c);const l=await s,d=vl({prologueBytes:this.generateNoisePrologue(h,o.code,t)})(this.components),f=nv({channel:l,direction:"inbound",logger:this.components.logger,...this.init.dataChannel??{}}),p={...f,sink:f.sink.bind(f),source:async function*(){for await(const t of f.source)for(const e of t)yield e}()},m=new Qy(this.components,{peerConnection:h,remoteAddr:t,timeline:{open:Date.now()},metrics:this.metrics?.dialerEvents}),g=Zy?"iceconnectionstatechange":"connectionstatechange";h.addEventListener(g,(()=>{switch(h.connectionState){case"failed":case"disconnected":case"closed":m.close().catch((t=>{this.log.error("error closing connection",t)})).finally((()=>{r.abort()}))}}),{signal:i}),this.metrics?.dialerEvents.increment({peer_connection:!0});const b=new ov(this.components,{peerConnection:h,metrics:this.metrics?.dialerEvents,dataChannelOptions:this.init.dataChannel});return await d.secureInbound(p,{signal:i,remotePeer:n}),await e.upgrader.upgradeOutbound(m,{skipProtection:!0,skipEncryption:!0,muxerFactory:b})}catch(t){throw h.close(),t}}generateNoisePrologue(t,e,r){if(0===t.getConfiguration().certificates?.length)throw new T("no local certificate");const i=function(t,e){const r=t.getConfiguration().certificates?.at(0);if(null==r?.getFingerprints){e.log.trace("fetching fingerprint from local SDP");const r=t.localDescription;if(null==r)return;return function(t){const e=t.match(Iv);return e?.groups?.fingerprint}(r.sdp)}if(e.log.trace("fetching fingerprint from local certificate"),0===r.getFingerprints().length)return;const i=r.getFingerprints()[0].value;if(null==i)throw new pv("","no fingerprint on local certificate");return i}(t,{log:this.log});if(null==i)throw new T("no local fingerprint found");const n=Vt(e,dn(i.trim().toLowerCase().replaceAll(":",""),"hex")),s=Av.decode(xv(r));return nh([dn("libp2p-webrtc-noise:"),n.bytes,s])}}function Nv(t){return e=>new Dv(e,t)}function Lv(t){return e=>new kv(e,t)}const Ov=[Fu("tcp").code,Fu("dns").code,Fu("dnsaddr").code,Fu("dns4").code,Fu("dns6").code];function Uv(t){return jv("sni",t)?.[1]}function Fv(t){const e=jv("tcp",t)?.[1];return null==e?"":`:${e}`}function jv(t,e){let r;try{r=Fu(t).code}catch(t){return}for(const[t,i]of e)if(t===r&&null!=i)return[t,i]}function Vv(t){return t.some((([t,e])=>t===Fu("tls").code))}function qv(t,e,r){const i=zv[Fu(t).name];if(null==i)throw new Error(`Can't interpret protocol ${Fu(t).name}`);const n=i(e,r);return t===Fu("ip6").code?`[${n}]`:n}const zv={ip4:(t,e)=>t,ip6:(t,e)=>0===e.length?t:`[${t}]`,tcp:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return`tcp://${qv(r[0],r[1]??"",e)}:${t}`},udp:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return`udp://${qv(r[0],r[1]??"",e)}:${t}`},dnsaddr:(t,e)=>t,dns4:(t,e)=>t,dns6:(t,e)=>t,dns:(t,e)=>t,ipfs:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return`${qv(r[0],r[1]??"",e)}`},p2p:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return`${qv(r[0],r[1]??"",e)}`},http:(t,e)=>{const r=Vv(e),i=Uv(e),n=Fv(e);if(r&&null!=i)return`https://${i}${n}`;const s=r?"https://":"http://",o=e.pop();if(null==o)throw new Error("Unexpected end of multiaddr");let a=qv(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return`${qv(r[0],r[1]??"",e)}/${decodeURIComponent(t)}`},tls:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return qv(r[0],r[1]??"",e)},sni:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");return qv(r[0],r[1]??"",e)},https:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");let i=qv(r[0],r[1]??"",e);return i=i.replace("tcp://",""),`https://${i}`},ws:(t,e)=>{const r=Vv(e),i=Uv(e),n=Fv(e);if(r&&null!=i)return`wss://${i}${n}`;const s=r?"wss://":"ws://",o=e.pop();if(null==o)throw new Error("Unexpected end of multiaddr");let a=qv(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(t,e)=>{const r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");let i=qv(r[0],r[1]??"",e);return i=i.replace("tcp://",""),`wss://${i}`}},Hv=async t=>{if(t.readyState>=2)throw new Error("socket closed");1!==t.readyState&&await new Promise(((e,r)=>{function i(){t.removeEventListener("open",n),t.removeEventListener("error",s)}function n(){i(),e()}function s(e){i(),r(e.error??new Error(`connect ECONNREFUSED ${t.url}`))}t.addEventListener("open",n),t.addEventListener("error",s)}))},$v=(t,e)=>((e=e??{}).closeOnEnd=!1!==e.closeOnEnd,async r=>{for await(const e of r){try{await Hv(t)}catch(t){if("socket closed"===t.message)break;throw t}if(t.readyState===t.CLOSING||t.readyState===t.CLOSED)break;t.send(e)}null!=e.closeOnEnd&&t.readyState<=1&&await new Promise(((e,r)=>{t.addEventListener("close",(t=>{if(t.wasClean||1006===t.code)e();else{const e=Object.assign(new Error("ws error"),{event:t});r(e)}})),setTimeout((()=>{t.close()}))}))});var Wv=r(9106);function Kv(t){return t instanceof ArrayBuffer||"ArrayBuffer"===t?.constructor?.name&&"number"==typeof t?.byteLength}const Gv=WebSocket,Zv={"http:":"ws:","https:":"wss:"};function Yv(t,e){e=e??{};const r=((t,e)=>{if(t.startsWith("//")&&(t=`${e?.protocol??"ws:"}${t}`),t.startsWith("/")&&null!=e){const r=e.protocol??"ws:",i=e.host,n=null!=e.port&&!0!==i?.endsWith(`:${e.port}`)?`:${e.port}`:"";t=`${r}//${i}${n}${t}`}const r=new URL(t);for(const[t,e]of Object.entries(Zv))r.protocol===t&&(r.protocol=e);return r})(t,"undefined"==typeof window?void 0:window.location);return((t,e)=>{e=e??{};const r=(t=>{t.binaryType="arraybuffer";const e=async()=>{await new Promise(((e,r)=>{if(n)return void e();if(null!=i)return void r(i);const s=e=>{t.removeEventListener("open",o),t.removeEventListener("error",a),e()},o=()=>{s(e)},a=e=>{s((()=>{r(e.error??new Error(`connect ECONNREFUSED ${t.url}`))}))};t.addEventListener("open",o),t.addEventListener("error",a)}))},r=async function*(){const r=new Wv.PP((({push:e,stop:r,fail:i})=>{const n=t=>{let r=null;"string"==typeof t.data&&(r=dn(t.data)),Kv(t.data)&&(r=new Uint8Array(t.data)),t.data instanceof Uint8Array&&(r=t.data),null!=r&&e(r)},s=t=>{i(t.error??new Error("Socket error"))};return t.addEventListener("message",n),t.addEventListener("error",s),t.addEventListener("close",r),()=>{t.removeEventListener("message",n),t.removeEventListener("error",s),t.removeEventListener("close",r)}}),{highWaterMark:1/0});await e();for await(const t of r)yield Kv(t)?new Uint8Array(t):t}();let i,n=1===t.readyState;return t.addEventListener("open",(()=>{n=!0,i=null})),t.addEventListener("close",(()=>{n=!1,i=null})),t.addEventListener("error",(e=>{n||(i=e.error??new Error(`connect ECONNREFUSED ${t.url}`))})),Object.assign(r,{connected:e})})(t);let i=e.remoteAddress,n=e.remotePort;if(null!=t.url)try{const e=new URL(t.url);i=e.hostname,n=parseInt(e.port,10)}catch{}if(null==i||null==n)throw new Error("Remote connection did not have address and/or port");return{sink:$v(t,e),source:r,connected:async()=>{await r.connected()},close:async()=>{t.readyState!==t.CONNECTING&&t.readyState!==t.OPEN||await new Promise((e=>{t.addEventListener("close",(()=>{e()})),t.close()}))},destroy:()=>{null!=t.terminate?t.terminate():t.close()},remoteAddress:i,remotePort:n,socket:t}})(new Gv(r.toString(),e.websocket),e)}function Jv(t){return t.filter((t=>Mp.exactMatch(t)||vp.exactMatch(t)))}class Xv{log;init;logger;metrics;components;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:websockets"),this.logger=t.logger,this.components=t,this.init=e,null!=t.metrics&&(this.metrics={dialerEvents:t.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[Zp]=!0;[Symbol.toStringTag]="@libp2p/websockets";[k]=["@libp2p/transport"];async dial(t,e){this.log("dialing %s",t),e=e??{};const r=function(t,e,r){const i=r.logger.forComponent("libp2p:websockets:maconn"),n=r.metrics,s=r.metricPrefix??"",o={log:i,async sink(e){try{await t.sink(async function*(){for await(const t of e)t instanceof Uint8Array?yield t:yield t.subarray()}())}catch(t){"aborted"!==t.type&&i.error(t)}},source:t.source,remoteAddr:e,timeline:{open:Date.now()},async close(e={}){const r=Date.now();if(null==e.signal){const t=AbortSignal.timeout(500);e={...e,signal:t}}const n=()=>{const{host:t,port:e}=o.remoteAddr.toOptions();i("timeout closing stream to %s:%s after %dms, destroying it manually",t,e,Date.now()-r),this.abort(new I("Socket close timeout"))};e.signal?.addEventListener("abort",n);try{await t.close()}catch(t){i.error("error closing WebSocket gracefully",t),this.abort(t)}finally{e.signal?.removeEventListener("abort",n),o.timeline.close=Date.now()}},abort(e){const{host:r,port:a}=o.remoteAddr.toOptions();i("timeout closing stream to %s:%s due to error",r,a,e),t.destroy(),o.timeline.close=Date.now(),n?.increment({[`${s}error`]:!0})}};return t.socket.addEventListener("close",(()=>{n?.increment({[`${s}close`]:!0}),null==o.timeline.close&&(o.timeline.close=Date.now())}),{once:!0}),o}(await this._connect(t,e),t,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",r.remoteAddr);const i=await e.upgrader.upgradeOutbound(r,e);return this.log("outbound connection %s upgraded",r.remoteAddr),i}async _connect(t,e){e?.signal?.throwIfAborted();const r=t.toOptions();this.log("dialing %s:%s",r.host,r.port);const i=vh(),n=Yv(function(t){const e=Ud(t).stringTuples(),r=e.pop();if(null==r)throw new Error("Unexpected end of multiaddr");const i=Fu(r[0]),n=zv[i.name];if(null==n)throw new Error(`No interpreter found for ${i.name}`);let s=n(r[1]??"",e);return Ov.includes(r[0])&&(s=s.replace(/^.*:\/\//,""),s="443"===r[1]?`https://${s}`:`http://${s}`),(s.startsWith("http://")||s.startsWith("https://")||s.startsWith("ws://")||s.startsWith("wss://"))&&(s=new URL(s).toString(),s.endsWith("/")&&(s=s.substring(0,s.length-1))),s}(t),this.init);n.socket.addEventListener("error",(()=>{const e=new N(`Could not connect to ${t.toString()}`);this.log.error("connection error:",e),this.metrics?.dialerEvents.increment({error:!0}),i.reject(e)}));try{e.onProgress?.(new im("websockets:open-connection")),await ic(Promise.race([n.connected(),i.promise]),e.signal)}catch(t){throw!0===e.signal?.aborted&&this.metrics?.dialerEvents.increment({abort:!0}),n.close().catch((t=>{this.log.error("error closing raw socket",t)})),t}return this.log("connected %s",t),this.metrics?.dialerEvents.increment({connect:!0}),n}createListener(t){return function(){throw new Error("WebSocket Servers can not be created in the browser!")}((this.logger,this.components.events,this.components.metrics),this.init)}listenFilter(t){return t=Array.isArray(t)?t:[t],null!=this.init?.filter?this.init?.filter(t):Jv(t)}dialFilter(t){return this.listenFilter(t)}}function Qv(t={}){return e=>new Xv(e,t)}class tw extends Fl{writer;reader;constructor(t){super(t),this.writer=t.bidiStream.writable.getWriter(),this.reader=t.bidiStream.readable.getReader(),Promise.resolve().then((async()=>{for(;;){const e=await this.reader.read();if(e.done)return void t.log("remote closed write");null!=e.value&&this.sourcePush(new hh(e.value))}})).catch((e=>{t.log.error("error reading from stream",e),this.abort(e)})).finally((()=>{this.remoteCloseWrite()})),this.writer.closed.then((()=>{t.log("writer closed")})).catch((e=>{t.log("writer close promise rejected",e)})).finally((()=>{this.remoteCloseRead()}))}sendNewStream(t){}async sendData(t,e){for await(const r of t)this.log("sendData waiting for writer to be ready"),await ic(this.writer.ready,e?.signal),this.writer.write(r).catch((t=>{this.log.error("error sending stream data",t)}))}async sendReset(t){this.log("sendReset aborting writer"),await ic(this.writer.abort(),t?.signal),this.log("sendReset aborted writer")}async sendCloseWrite(t){this.log("sendCloseWrite closing writer"),await ic(this.writer.close(),t?.signal),this.log("sendCloseWrite closed writer")}async sendCloseRead(t){this.log("sendCloseRead cancelling reader"),await ic(this.reader.cancel(),t?.signal),this.log("sendCloseRead cancelled reader")}}async function ew(t,e,r,i,n,s){const o=s.forComponent(`libp2p:webtransport:stream:${r}:${e}`),a=new tw({bidiStream:t,id:e,direction:r,log:o,onEnd:()=>{const t=i.findIndex((t=>t===a));-1!==t&&i.splice(t,1),n?.(a)}});return a}function rw(){return{source:{[Symbol.asyncIterator]:()=>({next:async()=>new Promise((()=>{}))})},sink:async t=>new Promise((()=>{}))}}function iw(t,e,r,i){let n=0;const s=r.forComponent("libp2p:webtransport:muxer");return{protocol:"webtransport",createStreamMuxer:o=>{"function"==typeof o&&(o={onIncomingStream:o});const a=[];Promise.resolve().then((async()=>{for(;;){const{done:t,value:h}=await e.read();if(t)break;if(a.length>=i.maxInboundStreams)s(`too many inbound streams open - ${a.length}/${i.maxInboundStreams}, closing new incoming stream`),h.writable.close().catch((t=>{s.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${t.message}`)})),h.readable.cancel().catch((t=>{s.error(`failed to close inbound stream that crossed our maxInboundStream limit: ${t.message}`)}));else{const t=await ew(h,String(n++),"inbound",a,o?.onStreamEnd,r);a.push(t),o?.onIncomingStream?.(t)}}})).catch((t=>{s.error("could not create a new stream",t)}));const h={protocol:"webtransport",streams:a,newStream:async e=>{s("new outgoing stream",e);const i=await t.createBidirectionalStream(),h=await ew(i,String(n++),o?.direction??"outbound",a,o?.onStreamEnd,r);return a.push(h),h},close:async()=>{s("closing webtransport muxer gracefully");try{t.close()}catch(t){h.abort(t)}},abort:e=>{s("closing webtransport muxer with err:",e);try{t.close()}catch(e){s.error("webtransport session threw error during close",e)}},...rw()};return h}}}const nw=Object.values(an).map((t=>t.decoder)).reduce(((t,e)=>t.or(e)));function sw(t){if(!kp.matches(t))throw new V("Invalid multiaddr, was not a WebTransport address");const e=t.stringTuples(),r=e.filter((([t,e])=>t===Fu("certhash").code)).map((([t,e])=>function(t){return qt(nw.decode(t))}(e??""))),i=e.filter((([t,e])=>t===Fu("p2p").code)).map((([t,e])=>th(e??"")))[0],n=t.toOptions();let s=n.host;return 6===n.family&&s?.includes(":")&&(s=`[${s}]`),{url:`https://${s}:${n.port}`,certhashes:r,remotePeer:i}}const ow=globalThis.WebTransport;class aw{log;components;config;metrics;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:webtransport"),this.components=t,this.config={...e,maxInboundStreams:e.maxInboundStreams??1e3,certificates:e.certificates??[]},null!=t.metrics&&(this.metrics={dialerEvents:t.metrics.registerCounterGroup("libp2p_webtransport_dialer_events_total",{label:"event",help:"Total count of WebTransport dialer events by type"})})}[Symbol.toStringTag]="@libp2p/webtransport";[Zp]=!0;[k]=["@libp2p/transport"];async dial(t,e){e?.signal?.throwIfAborted(),this.log("dialing %s",t),e=e??{};const{url:r,certhashes:i,remotePeer:n}=sw(t);let s,o,a=()=>{},h=!1,u=!1,c=!1;try{this.metrics?.dialerEvents.increment({pending:!0});const l=new ow(`${r}/.well-known/libp2p-webtransport?type=noise`,{serverCertificateHashes:i.map((t=>({algorithm:"sha-256",value:t.digest})))});if(a=t=>{if(!h)try{this.metrics?.dialerEvents.increment({[t]:!0}),l.close()}catch(t){this.log.error("error closing wt session",t)}finally{null!=o&&(o.timeline.close=Date.now()),h=!0}},s=()=>{a(u?"noise_timeout":"ready_timeout")},e.signal?.addEventListener("abort",s,{once:!0}),this.log("wait for session to be ready"),e.onProgress?.(new im("webtransport:wait-for-session")),await Promise.race([l.closed,l.ready]),this.log("session became ready"),u=!0,this.metrics?.dialerEvents.increment({ready:!0}),l.closed.catch((t=>{this.log.error("error on remote wt session close",t)})).finally((()=>{a("remote_close")})),c=await ic(this.authenticateWebTransport({wt:l,remotePeer:n,certhashes:i,...e}),e.signal),!c)throw new C("Failed to authenticate webtransport");return this.metrics?.dialerEvents.increment({open:!0}),o={close:async()=>{this.log("closing webtransport"),a("close")},abort:t=>{this.log("aborting webtransport due to passed err",t),a("abort")},remoteAddr:t,timeline:{open:Date.now()},log:this.components.logger.forComponent("libp2p:webtransport:maconn"),...rw()},await e.upgrader.upgradeOutbound(o,{skipEncryption:!0,muxerFactory:iw(l,l.incomingBidirectionalStreams.getReader(),this.components.logger,this.config),skipProtection:!0,onProgress:e.onProgress})}catch(t){throw this.log.error("caught wt session err",t),a(c?"upgrade_error":u?"noise_error":"ready_error"),t}finally{null!=s&&e.signal?.removeEventListener("abort",s)}}async authenticateWebTransport({wt:t,remotePeer:e,certhashes:r,onProgress:i,signal:n}){n?.throwIfAborted(),i?.(new im("webtransport:open-authentication-stream"));const s=await t.createBidirectionalStream(),o=s.writable.getWriter(),a=s.readable.getReader(),h={source:async function*(){for(;;){const t=await a.read();if(null!=t.value&&(yield t.value),t.done)break}}(),sink:async t=>{for await(const e of t){await ic(o.ready,n);const t=e instanceof Uint8Array?e:e.subarray();o.write(t).catch((t=>{this.log.error("could not write chunk during authentication of WebTransport stream",t)}))}}},u=vl()(this.components);i?.(new im("webtransport:secure-outbound-connection"));const{remoteExtensions:c}=await u.secureOutbound(h,{signal:n,remotePeer:e});if(i?.(new im("webtransport:close-authentication-stream")),o.close().catch((t=>{this.log.error(`Failed to close authentication stream writer: ${t.message}`)})),a.cancel().catch((t=>{this.log.error(`Failed to close authentication stream reader: ${t.message}`)})),l=c?.webtransportCerthashes??[],(d=r.map((t=>t.bytes))).filter((t=>Boolean(l.find((e=>te(t,e)))))).length!==d.length)throw new T("Our certhashes are not a subset of the remote's reported certhashes");var l,d;return!0}createListener(t){return function(){throw new Error("Not implemented")}(this.components,(this.config.certificates,this.config.maxInboundStreams))}listenFilter(){return[]}dialFilter(t){return null==globalThis.WebTransport?[]:t.filter((t=>{if(!kp.exactMatch(t))return!1;const{url:e,certhashes:r}=sw(t);return null!=e&&r.length>0}))}}function hw(t={}){return e=>new aw(e,t)}var uw=r(7178);class cw{#u=[];enqueue(t,e){const r={priority:(e={priority:0,...e}).priority,run:t};if(this.size&&this.#u[this.size-1].priority>=e.priority)return void this.#u.push(r);const i=function(t,e){let r=0,i=t.length;for(;i>0;){const s=Math.trunc(i/2);let o=r+s;n=t[o],e.priority-n.priority<=0?(r=++o,i-=s+1):i=s}var n;return r}(this.#u,r);this.#u.splice(i,0,r)}dequeue(){const t=this.#u.shift();return t?.run}filter(t){return this.#u.filter((e=>e.priority===t.priority)).map((t=>t.run))}get size(){return this.#u.length}}class lw extends uw{#c;#l;#d=0;#f;#p;#m=0;#g;#b;#u;#y;#v=0;#w;#M;#_;timeout;constructor(t){if(super(),!("number"==typeof(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:cw,...t}).intervalCap&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap?.toString()??""}\` (${typeof t.intervalCap})`);if(void 0===t.interval||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval?.toString()??""}\` (${typeof t.interval})`);this.#c=t.carryoverConcurrencyCount,this.#l=t.intervalCap===Number.POSITIVE_INFINITY||0===t.interval,this.#f=t.intervalCap,this.#p=t.interval,this.#u=new t.queueClass,this.#y=t.queueClass,this.concurrency=t.concurrency,this.timeout=t.timeout,this.#_=!0===t.throwOnTimeout,this.#M=!1===t.autoStart}get#S(){return this.#l||this.#d<this.#f}get#E(){return this.#v<this.#w}#k(){this.#v--,this.#A(),this.emit("next")}#I(){this.#x(),this.#C(),this.#b=void 0}get#T(){const t=Date.now();if(void 0===this.#g){const e=this.#m-t;if(!(e<0))return void 0===this.#b&&(this.#b=setTimeout((()=>{this.#I()}),e)),!0;this.#d=this.#c?this.#v:0}return!1}#A(){if(0===this.#u.size)return this.#g&&clearInterval(this.#g),this.#g=void 0,this.emit("empty"),0===this.#v&&this.emit("idle"),!1;if(!this.#M){const t=!this.#T;if(this.#S&&this.#E){const e=this.#u.dequeue();return!!e&&(this.emit("active"),e(),t&&this.#C(),!0)}}return!1}#C(){this.#l||void 0!==this.#g||(this.#g=setInterval((()=>{this.#x()}),this.#p),this.#m=Date.now()+this.#p)}#x(){0===this.#d&&0===this.#v&&this.#g&&(clearInterval(this.#g),this.#g=void 0),this.#d=this.#c?this.#v:0,this.#P()}#P(){for(;this.#A(););}get concurrency(){return this.#w}set concurrency(t){if(!("number"==typeof t&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);this.#w=t,this.#P()}async#B(t){return new Promise(((e,r)=>{t.addEventListener("abort",(()=>{r(t.reason)}),{once:!0})}))}async add(t,e={}){return e={timeout:this.timeout,throwOnTimeout:this.#_,...e},new Promise(((r,i)=>{this.#u.enqueue((async()=>{this.#v++,this.#d++;try{e.signal?.throwIfAborted();let i=t({signal:e.signal});e.timeout&&(i=Wy(Promise.resolve(i),{milliseconds:e.timeout})),e.signal&&(i=Promise.race([i,this.#B(e.signal)]));const n=await i;r(n),this.emit("completed",n)}catch(t){if(t instanceof qy&&!e.throwOnTimeout)return void r();i(t),this.emit("error",t)}finally{this.#k()}}),e),this.emit("add"),this.#A()}))}async addAll(t,e){return Promise.all(t.map((async t=>this.add(t,e))))}start(){return this.#M?(this.#M=!1,this.#P(),this):this}pause(){this.#M=!0}clear(){this.#u=new this.#y}async onEmpty(){0!==this.#u.size&&await this.#R("empty")}async onSizeLessThan(t){this.#u.size<t||await this.#R("next",(()=>this.#u.size<t))}async onIdle(){0===this.#v&&0===this.#u.size||await this.#R("idle")}async#R(t,e){return new Promise((r=>{const i=()=>{e&&!e()||(this.off(t,i),r())};this.on(t,i)}))}get size(){return this.#u.size}sizeBy(t){return this.#u.filter(t).length}get pending(){return this.#v}get isPaused(){return this.#M}}function dw(t){const e=[mw.A];return null==t?e:Array.isArray(t)?0===t.length?e:t:[t]}function fw(t){return{Status:t.Status??0,TC:t.TC??t.flag_tc??!1,RD:t.RD??t.flag_rd??!1,RA:t.RA??t.flag_ra??!1,AD:t.AD??t.flag_ad??!1,CD:t.CD??t.flag_cd??!1,Question:(t.Question??t.questions??[]).map((t=>({name:t.name,type:mw[t.type]}))),Answer:(t.Answer??t.answers??[]).map((t=>({name:t.name,type:mw[t.type],TTL:t.TTL??t.ttl??60,data:t.data instanceof Uint8Array?sa(t.data):t.data})))}}function pw(t,e={}){const r=new lw({concurrency:e.queryConcurrency??4});return async(e,i={})=>{const n=new URLSearchParams;n.set("name",e),dw(i.types).forEach((t=>{n.append("type",mw[t])})),i.onProgress?.(new im("dns:query",{detail:e}));const s=await r.add((async()=>{const e=await fetch(`${t}?${n}`,{headers:{accept:"application/dns-json"},signal:i?.signal});if(200!==e.status)throw new Error(`Unexpected HTTP status: ${e.status} - ${e.statusText}`);const r=fw(await e.json());return i.onProgress?.(new im("dns:response",{detail:r})),r}),{signal:i.signal});if(null==s)throw new Error("No DNS response received");return s}}var mw,gw=r(9991);class bw{lru;constructor(t){this.lru=gw(t)}get(t,e){let r=!0;const i=[];for(const n of e){const e=this.getAnswers(t,n);if(0===e.length){r=!1;break}i.push(...e)}if(r)return fw({answers:i})}getAnswers(t,e){const r=`${t.toLowerCase()}-${e}`,i=this.lru.get(r);if(null!=i){const t=i.filter((t=>t.expires>Date.now())).map((({expires:t,value:e})=>({...e,TTL:Math.round((t-Date.now())/1e3),type:mw[e.type]})));return 0===t.length&&this.lru.remove(r),t}return[]}add(t,e){const r=`${t.toLowerCase()}-${e.type}`,i=this.lru.get(r)??[];i.push({expires:Date.now()+1e3*(e.TTL??60),value:e}),this.lru.set(r,i)}remove(t,e){const r=`${t.toLowerCase()}-${e}`;this.lru.remove(r)}clear(){this.lru.clear()}}class yw{resolvers;cache;constructor(t){var e;this.resolvers={},this.cache=(e=t.cacheSize??1e3,new bw(e)),Object.entries(t.resolvers??{}).forEach((([t,e])=>{Array.isArray(e)||(e=[e]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=e})),null==this.resolvers["."]&&(this.resolvers["."]=[pw("https://cloudflare-dns.com/dns-query"),pw("https://dns.google/resolve")])}async query(t,e={}){const r=dw(e.types),i=!1!==e.cached?this.cache.get(t,r):void 0;if(null!=i)return e.onProgress?.(new im("dns:cache",{detail:i})),i;const n=`${t.split(".").pop()}.`,s=(this.resolvers[n]??this.resolvers["."]).sort((()=>Math.random()>.5?-1:1)),o=[];for(const i of s){if(!0===e.signal?.aborted)break;try{const n=await i(t,{...e,types:r});for(const e of n.Answer)this.cache.add(t,e);return n}catch(t){o.push(t),e.onProgress?.(new im("dns:error",{detail:t}))}}if(1===o.length)throw o[0];throw new AggregateError(o,`DNS lookup of ${t} ${r} failed`)}}!function(t){t[t.A=1]="A",t[t.CNAME=5]="CNAME",t[t.TXT=16]="TXT",t[t.AAAA=28]="AAAA"}(mw||(mw={}));const{code:vw}=Fu("dnsaddr");class ww extends Error{constructor(t="Max recursive depth reached"){super(t),this.name="RecursionLimitError"}}const Mw=async function(t,e={}){const r=e.maxRecursiveDepth??32;if(0===r)throw new ww("Max recursive depth reached");const[,i]=t.stringTuples().find((([t])=>t===vw))??[],n=e?.dns??function(t={}){return new yw(t)}(),s=await n.query(`_dnsaddr.${i}`,{signal:e?.signal,types:[mw.TXT]}),o=t.getPeerId(),a=[];for(const t of s.Answer){const i=t.data.replace(/["']/g,"").trim().split("=")[1];if(null==i)continue;if(null!=o&&!i.includes(o))continue;const n=Ud(i);if(i.startsWith("/dnsaddr")){const t=await n.resolve({...e,maxRecursiveDepth:r-1});a.push(...t.map((t=>t.toString())))}else a.push(n.toString())}return a},_w=r(6965),Sw={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:t=>t},connectionManager:{resolvers:{dnsaddr:Mw}},transportManager:{faultTolerance:Yp.FATAL_ALL}};async function Ew(t){const e=_w(Sw,t);if(null===e.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw new T("Private network is enforced, but no protector was provided");return e}const kw=Symbol.for("@libp2p/content-routing"),Aw=Symbol.for("@libp2p/peer-routing"),Iw=function(t){if(null!=t[Symbol.asyncIterator])return(async()=>{const e=[];for await(const r of t)e.push(r);return e})();const e=[];for(const r of t)e.push(r);return e},xw={},Cw=t=>{t.addEventListener("message",(e=>{Cw.dispatchEvent("message",t,e)})),null!=t.port&&t.port.addEventListener("message",(e=>{Cw.dispatchEvent("message",t,e)}))};Cw.addEventListener=(t,e)=>{null==xw[t]&&(xw[t]=[]),xw[t].push(e)},Cw.removeEventListener=(t,e)=>{null!=xw[t]&&(xw[t]=xw[t].filter((t=>t===e)))},Cw.dispatchEvent=function(t,e,r){null!=xw[t]&&xw[t].forEach((t=>t(e,r)))};const Tw=Cw,Pw="lock:worker:request-read",Bw="lock:worker:release-read",Rw="lock:master:grant-read",Dw="lock:worker:request-write",Nw="lock:worker:release-write",Lw="lock:master:grant-write",Ow=(t,e,r,i,n)=>(s,o)=>{if(o.data.type!==r)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};t.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{s.postMessage({type:n,name:a.name,identifier:a.identifier}),await new Promise((t=>{const e=r=>{if(null==r?.data)return;const n=r.data.type,o=(r.data.name,r.data.identifier);n===i&&o===a.identifier&&(s.removeEventListener("message",e),t())};s.addEventListener("message",e)}))}}}))},Uw=(t,e,r,i)=>async()=>{const n=Math.random().toString().substring(2);return globalThis.postMessage({type:e,identifier:n,name:t}),new Promise((e=>{const s=o=>{if(null==o?.data)return;const a=o.data.type,h=o.data.identifier;a===r&&h===n&&(globalThis.removeEventListener("message",s),e((()=>{globalThis.postMessage({type:i,identifier:n,name:t})})))};globalThis.addEventListener("message",s)}))},Fw={singleProcess:!1},jw={};let Vw;async function qw(t,e){let r;const i=new Promise((t=>{r=t}));return t.add((async()=>Wy((async()=>{await new Promise((t=>{r((()=>{t()}))}))})(),{milliseconds:e.timeout}))),i}const zw={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};var Hw,$w,Ww;function Kw(t,e){const r=Hw.decode(e);null!=r.publicKey&&null==t.publicKey&&(t=eh(Ha(r.publicKey)));const i=new Map,n=BigInt(Date.now());for(const[t,e]of r.tags.entries())null!=e.expiry&&e.expiry<n||i.set(t,e);return{...r,id:t,addresses:r.addresses.map((({multiaddr:t,isCertified:e})=>({multiaddr:Ud(t),isCertified:e??!1}))),metadata:r.metadata,peerRecordEnvelope:r.peerRecordEnvelope??void 0,tags:i}}!function(t){let e,r,i;!function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.key&&""!==t.key&&(e.uint32(10),e.string(t.key)),null!=t.value&&t.value.byteLength>0&&(e.uint32(18),e.bytes(t.value)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={key:"",value:Qr(0)},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.key=t.string();break;case 2:i.value=t.bytes();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(e=t.Peer$metadataEntry||(t.Peer$metadataEntry={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.key&&""!==t.key&&(e.uint32(10),e.string(t.key)),null!=t.value&&(e.uint32(18),Ww.codec().encode(t.value,e)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={key:""},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.key=t.string();break;case 2:i.value=Ww.codec().decode(t,t.uint32(),{limits:r.limits?.value});break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(r=t.Peer$tagsEntry||(t.Peer$tagsEntry={})),t.codec=()=>(null==i&&(i=Dn(((e,r,i={})=>{if(!1!==i.lengthDelimited&&r.fork(),null!=e.addresses)for(const t of e.addresses)r.uint32(10),$w.codec().encode(t,r);if(null!=e.protocols)for(const t of e.protocols)r.uint32(18),r.string(t);if(null!=e.publicKey&&(r.uint32(34),r.bytes(e.publicKey)),null!=e.peerRecordEnvelope&&(r.uint32(42),r.bytes(e.peerRecordEnvelope)),null!=e.metadata&&0!==e.metadata.size)for(const[i,n]of e.metadata.entries())r.uint32(50),t.Peer$metadataEntry.codec().encode({key:i,value:n},r);if(null!=e.tags&&0!==e.tags.size)for(const[i,n]of e.tags.entries())r.uint32(58),t.Peer$tagsEntry.codec().encode({key:i,value:n},r);!1!==i.lengthDelimited&&r.ldelim()}),((e,r,i={})=>{const n={addresses:[],protocols:[],metadata:new Map,tags:new Map},s=null==r?e.len:e.pos+r;for(;e.pos<s;){const r=e.uint32();switch(r>>>3){case 1:if(null!=i.limits?.addresses&&n.addresses.length===i.limits.addresses)throw new Nn('Decode error - map field "addresses" had too many elements');n.addresses.push($w.codec().decode(e,e.uint32(),{limits:i.limits?.addresses$}));break;case 2:if(null!=i.limits?.protocols&&n.protocols.length===i.limits.protocols)throw new Nn('Decode error - map field "protocols" had too many elements');n.protocols.push(e.string());break;case 4:n.publicKey=e.bytes();break;case 5:n.peerRecordEnvelope=e.bytes();break;case 6:{if(null!=i.limits?.metadata&&n.metadata.size===i.limits.metadata)throw new Ln('Decode error - map field "metadata" had too many elements');const r=t.Peer$metadataEntry.codec().decode(e,e.uint32());n.metadata.set(r.key,r.value);break}case 7:{if(null!=i.limits?.tags&&n.tags.size===i.limits.tags)throw new Ln('Decode error - map field "tags" had too many elements');const r=t.Peer$tagsEntry.codec().decode(e,e.uint32(),{limits:{value:i.limits?.tags$value}});n.tags.set(r.key,r.value);break}default:e.skipType(7&r)}}return n}))),i),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Hw||(Hw={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.multiaddr&&t.multiaddr.byteLength>0&&(e.uint32(10),e.bytes(t.multiaddr)),null!=t.isCertified&&(e.uint32(16),e.bool(t.isCertified)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={multiaddr:Qr(0)},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.multiaddr=t.bytes();break;case 2:i.isCertified=t.bool();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}($w||($w={})),function(t){let e;t.codec=()=>(null==e&&(e=Dn(((t,e,r={})=>{!1!==r.lengthDelimited&&e.fork(),null!=t.value&&0!==t.value&&(e.uint32(8),e.uint32(t.value)),null!=t.expiry&&(e.uint32(16),e.uint64(t.expiry)),!1!==r.lengthDelimited&&e.ldelim()}),((t,e,r={})=>{const i={value:0},n=null==e?t.len:t.pos+e;for(;t.pos<n;){const e=t.uint32();switch(e>>>3){case 1:i.value=t.uint32();break;case 2:i.expiry=t.uint64();break;default:t.skipType(7&e)}}return i}))),e),t.encode=e=>An(e,t.codec()),t.decode=(e,r)=>Ti(e,t.codec(),r)}(Ww||(Ww={}));const Gw="/",Zw=(new TextEncoder).encode(Gw),Yw=Zw[0];class Jw{_buf;constructor(t,e){if("string"==typeof t)this._buf=dn(t);else{if(!(t instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=t}if(null==e&&(e=!0),e&&this.clean(),0===this._buf.byteLength||this._buf[0]!==Yw)throw new Error("Invalid key")}toString(t="utf8"){return sa(this._buf,t)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(t){return new Jw(t.join(Gw))}static random(){return new Jw(Math.random().toString().substring(2))}static asKey(t){return t instanceof Uint8Array||"string"==typeof t?new Jw(t):"function"==typeof t.uint8Array?new Jw(t.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=Zw),this._buf[0]!==Yw){const t=new Uint8Array(this._buf.byteLength+1);t.fill(Yw,0,1),t.set(this._buf,1),this._buf=t}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Yw;)this._buf=this._buf.subarray(0,-1)}less(t){const e=this.list(),r=t.list();for(let t=0;t<e.length;t++){if(r.length<t+1)return!1;const i=e[t],n=r[t];if(i<n)return!0;if(i>n)return!1}return e.length<r.length}reverse(){return Jw.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const t=this.namespaces();return t[t.length-1]}list(){return this.toString().split(Gw).slice(1)}type(){return function(t){const e=t.split(":");return e.length<2?"":e.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(t){const e=t.split(":");return e[e.length-1]}(this.baseNamespace())}instance(t){return new Jw(this.toString()+":"+t)}path(){let t=this.parent().toString();return t.endsWith(Gw)||(t+=Gw),t+=this.type(),new Jw(t)}parent(){const t=this.list();return 1===t.length?new Jw(Gw):new Jw(t.slice(0,-1).join(Gw))}child(t){return this.toString()===Gw?t:t.toString()===Gw?this:new Jw(this.toString()+t.toString(),!1)}isAncestorOf(t){return t.toString()!==this.toString()&&t.toString().startsWith(this.toString())}isDecendantOf(t){return t.toString()!==this.toString()&&this.toString().startsWith(t.toString())}isTopLevel(){return 1===this.list().length}concat(...t){return Jw.withNamespaces([...this.namespaces(),...(e=t.map((t=>t.namespaces())),[].concat(...e))]);var e}}const Xw="/peers/";function Qw(t){if(!Ka(t)||null==t.type)throw new T("Invalid PeerId");const e=t.toCID().toString();return new Jw(`${Xw}${e}`)}async function tM(t,e,r){const i=new Map;for(const n of r){if(null==n)continue;if(n.multiaddr instanceof Uint8Array&&(n.multiaddr=Ud(n.multiaddr)),!Od(n.multiaddr))throw new T("Multiaddr was invalid");if(!await e(t,n.multiaddr))continue;const r=n.isCertified??!1,s=n.multiaddr.toString(),o=i.get(s);null!=o?n.isCertified=o.isCertified||r:i.set(s,{multiaddr:n.multiaddr,isCertified:r})}return[...i.values()].sort(((t,e)=>t.multiaddr.toString().localeCompare(e.multiaddr.toString()))).map((({isCertified:t,multiaddr:e})=>({isCertified:t,multiaddr:e.bytes})))}async function eM(t,e,r,i){if(null==e)throw new T("Invalid PeerData");if(null!=e.publicKey&&null!=t.publicKey&&!e.publicKey.equals(t.publicKey))throw new T("publicKey bytes do not match peer id publicKey bytes");const n=i.existingPeer;if(null!=n&&!t.equals(n.id))throw new T("peer id did not match existing peer id");let s,o=n?.addresses??[],a=new Set(n?.protocols??[]),h=n?.metadata??new Map,u=n?.tags??new Map,c=n?.peerRecordEnvelope;if("patch"===r&&(null==e.multiaddrs&&null==e.addresses||(o=[],null!=e.multiaddrs&&o.push(...e.multiaddrs.map((t=>({isCertified:!1,multiaddr:t})))),null!=e.addresses&&o.push(...e.addresses)),null!=e.protocols&&(a=new Set(e.protocols)),null!=e.metadata&&(h=rM(e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata),{validate:iM})),null!=e.tags&&(u=rM(e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),{validate:nM,map:sM})),null!=e.peerRecordEnvelope&&(c=e.peerRecordEnvelope)),"merge"===r){if(null!=e.multiaddrs&&o.push(...e.multiaddrs.map((t=>({isCertified:!1,multiaddr:t})))),null!=e.addresses&&o.push(...e.addresses),null!=e.protocols&&(a=new Set([...a,...e.protocols])),null!=e.metadata){const t=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[e,r]of t)null==r?h.delete(e):h.set(e,r);h=rM([...h.entries()],{validate:iM})}if(null!=e.tags){const t=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),r=new Map(u);for(const[e,i]of t)null==i?r.delete(e):r.set(e,i);u=rM([...r.entries()],{validate:nM,map:sM})}null!=e.peerRecordEnvelope&&(c=e.peerRecordEnvelope)}null!=n?.id.publicKey?s=$a(n.id.publicKey):null!=e.publicKey?s=$a(e.publicKey):null!=t.publicKey&&(s=$a(t.publicKey));const l={addresses:await tM(t,i.addressFilter??(async()=>!0),o),protocols:[...a.values()].sort(((t,e)=>t.localeCompare(e))),metadata:h,tags:u,publicKey:s,peerRecordEnvelope:c};return"RSA"!==t.type&&delete l.publicKey,l}function rM(t,e){const r=new Map;for(const[r,i]of t)null!=i&&e.validate(r,i);for(const[i,n]of t.sort((([t],[e])=>t.localeCompare(e))))null!=n&&r.set(i,e.map?.(i,n)??n);return r}function iM(t,e){if("string"!=typeof t)throw new T("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new T("Metadata value must be a Uint8Array")}function nM(t,e){if("string"!=typeof t)throw new T("Tag name must be a string");if(null!=e.value){if(parseInt(`${e.value}`,10)!==e.value)throw new T("Tag value must be an integer");if(e.value<0||e.value>100)throw new T("Tag value must be between 0-100")}if(null!=e.ttl){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new T("Tag ttl must be an integer");if(e.ttl<0)throw new T("Tag ttl must be between greater than 0")}}function sM(t,e){let r;return null!=e.expiry&&(r=e.expiry),null!=e.ttl&&(r=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:r}}function oM(t,e){const r=t.toString().split("/")[2];return Kw(ih(Kt.parse(r,dt)),e)}class aM{peerId;datastore;lock;addressFilter;log;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:peer-store"),this.peerId=t.peerId,this.datastore=t.datastore,this.addressFilter=e.addressFilter,this.lock=function(t){const e=Object.assign({},zw,t);return null==Vw&&(Vw=(t=>{if(t=Object.assign({},Fw,t),Boolean(globalThis.document)||t.singleProcess){const t=new EventTarget;return Tw.addEventListener("message",Ow(t,"requestReadLock",Pw,Bw,Rw)),Tw.addEventListener("message",Ow(t,"requestWriteLock",Dw,Nw,Lw)),t}return{isWorker:!0,readLock:t=>Uw(t,Pw,Rw,Bw),writeLock:t=>Uw(t,Dw,Lw,Nw)}})(e),!0!==Vw.isWorker&&(Vw.addEventListener("requestReadLock",(t=>{null!=jw[t.data.name]&&jw[t.data.name].readLock().then((async e=>t.data.handler().finally((()=>{e()}))))})),Vw.addEventListener("requestWriteLock",(async t=>{null!=jw[t.data.name]&&jw[t.data.name].writeLock().then((async e=>t.data.handler().finally((()=>{e()}))))})))),null==jw[e.name]&&(jw[e.name]=((t,e)=>{if(!0===Vw.isWorker)return{readLock:Vw.readLock(t,e),writeLock:Vw.writeLock(t,e)};const r=new lw({concurrency:1});let i;return{async readLock(){if(null!=i)return qw(i,e);i=new lw({concurrency:e.concurrency,autoStart:!1});const t=i,n=qw(i,e);return r.add((async()=>{t.start(),await t.onIdle().then((()=>{i===t&&(i=null)}))})),n},writeLock:async()=>(i=null,qw(r,e))}})(e.name,e)),jw[e.name]}({name:"peer-store",singleProcess:!0})}async has(t){return this.datastore.has(Qw(t))}async delete(t){if(this.peerId.equals(t))throw new T("Cannot delete self peer");await this.datastore.delete(Qw(t))}async load(t){return Kw(t,await this.datastore.get(Qw(t)))}async save(t,e){const{existingBuf:r,existingPeer:i}=await this.#D(t),n=await eM(t,e,"patch",{addressFilter:this.addressFilter});return this.#N(t,n,r,i)}async patch(t,e){const{existingBuf:r,existingPeer:i}=await this.#D(t),n=await eM(t,e,"patch",{addressFilter:this.addressFilter,existingPeer:i});return this.#N(t,n,r,i)}async merge(t,e){const{existingBuf:r,existingPeer:i}=await this.#D(t),n=await eM(t,e,"merge",{addressFilter:this.addressFilter,existingPeer:i});return this.#N(t,n,r,i)}async*all(t){for await(const{key:e,value:r}of this.datastore.query(function(t){return null==t?{}:{prefix:Xw,filters:(t.filters??[]).map((t=>({key:e,value:r})=>t(oM(e,r)))),orders:(t.orders??[]).map((t=>(e,r)=>t(oM(e.key,e.value),oM(r.key,r.value))))}}(t??{}))){const t=oM(e,r);t.id.equals(this.peerId)||(yield t)}}async#D(t){try{const e=await this.datastore.get(Qw(t));return{existingBuf:e,existingPeer:Kw(t,e)}}catch(t){"NotFoundError"!==t.name&&this.log.error("invalid peer data found in peer store - %e",t)}return{}}async#N(t,e,r,i){const n=Hw.encode(e);return null!=r&&te(n,r)?{peer:Kw(t,n),previous:i,updated:!1}:(await this.datastore.put(Qw(t),n),{peer:Kw(t,n),previous:i,updated:!0})}}class hM{store;events;peerId;log;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:peer-store"),this.events=t.events,this.peerId=t.peerId,this.store=new aM(t,e)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(t,e){this.log.trace("forEach await read lock");const r=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const r of this.store.all(e))t(r)}finally{this.log.trace("forEach release read lock"),r()}}async all(t){this.log.trace("all await read lock");const e=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Iw(this.store.all(t))}finally{this.log.trace("all release read lock"),e()}}async delete(t){this.log.trace("delete await write lock");const e=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(t)}finally{this.log.trace("delete release write lock"),e()}}async has(t){this.log.trace("has await read lock");const e=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(t)}finally{this.log.trace("has release read lock"),e()}}async get(t){this.log.trace("get await read lock");const e=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(t)}finally{this.log.trace("get release read lock"),e()}}async save(t,e){this.log.trace("save await write lock");const r=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const r=await this.store.save(t,e);return this.#L(t,r),r.peer}finally{this.log.trace("save release write lock"),r()}}async patch(t,e){this.log.trace("patch await write lock");const r=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const r=await this.store.patch(t,e);return this.#L(t,r),r.peer}finally{this.log.trace("patch release write lock"),r()}}async merge(t,e){this.log.trace("merge await write lock");const r=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const r=await this.store.merge(t,e);return this.#L(t,r),r.peer}finally{this.log.trace("merge release write lock"),r()}}async consumePeerRecord(t,e){const r=await Af.openAndCertify(t,uy.DOMAIN),i=ih(r.publicKey.toCID());if(!1===e?.equals(i))return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",e,i),!1;const n=uy.createFromProtobuf(r.payload);let s;try{s=await this.get(i)}catch(t){if("NotFoundError"!==t.name)throw t}if(null!=s?.peerRecordEnvelope){const t=await Af.createFromProtobuf(s.peerRecordEnvelope),e=uy.createFromProtobuf(t.payload);if(e.seqNumber>=n.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",e.seqNumber,n.seqNumber),!1}return await this.patch(n.peerId,{peerRecordEnvelope:t,addresses:n.multiaddrs.map((t=>({isCertified:!0,multiaddr:t})))}),!0}#L(t,e){e.updated&&(this.peerId.equals(t)?this.events.safeDispatchEvent("self:peer:update",{detail:e}):this.events.safeDispatchEvent("peer:update",{detail:e}))}}Error,Error,Error,Error,Error,Error;class uM extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=uM.name;code=uM.code;constructor(t="Not Found"){super(t)}}Error;const cM=function(t){if(null!=t[Symbol.asyncIterator])return(async()=>{for await(const e of t);})();for(const e of t);},lM=function(t,e){let r=0;if(null!=t[Symbol.asyncIterator])return async function*(){for await(const i of t)await e(i,r++)&&(yield i)}();const i=jl(t),{value:n,done:s}=i.next();if(!0===s)return function*(){}();const o=e(n,r++);if("function"==typeof o.then)return async function*(){await o&&(yield n);for await(const t of i)await e(t,r++)&&(yield t)}();const a=e;return function*(){!0===o&&(yield n);for(const t of i)a(t,r++)&&(yield t)}()},dM=function(t,e){return null!=t[Symbol.asyncIterator]?async function*(){const r=await Iw(t);yield*r.sort(e)}():function*(){const r=Iw(t);yield*r.sort(e)}()},fM=function(t,e){return null!=t[Symbol.asyncIterator]?async function*(){let r=0;if(!(e<1))for await(const i of t)if(yield i,r++,r===e)return}():function*(){let r=0;if(!(e<1))for(const i of t)if(yield i,r++,r===e)return}()};class pM{put(t,e,r){return Promise.reject(new Error(".put is not implemented"))}get(t,e){return Promise.reject(new Error(".get is not implemented"))}has(t,e){return Promise.reject(new Error(".has is not implemented"))}delete(t,e){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(t,e={}){for await(const{key:r,value:i}of t)await this.put(r,i,e),yield r}async*getMany(t,e={}){for await(const r of t)yield{key:r,value:await this.get(r,e)}}async*deleteMany(t,e={}){for await(const r of t)await this.delete(r,e),yield r}batch(){let t=[],e=[];return{put(e,r){t.push({key:e,value:r})},delete(t){e.push(t)},commit:async r=>{await cM(this.putMany(t,r)),t=[],await cM(this.deleteMany(e,r)),e=[]}}}async*_all(t,e){throw new Error("._all is not implemented")}async*_allKeys(t,e){throw new Error("._allKeys is not implemented")}query(t,e){let r=this._all(t,e);if(null!=t.prefix){const e=t.prefix;r=lM(r,(t=>t.key.toString().startsWith(e)))}if(Array.isArray(t.filters)&&(r=t.filters.reduce(((t,e)=>lM(t,e)),r)),Array.isArray(t.orders)&&(r=t.orders.reduce(((t,e)=>dM(t,e)),r)),null!=t.offset){let e=0;const i=t.offset;r=lM(r,(()=>e++>=i))}return null!=t.limit&&(r=fM(r,t.limit)),r}queryKeys(t,e){let r=this._allKeys(t,e);if(null!=t.prefix){const e=t.prefix;r=lM(r,(t=>t.toString().startsWith(e)))}if(Array.isArray(t.filters)&&(r=t.filters.reduce(((t,e)=>lM(t,e)),r)),Array.isArray(t.orders)&&(r=t.orders.reduce(((t,e)=>dM(t,e)),r)),null!=t.offset){const e=t.offset;let i=0;r=lM(r,(()=>i++>=e))}return null!=t.limit&&(r=fM(r,t.limit)),r}}class mM extends pM{data;constructor(){super(),this.data=new Map}put(t,e){return this.data.set(t.toString(),e),t}get(t){const e=this.data.get(t.toString());if(null==e)throw new uM;return e}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,e]of this.data.entries())yield{key:new Jw(t),value:e}}*_allKeys(){for(const t of this.data.keys())yield new Jw(t)}}const gM=864e13;class bM{log;mappings;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(t){const e=this.findHost(t);for(const t of this.mappings.values())if(t.domain===e)return!0;return!1}add(t,e){e.forEach((e=>{this.log("add DNS mapping %s to %s",e,t);const r=!0===pd(e);this.mappings.set(e,{domain:t,verified:r,expires:r?gM-Date.now():0,lastVerified:r?gM-Date.now():void 0})}))}remove(t){const e=this.findHost(t);let r=!1;for(const[t,i]of this.mappings.entries())i.domain===e&&(this.log("removing %s to %s DNS mapping %e",t,i.domain,new Error("where")),this.mappings.delete(t),r=r||i.verified);return r}getAll(t){const e=[];for(let r=0;r<t.length;r++){const i=t[r].multiaddr.stringTuples(),n=i[0][1];if(null!=n)for(const[s,o]of this.mappings.entries())n===s&&this.maybeAddSNITuple(i,o.domain)&&(t.splice(r,1),r--,e.push({multiaddr:Ud(`/${i.map((t=>[Fu(t[0]).name,t[1]].join("/"))).join("/")}`),verified:o.verified,type:"dns-mapping",expires:o.expires,lastVerified:o.lastVerified}))}return e}maybeAddSNITuple(t,e){for(let r=0;r<t.length;r++)if(448===t[r][0]&&449!==t[r+1]?.[0])return t.splice(r+1,0,[449,e]),!0;return!1}confirm(t,e){const r=this.findHost(t);let i=!1;for(const[t,n]of this.mappings.entries())n.domain===r&&(this.log("marking %s to %s DNS mapping as verified",t,n.domain),i=n.verified,n.verified=!0,n.expires=Date.now()+e,n.lastVerified=Date.now());return i}unconfirm(t,e){const r=this.findHost(t);let i=!1;for(const[t,n]of this.mappings.entries())n.domain===r&&(this.log("removing verification of %s to %s DNS mapping",t,n.domain),i=i||n.verified,n.verified=!1,n.expires=Date.now()+e);return i}findHost(t){for(const e of t.stringTuples()){if(449===e[0])return e[1];if(53===e[0]||54===e[0]||55===e[0]||56===e[0])return e[1]}}}class yM{log;mappings;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(t){const e=t.stringTuples();for(const t of this.mappings.values())for(const r of t)if(r.externalIp===e[0][1])return!0;return!1}add(t,e,r,i=e,n="tcp"){const s=`${t}-${e}-${n}`,o=this.mappings.get(s)??[],a={internalIp:t,internalPort:e,externalIp:r,externalPort:i,externalFamily:Tu(r)?4:6,protocol:n,verified:!1,expires:0};o.push(a),this.mappings.set(s,o)}remove(t){const e=t.stringTuples(),r=e[0][1]??"",i=6===e[1][0]?"tcp":"udp",n=parseInt(e[1][1]??"0");let s=!1;for(const[t,e]of this.mappings.entries()){for(let t=0;t<e.length;t++){const o=e[t];o.externalIp===r&&o.externalPort===n&&o.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",o.externalIp,o.externalPort,r,n,i),s=s||o.verified,e.splice(t,1),t--)}0===e.length&&this.mappings.delete(t)}return s}getAll(t){const e=[];for(const{multiaddr:r}of t){const t=r.stringTuples();let i;if(4!==t[0][0]&&41!==t[0][0]||6!==t[1][0]?4!==t[0][0]&&41!==t[0][0]||273!==t[1][0]||(i=`${t[0][1]}-${t[1][1]}-udp`):i=`${t[0][1]}-${t[1][1]}-tcp`,null==i)continue;const n=this.mappings.get(i);if(null!=n)for(const r of n)t[0][0]=4===r.externalFamily?4:41,t[0][1]=r.externalIp,t[1][1]=`${r.externalPort}`,e.push({multiaddr:Ud(`/${t.map((t=>[Fu(t[0]).name,t[1]].join("/"))).join("/")}`),verified:r.verified,type:"ip-mapping",expires:r.expires,lastVerified:r.lastVerified})}return e}confirm(t,e){const r=t.stringTuples()[0][1];let i=!1;for(const t of this.mappings.values())for(const n of t)n.externalIp===r&&(this.log("marking %s to %s IP mapping as verified",n.internalIp,n.externalIp),i=n.verified,n.verified=!0,n.expires=Date.now()+e,n.lastVerified=Date.now());return i}unconfirm(t,e){const r=t.stringTuples(),i=r[0][1]??"",n=6===r[1][0]?"tcp":"udp",s=parseInt(r[1][1]??"0");let o=!1;for(const t of this.mappings.values())for(let r=0;r<t.length;r++){const a=t[r];a.externalIp===i&&a.externalPort===s&&a.protocol===n&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",a.externalIp,a.externalPort,i,s,n),o=o||a.verified,a.verified=!1,a.expires=Date.now()+e)}return o}}class vM{log;addresses;maxObservedAddresses;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=e.maxObservedAddresses??10}has(t){return this.addresses.has(t.toString())}removePrefixed(t){for(const e of this.addresses.keys())e.toString().startsWith(t)&&this.addresses.delete(e)}add(t){this.addresses.size!==this.maxObservedAddresses&&(md(t)||function(t){try{const[[e,r]]=t.stringTuples();if(null==r)return!1;if(4===e)return r.startsWith("169.254.");if(41===e)return r.toLowerCase().startsWith("fe80")}catch{}return!1}(t)||(this.log("adding observed address %a",t),this.addresses.set(t.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map((([t,e])=>({multiaddr:Ud(t),verified:e.verified,type:"observed",expires:e.expires,lastVerified:e.lastVerified})))}remove(t){const e=this.addresses.get(t.toString())?.verified??!1;return this.log("removing observed address %a",t),this.addresses.delete(t.toString()),e}confirm(t,e){const r=t.toString(),i=this.addresses.get(r)??{verified:!1,expires:Date.now()+e,lastVerified:Date.now()},n=i.verified;return i.verified=!0,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,i),n}}class wM{log;addresses;maxObservedAddresses;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=e.maxObservedAddresses??10}get(t,e){if(md(t))return{multiaddr:t,verified:!0,type:"transport",expires:Date.now()+e,lastVerified:Date.now()};const r=this.toKey(t);let i=this.addresses.get(r);return null==i&&(i={verified:!1,expires:0},this.addresses.set(r,i)),{multiaddr:t,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(t){const e=this.toKey(t);return this.addresses.has(e)}remove(t){const e=this.toKey(t),r=this.addresses.get(e)?.verified??!1;return this.log("removing observed address %a",t),this.addresses.delete(e),r}confirm(t,e){const r=this.toKey(t),i=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},n=i.verified;return i.verified=!0,i.expires=Date.now()+e,i.lastVerified=Date.now(),this.addresses.set(r,i),n}unconfirm(t,e){const r=this.toKey(t),i=this.addresses.get(r)??{verified:!1,expires:0},n=i.verified;return i.verified=!1,i.expires=Date.now()+e,this.addresses.set(r,i),n}toKey(t){const e=t.toOptions();return`${e.host}-${e.port}-${e.transport}`}}const MM=6e5,_M=3e5,SM=t=>t;function EM(t,e){const r=t.getPeerId();return null!=r&&th(r).equals(e)&&(t=t.decapsulate(Ud(`/p2p/${e.toString()}`))),t}class kM{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(t,e={}){const{listen:r=[],announce:i=[],appendAnnounce:n=[]}=e;this.components=t,this.log=t.logger.forComponent("libp2p:address-manager"),this.listen=r.map((t=>t.toString())),this.announce=new Set(i.map((t=>t.toString()))),this.appendAnnounce=new Set(n.map((t=>t.toString()))),this.observed=new vM(t,e),this.dnsMappings=new bM(t,e),this.ipMappings=new yM(t,e),this.transportAddresses=new wM(t,e),this.announceFilter=e.announceFilter??SM,this.observedAddressFilter=ud(1024),this.addressVerificationTTL=e.addressVerificationTTL??MM,this.addressVerificationRetry=e.addressVerificationRetry??_M,this._updatePeerStoreAddresses=function(t){let e;const r=function(){clearTimeout(e),e=setTimeout((function(){e=void 0,t()}),1e3)};return r.start=()=>{},r.stop=()=>{clearTimeout(e)},r}(this._updatePeerStoreAddresses.bind(this)),t.events.addEventListener("transport:listening",(()=>{this._updatePeerStoreAddresses()})),t.events.addEventListener("transport:close",(()=>{this._updatePeerStoreAddresses()}))}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const t=this.getAddresses().map((t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t));this.components.peerStore.patch(this.components.peerId,{multiaddrs:t}).catch((t=>{this.log.error("error updating addresses",t)}))}getListenAddrs(){return Array.from(this.listen).map((t=>Ud(t)))}getAnnounceAddrs(){return Array.from(this.announce).map((t=>Ud(t)))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map((t=>Ud(t)))}getObservedAddrs(){return this.observed.getAll().map((t=>t.multiaddr))}addObservedAddr(t){const e=t.stringTuples(),r=`${e[0][1]}:${e[1][1]}`;this.observedAddressFilter.has(r)||(this.observedAddressFilter.add(r),t=EM(t,this.components.peerId),this.ipMappings.has(t)||this.dnsMappings.has(t)||this.observed.add(t))}confirmObservedAddr(t,e){t=EM(t,this.components.peerId);let r=!0;("observed"===e?.type||this.observed.has(t))&&(r=this.observed.confirm(t,e?.ttl??this.addressVerificationTTL)),("transport"===e?.type||this.transportAddresses.has(t))&&(r=this.transportAddresses.confirm(t,e?.ttl??this.addressVerificationTTL)),("dns-mapping"===e?.type||this.dnsMappings.has(t))&&(r=this.dnsMappings.confirm(t,e?.ttl??this.addressVerificationTTL)),("ip-mapping"===e?.type||this.ipMappings.has(t))&&(r=this.ipMappings.confirm(t,e?.ttl??this.addressVerificationTTL)),r||this._updatePeerStoreAddresses()}removeObservedAddr(t,e){t=EM(t,this.components.peerId);let r=!1;this.observed.has(t)&&(r=this.observed.remove(t)),this.transportAddresses.has(t)&&(r=this.transportAddresses.unconfirm(t,e?.ttl??this.addressVerificationRetry)),this.dnsMappings.has(t)&&(r=this.dnsMappings.unconfirm(t,e?.ttl??this.addressVerificationRetry)),this.ipMappings.has(t)&&(r=this.ipMappings.unconfirm(t,e?.ttl??this.addressVerificationRetry)),r&&this._updatePeerStoreAddresses()}getAddresses(){const t=new Set,e=this.getAddressesWithMetadata().filter((e=>{if(!e.verified)return!1;const r=e.multiaddr.toString();return!t.has(r)&&(t.add(r),!0)})).map((t=>t.multiaddr));return this.announceFilter(e.map((t=>{const e=Ud(t);return!0===e.protos().pop()?.path||e.getPeerId()===this.components.peerId.toString()?e:e.encapsulate(`/p2p/${this.components.peerId.toString()}`)})))}getAddressesWithMetadata(){const t=this.getAnnounceAddrs();if(t.length>0)return t.map((t=>({multiaddr:t,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})));let e=[];return e=e.concat(this.components.transportManager.getAddrs().map((t=>this.transportAddresses.get(t,this.addressVerificationTTL)))),e=e.concat(this.getAppendAnnounceAddrs().map((t=>({multiaddr:t,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),e=e.concat(this.observed.getAll()),e=e.concat(this.ipMappings.getAll(e)),e=e.concat(this.dnsMappings.getAll(e)),e}addDNSMapping(t,e){this.dnsMappings.add(t,e)}removeDNSMapping(t){this.dnsMappings.remove(Ud(`/dns/${t}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(t,e,r,i=e,n="tcp"){this.ipMappings.add(t,e,r,i,n),this.observed.removePrefixed(`/ip${Tu(r)?4:6}/${r}/${n}/${i}`)}removePublicAddressMapping(t,e,r,i=e,n="tcp"){this.ipMappings.remove(Ud(`/ip${Tu(r)?4:6}/${r}/${n}/${i}`))&&this._updatePeerStoreAddresses()}}var AM;!function(t){t.NOT_STARTED_YET="The libp2p node is not started yet",t.NOT_FOUND="Not found"}(AM||(AM={}));class IM extends Error{constructor(t="Missing service"){super(t),this.name="MissingServiceError"}}class xM extends Error{constructor(t="Unmet service dependencies"){super(t),this.name="UnmetServiceDependenciesError"}}class CM extends Error{constructor(t="No content routers available"){super(t),this.name="NoContentRoutersError"}}class TM extends Error{constructor(t="No peer routers available"){super(t),this.name="NoPeerRoutersError"}}class PM extends Error{constructor(t="Should not try to find self"){super(t),this.name="QueriedForSelfError"}}class BM extends Error{constructor(t="Unhandled protocol error"){super(t),this.name="UnhandledProtocolError"}}class RM extends Error{constructor(t="Duplicate protocol handler error"){super(t),this.name="DuplicateProtocolHandlerError"}}class DM extends Error{constructor(t="Dial denied error"){super(t),this.name="DialDeniedError"}}class NM extends Error{constructor(t="No valid addresses"){super(t),this.name="NoValidAddressesError"}}class LM extends Error{constructor(t="Connection intercepted"){super(t),this.name="ConnectionInterceptedError"}}class OM extends Error{constructor(t="Connection denied"){super(t),this.name="ConnectionDeniedError"}}class UM extends Error{constructor(t="Stream is not multiplexed"){super(t),this.name="MuxerUnavailableError"}}class FM extends Error{constructor(t="Encryption failed"){super(t),this.name="EncryptionFailedError"}}class jM extends Error{constructor(t="Transport unavailable"){super(t),this.name="TransportUnavailableError"}}class VM{components={};_started=!1;constructor(t={}){this.components={};for(const[e,r]of Object.entries(t))this.components[e]=r;null==this.components.logger&&(this.components.logger=Tm())}isStarted(){return this._started}async _invokeStartableMethod(t){await Promise.all(Object.values(this.components).filter((t=>Jp(t))).map((async e=>{await(e[t]?.())})))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const qM=["metrics","connectionProtector","dns"],zM=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function HM(t){return Array.isArray(t?.[k])?t[k]:[]}function $M(t){return Array.isArray(t?.[A])?t[A]:[]}function WM(t){return t?.[Symbol.toStringTag]??t?.toString()??"unknown"}function KM(t={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async t=>{if(vp.matches(t))return!1;const e=t.stringTuples();return(4===e[0][0]||41===e[0][0])&&Boolean(pd(`${e[0][1]}`))},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...t}}class GM{memoryStorage;points;duration;blockDuration;execEvenly;execEvenlyMinDelayMs;keyPrefix;constructor(t={}){this.points=t.points??4,this.duration=t.duration??1,this.blockDuration=t.blockDuration??0,this.execEvenly=t.execEvenly??!1,this.execEvenlyMinDelayMs=t.execEvenlyMinDelayMs??1e3*this.duration/this.points,this.keyPrefix=t.keyPrefix??"rlflx",this.memoryStorage=new ZM}async consume(t,e=1,r={}){const i=this.getKey(t),n=this._getKeySecDuration(r);let s=this.memoryStorage.incrby(i,e,n);if(s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s.consumedPoints>this.points)throw this.blockDuration>0&&s.consumedPoints<=this.points+e&&(s=this.memoryStorage.set(i,s.consumedPoints,this.blockDuration)),new yd("Rate limit exceeded",s);if(this.execEvenly&&s.msBeforeNext>0&&!s.isFirstInDuration){let t=Math.ceil(s.msBeforeNext/(s.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=s.consumedPoints*this.execEvenlyMinDelayMs),await fm(t)}return s}penalty(t,e=1,r={}){const i=this.getKey(t),n=this._getKeySecDuration(r),s=this.memoryStorage.incrby(i,e,n);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}reward(t,e=1,r={}){const i=this.getKey(t),n=this._getKeySecDuration(r),s=this.memoryStorage.incrby(i,-e,n);return s.remainingPoints=Math.max(this.points-s.consumedPoints,0),s}block(t,e){const r=1e3*e,i=this.points+1;return this.memoryStorage.set(this.getKey(t),i,e),{remainingPoints:0,msBeforeNext:0===r?-1:r,consumedPoints:i,isFirstInDuration:!1}}set(t,e,r=0){const i=1e3*(r>=0?r:this.duration);return this.memoryStorage.set(this.getKey(t),e,r),{remainingPoints:0,msBeforeNext:0===i?-1:i,consumedPoints:e,isFirstInDuration:!1}}get(t){const e=this.memoryStorage.get(this.getKey(t));return null!=e&&(e.remainingPoints=Math.max(this.points-e.consumedPoints,0)),e}delete(t){this.memoryStorage.delete(this.getKey(t))}_getKeySecDuration(t){return null!=t?.customDuration&&t.customDuration>=0?t.customDuration:this.duration}getKey(t){return this.keyPrefix.length>0?`${this.keyPrefix}:${t}`:t}parseKey(t){return t.substring(this.keyPrefix.length)}}class ZM{storage;constructor(){this.storage=new Map}incrby(t,e,r){const i=this.storage.get(t);if(null!=i){const n=null!=i.expiresAt?i.expiresAt.getTime()-(new Date).getTime():-1;return null==i.expiresAt||n>0?(i.value+=e,{remainingPoints:0,msBeforeNext:n,consumedPoints:i.value,isFirstInDuration:!1}):this.set(t,e,r)}return this.set(t,e,r)}set(t,e,r){const i=1e3*r,n=this.storage.get(t);null!=n&&clearTimeout(n.timeoutId);const s={value:e,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(t,s),i>0&&(s.timeoutId=setTimeout((()=>{this.storage.delete(t)}),i),null!=s.timeoutId.unref&&s.timeoutId.unref()),{remainingPoints:0,msBeforeNext:0===i?-1:i,consumedPoints:s.value,isFirstInDuration:!0}}get(t){const e=this.storage.get(t);if(null!=e)return{remainingPoints:0,msBeforeNext:null!=e.expiresAt?e.expiresAt.getTime()-(new Date).getTime():-1,consumedPoints:e.value,isFirstInDuration:!1}}delete(t){const e=this.storage.get(t);return null!=e&&(null!=e.timeoutId&&clearTimeout(e.timeoutId),this.storage.delete(t),!0)}}function YM(t){if(Ka(t))return{peerId:t,multiaddrs:[]};let e;if(Array.isArray(t)||(t=[t]),t.length>0){const r=t[0].getPeerId();e=null==r?void 0:th(r),t.forEach((t=>{if(!Od(t))throw new V("Invalid multiaddr");const r=t.getPeerId();if(null==r){if(null!=e)throw new T("Multiaddrs must all have the same peer id or have no peer id")}else{const t=th(r);if(!0!==e?.equals(t))throw new T("Multiaddrs must all have the same peer id or have no peer id")}}))}return{peerId:e,multiaddrs:t}}const JM=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];function XM(t){try{let e;if(e="string"==typeof t?Ud(t):t,!e.protoNames().includes("ipcidr")){const t=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(t)}return function(t){let e,r;if(t.stringTuples().forEach((([t,i])=>{t!==ju.code&&t!==Vu.code||(r=i),t===qu.code&&(e=i)})),null==e||null==r)throw new Error("Invalid multiaddr");return new Cu(r,e)}(e)}catch(e){throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${t}`)}}class QM{maxConnections;connectionManager;peerStore;allow;events;log;constructor(t,e={}){this.maxConnections=e.maxConnections??100,this.allow=(e.allow??[]).map((t=>XM(t))),this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.log=t.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch((t=>{this.log.error("error while pruning connections %e",t)}))}async _maybePruneConnections(){const t=this.connectionManager.getConnections(),e=t.length;if(this.log("checking max connections limit %d/%d",e,this.maxConnections),e<=this.maxConnections)return;const r=new jp;for(const e of t){const t=e.remotePeer;if(!r.has(t)){r.set(t,0);try{const e=await this.peerStore.get(t);r.set(t,[...e.tags.values()].reduce(((t,e)=>t+e.value),0))}catch(t){"NotFoundError"!==t.name&&this.log.error("error loading peer tags",t)}}}const i=this.sortConnections(t,r),n=Math.max(e-this.maxConnections,0),s=[];for(const t of i)if(this.log("too many connections open - closing a connection to %p",t.remotePeer),this.allow.some((e=>e.contains(t.remoteAddr.nodeAddress().address)))||s.push(t),s.length===n)break;await Promise.all(s.map((async t=>{await async function(t,e){const r=t?.streams?.map((t=>t.protocol))??[],i=e?.closableProtocols??JM;if(!(r.filter((t=>null!=t&&!i.includes(t))).length>0))try{await(t?.close(e))}catch(e){t?.abort(e)}}(t,{signal:AbortSignal.timeout(1e3)})}))),this.events.safeDispatchEvent("connection:prune",{detail:s})}sortConnections(t,e){return t.sort(((t,e)=>{const r=t.timeline.open,i=e.timeline.open;return r<i?1:r>i?-1:0})).sort(((t,e)=>"outbound"===t.direction&&"inbound"===e.direction?1:"inbound"===t.direction&&"outbound"===e.direction?-1:0)).sort(((t,e)=>t.streams.length>e.streams.length?1:t.streams.length<e.streams.length?-1:0)).sort(((t,r)=>{const i=e.get(t.remotePeer)??0,n=e.get(r.remotePeer)??0;return i>n?1:i<n?-1:0}))}}const t_="last-dial-failure",e_="last-dial-success";class r_ extends _d{constructor(t={}){super({...t,sort:(t,e)=>t.options.priority>e.options.priority?-1:t.options.priority<e.options.priority?1:0})}}function i_(t,e){const r=fp.exactMatch(t.multiaddr),i=fp.exactMatch(e.multiaddr);if(r&&!i)return-1;if(!r&&i)return 1;const n=Mp.exactMatch(t.multiaddr),s=Mp.exactMatch(e.multiaddr);if(n&&!s)return-1;if(!n&&s)return 1;const o=vp.exactMatch(t.multiaddr),a=vp.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const h=Cp.exactMatch(t.multiaddr),u=Cp.exactMatch(e.multiaddr);if(h&&!u)return-1;if(!h&&u)return 1;const c=Sp.exactMatch(t.multiaddr),l=Sp.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const d=kp.exactMatch(t.multiaddr),f=kp.exactMatch(e.multiaddr);return d&&!f?-1:!d&&f?1:0}function n_(t,e){const r=md(t.multiaddr),i=md(e.multiaddr);return r&&!i?1:!r&&i?-1:0}function s_(t,e){return t.isCertified&&!e.isCertified?-1:!t.isCertified&&e.isCertified?1:0}function o_(t,e){const r=xp.exactMatch(t.multiaddr),i=xp.exactMatch(e.multiaddr);return r&&!i?1:!r&&i?-1:0}class a_{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;constructor(t,e={}){this.addressSorter=e.addressSorter,this.maxPeerAddrsToDial=e.maxPeerAddrsToDial??25,this.maxDialQueueLength=e.maxDialQueueLength??500,this.dialTimeout=e.dialTimeout??5e3,this.connections=e.connections??new jp,this.log=t.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=t,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[t,r]of Object.entries(e.resolvers??{}))Ld.set(t,r);this.queue=new r_({concurrency:e.maxParallelDials??50,metricName:"libp2p_dial_queue",metrics:t.metrics}),this.queue.addEventListener("error",(t=>{t.detail.name!==I.name&&this.log.error("error in dial queue - %e",t.detail)}))}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(t,e={}){const{peerId:r,multiaddrs:i}=YM(t),n=Array.from(this.connections.values()).flat().find((t=>!0!==e.force&&(!!t.remotePeer.equals(r)||i.find((e=>e.equals(t.remoteAddr))))));if("open"===n?.status)return this.log("already connected to %a",n.remoteAddr),e.onProgress?.(new im("dial-queue:already-connected")),n;const s=this.queue.queue.find((t=>{if(!0===r?.equals(t.options.peerId))return!0;const e=t.options.multiaddrs;if(null==e)return!1;for(const t of i)if(e.has(t.toString()))return!0;return!1}));if(null!=s){this.log("joining existing dial target for %p",r);for(const t of i)s.options.multiaddrs.add(t.toString());return e.onProgress?.(new im("dial-queue:already-in-dial-queue")),s.join(e)}if(this.queue.size>=this.maxDialQueueLength)throw new G("Dial queue is full");return this.log("creating dial target for %p",r,i.map((t=>t.toString()))),e.onProgress?.(new im("dial-queue:add-to-dial-queue")),this.queue.add((async t=>{t?.onProgress?.(new im("dial-queue:start-dial"));const e=Ed([this.shutDownController.signal,t.signal]);let i;try{i=await this.calculateMultiaddrs(r,t?.multiaddrs,{...t,signal:e}),t?.onProgress?.(new im("dial-queue:calculated-addresses",i)),i.map((({multiaddr:t})=>t.toString())).forEach((e=>{t?.multiaddrs.add(e)}))}catch(t){throw e.clear(),t}try{let n=0;const s=[];for(const o of i){if(n===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",n,r),new G("Peer had more than maxPeerAddrsToDial");n++;try{const i=await this.components.transportManager.dial(o.multiaddr,{...t,signal:e});this.log("dial to %a succeeded",o.multiaddr);try{await this.components.peerStore.merge(i.remotePeer,{multiaddrs:[i.remoteAddr],metadata:{[e_]:dn(Date.now().toString())}})}catch(t){this.log.error("could not update last dial failure key for %p",r,t)}return i}catch(t){if(this.log.error("dial failed to %a",o.multiaddr,t),null!=r)try{await this.components.peerStore.merge(r,{metadata:{[t_]:dn(Date.now().toString())}})}catch(t){this.log.error("could not update last dial failure key for %p",r,t)}if(e.aborted)throw new W(t.message);s.push(t)}}if(1===s.length)throw s[0];throw new AggregateError(s,"All multiaddr dials failed")}finally{e.clear()}}),{peerId:r,priority:e.priority??m_,multiaddrs:new Set(i.map((t=>t.toString()))),signal:e.signal??AbortSignal.timeout(this.dialTimeout),onProgress:e.onProgress})}async calculateMultiaddrs(t,e=new Set,r={}){const i=[...e].map((t=>({multiaddr:Ud(t),isCertified:!1})));if(null!=t){if(this.components.peerId.equals(t))throw new G("Tried to dial self");if(!0===await(this.components.connectionGater.denyDialPeer?.(t)))throw new DM("The dial request is blocked by gater.allowDialPeer");if(0===i.length){this.log("loading multiaddrs for %p",t);try{const e=await this.components.peerStore.get(t);i.push(...e.addresses),this.log("loaded multiaddrs for %p",t,i.map((({multiaddr:t})=>t.toString())))}catch(t){if("NotFoundError"!==t.name)throw t}}if(0===i.length){this.log("looking up multiaddrs for %p in the peer routing",t);try{const e=await this.components.peerRouting.findPeer(t,r);this.log("found multiaddrs for %p in the peer routing",t,i.map((({multiaddr:t})=>t.toString()))),i.push(...e.multiaddrs.map((t=>({multiaddr:t,isCertified:!1}))))}catch(e){"NoPeerRoutersError"!==e.name&&this.log.error("looking up multiaddrs for %p in the peer routing failed",t,e)}}}let n=(await Promise.all(i.map((async t=>{const e=await async function(t,e){let r=!1;for(const e of Ld.keys())if(r=t.protoNames().includes(e),r)break;if(!r)return[t];const i=await t.resolve(e);return e.log("resolved %s to",t,i.map((t=>t.toString()))),i}(t.multiaddr,{dns:this.components.dns,...r,log:this.log});return 1===e.length&&e[0].equals(t.multiaddr)?t:e.map((t=>({multiaddr:t,isCertified:!1})))})))).flat();if(null!=t){const e=`/p2p/${t.toString()}`;n=n.map((t=>{const r=t.multiaddr.protos().pop();return!0===r?.path?t:null==t.multiaddr.getPeerId()?{multiaddr:t.multiaddr.encapsulate(e),isCertified:t.isCertified}:t}))}const s=n.filter((e=>{if(null==this.components.transportManager.dialTransportForMultiaddr(e.multiaddr))return!1;const r=e.multiaddr.getPeerId();return null==t||null==r||t.equals(r)})),o=new Map;for(const t of s){const e=t.multiaddr.toString(),r=o.get(e);null==r?o.set(e,t):r.isCertified=r.isCertified||t.isCertified||!1}const a=[...o.values()];if(0===a.length)throw new NM("The dial request has no valid addresses");const h=[];for(const t of a)null!=this.components.connectionGater.denyDialMultiaddr&&await this.components.connectionGater.denyDialMultiaddr(t.multiaddr)||h.push(t);const u=null==this.addressSorter?h.sort(i_).sort(s_).sort(o_).sort(n_):h.sort(this.addressSorter);if(0===u.length)throw new DM("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",t??"unknown peer",n.map((({multiaddr:t})=>t.toString()))),this.log.trace("addresses for %p after filtering",t??"unknown peer",u.map((({multiaddr:t})=>t.toString()))),u}async isDialable(t,e={}){Array.isArray(t)||(t=[t]);try{const r=await this.calculateMultiaddrs(void 0,new Set(t.map((t=>t.toString()))),e);return!1!==e.runOnLimitedConnection||null!=r.find((t=>!xp.matches(t.multiaddr)))}catch(t){this.log.trace("error calculating if multiaddr(s) were dialable",t)}return!1}}var h_=r(5765);const u_=Object.prototype.toString,c_=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);class l_ extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,({message:t}=t)):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}}const d_=(t,e,r)=>{const i=r.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=i,t};class f_{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=t.peerStore,this.connectionManager=t.connectionManager,this.queue=new Sd({concurrency:e.maxParallelReconnects??5,metricName:"libp2p_reconnect_queue",metrics:t.metrics}),this.started=!1,this.retries=e.retries??5,this.backoffFactor=e.backoffFactor,this.retryInterval=e.retryInterval,this.events=t.events,t.events.addEventListener("peer:disconnect",(t=>{this.maybeReconnect(t.detail).catch((e=>{this.log.error("failed to maybe reconnect to %p - %e",t.detail,e)}))}))}async maybeReconnect(t){if(!this.started)return;const e=await this.peerStore.get(t);p_(e)&&(this.queue.has(t)||this.queue.add((async e=>{await async function(t,e){return new Promise(((r,i)=>{e={...e},e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,e.retries??=10;const n=h_.operation(e),s=()=>{n.stop(),i(e.signal?.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{e.signal?.removeEventListener("abort",s),n.stop()};n.attempt((async s=>{try{const e=await t(s);o(),r(e)}catch(t){try{if(!(t instanceof Error))throw new TypeError(`Non-error was thrown: "${t}". You should only throw errors.`);if(t instanceof l_)throw t.originalError;if(t instanceof TypeError&&!function(t){var e;return!(!t||(e=t,"[object Error]"!==u_.call(e))||"TypeError"!==t.name||"string"!=typeof t.message)&&("Load failed"===t.message?void 0===t.stack:c_.has(t.message))}(t))throw t;if(d_(t,s,e),await e.shouldRetry(t)||(n.stop(),i(t)),await e.onFailedAttempt(t),!n.retry(t))throw n.mainError()}catch(t){d_(t,s,e),o(),i(t)}}}))}))}((async r=>{if(this.started)try{await this.connectionManager.openConnection(t,{signal:e?.signal})}catch(e){throw this.log("reconnecting to %p attempt %d of %d failed - %e",t,r,this.retries,e),e}}),{signal:e?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})}),{peerId:t}).catch((async r=>{this.log.error("failed to reconnect to %p - %e",t,r);const i={};[...e.tags.keys()].forEach((t=>{t.startsWith(xf)&&(i[t]=void 0)})),await this.peerStore.merge(t,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:t})})).catch((async e=>{this.log.error("failed to remove keep-alive tag from %p - %e",t,e)})))}start(){this.started=!0}async afterStart(){Promise.resolve().then((async()=>{const t=await this.peerStore.all({filters:[t=>p_(t)]});await Promise.all(t.map((async t=>{await this.connectionManager.openConnection(t.id).catch((t=>{this.log.error(t)}))})))})).catch((t=>{this.log.error(t)}))}stop(){this.started=!1,this.queue.abort()}}function p_(t){for(const e of t.tags.keys())if(e.startsWith(xf))return!0;return!1}const m_=50;class g_{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(t,e={}){if(this.maxConnections=e.maxConnections??100,this.maxConnections<1)throw new T("Connection Manager maxConnections must be greater than 0");this.connections=new jp,this.started=!1,this.peerId=t.peerId,this.peerStore=t.peerStore,this.metrics=t.metrics,this.events=t.events,this.log=t.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(e.allow??[]).map((t=>XM(t))),this.deny=(e.deny??[]).map((t=>XM(t))),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=e.maxIncomingPendingConnections??10,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new GM({points:e.inboundConnectionThreshold??5,duration:1}),this.connectionPruner=new QM({connectionManager:this,peerStore:t.peerStore,events:t.events,logger:t.logger},{maxConnections:this.maxConnections,allow:e.allow?.map((t=>Ud(t)))}),this.dialQueue=new a_(t,{addressSorter:e.addressSorter,maxParallelDials:e.maxParallelDials??50,maxDialQueueLength:e.maxDialQueueLength??500,maxPeerAddrsToDial:e.maxPeerAddrsToDial??25,dialTimeout:e.dialTimeout??5e3,resolvers:e.resolvers??{dnsaddr:Mw},connections:this.connections}),this.reconnectQueue=new f_({events:t.events,peerStore:t.peerStore,logger:t.logger,connectionManager:this},{retries:e.reconnectRetries,retryInterval:e.reconnectRetryInterval,backoffFactor:e.reconnectBackoffFactor,maxParallelReconnects:e.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const t={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const e of this.connections.values())for(const r of e)t[r.direction]++;return t}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const t={};for(const e of this.connections.values())for(const r of e)for(const e of r.streams){const r=`${e.direction} ${e.protocol??"unnegotiated"}`;t[r]=(t[r]??0)+1}return t}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const t={};for(const e of this.connections.values())for(const r of e){const e={};for(const t of r.streams){const r=`${t.direction} ${t.protocol??"unnegotiated"}`;e[r]=(e[r]??0)+1}for(const[r,i]of Object.entries(e))t[r]=t[r]??[],t[r].push(i)}const e={};for(let[r,i]of Object.entries(t)){i=i.sort(((t,e)=>t-e));const t=Math.floor(.9*i.length);e[r]=i[t]}return e}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Xp(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Qp(this.reconnectQueue,this.dialQueue,this.connectionPruner);const t=[];for(const e of this.connections.values())for(const r of e)t.push((async()=>{try{await r.close()}catch(t){this.log.error(t)}})());this.log("closing %d connections",t.length),await Promise.all(t),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(t){this._onConnect(t).catch((t=>{this.log.error(t)}))}async _onConnect(t){const{detail:e}=t;if(!this.started)return void await e.close();if("open"!==e.status)return;const r=e.remotePeer,i=!this.connections.has(r),n=this.connections.get(r)??[];n.push(e),this.connections.set(r,n),null!=r.publicKey&&"RSA"===r.type&&await this.peerStore.patch(r,{publicKey:r.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:e.remotePeer})}onDisconnect(t){const{detail:e}=t,r=e.remotePeer,i=(this.connections.get(r)??[]).filter((t=>t.id!==e.id));this.connections.set(r,i),0===i.length&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:e.remotePeer}))}getConnections(t){if(null!=t)return this.connections.get(t)??[];let e=[];for(const t of this.connections.values())e=e.concat(t);return e}getConnectionsMap(){return this.connections}async openConnection(t,e={}){if(!this.started)throw new K("Not started");this.outboundPendingConnections++;try{e.signal?.throwIfAborted();const{peerId:r}=YM(t);if(this.peerId.equals(r))throw new j("Can not dial self");if(null!=r&&!0!==e.force){this.log("dial %p",r);const t=this.getConnections(r).find((t=>null==t.limits));if(null!=t)return this.log("had an existing non-limited connection to %p",r),e.onProgress?.(new im("dial-queue:already-connected")),t}const i=await this.dialQueue.dial(t,{...e,priority:e.priority??m_});if("open"!==i.status)throw new D("Remote closed connection during opening");let n=this.connections.get(i.remotePeer);null==n&&(n=[],this.connections.set(i.remotePeer,n));let s=!1;for(const t of n)if(t.id===i.id&&(s=!0),!0!==e.force&&t.id!==i.id&&t.remoteAddr.equals(i.remoteAddr))return i.abort(new V("Duplicate multiaddr connection")),t;return s||n.push(i),i}finally{this.outboundPendingConnections--}}async closeConnections(t,e={}){const r=this.connections.get(t)??[];await Promise.all(r.map((async t=>{try{await t.close(e)}catch(e){t.abort(e)}})))}async acceptIncomingConnection(t){if(this.deny.some((e=>e.contains(t.remoteAddr.nodeAddress().address))))return this.log("connection from %a refused - connection remote address was in deny list",t.remoteAddr),!1;if(this.allow.some((e=>e.contains(t.remoteAddr.nodeAddress().address))))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",t.remoteAddr),!1;if(t.remoteAddr.isThinWaistAddress()){const e=t.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(e,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",t.remoteAddr,e),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",t.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const t={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map((e=>({id:e.id,status:t[e.status],peerId:e.options.peerId,multiaddrs:[...e.options.multiaddrs].map((t=>Ud(t)))})))}async isDialable(t,e={}){return this.dialQueue.isDialable(t,e)}}class b_{movingAverage;variance;deviation;forecast;timespan;previousTime;constructor(t){this.timespan=t,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(t,e){return 1-Math.exp(-(t-e)/this.timespan)}push(t,e=Date.now()){if(null!=this.previousTime){const r=this.alpha(e,this.previousTime),i=t-this.movingAverage,n=r*i;this.movingAverage=r*t+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+i*n),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*i}else this.movingAverage=t;this.previousTime=e}}class y_{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;constructor(t={}){this.success=new b_(t.interval??5e3),this.failure=new b_(t.interval??5e3),this.next=new b_(t.interval??5e3),this.failureMultiplier=t.failureMultiplier??2,this.timeoutMultiplier=t.timeoutMultiplier??1.2,this.minTimeout=t.minTimeout??2e3,null!=t.metricName&&(this.metric=t.metrics?.registerMetricGroup(t.metricName))}getTimeoutSignal(t={}){const e=Math.max(Math.round(this.next.movingAverage*(t.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),r=AbortSignal.timeout(e),i=Ed([t.signal,r]);return i.start=Date.now(),i.timeout=e,i}cleanUp(t){const e=Date.now()-t.start;t.aborted?(this.failure.push(e),this.next.push(e*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:e})):(this.success.push(e),this.next.push(e),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:e}))}}class v_{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(t,e={}){this.components=t,this.protocol=`/${e.protocolPrefix??"ipfs"}/ping/1.0.0`,this.log=t.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=e.pingInterval??1e4,this.abortConnectionOnPingFailure=e.abortConnectionOnPingFailure??!0,this.timeout=new y_({...e.pingTimeout??{},metrics:t.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[k]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval((()=>{this.components.connectionManager.getConnections().forEach((t=>{Promise.resolve().then((async()=>{let e=Date.now();try{const r=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),i=hc(await t.newStream(this.protocol,{signal:r,runOnLimitedConnection:!0}));e=Date.now(),await Promise.all([i.write(pu(32),{signal:r}),i.read(32,{signal:r})]),t.rtt=Date.now()-e,await i.unwrap().close({signal:r})}catch(r){if("UnsupportedProtocolError"!==r.name)throw r;t.rtt=(Date.now()-e)/2}})).catch((e=>{this.log.error("error during heartbeat",e),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),t.abort(e)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")}))}))}),this.pingIntervalMs)}stop(){this.abortController?.abort(),null!=this.heartbeatInterval&&clearInterval(this.heartbeatInterval)}}class w_{routers;started;components;constructor(t,e){this.routers=e.routers??[],this.started=!1,this.components=t}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(t,e={}){if(0===this.routers.length)throw new CM("No content routers available");const r=this,i=new Jl;for await(const n of Eh(...r.routers.map((r=>r.findProviders(t,e)))))null!=n&&(n.multiaddrs.length>0&&await this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}),i.has(n.id)||(i.add(n.id),yield n))}async provide(t,e={}){if(0===this.routers.length)throw new CM("No content routers available");await Promise.all(this.routers.map((async r=>{await r.provide(t,e)})))}async cancelReprovide(t,e={}){if(0===this.routers.length)throw new CM("No content routers available");await Promise.all(this.routers.map((async r=>{await r.cancelReprovide(t,e)})))}async put(t,e,r){if(!this.isStarted())throw new K;await Promise.all(this.routers.map((async i=>{await i.put(t,e,r)})))}async get(t,e){if(!this.isStarted())throw new K;return Promise.any(this.routers.map((async r=>r.get(t,e))))}}const M_=globalThis.CustomEvent??Event;class __{log;peerId;peerStore;routers;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:peer-routing"),this.peerId=t.peerId,this.peerStore=t.peerStore,this.routers=e.routers??[]}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(t,e){if(0===this.routers.length)throw new TM("No peer routers available");if(t.toString()===this.peerId.toString())throw new PM("Should not try to find self");const r=this,i=Eh(...this.routers.map((i=>async function*(){try{yield await i.findPeer(t,e)}catch(t){r.log.error(t)}}())));for await(const t of i)if(null!=t)return t.multiaddrs.length>0&&await this.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}),t;throw new F}async*getClosestPeers(t,e={}){if(0===this.routers.length)throw new TM("No peer routers available");const r=this,i=ud(1024);for await(const n of async function*(t,e={}){let r=e.concurrency??1/0;r<1&&(r=1/0);const i=null!=e.ordered&&e.ordered,n=new EventTarget,s=[];let o,a=vh(),h=vh(),u=!1,c=!1;function l(){return i?s[0]?.done:Boolean(s.find((t=>t.done)))}function*d(){for(;s.length>0&&s[0].done;){const t=s[0];if(s.shift(),!t.ok)throw c=!0,a.resolve(),t.err;yield t.value,a.resolve()}}function*f(){for(;l();)for(let t=0;t<s.length;t++)if(s[t].done){const e=s[t];if(s.splice(t,1),t--,!e.ok)throw c=!0,a.resolve(),e.err;yield e.value,a.resolve()}}for(n.addEventListener("task-complete",(()=>{h.resolve()})),Promise.resolve().then((async()=>{try{for await(const e of t){if(s.length===r&&(a=vh(),await a.promise),c)break;const t={done:!1};s.push(t),e().then((e=>{t.done=!0,t.ok=!0,t.value=e,n.dispatchEvent(new M_("task-complete"))}),(e=>{t.done=!0,t.err=e,n.dispatchEvent(new M_("task-complete"))}))}u=!0,n.dispatchEvent(new M_("task-complete"))}catch(t){o=t,n.dispatchEvent(new M_("task-complete"))}}));;){if(l()||(h=vh(),await h.promise),null!=o)throw o;if(i?yield*d():yield*f(),u&&0===s.length)break}}(async function*(){const i=Eh(...r.routers.map((r=>r.getClosestPeers(t,e))));for await(let t of i)yield async()=>{if(0===t.multiaddrs.length)try{t=await r.findPeer(t.id,{...e,useCache:!1})}catch(t){return void r.log.error("could not find peer multiaddrs",t)}return t}}()))null!=n&&(n.multiaddrs.length>0&&await this.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}),i.has(n.id.toMultihash().bytes)||(i.add(n.id.toMultihash().bytes),yield n))}}class S_ extends v{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(t){super(),this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){this.walking||this.startWalk(),this.walkers++;const e=Ed([this.shutdownController.signal,t?.signal]);try{for(;;){this.needNext?.resolve(),this.needNext=vh();const t=await bd(this,"walk:peer",e,{errorEvent:"walk:error"});yield t.detail}}finally{e.clear(),this.walkers--,0===this.walkers&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=Ed([this.walkController.signal,this.shutdownController.signal]),e=Date.now();let r=0;Promise.resolve().then((async()=>{for(this.log("start walk");this.walkers>0;)try{const e=pu(32);let i=Date.now();for await(const n of this.peerRouting.getClosestPeers(e,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",n.id,Date.now()-i,this.walkers),r++,this.safeDispatchEvent("walk:peer",{detail:n}),1===this.walkers&&null!=this.needNext&&(this.log("wait for need next"),await ic(this.needNext.promise,t)),i=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",e,this.walkers,r)}catch(t){this.log.error("randomwalk errored",t),this.safeDispatchEvent("walk:error",{detail:t})}this.log("no walkers left, ended walk")})).catch((t=>{this.log.error("randomwalk errored",t)})).finally((()=>{this.log("finished walk, found %d peers after %dms",r,Date.now()-e),this.walking=!1}))}}class E_{log;topologies;handlers;components;constructor(t){this.log=t.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=t,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(t){const e=this.handlers.get(t);if(null==e)throw new BM(`No handler registered for protocol ${t}`);return e}getTopologies(t){const e=this.topologies.get(t);return null==e?[]:[...e.values()]}async handle(t,e,r){if(this.handlers.has(t))throw new RM(`Handler already registered for protocol ${t}`);const i=_w.bind({ignoreUndefined:!0})({maxInboundStreams:32,maxOutboundStreams:64},r);this.handlers.set(t,{handler:e,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[t]})}async unhandle(t){(Array.isArray(t)?t:[t]).forEach((t=>{this.handlers.delete(t)})),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(t,e){if(null==e)throw new T("invalid topology");const r=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let i=this.topologies.get(t);return null==i&&(i=new Map,this.topologies.set(t,i)),i.set(r,e),r}unregister(t){for(const[e,r]of this.topologies.entries())r.has(t)&&(r.delete(t),0===r.size&&this.topologies.delete(e))}_onDisconnect(t){const e=t.detail;this.components.peerStore.get(e).then((t=>{for(const r of t.protocols){const t=this.topologies.get(r);if(null!=t)for(const r of t.values())!1!==r.filter?.has(e)&&(r.filter?.remove(e),r.onDisconnect?.(e))}})).catch((t=>{"NotFoundError"!==t.name&&this.log.error("could not inform topologies of disconnecting peer %p",e,t)}))}_onPeerUpdate(t){const{peer:e,previous:r}=t.detail,i=(r?.protocols??[]).filter((t=>!e.protocols.includes(t)));for(const t of i){const r=this.topologies.get(t);if(null!=r)for(const t of r.values())!1!==t.filter?.has(e.id)&&(t.filter?.remove(e.id),t.onDisconnect?.(e.id))}}_onPeerIdentify(t){const e=t.detail.protocols,r=t.detail.connection,i=t.detail.peerId;for(const t of e){const e=this.topologies.get(t);if(null!=e)for(const t of e.values())null!=r.limits&&!0!==t.notifyOnLimitedConnection||!0!==t.filter?.has(i)&&(t.filter?.add(i),t.onConnect?.(i,r))}}}class k_ extends Map{metric;constructor(t){super();const{name:e,metrics:r}=t;this.metric=r.registerMetric(e),this.updateComponentMetric()}set(t,e){return super.set(t,e),this.updateComponentMetric(),this}delete(t){const e=super.delete(t);return this.updateComponentMetric(),e}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}class A_{log;components;transports;listeners;faultTolerance;started;constructor(t,e={}){this.log=t.logger.forComponent("libp2p:transports"),this.components=t,this.started=!1,this.transports=new Map,this.listeners=function(t){const{name:e,metrics:r}=t;let i;return i=null!=r?new k_({name:e,metrics:r}):new Map,i}({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=e.faultTolerance??Yp.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(t){const e=t[Symbol.toStringTag];if(null==e)throw new T("Transport must have a valid tag");if(this.transports.has(e))throw new T(`There is already a transport with the tag ${e}`);this.log("adding transport %s",e),this.transports.set(e,t),this.listeners.has(e)||this.listeners.set(e,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const t=this.components.addressManager.getListenAddrs();await this.listen(t)}async stop(){const t=[];for(const[e,r]of this.listeners)for(this.log("closing listeners for %s",e);r.length>0;){const e=r.pop();null!=e&&t.push(e.close())}await Promise.all(t),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(t,e){const r=this.dialTransportForMultiaddr(t);if(null==r)throw new jM(`No transport available for address ${String(t)}`);return e?.onProgress?.(new im("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(t,{...e,upgrader:this.components.upgrader})}getAddrs(){let t=[];for(const e of this.listeners.values())for(const r of e)t=[...t,...r.getAddrs()];return t}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(t){for(const e of this.transports.values())if(e.dialFilter([t]).length>0)return e}listenTransportForMultiaddr(t){for(const e of this.transports.values())if(e.listenFilter([t]).length>0)return e}async listen(t){if(!this.isStarted())throw new K("Not started");if(null==t||0===t.length)return void this.log("no addresses were provided for listening, this node is dial only");const e=[];for(const[r,i]of this.transports.entries()){const n=i.listenFilter(t),s=[];for(const t of n){this.log("creating listener for %s on %a",r,t);const e=i.createListener({upgrader:this.components.upgrader});let n=this.listeners.get(r)??[];null==n&&(n=[],this.listeners.set(r,n)),n.push(e),e.addEventListener("listening",(()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:e})})),e.addEventListener("close",(()=>{const t=n.findIndex((t=>t===e));n.splice(t,1),this.components.events.safeDispatchEvent("transport:close",{detail:e})})),s.push(e.listen(t))}if(0!==s.length){if(null==(await Promise.allSettled(s)).find((t=>"fulfilled"===t.status))&&this.faultTolerance!==Yp.NO_FATAL)throw new NM(`Transport (${r}) could not listen on any available address`)}else e.push(r)}if(e.length===this.transports.size){const t=`no valid addresses were provided for transports [${e.join(", ")}]`;if(this.faultTolerance===Yp.FATAL_ALL)throw new NM(t);this.log(`libp2p in dial mode only: ${t}`)}}async remove(t){const e=this.listeners.get(t)??[];this.log.trace("removing transport %s",t);const r=[];for(this.log.trace("closing listeners for %s",t);e.length>0;){const t=e.pop();null!=t&&r.push(t.close())}await Promise.all(r),this.transports.delete(t),this.listeners.delete(t)}async removeAll(){const t=[];for(const e of this.transports.keys())t.push(this.remove(e));await Promise.all(t)}}const I_="/multistream/1.0.0",x_=1024,C_=dn("\n");async function T_(t,e,r){await t.write(e,r)}async function P_(t,e){const r=await async function(t,e){const r=await t.read(e);if(0===r.byteLength||r.get(r.byteLength-1)!==C_[0])throw e.log.error("Invalid mss message - missing newline",r),new $("Missing newline");return r.sublist(0,-1)}(t,e);return sa(r.subarray())}async function B_(t,e,r){e=Array.isArray(e)?e:[e],r.log.trace("handle: available protocols %s",e);const i=dc(t,{...r,maxDataLength:x_,maxLengthLength:2});for(;;){r.log.trace("handle: reading incoming string");const t=await P_(i,r);if(r.log.trace('handle: read "%s"',t),t!==I_){if(e.includes(t))return r.log.trace('handle: respond with "%s" for "%s"',t,t),await T_(i,dn(`${t}\n`),r),r.log.trace('handle: responded with "%s" for "%s"',t,t),{stream:i.unwrap(),protocol:t};if("ls"!==t)r.log.trace('handle: respond with "na" for "%s"',t),await T_(i,dn("na\n"),r),r.log('handle: responded with "na" for "%s"',t);else{const n=new hh(...e.map((t=>lh.single(dn(`${t}\n`)))),dn("\n"));r.log.trace('handle: respond with "%s" for %s',e,t),await T_(i,n,r),r.log.trace('handle: responded with "%s" for %s',e,t)}}else r.log.trace('handle: respond with "%s" for "%s"',I_,t),await T_(i,dn(`${I_}\n`),r),r.log.trace('handle: responded with "%s" for "%s"',I_,t)}}async function R_(t,e,r){if(1===(e=Array.isArray(e)?[...e]:[e]).length&&!1===r.negotiateFully)return function(t,e,r){const i=t.sink.bind(t),n=t.source;let s=!1,o=!1;const a=vh();let h=!1,u=!1;const c=vh();let l=!1,d=!1;const f=vh(),p=dc({sink:i,source:n},{...r,maxDataLength:x_});async function m(){if(o)return r.log.trace("optimistic: already negotiating %s stream",e),void await a.promise;o=!0;try{h||(r.log.trace("optimistic: doing send protocol for %s stream",e),await async function(){if(u)await c.promise;else{u=!0;try{r.log.trace('optimistic: write ["%s", "%s", data] in source',I_,e),await p.writeV([dn(`${I_}\n`),dn(`${e}\n`)]),r.log.trace('optimistic: wrote ["%s", "%s", data] in source',I_,e)}finally{h=!0,u=!1,c.resolve()}}}()),l||(r.log.trace("optimistic: doing read protocol for %s stream",e),await async function(){if(d)await f.promise;else{d=!0;try{r.log.trace("optimistic: reading multistream select header");let t=await P_(p,r);if(r.log.trace('optimistic: read multistream select header "%s"',t),t===I_&&(t=await P_(p,r)),r.log.trace('optimistic: read protocol "%s", expecting "%s"',t,e),t!==e)throw new H("protocol selection failed")}finally{l=!0,d=!1,f.resolve()}}}())}finally{o=!1,s=!0,a.resolve()}}if(t.sink=async t=>{const{sink:i}=p.unwrap();await i(async function*(){let i=!1;for await(const n of t){if(u&&await c.promise,h)yield n;else{u=!0,r.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',I_,e,n.byteLength);const t=`${e}\n`;yield new hh(Uint8Array.from([19]),dn(`${I_}\n`),fi(t.length),dn(t),n).subarray(),r.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',I_,e,n.byteLength),h=!0,u=!1,c.resolve(),m().catch((t=>{r.log.error("could not finish optimistic protocol negotiation of %s",e,t)}))}i=!0}i||await m()}())},t.source=async function*(){await m(),r.log.trace('optimistic: reading data from "%s" stream',e),yield*p.unwrap().source}(),null!=t.closeRead){const e=t.closeRead.bind(t);t.closeRead=async t=>{s||await m().catch((t=>{r.log.error("could not negotiate protocol before close read",t)})),await e(t)}}if(null!=t.closeWrite){const e=t.closeWrite.bind(t);t.closeWrite=async t=>{s||await m().catch((t=>{r.log.error("could not negotiate protocol before close write",t)})),await e(t)}}if(null!=t.close){const e=t.close.bind(t);t.close=async t=>{const r=[];u&&r.push(c.promise),d&&r.push(f.promise),r.length>0?await ic(Promise.all(r),t?.signal):(s=!0,o=!1,a.resolve()),await e(t)}}return{stream:t,protocol:e}}(t,e[0],r);const i=dc(t,{...r,maxDataLength:x_}),n=e.shift();if(null==n)throw new Error("At least one protocol must be specified");r.log.trace('select: write ["%s", "%s"]',I_,n);const s=dn(`${I_}\n`),o=dn(`${n}\n`);await async function(t,e,r){await t.writeV(e,r)}(i,[s,o],r),r.log.trace("select: reading multistream-select header");let a=await P_(i,r);if(r.log.trace('select: read "%s"',a),a===I_&&(r.log.trace("select: reading protocol response"),a=await P_(i,r),r.log.trace('select: read "%s"',a)),a===n)return{stream:i.unwrap(),protocol:n};for(const t of e){r.log.trace('select: write "%s"',t),await T_(i,dn(`${t}\n`),r),r.log.trace("select: reading protocol response");const e=await P_(i,r);if(r.log.trace('select: read "%s" for "%s"',e,t),e===t)return{stream:i.unwrap(),protocol:t}}throw new H("protocol selection failed")}const D_=Symbol.for("@libp2p/connection");class N_{id;remoteAddr;remotePeer;direction;timeline;multiplexer;encryption;status;limits;log;tags;_newStream;_close;_abort;_getStreams;constructor(t){const{remoteAddr:e,remotePeer:r,newStream:i,close:n,abort:s,getStreams:o}=t;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=e,this.remotePeer=r,this.direction=t.direction,this.status="open",this.timeline=t.timeline,this.multiplexer=t.multiplexer,this.encryption=t.encryption,this.limits=t.limits,this.log=t.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),null==this.remoteAddr.getPeerId()&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=n,this._abort=s,this._getStreams=o,this.tags=[]}[Symbol.toStringTag]="Connection";[D_]=!0;get streams(){return this._getStreams()}async newStream(t,e){if("closing"===this.status)throw new R("the connection is being closed");if("closed"===this.status)throw new D("the connection is closed");if(Array.isArray(t)||(t=[t]),null!=this.limits&&!0!==e?.runOnLimitedConnection)throw new Y("Cannot open protocol stream on limited connection");const r=await this._newStream(t,e);return r.direction="outbound",r}async close(t={}){if("closed"!==this.status&&"closing"!==this.status){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",null==t.signal){const e=AbortSignal.timeout(500);t={...t,signal:e}}try{this.log.trace("closing underlying transport"),await this._close(t),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(t){"closed"!==this.status&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,t),this.status="closing",this._abort(t),this.status="closed",this.timeline.close=Date.now())}}function L_(t,e,r){let i=0;return r.streams.forEach((r=>{r.direction===e&&r.protocol===t&&i++})),i}class O_{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;outboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;constructor(t,e){this.components=t,this.connectionEncrypters=new Map,e.connectionEncrypters.forEach((t=>{this.connectionEncrypters.set(t.protocol,t)})),this.streamMuxers=new Map,e.streamMuxers.forEach((t=>{this.streamMuxers.set(t.protocol,t)})),this.inboundUpgradeTimeout=e.inboundUpgradeTimeout??3e3,this.outboundUpgradeTimeout=e.outboundUpgradeTimeout??3e3,this.inboundStreamProtocolNegotiationTimeout=e.inboundStreamProtocolNegotiationTimeout??2e3,this.outboundStreamProtocolNegotiationTimeout=e.outboundStreamProtocolNegotiationTimeout??2e3,this.events=t.events,this.metrics={dials:t.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:t.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(t,...e){const r=this.components.connectionGater[t];if(null!=r&&!0===await r.apply(this.components.connectionGater,e))throw new LM(`The multiaddr connection is blocked by gater.${t}`)}async upgradeInbound(t,e={}){let r=!1;try{if(this.metrics.dials?.increment({inbound:!0}),r=await this.components.connectionManager.acceptIncomingConnection(t),!r)throw new OM("Connection denied");await this.shouldBlockConnection("denyInboundConnection",t),await this._performUpgrade(t,"inbound",e)}catch(t){throw this.metrics.errors?.increment({inbound:!0}),t}finally{r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(t,e={}){try{this.metrics.dials?.increment({outbound:!0});const r=t.remoteAddr.getPeerId();let i;return null!=r&&(i=th(r),await this.shouldBlockConnection("denyOutboundConnection",i,t)),await this._performUpgrade(t,"outbound",e)}catch(t){throw this.metrics.errors?.increment({outbound:!0}),t}}async _performUpgrade(t,e,r){let i,n,s,o,a;const h=Ed([AbortSignal.timeout("inbound"===e?this.inboundUpgradeTimeout:this.outboundUpgradeTimeout),r.signal]);r.signal=h,this.components.metrics?.trackMultiaddrConnection(t),t.log.trace("starting the %s connection upgrade",e);let u=t;if(!0!==r?.skipProtection){const i=this.components.connectionProtector;null!=i&&(t.log("protecting the %s connection",e),u=await i.protect(t,r))}try{if(i=u,!0!==r?.skipEncryption){r?.onProgress?.(new im(`upgrader:encrypt-${e}-connection`)),({conn:i,remotePeer:n,protocol:a}=await("inbound"===e?this._encryptInbound(u,{...r,signal:h}):this._encryptOutbound(u,{...r,signal:h})));const t={...u,...i};await this.shouldBlockConnection("inbound"===e?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",n,t)}else{const r=t.remoteAddr.getPeerId();if(null==r)throw new V(`${e} connection that skipped encryption must have a peer id`);const i=th(r);a="native",n=i}if(n.equals(this.components.peerId)){const e=new j("Can not dial self");throw t.abort(e),e}if(s=i,null!=r?.muxerFactory)o=r.muxerFactory;else if(this.streamMuxers.size>0){r?.onProgress?.(new im(`upgrader:multiplex-${e}-connection`));const t=await("inbound"===e?this._multiplexInbound({...u,...i},this.streamMuxers,r):this._multiplexOutbound({...u,...i},this.streamMuxers,r));o=t.muxerFactory,s=t.stream}}catch(r){throw t.log.error("failed to upgrade inbound connection %s %a - %e","inbound"===e?"from":"to",t.remoteAddr,r),r}finally{h.clear()}return await this.shouldBlockConnection("inbound"===e?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",n,t),t.log("successfully upgraded %s connection",e),this._createConnection({cryptoProtocol:a,direction:e,maConn:t,upgradedConn:s,muxerFactory:o,remotePeer:n,limits:r?.limits})}_createConnection(t){const{cryptoProtocol:e,direction:r,maConn:i,upgradedConn:n,remotePeer:s,muxerFactory:o,limits:a}=t;let h,u,c;null!=o&&(h=o.createStreamMuxer({direction:r,onIncomingStream:t=>{null!=c&&Promise.resolve().then((async()=>{const e=this.components.registrar.getProtocols(),r=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:i,protocol:n}=await B_(t,e,{signal:r,log:t.log,yieldBytes:!1});if(null==c)return;c.log("incoming stream opened on %s",n);const o=function(t,e){try{const{options:r}=e.getHandler(t);return r.maxInboundStreams}catch(t){if("UnhandledProtocolError"!==t.name)throw t}return 32}(n,this.components.registrar);if(L_(n,"inbound",c)===o){const e=new J(`Too many inbound protocol streams for protocol "${n}" - limit ${o}`);throw t.abort(e),e}t.source=i.source,t.sink=i.sink,t.protocol=n,null!=i.closeWrite&&(t.closeWrite=i.closeWrite),null!=i.closeRead&&(t.closeRead=i.closeRead),null!=i.close&&(t.close=i.close),await this.components.peerStore.merge(s,{protocols:[n]}),this.components.metrics?.trackProtocolStream(t,c),this._onStream({connection:c,stream:t,protocol:n})})).catch((async e=>{c.log.error("error handling incoming stream id %s - %e",t.id,e),null==t.timeline.close&&await t.close()}))}}),u=async(e,i={})=>{if(null==h)throw new UM("Connection is not multiplexed");c.log.trace("starting new stream for protocols %s",e);const n=await h.newStream();c.log.trace("started new stream %s for protocols %s",n.id,e);try{if(null==i.signal){n.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e);const t=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);i={...i,signal:t}}n.log.trace("selecting protocol from protocols %s",e);const{stream:t,protocol:r}=await R_(n,e,{...i,log:n.log,yieldBytes:!0});n.log.trace("selected protocol %s",r);const o=function(t,e,r={}){try{const{options:r}=e.getHandler(t);if(null!=r.maxOutboundStreams)return r.maxOutboundStreams}catch(t){if("UnhandledProtocolError"!==t.name)throw t}return r.maxOutboundStreams??64}(r,this.components.registrar,i),a=L_(r,"outbound",c);if(a>=o){const t=new X(`Too many outbound protocol streams for protocol "${r}" - ${a}/${o}`);throw n.abort(t),t}return await this.components.peerStore.merge(s,{protocols:[r]}),n.source=t.source,n.sink=t.sink,n.protocol=r,null!=t.closeWrite&&(n.closeWrite=t.closeWrite),null!=t.closeRead&&(n.closeRead=t.closeRead),null!=t.close&&(n.close=t.close),this.components.metrics?.trackProtocolStream(n,c),n}catch(i){throw c.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e","inbound"===r?"from":"to",t.maConn.remoteAddr,e,i),null==n.timeline.close&&n.abort(i),i}},Promise.all([h.sink(n.source),n.sink(h.source)]).catch((t=>{c.log.error("error piping data through muxer - %e",t)})));const l=i.timeline;var d;return i.timeline=new Proxy(l,{set:(...t)=>("close"===t[1]&&null!=t[2]&&null==l.close&&(async()=>{try{"open"===c.status&&await c.close()}catch(t){c.log.error("error closing connection after timeline close %e",t)}finally{this.events.safeDispatchEvent("connection:close",{detail:c})}})().catch((t=>{c.log.error("error thrown while dispatching connection:close event %e",t)})),Reflect.set(...t))}),i.timeline.upgraded=Date.now(),d={remoteAddr:i.remoteAddr,remotePeer:s,status:"open",direction:r,timeline:i.timeline,multiplexer:h?.protocol,encryption:e,limits:a,logger:this.components.logger,newStream:u??(()=>{throw new UM("Connection is not multiplexed")}),getStreams:()=>h?.streams??[],close:async t=>{await(h?.close(t)),await i.close(t)},abort:t=>{i.abort(t),h?.abort(t)}},c=new N_(d),this.events.safeDispatchEvent("connection:open",{detail:c}),c.__maConnTimeline=l,c}_onStream(t){const{connection:e,stream:r,protocol:i}=t,{handler:n,options:s}=this.components.registrar.getHandler(i);if(null!=e.limits&&!0!==s.runOnLimitedConnection)throw new Y("Cannot open protocol stream on limited connection");n({connection:e,stream:r})}async _encryptInbound(t,e){const r=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:n}=await B_(t,r,{...e,log:t.log}),s=this.connectionEncrypters.get(n);if(null==s)throw new FM(`no crypto module found for ${n}`);return t.log("encrypting inbound connection to %a using %s",t.remoteAddr,n),{...await s.secureInbound(i,e),protocol:n}}catch(e){throw t.log.error("encrypting inbound connection from %a failed",t.remoteAddr,e),new FM(e.message)}}async _encryptOutbound(t,e){const r=Array.from(this.connectionEncrypters.keys());try{t.log.trace("selecting encrypter from %s",r);const{stream:i,protocol:n}=await R_(t,r,{...e,log:t.log,yieldBytes:!0}),s=this.connectionEncrypters.get(n);if(null==s)throw new FM(`no crypto module found for ${n}`);return t.log("encrypting outbound connection to %a using %s",t.remoteAddr,n),{...await s.secureOutbound(i,e),protocol:n}}catch(e){throw t.log.error("encrypting outbound connection to %a failed",t.remoteAddr,e),new FM(e.message)}}async _multiplexOutbound(t,e,r){const i=Array.from(e.keys());t.log("outbound selecting muxer %s",i);try{t.log.trace("selecting stream muxer from %s",i);const{stream:n,protocol:s}=await R_(t,i,{...r,log:t.log,yieldBytes:!0});return t.log("selected %s as muxer protocol",s),{stream:n,muxerFactory:e.get(s)}}catch(e){throw t.log.error("error multiplexing outbound connection",e),new UM(String(e))}}async _multiplexInbound(t,e,r){const i=Array.from(e.keys());t.log("inbound handling muxers %s",i);try{const{stream:n,protocol:s}=await B_(t,i,{...r,log:t.log});return{stream:n,muxerFactory:e.get(s)}}catch(e){throw t.log.error("error multiplexing inbound connection",e),new UM(String(e))}}}class U_ extends v{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(t){super(),this.status="stopped";const e=new v,r=e.dispatchEvent.bind(e);e.dispatchEvent=t=>{const e=r(t),i=this.dispatchEvent(new CustomEvent(t.type,{detail:t.detail}));return e||i},this.peerId=t.peerId,this.logger=t.logger??Tm(),this.log=this.logger.forComponent("libp2p"),this.services={};const i=this.components=function(t={}){const e=new VM(t);return new Proxy(e,{get(t,r,i){if("string"==typeof r&&!zM.includes(r)){const t=e.components[r];if(null==t&&!qM.includes(r))throw new IM(`${r} not set`);return t}return Reflect.get(t,r,i)},set:(t,r,i)=>("string"==typeof r?e.components[r]=i:Reflect.set(t,r,i),!0)})}({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:t.nodeInfo??{name:"js-libp2p",version:"2.4.2"},logger:this.logger,events:e,datastore:t.datastore??new mM,connectionGater:KM(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",function(t,e={}){return new hM(t,e)}(i,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),null!=t.metrics&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),i.events.addEventListener("peer:update",(t=>{if(null==t.detail.previous){const e={id:t.detail.peer.id,multiaddrs:t.detail.peer.addresses.map((t=>t.multiaddr))};i.events.safeDispatchEvent("peer:discovery",{detail:e})}})),null!=t.connectionProtector&&this.configureComponent("connectionProtector",t.connectionProtector(i)),this.components.upgrader=new O_(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map(((t,e)=>this.configureComponent(`connection-encryption-${e}`,t(this.components)))),streamMuxers:(t.streamMuxers??[]).map(((t,e)=>this.configureComponent(`stream-muxers-${e}`,t(this.components)))),inboundUpgradeTimeout:t.connectionManager?.inboundUpgradeTimeout,outboundUpgradeTimeout:t.connectionManager?.outboundUpgradeTimeout}),this.configureComponent("transportManager",new A_(this.components,t.transportManager)),this.configureComponent("connectionManager",new g_(this.components,t.connectionManager)),!1!==t.connectionMonitor?.enabled&&this.configureComponent("connectionMonitor",new v_(this.components,t.connectionMonitor)),this.configureComponent("registrar",new E_(this.components)),this.configureComponent("addressManager",new kM(this.components,t.addresses));const n=(t.peerRouters??[]).map(((t,e)=>this.configureComponent(`peer-router-${e}`,t(this.components))));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new __(this.components,{routers:n}));const s=(t.contentRouters??[]).map(((t,e)=>this.configureComponent(`content-router-${e}`,t(this.components))));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new w_(this.components,{routers:s})),this.configureComponent("randomWalk",new S_(this.components)),(t.peerDiscovery??[]).forEach(((t,e)=>{this.configureComponent(`peer-discovery-${e}`,t(this.components)).addEventListener("peer",(t=>{this.#O(t)}))})),t.transports?.forEach(((t,e)=>{this.components.transportManager.add(this.configureComponent(`transport-${e}`,t(this.components)))})),null!=t.services)for(const e of Object.keys(t.services)){const r=(0,t.services[e])(this.components);null!=r?(this.services[e]=r,this.configureComponent(e,r),null!=r[kw]&&(this.log("registering service %s for content routing",e),s.push(r[kw])),null!=r[Aw]&&(this.log("registering service %s for peer routing",e),n.push(r[Aw])),null!=r[zd]&&(this.log("registering service %s for peer discovery",e),r[zd].addEventListener?.("peer",(t=>{this.#O(t)})))):this.log.error("service factory %s returned null or undefined instance",e)}!function(t){const e={};for(const r of Object.values(t.components))for(const t of HM(r))e[t]=!0;for(const r of Object.values(t.components))for(const t of $M(r))if(!0!==e[t])throw new xM(`Service "${WM(r)}" required capability "${t}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}(i)}configureComponent(t,e){return null==e&&this.log.error("component %s was null or undefined",t),this.components[t]=e,e}async start(){if("stopped"===this.status){this.status="starting",this.log("libp2p is starting");try{await(this.components.beforeStart?.()),await this.components.start(),await(this.components.afterStart?.()),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(t){throw this.log.error("An error occurred starting libp2p",t),this.status="started",await this.stop(),t}}}async stop(){"started"===this.status&&(this.log("libp2p is stopping"),this.status="stopping",await(this.components.beforeStop?.()),await this.components.stop(),await(this.components.afterStop?.()),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Jl;for(const e of this.components.connectionManager.getConnections())t.add(e.remotePeer);return Array.from(t)}async dial(t,e={}){return this.components.connectionManager.openConnection(t,{priority:75,...e})}async dialProtocol(t,e,r={}){if(null==e)throw new T("no protocols were provided to open a stream");if(0===(e=Array.isArray(e)?e:[e]).length)throw new T("no protocols were provided to open a stream");return(await this.dial(t,r)).newStream(e,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,e={}){Od(t)&&(t=th(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,e)}async getPublicKey(t,e={}){if(this.log("getPublicKey %p",t),null!=t.publicKey)return t.publicKey;try{const e=await this.peerStore.get(t);if(null!=e.id.publicKey)return e.id.publicKey}catch(t){if("NotFoundError"!==t.name)throw t}const r=nh([dn("/pk/"),t.toMultihash().bytes]),i=Ha(await this.contentRouting.get(r,e));return await this.peerStore.patch(t,{publicKey:i}),i}async handle(t,e,r){Array.isArray(t)||(t=[t]),await Promise.all(t.map((async t=>{await this.components.registrar.handle(t,e,r)})))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map((async t=>{await this.components.registrar.unhandle(t)})))}async register(t,e){return this.components.registrar.register(t,e)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,e={}){return this.components.connectionManager.isDialable(t,e)}#O(t){const{detail:e}=t;e.id.toString()!==this.peerId.toString()?this.components.peerStore.merge(e.id,{multiaddrs:e.multiaddrs}).catch((t=>{this.log.error(t)})):this.log.error("peer discovery mechanism discovered self")}}var F_,j_=r(2186);function V_(t){switch(t){case 0:case"NULL_VALUE":return F_.NULL_VALUE;default:return F_.UNRECOGNIZED}}!function(t){t[t.NULL_VALUE=0]="NULL_VALUE",t[t.UNRECOGNIZED=-1]="UNRECOGNIZED"}(F_||(F_={}));const q_={encode:(t,e=new j_.fI)=>(Object.entries(t.fields).forEach((([t,r])=>{void 0!==r&&z_.encode({key:t,value:r},e.uint32(10).fork()).join()})),e),decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={fields:{}};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:{if(10!==t)break;const e=z_.decode(r,r.uint32());void 0!==e.value&&(n.fields[e.key]=e.value);continue}}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({fields:W_(t.fields)?Object.entries(t.fields).reduce(((t,[e,r])=>(t[e]=r,t)),{}):{}}),toJSON(t){const e={};if(t.fields){const r=Object.entries(t.fields);r.length>0&&(e.fields={},r.forEach((([t,r])=>{e.fields[t]=r})))}return e},create:t=>q_.fromPartial(t??{}),fromPartial(t){const e={fields:{}};return e.fields=Object.entries(t.fields??{}).reduce(((t,[e,r])=>(void 0!==r&&(t[e]=r),t)),{}),e},wrap(t){const e={fields:{}};if(void 0!==t)for(const r of Object.keys(t))e.fields[r]=t[r];return e},unwrap(t){const e={};if(t.fields)for(const r of Object.keys(t.fields))e[r]=t.fields[r];return e}},z_={encode:(t,e=new j_.fI)=>(""!==t.key&&e.uint32(10).string(t.key),void 0!==t.value&&H_.encode(H_.wrap(t.value),e.uint32(18).fork()).join(),e),decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={key:"",value:void 0};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.key=r.string();continue;case 2:if(18!==t)break;n.value=H_.unwrap(H_.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({key:K_(t.key)?globalThis.String(t.key):"",value:K_(t?.value)?t.value:void 0}),toJSON(t){const e={};return""!==t.key&&(e.key=t.key),void 0!==t.value&&(e.value=t.value),e},create:t=>z_.fromPartial(t??{}),fromPartial(t){const e={key:"",value:void 0};return e.key=t.key??"",e.value=t.value??void 0,e}},H_={encode:(t,e=new j_.fI)=>(void 0!==t.nullValue&&e.uint32(8).int32(t.nullValue),void 0!==t.numberValue&&e.uint32(17).double(t.numberValue),void 0!==t.stringValue&&e.uint32(26).string(t.stringValue),void 0!==t.boolValue&&e.uint32(32).bool(t.boolValue),void 0!==t.structValue&&q_.encode(q_.wrap(t.structValue),e.uint32(42).fork()).join(),void 0!==t.listValue&&$_.encode($_.wrap(t.listValue),e.uint32(50).fork()).join(),e),decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(8!==t)break;n.nullValue=r.int32();continue;case 2:if(17!==t)break;n.numberValue=r.double();continue;case 3:if(26!==t)break;n.stringValue=r.string();continue;case 4:if(32!==t)break;n.boolValue=r.bool();continue;case 5:if(42!==t)break;n.structValue=q_.unwrap(q_.decode(r,r.uint32()));continue;case 6:if(50!==t)break;n.listValue=$_.unwrap($_.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({nullValue:K_(t.nullValue)?V_(t.nullValue):void 0,numberValue:K_(t.numberValue)?globalThis.Number(t.numberValue):void 0,stringValue:K_(t.stringValue)?globalThis.String(t.stringValue):void 0,boolValue:K_(t.boolValue)?globalThis.Boolean(t.boolValue):void 0,structValue:W_(t.structValue)?t.structValue:void 0,listValue:globalThis.Array.isArray(t.listValue)?[...t.listValue]:void 0}),toJSON(t){const e={};return void 0!==t.nullValue&&(e.nullValue=function(t){switch(t){case F_.NULL_VALUE:return"NULL_VALUE";case F_.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(t.nullValue)),void 0!==t.numberValue&&(e.numberValue=t.numberValue),void 0!==t.stringValue&&(e.stringValue=t.stringValue),void 0!==t.boolValue&&(e.boolValue=t.boolValue),void 0!==t.structValue&&(e.structValue=t.structValue),void 0!==t.listValue&&(e.listValue=t.listValue),e},create:t=>H_.fromPartial(t??{}),fromPartial(t){const e={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};return e.nullValue=t.nullValue??void 0,e.numberValue=t.numberValue??void 0,e.stringValue=t.stringValue??void 0,e.boolValue=t.boolValue??void 0,e.structValue=t.structValue??void 0,e.listValue=t.listValue??void 0,e},wrap(t){const e={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};if(null===t)e.nullValue=F_.NULL_VALUE;else if("boolean"==typeof t)e.boolValue=t;else if("number"==typeof t)e.numberValue=t;else if("string"==typeof t)e.stringValue=t;else if(globalThis.Array.isArray(t))e.listValue=t;else if("object"==typeof t)e.structValue=t;else if(void 0!==t)throw new globalThis.Error("Unsupported any value type: "+typeof t);return e},unwrap:t=>void 0!==t.stringValue?t.stringValue:void 0!==t?.numberValue?t.numberValue:void 0!==t?.boolValue?t.boolValue:void 0!==t?.structValue?t.structValue:void 0!==t?.listValue?t.listValue:void 0!==t?.nullValue?null:void 0},$_={encode(t,e=new j_.fI){for(const r of t.values)H_.encode(H_.wrap(r),e.uint32(10).fork()).join();return e},decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={values:[]};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.values.push(H_.unwrap(H_.decode(r,r.uint32())));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({values:globalThis.Array.isArray(t?.values)?[...t.values]:[]}),toJSON(t){const e={};return t.values?.length&&(e.values=t.values),e},create:t=>$_.fromPartial(t??{}),fromPartial(t){const e={values:[]};return e.values=t.values?.map((t=>t))||[],e},wrap(t){const e={values:[]};return e.values=t??[],e},unwrap:t=>t?.hasOwnProperty("values")&&globalThis.Array.isArray(t.values)?t.values:t};function W_(t){return"object"==typeof t&&null!==t}function K_(t){return null!=t}const G_={encode(t,e=new j_.fI){""!==t.hash&&e.uint32(10).string(t.hash),""!==t.nodeId&&e.uint32(18).string(t.nodeId),void 0!==t.operation&&Z_.encode(t.operation,e.uint32(26).fork()).join();for(const r of t.dependencies)e.uint32(34).string(r);return""!==t.signature&&e.uint32(42).string(t.signature),e},decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={hash:"",nodeId:"",operation:void 0,dependencies:[],signature:""};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.hash=r.string();continue;case 2:if(18!==t)break;n.nodeId=r.string();continue;case 3:if(26!==t)break;n.operation=Z_.decode(r,r.uint32());continue;case 4:if(34!==t)break;n.dependencies.push(r.string());continue;case 5:if(42!==t)break;n.signature=r.string();continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({hash:Y_(t.hash)?globalThis.String(t.hash):"",nodeId:Y_(t.nodeId)?globalThis.String(t.nodeId):"",operation:Y_(t.operation)?Z_.fromJSON(t.operation):void 0,dependencies:globalThis.Array.isArray(t?.dependencies)?t.dependencies.map((t=>globalThis.String(t))):[],signature:Y_(t.signature)?globalThis.String(t.signature):""}),toJSON(t){const e={};return""!==t.hash&&(e.hash=t.hash),""!==t.nodeId&&(e.nodeId=t.nodeId),void 0!==t.operation&&(e.operation=Z_.toJSON(t.operation)),t.dependencies?.length&&(e.dependencies=t.dependencies),""!==t.signature&&(e.signature=t.signature),e},create:t=>G_.fromPartial(t??{}),fromPartial(t){const e={hash:"",nodeId:"",operation:void 0,dependencies:[],signature:""};return e.hash=t.hash??"",e.nodeId=t.nodeId??"",e.operation=void 0!==t.operation&&null!==t.operation?Z_.fromPartial(t.operation):void 0,e.dependencies=t.dependencies?.map((t=>t))||[],e.signature=t.signature??"",e}},Z_={encode:(t,e=new j_.fI)=>(""!==t.type&&e.uint32(10).string(t.type),void 0!==t.value&&H_.encode(H_.wrap(t.value),e.uint32(18).fork()).join(),e),decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={type:"",value:void 0};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.type=r.string();continue;case 2:if(18!==t)break;n.value=H_.unwrap(H_.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({type:Y_(t.type)?globalThis.String(t.type):"",value:Y_(t?.value)?t.value:void 0}),toJSON(t){const e={};return""!==t.type&&(e.type=t.type),void 0!==t.value&&(e.value=t.value),e},create:t=>Z_.fromPartial(t??{}),fromPartial(t){const e={type:"",value:void 0};return e.type=t.type??"",e.value=t.value??void 0,e}};function Y_(t){return null!=t}var J_;function X_(t){switch(t){case 0:case"MESSAGE_TYPE_UNSPECIFIED":return J_.MESSAGE_TYPE_UNSPECIFIED;case 1:case"MESSAGE_TYPE_UPDATE":return J_.MESSAGE_TYPE_UPDATE;case 2:case"MESSAGE_TYPE_SYNC":return J_.MESSAGE_TYPE_SYNC;case 3:case"MESSAGE_TYPE_SYNC_ACCEPT":return J_.MESSAGE_TYPE_SYNC_ACCEPT;case 4:case"MESSAGE_TYPE_SYNC_REJECT":return J_.MESSAGE_TYPE_SYNC_REJECT;case 5:case"MESSAGE_TYPE_CUSTOM":return J_.MESSAGE_TYPE_CUSTOM;default:return J_.UNRECOGNIZED}}function Q_(){return{sender:"",type:0,data:new Uint8Array(0)}}!function(t){t[t.MESSAGE_TYPE_UNSPECIFIED=0]="MESSAGE_TYPE_UNSPECIFIED",t[t.MESSAGE_TYPE_UPDATE=1]="MESSAGE_TYPE_UPDATE",t[t.MESSAGE_TYPE_SYNC=2]="MESSAGE_TYPE_SYNC",t[t.MESSAGE_TYPE_SYNC_ACCEPT=3]="MESSAGE_TYPE_SYNC_ACCEPT",t[t.MESSAGE_TYPE_SYNC_REJECT=4]="MESSAGE_TYPE_SYNC_REJECT",t[t.MESSAGE_TYPE_CUSTOM=5]="MESSAGE_TYPE_CUSTOM",t[t.UNRECOGNIZED=-1]="UNRECOGNIZED"}(J_||(J_={}));const tS={encode:(t,e=new j_.fI)=>(""!==t.sender&&e.uint32(10).string(t.sender),0!==t.type&&e.uint32(16).int32(t.type),0!==t.data.length&&e.uint32(26).bytes(t.data),e),decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n=Q_();for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.sender=r.string();continue;case 2:if(16!==t)break;n.type=r.int32();continue;case 3:if(26!==t)break;n.data=r.bytes();continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({sender:sS(t.sender)?globalThis.String(t.sender):"",type:sS(t.type)?X_(t.type):0,data:sS(t.data)?nS(t.data):new Uint8Array(0)}),toJSON(t){const e={};return""!==t.sender&&(e.sender=t.sender),0!==t.type&&(e.type=function(t){switch(t){case J_.MESSAGE_TYPE_UNSPECIFIED:return"MESSAGE_TYPE_UNSPECIFIED";case J_.MESSAGE_TYPE_UPDATE:return"MESSAGE_TYPE_UPDATE";case J_.MESSAGE_TYPE_SYNC:return"MESSAGE_TYPE_SYNC";case J_.MESSAGE_TYPE_SYNC_ACCEPT:return"MESSAGE_TYPE_SYNC_ACCEPT";case J_.MESSAGE_TYPE_SYNC_REJECT:return"MESSAGE_TYPE_SYNC_REJECT";case J_.MESSAGE_TYPE_CUSTOM:return"MESSAGE_TYPE_CUSTOM";case J_.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(t.type)),0!==t.data.length&&(e.data=function(t){if(globalThis.Buffer)return globalThis.Buffer.from(t).toString("base64");{const e=[];return t.forEach((t=>{e.push(globalThis.String.fromCharCode(t))})),globalThis.btoa(e.join(""))}}(t.data)),e},create:t=>tS.fromPartial(t??{}),fromPartial(t){const e=Q_();return e.sender=t.sender??"",e.type=t.type??0,e.data=t.data??new Uint8Array(0),e}},eS={encode(t,e=new j_.fI){""!==t.objectId&&e.uint32(10).string(t.objectId);for(const r of t.vertices)G_.encode(r,e.uint32(18).fork()).join();return e},decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={objectId:"",vertices:[]};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.objectId=r.string();continue;case 2:if(18!==t)break;n.vertices.push(G_.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({objectId:sS(t.objectId)?globalThis.String(t.objectId):"",vertices:globalThis.Array.isArray(t?.vertices)?t.vertices.map((t=>G_.fromJSON(t))):[]}),toJSON(t){const e={};return""!==t.objectId&&(e.objectId=t.objectId),t.vertices?.length&&(e.vertices=t.vertices.map((t=>G_.toJSON(t)))),e},create:t=>eS.fromPartial(t??{}),fromPartial(t){const e={objectId:"",vertices:[]};return e.objectId=t.objectId??"",e.vertices=t.vertices?.map((t=>G_.fromPartial(t)))||[],e}},rS={encode(t,e=new j_.fI){""!==t.objectId&&e.uint32(10).string(t.objectId);for(const r of t.vertexHashes)e.uint32(18).string(r);return e},decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={objectId:"",vertexHashes:[]};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.objectId=r.string();continue;case 2:if(18!==t)break;n.vertexHashes.push(r.string());continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({objectId:sS(t.objectId)?globalThis.String(t.objectId):"",vertexHashes:globalThis.Array.isArray(t?.vertexHashes)?t.vertexHashes.map((t=>globalThis.String(t))):[]}),toJSON(t){const e={};return""!==t.objectId&&(e.objectId=t.objectId),t.vertexHashes?.length&&(e.vertexHashes=t.vertexHashes),e},create:t=>rS.fromPartial(t??{}),fromPartial(t){const e={objectId:"",vertexHashes:[]};return e.objectId=t.objectId??"",e.vertexHashes=t.vertexHashes?.map((t=>t))||[],e}},iS={encode(t,e=new j_.fI){""!==t.objectId&&e.uint32(10).string(t.objectId);for(const r of t.requested)G_.encode(r,e.uint32(18).fork()).join();for(const r of t.requesting)e.uint32(26).string(r);return e},decode(t,e){const r=t instanceof j_.V5?t:new j_.V5(t);let i=void 0===e?r.len:r.pos+e;const n={objectId:"",requested:[],requesting:[]};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.objectId=r.string();continue;case 2:if(18!==t)break;n.requested.push(G_.decode(r,r.uint32()));continue;case 3:if(26!==t)break;n.requesting.push(r.string());continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({objectId:sS(t.objectId)?globalThis.String(t.objectId):"",requested:globalThis.Array.isArray(t?.requested)?t.requested.map((t=>G_.fromJSON(t))):[],requesting:globalThis.Array.isArray(t?.requesting)?t.requesting.map((t=>globalThis.String(t))):[]}),toJSON(t){const e={};return""!==t.objectId&&(e.objectId=t.objectId),t.requested?.length&&(e.requested=t.requested.map((t=>G_.toJSON(t)))),t.requesting?.length&&(e.requesting=t.requesting),e},create:t=>iS.fromPartial(t??{}),fromPartial(t){const e={objectId:"",requested:[],requesting:[]};return e.objectId=t.objectId??"",e.requested=t.requested?.map((t=>G_.fromPartial(t)))||[],e.requesting=t.requesting?.map((t=>t))||[],e}};function nS(t){if(globalThis.Buffer)return Uint8Array.from(globalThis.Buffer.from(t,"base64"));{const e=globalThis.atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return r}}function sS(t){return null!=t}async function oS(t,e){await kh(e,(t=>lh([t])),t.sink)}const aS="/drp/message/0.0.1";let hS;class uS{_config;_node;_pubsub;_privateKey;publicKey;peerId="";constructor(t){this._config=t,hS=new y.V("drp::network",t?.log_config)}async start(){if(this._config?.private_key_seed){const t=this._config.private_key_seed.padEnd(32,"0");this._privateKey=await async function(t,e){return async function(t){const{privateKey:e,publicKey:r}=function(t){if(32!==t.length)throw new TypeError('"seed" must be 32 bytes in length.');if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=t,r=Wr.getPublicKey(e);return{privateKey:Gr(e,r),publicKey:r}}(t);return new Yr(e,r)}(e)}(0,dn(t))}else this._privateKey=await za("Ed25519");this.publicKey=sa(this._privateKey.publicKey.raw,"base64");const t=this._config?.bootstrap_peers?this._config.bootstrap_peers:["/dns4/bootstrap2.topology.gg/tcp/50000/ws/p2p/12D3KooWLGuTtCHLpd1SBHeyvzT3kHVe2dw8P7UdoXsfQHu8qvkf"],e=function(t={}){return e=>new Py(e,t)}({interval:1e4,topics:["drp::discovery"]}),r=t.length?[e,(i={list:t},t=>new Sf(t,i))]:[e];var i;const n={autonat:qd(),dcutr:ym(),identify:Cy(),pubsub:ec({allowPublishToZeroTopicPeers:!0})},s={...n,relay:Gp()};if(this._node=await async function(t={}){t.privateKey??=await za("Ed25519");const e=new U_({...await Ew(t),peerId:(r=t.privateKey,eh(r.publicKey))});var r;return!1!==t.start&&await e.start(),e}({privateKey:this._privateKey,addresses:{listen:this._config?.addresses?this._config.addresses:["/p2p-circuit","/webrtc"]},connectionEncrypters:[vl()],connectionGater:{denyDialMultiaddr:()=>!1},metrics:this._config?.browser_metrics?sy():void 0,peerDiscovery:r,services:this._config?.bootstrap?s:n,streamMuxers:[Gl()],transports:[cm(),Lv(),Nv(),Qv({filter:Jv}),hw()]}),hS.info("running on:",this._node.getMultiaddrs()),!this._config?.bootstrap)for(const t of this._config?.bootstrap_peers||[])try{await this._node.dial(Ud(t))}catch(t){hS.error("::start::dial::error",t)}this._pubsub=this._node.services.pubsub,this.peerId=this._node.peerId.toString(),hS.info("::start: Successfuly started DRP network w/ peer_id",this.peerId),this._node.addEventListener("peer:connect",(t=>hS.info("::start::peer::connect",t.detail))),this._node.addEventListener("peer:discovery",(async t=>{const e=t.detail.multiaddrs.sort(((t,e)=>{const r=/(^\/ip4\/127\.)|(^\/ip4\/10\.)|(^\/ip4\/172\.1[6-9]\.)|(^\/ip4\/172\.2[0-9]\.)|(^\/ip4\/172\.3[0-1]\.)|(^\/ip4\/192\.168\.)/,i=r.test(t.toString()),n=r.test(e.toString()),s=t.toString().includes("/webrtc/"),o=e.toString().includes("/webrtc/");return i&&!n?1:!i&&n||s&&!o?-1:!s&&o?1:0}));for(const r of e)try{await(this._node?.dial(r))}catch(t){hS.error("::start::peer::dial::error",t)}hS.info("::start::peer::discovery",t.detail)})),this._node.addEventListener("peer:identify",(t=>hS.info("::start::peer::identify",t.detail)))}subscribe(t){if(this._node)try{this._pubsub?.subscribe(t),this._pubsub?.getPeers(),hS.info("::subscribe: Successfuly subscribed the topic",t)}catch(t){hS.error("::subscribe:",t)}else hS.error("::subscribe: Node not initialized, please run .start()")}unsubscribe(t){if(this._node)try{this._pubsub?.unsubscribe(t),hS.info("::unsubscribe: Successfuly unsubscribed the topic",t)}catch(t){hS.error("::unsubscribe:",t)}else hS.error("::unsubscribe: Node not initialized, please run .start()")}getAllPeers(){const t=this._node?.getPeers();return t?t.map((t=>t.toString())):[]}getGroupPeers(t){const e=this._pubsub?.getSubscribers(t);return e?e.map((t=>t.toString())):[]}async broadcastMessage(t,e){try{const r=tS.encode(e).finish();await(this._pubsub?.publish(t,r)),hS.info("::broadcastMessage: Successfuly broadcasted message to topic",t)}catch(t){hS.error("::broadcastMessage:",t)}}async sendMessage(t,e){try{const r=await(this._node?.dial([Ud(`/p2p/${t}`)]));oS(await(r?.newStream(aS)),tS.encode(e).finish())}catch(t){hS.error("::sendMessage:",t)}}async sendGroupMessageRandomPeer(t,e){try{const r=this._pubsub?.getSubscribers(t);if(!r||0===r.length)throw Error("Topic wo/ peers");const i=r[Math.floor(Math.random()*r.length)],n=await(this._node?.dial(i));oS(await(n?.newStream(aS)),tS.encode(e).finish())}catch(t){hS.error("::sendMessageRandomTopicPeer:",t)}}addGroupMessageHandler(t,e){this._pubsub?.addEventListener("gossipsub:message",(r=>{t&&r.detail.msg.topic!==t||e(r)}))}addMessageHandler(t){this._node?.handle(aS,t)}addCustomMessageHandler(t,e){this._node?.handle(t,e)}async sign(t){return this._privateKey?sa(await this._privateKey.sign(dn(t)),"base64"):(hS.error("::signVertexOperation: Private key not found"),"")}}var cS,lS=r(1132);async function dS(t,e,r){let i;if(e){const t=await async function(t){return await kh(t.source,(t=>yh(t)),(t=>function(t,e){let r=0;if(null!=t[Symbol.asyncIterator])return async function*(){for await(const i of t)yield e(i,r++)}();const i=jl(t),{value:n,done:s}=i.next();if(!0===s)return function*(){}();const o=e(n,r++);if("function"==typeof o.then)return async function*(){yield await o;for await(const t of i)yield e(t,r++)}();const a=e;return function*(){yield o;for(const t of i)yield a(t,r++)}()}(t,(t=>t.subarray()))),(async t=>{const e=[];for await(const r of t)e.push(r);return e[0]}))}(e);i=tS.decode(t)}else{if(!r)return void yS.error("::messageHandler: Stream and data are undefined");i=tS.decode(r)}switch(i.type){case J_.MESSAGE_TYPE_UPDATE:!async function(t,e,r){const i=eS.decode(e),n=t.objectStore.get(i.objectId);if(!n)return yS.error("::updateHandler: Object not found"),!1;const s=await pS(n,i.vertices),[o,a]=n.merge(s);o||await t.syncObject(i.objectId,r),t.objectStore.put(n.id,n)}(t,i.data,i.sender);break;case J_.MESSAGE_TYPE_SYNC:if(!e)return void yS.error("::messageHandler: Stream is undefined");!async function(t,e,r){const i=rS.decode(r),n=t.objectStore.get(i.objectId);if(!n)return void yS.error("::syncHandler: Object not found");await fS(t,n.vertices);const s=new Set(n.vertices),o=[];for(const t of i.vertexHashes){const e=n.vertices.find((e=>e.hash===t));e?s.delete(e):o.push(t)}if(0===s.size&&0===o.length)return;const a=tS.create({sender:t.networkNode.peerId,type:J_.MESSAGE_TYPE_SYNC_ACCEPT,data:iS.encode(iS.create({objectId:n.id,requested:[...s],requesting:o})).finish()});t.networkNode.sendMessage(e,a)}(t,i.sender,i.data);break;case J_.MESSAGE_TYPE_SYNC_ACCEPT:if(!e)return void yS.error("::messageHandler: Stream is undefined");!async function(t,e,r){const i=iS.decode(r),n=t.objectStore.get(i.objectId);if(!n)return void yS.error("::syncAcceptHandler: Object not found");const s=await pS(n,i.requested);0!==s.length&&(n.merge(s),t.objectStore.put(n.id,n)),await fS(t,n.vertices);const o=[];for(const t of i.requesting){const e=n.vertices.find((e=>e.hash===t));e&&o.push(e)}if(0===o.length)return;const a=tS.create({sender:t.networkNode.peerId,type:J_.MESSAGE_TYPE_SYNC_ACCEPT,data:iS.encode(iS.create({objectId:n.id,requested:o,requesting:[]})).finish()});t.networkNode.sendMessage(e,a)}(t,i.sender,i.data);break;case J_.MESSAGE_TYPE_SYNC_REJECT:i.data;break;default:yS.error("::messageHandler: Invalid operation")}}async function fS(t,e){const r=e.map((async e=>{e.nodeId===t.networkNode.peerId&&""===e.signature&&await t.signVertexOperation(e)}));await Promise.all(r)}async function pS(t,e){const r=e.map((t=>({hash:t.hash,nodeId:t.nodeId,operation:{type:t.operation?.type??"",value:t.operation?.value},dependencies:t.dependencies,signature:t.signature}))),i=t.drp;if(!i.acl)return r;const n=i.acl,s=r.map((async t=>{if(""===t.signature)return null;const e=dn(t.signature,"base64"),r=n.getPeerKey(t.nodeId);if(!r)return null;const i=dn(r,"base64"),s=dn(JSON.stringify(t.operation));try{const r=await crypto.subtle.importKey("raw",i,{name:"Ed25519"},!0,["verify"]);return await crypto.subtle.verify({name:"Ed25519"},r,e,s)?t:null}catch(t){return console.error("Error verifying signature:",t),null}}));return(await Promise.all(s)).filter((t=>null!==t))}async function mS(t,e){t.networkNode.subscribe(e),t.networkNode.addGroupMessageHandler(e,(async e=>dS(t,void 0,e.detail.msg.data)))}async function gS(t,e,r){const i=t.objectStore.get(e);if(!i)return void yS.error("::syncObject: Object not found");const n=rS.create({objectId:e,vertexHashes:i.vertices.map((t=>t.hash))}),s=tS.create({sender:t.networkNode.peerId,type:J_.MESSAGE_TYPE_SYNC,data:rS.encode(n).finish()});r?await t.networkNode.sendMessage(r,s):await t.networkNode.sendGroupMessageRandomPeer(e,s)}!function(t){t[t.CREATE=0]="CREATE",t[t.UPDATE=1]="UPDATE",t[t.SUBSCRIBE=2]="SUBSCRIBE",t[t.UNSUBSCRIBE=3]="UNSUBSCRIBE",t[t.SYNC=4]="SYNC"}(cS||(cS={}));class bS{_store;_subscriptions;constructor(){this._store=new Map,this._subscriptions=new Map}get(t){return this._store.get(t)}put(t,e){this._store.set(t,e),this._notifySubscribers(t,e)}subscribe(t,e){this._subscriptions.has(t)||this._subscriptions.set(t,[]),this._subscriptions.get(t)?.push(e)}_notifySubscribers(t,e){const r=this._subscriptions.get(t);if(r)for(const i of r)i(t,e)}remove(t){this._store.delete(t)}}let yS;class vS{config;objectStore;networkNode;constructor(t){this.config=t,yS=new y.V("drp::node",t?.log_config),this.networkNode=new uS(t?.network_config),this.objectStore=new bS}async start(){await this.networkNode.start(),this.networkNode.addMessageHandler((async({stream:t})=>dS(this,t)))}addCustomGroup(t){this.networkNode.subscribe(t)}addCustomGroupMessageHandler(t,e){this.networkNode.addGroupMessageHandler(t,e)}sendGroupMessage(t,e){const r=tS.create({sender:this.networkNode.peerId,type:J_.MESSAGE_TYPE_CUSTOM,data:e});this.networkNode.broadcastMessage(t,r)}addCustomMessageHandler(t,e){this.networkNode.addCustomMessageHandler(t,e)}sendCustomMessage(t,e,r){const i=tS.create({sender:this.networkNode.peerId,type:J_.MESSAGE_TYPE_CUSTOM,data:r});this.networkNode.sendMessage(t,i)}async createObject(t,e,r,i,n){const s=new lS.DRPObject(this.networkNode.peerId,t,e,r);return function(t,e){t.objectStore.put(e.id,e),e.subscribe(((e,r,i)=>function(t,e,r,i){switch(r){case"merge":t.objectStore.put(e.id,e);break;case"callFn":{t.objectStore.put(e.id,e);const r=tS.create({sender:t.networkNode.peerId,type:J_.MESSAGE_TYPE_UPDATE,data:eS.encode(eS.create({objectId:e.id,vertices:i})).finish()});t.networkNode.broadcastMessage(e.id,r);break}default:yS.error("::createObject: Invalid origin function")}}(t,e,r,i)))}(this,s),mS(this,s.id),i&&gS(this,s.id,n),s}async subscribeObject(t){return mS(this,t)}unsubscribeObject(t,e){!function(t,e,r){t.networkNode.unsubscribe(e),r&&t.objectStore.remove(e)}(this,t,e)}async syncObject(t,e){gS(this,t,e)}async signVertexOperation(t){if(t.nodeId!==this.networkNode.peerId)return yS.error("::signVertexOperation: Invalid peer id"),"";t.signature=await this.networkNode.sign(JSON.stringify(t.operation))}}},1132:(t,e,r)=>{"use strict";r.r(e),r.d(e,{ActionType:()=>o,DRPObject:()=>T,DepthFirstSearchState:()=>n,HashGraph:()=>d,ObjectPb:()=>i,OperationType:()=>s,SemanticsType:()=>a,log:()=>C});var i={};r.r(i),r.d(i,{DRPObjectBase:()=>A,Vertex:()=>E,Vertex_Operation:()=>k,protobufPackage:()=>S});var n,s,o,a,h=r(1565),u=r(3280);class c{set;constructor(t=[]){this.set={};for(const e of t)this.set[e]=!0}add(t){this.set[t]=!0}delete(t){delete this.set[t]}has(t){return!0===this.set[t]}entries(){return Object.keys(this.set)}}class l{data;constructor(t=1){this.data=new Uint32Array(t)}clear(){this.data=new Uint32Array(this.data.length)}set(t,e){const r=t/32|0,i=t%32;e?this.data[r]|=1<<i:this.data[r]&=~(1<<i)}get(t){const e=t/32|0,r=t%32;return!!(this.data[e]&1<<r)}flip(t){const e=t/32|0,r=t%32;this.data[e]^=1<<r}and(t){const e=new l(this.data.length);for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]&t.data[r];return e}or(t){const e=new l(this.data.length);for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]|t.data[r];return e}xor(t){const e=new l(this.data.length);for(let r=0;r<this.data.length;r++)e.data[r]=this.data[r]^t.data[r];return e}not(){const t=new l(32*this.data.length);for(let e=0;e<this.data.length;e++)t.data[e]=~this.data[e];return t}toString(){return Array.from(this.data).reverse().map((t=>t.toString(2).padStart(32,"0"))).join("")}findNext(t,e){let r=Math.floor((t+1)/32),i=~((1<<(t+1)%32)-1);for(;r<this.data.length;){let t=this.data[r];if(0===e&&(t=~t),t&=i,0!==t)return 32*r+31-Math.clz32(t&-t);r++,i=-1}return 32*this.data.length}}!function(t){t[t.UNVISITED=0]="UNVISITED",t[t.VISITING=1]="VISITING",t[t.VISITED=2]="VISITED"}(n||(n={})),function(t){t.NOP="-1"}(s||(s={})),function(t){t[t.DropLeft=0]="DropLeft",t[t.DropRight=1]="DropRight",t[t.Nop=2]="Nop",t[t.Swap=3]="Swap",t[t.Drop=4]="Drop"}(o||(o={})),function(t){t[t.pair=0]="pair",t[t.multiple=1]="multiple"}(a||(a={}));class d{nodeId;resolveConflicts;semanticsType;vertices=new Map;frontier=[];forwardEdges=new Map;static rootHash="02465e287e3d086f12c6edd856953ca5ad0f01d6707bf8e410b4a601314c1ca5";arePredecessorsFresh=!1;reachablePredecessors=new Map;topoSortedIndex=new Map;vertexDistances=new Map;currentBitsetSize=1;constructor(t,e,r){this.nodeId=t,this.resolveConflicts=e,this.semanticsType=r;const i={hash:d.rootHash,nodeId:"",operation:{type:s.NOP,value:null},dependencies:[],signature:""};this.vertices.set(d.rootHash,i),this.frontier.push(d.rootHash),this.forwardEdges.set(d.rootHash,[]),this.vertexDistances.set(d.rootHash,{distance:0})}addToFrontier(t){const e=this.getFrontier(),r=f(this.nodeId,t,e),i={hash:r,nodeId:this.nodeId,operation:t??{type:s.NOP},dependencies:e,signature:""};this.vertices.set(r,i),this.frontier.push(r);for(const t of e)this.forwardEdges.has(t)||this.forwardEdges.set(t,[]),this.forwardEdges.get(t)?.push(r);const n={distance:Number.MAX_VALUE,closestDependency:""};for(const t of e){const e=this.vertexDistances.get(t);e&&e.distance+1<n.distance&&(n.distance=e.distance+1,n.closestDependency=t)}this.vertexDistances.set(r,n);const o=new Set(e);return this.frontier=this.frontier.filter((t=>!o.has(t))),this.arePredecessorsFresh=!1,i}addVertex(t,e,r,i){const n=f(r,t,e);if(this.vertices.has(n))return n;if(!e.every((t=>this.forwardEdges.has(t)||this.vertices.has(t))))throw new Error("Invalid dependency detected.");const s={hash:n,nodeId:r,operation:t,dependencies:e,signature:i};this.vertices.set(n,s),this.frontier.push(n);for(const t of e)this.forwardEdges.has(t)||this.forwardEdges.set(t,[]),this.forwardEdges.get(t)?.push(n);const o={distance:Number.MAX_VALUE,closestDependency:""};for(const t of e){const e=this.vertexDistances.get(t);e&&e.distance+1<o.distance&&(o.distance=e.distance+1,o.closestDependency=t)}this.vertexDistances.set(n,o);const a=new Set(e);return this.frontier=this.frontier.filter((t=>!a.has(t))),this.arePredecessorsFresh=!1,n}depthFirstSearch(t,e,r=new Map){const i=[];for(const t of e.entries())r.set(t,n.UNVISITED);const s=t=>{r.set(t,n.VISITING);const o=this.forwardEdges.get(t)||[];for(const t of o)if(e.has(t)){if(r.get(t)===n.VISITING)return void C.error("::hashgraph::DFS: Cycle detected");if(void 0===r.get(t))return void C.error("::hashgraph::DFS: Undefined child");r.get(t)===n.UNVISITED&&s(t)}i.push(t),r.set(t,n.VISITED)};return s(t),i}topologicalSort(t=!1,e=d.rootHash,r=new c(this.vertices.keys())){const i=this.depthFirstSearch(e,r);if(i.reverse(),!t)return i;for(this.reachablePredecessors.clear(),this.topoSortedIndex.clear();this.currentBitsetSize<i.length;)this.currentBitsetSize*=2;for(let t=0;t<i.length;t++){this.topoSortedIndex.set(i[t],t),this.reachablePredecessors.set(i[t],new l(this.currentBitsetSize));for(const e of this.vertices.get(i[t])?.dependencies||[]){const r=this.reachablePredecessors.get(e);if(r?.set(this.topoSortedIndex.get(e)||0,!0),r){const e=this.reachablePredecessors.get(i[t]);this.reachablePredecessors.set(i[t],e?.or(r)||r)}}}return this.arePredecessorsFresh=!0,i}linearizeOperations(t=d.rootHash,e=new c(this.vertices.keys())){switch(this.semanticsType){case a.pair:return function(t,e,r){const i=t.topologicalSort(!0,e,r),n=new Array(i.length).fill(!1),s=[];let a=1;for(;a<i.length;){if(n[a]){a++;continue}const e=i[a];let r=a+1;for(;r<i.length;){if(t.areCausallyRelatedUsingBitsets(e,i[r])||n[r]){r++;continue}const s=i[r],h=t.vertices.get(e),u=t.vertices.get(s);let c;switch(c=h&&u?t.resolveConflicts([h,u]).action:o.Nop,c){case o.DropLeft:n[a]=!0,r=i.length;break;case o.DropRight:n[r]=!0,r++;break;case o.Swap:[i[a],i[r]]=[i[r],i[a]],r=a+1;break;case o.Nop:r++}}if(!n[a]){const e=t.vertices.get(i[a])?.operation;e&&null!==e.value&&s.push(e)}a++}return s}(this,t,e);case a.multiple:return function(t,e,r){const i=t.topologicalSort(!0,e,r),n=new Array(i.length).fill(!1),s=new Map,a=[];let h=1;for(;h<i.length;){if(n[h]){h++;continue}const e=i[h];let r=h+1;for(;r<i.length;){if(t.areCausallyRelatedUsingBitsets(e,i[r])||n[r]){r++;continue}const a=i[r],u=[];u.push(e),s.set(e,h),u.push(a),s.set(a,r);let c=r+1;for(;c<i.length;){if(n[c]){c++;continue}let e=!0;for(const r of u)if(t.areCausallyRelatedUsingBitsets(r,i[c])){e=!1;break}e&&(u.push(i[c]),s.set(i[c],c)),c++}const l=t.resolveConflicts(u.map((e=>t.vertices.get(e))));switch(l.action){case o.Drop:for(const t of l.vertices||[])n[s.get(t)||-1]=!0;n[h]&&(r=i.length);break;case o.Nop:r++}}if(!n[h]){const e=t.vertices.get(i[h])?.operation;e&&null!==e.value&&a.push(e)}h++}return a}(this,t,e);default:return[]}}lowestCommonAncestorMultipleVertices(t,e){if(0===t.length)throw new Error("Vertex dependencies are empty");if(1===t.length)return e.add(t[0]),t[0];let r=t[0];const i=[...t];for(let t=1;t<i.length;t++){if(!r)throw new Error("LCA not found");e.has(i[t])||(r=this.lowestCommonAncestorPairVertices(r,i[t],e,i))}if(!r)throw new Error("LCA not found");return r}lowestCommonAncestorPairVertices(t,e,r,i){let n=t,s=e;for(r.add(n),r.add(s);n!==s;){const t=this.vertexDistances.get(n);if(!t)return void C.error("::hashgraph::LCA: Vertex not found");const e=this.vertexDistances.get(s);if(!e)return void C.error("::hashgraph::LCA: Vertex not found");if(t.distance>e.distance){if(!t.closestDependency)return void C.error("::hashgraph::LCA: Closest dependency not found");for(const e of this.vertices.get(n)?.dependencies||[])e===t.closestDependency||r.has(e)||i.push(e);if(n=t.closestDependency,r.has(n))return s;r.add(n)}else{if(!e.closestDependency)return void C.error("::hashgraph::LCA: Closest dependency not found");for(const t of this.vertices.get(s)?.dependencies||[])t===e.closestDependency||r.has(t)||i.push(t);if(s=e.closestDependency,r.has(s))return n;r.add(s)}}return n}areCausallyRelatedUsingBitsets(t,e){this.arePredecessorsFresh||this.topologicalSort(!0);const r=this.reachablePredecessors.get(t)?.get(this.topoSortedIndex.get(e)||0)||!1,i=this.reachablePredecessors.get(e)?.get(this.topoSortedIndex.get(t)||0)||!1;return r||i}_areCausallyRelatedUsingBFS(t,e){const r=new Set,i=[];let n=0;for(i.push(t);n<i.length;){const t=i[n];if(n++,t===e)return!0;if(void 0===t)continue;r.add(t);const s=this.vertices.get(t);if(s){for(const t of s.dependencies)r.has(t)||i.push(t);n>i.length/2&&(i.splice(0,n),n=0)}}return!1}selfCheckConstraints(){const t=new Map;for(const e of this.getAllVertices()){const r=e.hash;t.set(r,0)}for(const[e,r]of this.forwardEdges)for(const e of r)t.set(e,(t.get(e)||0)+1);for(const e of this.getAllVertices()){const r=e.hash;if(t.get(r)!==e.dependencies.length)return!1;if(0===e.dependencies.length&&r!==d.rootHash)return!1}const e=new Map;this.depthFirstSearch(d.rootHash,new c(this.vertices.keys()),e);for(const t of this.getAllVertices())if(!e.has(t.hash))return!1;return!0}findNextCausallyUnrelated(t,e){return this.reachablePredecessors.get(t)?.findNext(e,0)}areCausallyRelatedUsingBFS(t,e){return this._areCausallyRelatedUsingBFS(t,e)||this._areCausallyRelatedUsingBFS(e,t)}getFrontier(){return Array.from(this.frontier)}getDependencies(t){return Array.from(this.vertices.get(t)?.dependencies||[])}getVertex(t){return this.vertices.get(t)}getAllVertices(){return Array.from(this.vertices.values())}getReachablePredecessors(t){return this.reachablePredecessors.get(t)}getCurrentBitsetSize(){return this.currentBitsetSize}}function f(t,e,r){const i=JSON.stringify({operation:e,deps:r,nodeId:t});return h.n1("sha256").update(i).digest("hex")}var p,m=r(2186);function g(t){switch(t){case 0:case"NULL_VALUE":return p.NULL_VALUE;default:return p.UNRECOGNIZED}}!function(t){t[t.NULL_VALUE=0]="NULL_VALUE",t[t.UNRECOGNIZED=-1]="UNRECOGNIZED"}(p||(p={}));const b={encode:(t,e=new m.fI)=>(Object.entries(t.fields).forEach((([t,r])=>{void 0!==r&&y.encode({key:t,value:r},e.uint32(10).fork()).join()})),e),decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={fields:{}};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:{if(10!==t)break;const e=y.decode(r,r.uint32());void 0!==e.value&&(n.fields[e.key]=e.value);continue}}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({fields:M(t.fields)?Object.entries(t.fields).reduce(((t,[e,r])=>(t[e]=r,t)),{}):{}}),toJSON(t){const e={};if(t.fields){const r=Object.entries(t.fields);r.length>0&&(e.fields={},r.forEach((([t,r])=>{e.fields[t]=r})))}return e},create:t=>b.fromPartial(t??{}),fromPartial(t){const e={fields:{}};return e.fields=Object.entries(t.fields??{}).reduce(((t,[e,r])=>(void 0!==r&&(t[e]=r),t)),{}),e},wrap(t){const e={fields:{}};if(void 0!==t)for(const r of Object.keys(t))e.fields[r]=t[r];return e},unwrap(t){const e={};if(t.fields)for(const r of Object.keys(t.fields))e[r]=t.fields[r];return e}},y={encode:(t,e=new m.fI)=>(""!==t.key&&e.uint32(10).string(t.key),void 0!==t.value&&v.encode(v.wrap(t.value),e.uint32(18).fork()).join(),e),decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={key:"",value:void 0};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.key=r.string();continue;case 2:if(18!==t)break;n.value=v.unwrap(v.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({key:_(t.key)?globalThis.String(t.key):"",value:_(t?.value)?t.value:void 0}),toJSON(t){const e={};return""!==t.key&&(e.key=t.key),void 0!==t.value&&(e.value=t.value),e},create:t=>y.fromPartial(t??{}),fromPartial(t){const e={key:"",value:void 0};return e.key=t.key??"",e.value=t.value??void 0,e}},v={encode:(t,e=new m.fI)=>(void 0!==t.nullValue&&e.uint32(8).int32(t.nullValue),void 0!==t.numberValue&&e.uint32(17).double(t.numberValue),void 0!==t.stringValue&&e.uint32(26).string(t.stringValue),void 0!==t.boolValue&&e.uint32(32).bool(t.boolValue),void 0!==t.structValue&&b.encode(b.wrap(t.structValue),e.uint32(42).fork()).join(),void 0!==t.listValue&&w.encode(w.wrap(t.listValue),e.uint32(50).fork()).join(),e),decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(8!==t)break;n.nullValue=r.int32();continue;case 2:if(17!==t)break;n.numberValue=r.double();continue;case 3:if(26!==t)break;n.stringValue=r.string();continue;case 4:if(32!==t)break;n.boolValue=r.bool();continue;case 5:if(42!==t)break;n.structValue=b.unwrap(b.decode(r,r.uint32()));continue;case 6:if(50!==t)break;n.listValue=w.unwrap(w.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({nullValue:_(t.nullValue)?g(t.nullValue):void 0,numberValue:_(t.numberValue)?globalThis.Number(t.numberValue):void 0,stringValue:_(t.stringValue)?globalThis.String(t.stringValue):void 0,boolValue:_(t.boolValue)?globalThis.Boolean(t.boolValue):void 0,structValue:M(t.structValue)?t.structValue:void 0,listValue:globalThis.Array.isArray(t.listValue)?[...t.listValue]:void 0}),toJSON(t){const e={};return void 0!==t.nullValue&&(e.nullValue=function(t){switch(t){case p.NULL_VALUE:return"NULL_VALUE";case p.UNRECOGNIZED:default:return"UNRECOGNIZED"}}(t.nullValue)),void 0!==t.numberValue&&(e.numberValue=t.numberValue),void 0!==t.stringValue&&(e.stringValue=t.stringValue),void 0!==t.boolValue&&(e.boolValue=t.boolValue),void 0!==t.structValue&&(e.structValue=t.structValue),void 0!==t.listValue&&(e.listValue=t.listValue),e},create:t=>v.fromPartial(t??{}),fromPartial(t){const e={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};return e.nullValue=t.nullValue??void 0,e.numberValue=t.numberValue??void 0,e.stringValue=t.stringValue??void 0,e.boolValue=t.boolValue??void 0,e.structValue=t.structValue??void 0,e.listValue=t.listValue??void 0,e},wrap(t){const e={nullValue:void 0,numberValue:void 0,stringValue:void 0,boolValue:void 0,structValue:void 0,listValue:void 0};if(null===t)e.nullValue=p.NULL_VALUE;else if("boolean"==typeof t)e.boolValue=t;else if("number"==typeof t)e.numberValue=t;else if("string"==typeof t)e.stringValue=t;else if(globalThis.Array.isArray(t))e.listValue=t;else if("object"==typeof t)e.structValue=t;else if(void 0!==t)throw new globalThis.Error("Unsupported any value type: "+typeof t);return e},unwrap:t=>void 0!==t.stringValue?t.stringValue:void 0!==t?.numberValue?t.numberValue:void 0!==t?.boolValue?t.boolValue:void 0!==t?.structValue?t.structValue:void 0!==t?.listValue?t.listValue:void 0!==t?.nullValue?null:void 0},w={encode(t,e=new m.fI){for(const r of t.values)v.encode(v.wrap(r),e.uint32(10).fork()).join();return e},decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={values:[]};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.values.push(v.unwrap(v.decode(r,r.uint32())));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({values:globalThis.Array.isArray(t?.values)?[...t.values]:[]}),toJSON(t){const e={};return t.values?.length&&(e.values=t.values),e},create:t=>w.fromPartial(t??{}),fromPartial(t){const e={values:[]};return e.values=t.values?.map((t=>t))||[],e},wrap(t){const e={values:[]};return e.values=t??[],e},unwrap:t=>t?.hasOwnProperty("values")&&globalThis.Array.isArray(t.values)?t.values:t};function M(t){return"object"==typeof t&&null!==t}function _(t){return null!=t}const S="drp.object.v1",E={encode(t,e=new m.fI){""!==t.hash&&e.uint32(10).string(t.hash),""!==t.nodeId&&e.uint32(18).string(t.nodeId),void 0!==t.operation&&k.encode(t.operation,e.uint32(26).fork()).join();for(const r of t.dependencies)e.uint32(34).string(r);return""!==t.signature&&e.uint32(42).string(t.signature),e},decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={hash:"",nodeId:"",operation:void 0,dependencies:[],signature:""};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.hash=r.string();continue;case 2:if(18!==t)break;n.nodeId=r.string();continue;case 3:if(26!==t)break;n.operation=k.decode(r,r.uint32());continue;case 4:if(34!==t)break;n.dependencies.push(r.string());continue;case 5:if(42!==t)break;n.signature=r.string();continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({hash:x(t.hash)?globalThis.String(t.hash):"",nodeId:x(t.nodeId)?globalThis.String(t.nodeId):"",operation:x(t.operation)?k.fromJSON(t.operation):void 0,dependencies:globalThis.Array.isArray(t?.dependencies)?t.dependencies.map((t=>globalThis.String(t))):[],signature:x(t.signature)?globalThis.String(t.signature):""}),toJSON(t){const e={};return""!==t.hash&&(e.hash=t.hash),""!==t.nodeId&&(e.nodeId=t.nodeId),void 0!==t.operation&&(e.operation=k.toJSON(t.operation)),t.dependencies?.length&&(e.dependencies=t.dependencies),""!==t.signature&&(e.signature=t.signature),e},create:t=>E.fromPartial(t??{}),fromPartial(t){const e={hash:"",nodeId:"",operation:void 0,dependencies:[],signature:""};return e.hash=t.hash??"",e.nodeId=t.nodeId??"",e.operation=void 0!==t.operation&&null!==t.operation?k.fromPartial(t.operation):void 0,e.dependencies=t.dependencies?.map((t=>t))||[],e.signature=t.signature??"",e}},k={encode:(t,e=new m.fI)=>(""!==t.type&&e.uint32(10).string(t.type),void 0!==t.value&&v.encode(v.wrap(t.value),e.uint32(18).fork()).join(),e),decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={type:"",value:void 0};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.type=r.string();continue;case 2:if(18!==t)break;n.value=v.unwrap(v.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({type:x(t.type)?globalThis.String(t.type):"",value:x(t?.value)?t.value:void 0}),toJSON(t){const e={};return""!==t.type&&(e.type=t.type),void 0!==t.value&&(e.value=t.value),e},create:t=>k.fromPartial(t??{}),fromPartial(t){const e={type:"",value:void 0};return e.type=t.type??"",e.value=t.value??void 0,e}},A={encode(t,e=new m.fI){""!==t.id&&e.uint32(10).string(t.id),void 0!==t.abi&&e.uint32(18).string(t.abi),void 0!==t.bytecode&&e.uint32(26).bytes(t.bytecode);for(const r of t.vertices)E.encode(r,e.uint32(34).fork()).join();return e},decode(t,e){const r=t instanceof m.V5?t:new m.V5(t);let i=void 0===e?r.len:r.pos+e;const n={id:"",abi:void 0,bytecode:void 0,vertices:[]};for(;r.pos<i;){const t=r.uint32();switch(t>>>3){case 1:if(10!==t)break;n.id=r.string();continue;case 2:if(18!==t)break;n.abi=r.string();continue;case 3:if(26!==t)break;n.bytecode=r.bytes();continue;case 4:if(34!==t)break;n.vertices.push(E.decode(r,r.uint32()));continue}if(4==(7&t)||0===t)break;r.skip(7&t)}return n},fromJSON:t=>({id:x(t.id)?globalThis.String(t.id):"",abi:x(t.abi)?globalThis.String(t.abi):void 0,bytecode:x(t.bytecode)?I(t.bytecode):void 0,vertices:globalThis.Array.isArray(t?.vertices)?t.vertices.map((t=>E.fromJSON(t))):[]}),toJSON(t){const e={};return""!==t.id&&(e.id=t.id),void 0!==t.abi&&(e.abi=t.abi),void 0!==t.bytecode&&(e.bytecode=function(t){if(globalThis.Buffer)return globalThis.Buffer.from(t).toString("base64");{const e=[];return t.forEach((t=>{e.push(globalThis.String.fromCharCode(t))})),globalThis.btoa(e.join(""))}}(t.bytecode)),t.vertices?.length&&(e.vertices=t.vertices.map((t=>E.toJSON(t)))),e},create:t=>A.fromPartial(t??{}),fromPartial(t){const e={id:"",abi:void 0,bytecode:void 0,vertices:[]};return e.id=t.id??"",e.abi=t.abi??void 0,e.bytecode=t.bytecode??void 0,e.vertices=t.vertices?.map((t=>E.fromPartial(t)))||[],e}};function I(t){if(globalThis.Buffer)return Uint8Array.from(globalThis.Buffer.from(t,"base64"));{const e=globalThis.atob(t),r=new Uint8Array(e.length);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return r}}function x(t){return null!=t}let C;class T{nodeId;id;abi;bytecode;vertices;drp;hashGraph;states;originalDRP;subscriptions;constructor(t,e,r,i,n){this.nodeId=t,C=new u.V("drp::object",n?.log_config),this.id=r??h.n1("sha256").update(i??"").update(t).update(Math.floor(Math.random()*Number.MAX_VALUE).toString()).digest("hex"),this.abi=i??"",this.bytecode=new Uint8Array,this.vertices=[],this.drp=e?new Proxy(e,this.proxyDRPHandler()):null,this.hashGraph=new d(t,e?.resolveConflicts?.bind(e??this),e?.semanticsType),this.subscriptions=[],this.states=new Map([[d.rootHash,{state:new Map}]]),this.originalDRP=Object.create(Object.getPrototypeOf(e),Object.getOwnPropertyDescriptors(structuredClone(e))),this.vertices=this.hashGraph.getAllVertices()}proxyDRPHandler(){const t=this;return{get:(e,r,i)=>"function"==typeof e[r]?new Proxy(e[r],{apply:(e,i,n)=>(i.operations.includes(r)&&t.callFn(r,1===n.length?n[0]:n),Reflect.apply(e,i,n))}):Reflect.get(e,r,i)}}callFn(t,e){const r=this.hashGraph.addToFrontier({type:t,value:e});this._setState(r);const i=E.create({hash:r.hash,nodeId:r.nodeId,operation:r.operation,dependencies:r.dependencies});this.vertices.push(i),this._notify("callFn",[i])}merge(t){const e=[];for(const r of t)if(r.operation&&!this.hashGraph.vertices.has(r.hash))try{this.hashGraph.addVertex(r.operation,r.dependencies,r.nodeId,r.signature),this._setState(r)}catch(t){e.push(r.hash)}return this.vertices=this.hashGraph.getAllVertices(),this._updateDRPState(),this._notify("merge",this.vertices),[0===e.length,e]}subscribe(t){this.subscriptions.push(t)}_notify(t,e){for(const r of this.subscriptions)r(this,t,e)}_computeState(t,e){const r=new c,i=1===t.length?t[0]:this.hashGraph.lowestCommonAncestorMultipleVertices(t,r),n=1===t.length?[]:this.hashGraph.linearizeOperations(i,r),s=Object.create(Object.getPrototypeOf(this.originalDRP),Object.getOwnPropertyDescriptors(structuredClone(this.originalDRP))),o=this.states.get(i);if(!o)throw new Error("State is undefined");const a=structuredClone(o);for(const[t,e]of a.state)s[t]=e;for(const t of n){const e=Array.isArray(t.value)?t.value:[t.value];s[t.type](...e)}if(e){const t=Array.isArray(e.value)?e.value:[e.value];s[e.type](...t)}const h=Object.keys(s),u=new Map;for(const t of h)u.set(t,s[t]);return u}_setState(t){const e=this._computeState(t.dependencies,t.operation);this.states.set(t.hash,{state:e})}_updateDRPState(){if(!this.drp)return;const t=this.drp,e=this._computeState(this.hashGraph.getFrontier());for(const[r,i]of e.entries())r in t&&"function"!=typeof t[r]&&(t[r]=i)}}},3219:t=>{"use strict";t.exports=JSON.parse('{"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}')},2951:t=>{"use strict";t.exports=JSON.parse('{"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}')},4589:t=>{"use strict";t.exports=JSON.parse('{"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}')},3241:t=>{"use strict";t.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')},1636:t=>{"use strict";t.exports={rE:"6.6.1"}},5579:t=>{"use strict";t.exports=JSON.parse('{"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}')}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t].call(r.exports,r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.d=(t,e)=>{for(var r in e)__webpack_require__.o(e,r)&&!__webpack_require__.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var __webpack_exports__=__webpack_require__(1481)})();